const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/raw-in9isEBO.js","assets/basedecoder-B2c5_Eok.js","assets/lzw-_aCqfs4w.js","assets/jpeg-CKYXsxFN.js","assets/deflate-B9JhHpvg.js","assets/pako.esm-Cram60i4.js","assets/packbits-DDWKfGV_.js","assets/lerc-DjPtvjVj.js","assets/webimage-DBgUwIbt.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();/**
* @vue/shared v3.5.20
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Kc(i){const e=Object.create(null);for(const t of i.split(","))e[t]=1;return t=>t in e}const De={},ps=[],gi=()=>{},Mf=()=>!1,va=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&(i.charCodeAt(2)>122||i.charCodeAt(2)<97),Yc=i=>i.startsWith("onUpdate:"),Tt=Object.assign,$c=(i,e)=>{const t=i.indexOf(e);t>-1&&i.splice(t,1)},Xm=Object.prototype.hasOwnProperty,Fe=(i,e)=>Xm.call(i,e),de=Array.isArray,ys=i=>Ia(i)==="[object Map]",Ff=i=>Ia(i)==="[object Set]",ye=i=>typeof i=="function",$e=i=>typeof i=="string",mn=i=>typeof i=="symbol",Xe=i=>i!==null&&typeof i=="object",Df=i=>(Xe(i)||ye(i))&&ye(i.then)&&ye(i.catch),Of=Object.prototype.toString,Ia=i=>Of.call(i),jm=i=>Ia(i).slice(8,-1),Gf=i=>Ia(i)==="[object Object]",Hc=i=>$e(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,Tr=Kc(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ba=i=>{const e=Object.create(null);return t=>e[t]||(e[t]=i(t))},zm=/-(\w)/g,ln=ba(i=>i.replace(zm,(e,t)=>t?t.toUpperCase():"")),Vm=/\B([A-Z])/g,pn=ba(i=>i.replace(Vm,"-$1").toLowerCase()),Nf=ba(i=>i.charAt(0).toUpperCase()+i.slice(1)),ul=ba(i=>i?`on${Nf(i)}`:""),rn=(i,e)=>!Object.is(i,e),qo=(i,...e)=>{for(let t=0;t<i.length;t++)i[t](...e)},kf=(i,e,t,n=!1)=>{Object.defineProperty(i,e,{configurable:!0,enumerable:!1,writable:n,value:t})},oc=i=>{const e=parseFloat(i);return isNaN(e)?i:e};let vu;const Aa=()=>vu||(vu=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Zc(i){if(de(i)){const e={};for(let t=0;t<i.length;t++){const n=i[t],s=$e(n)?$m(n):Zc(n);if(s)for(const r in s)e[r]=s[r]}return e}else if($e(i)||Xe(i))return i}const Wm=/;(?![^(]*\))/g,Km=/:([^]+)/,Ym=/\/\*[^]*?\*\//g;function $m(i){const e={};return i.replace(Ym,"").split(Wm).forEach(t=>{if(t){const n=t.split(Km);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function Pa(i){let e="";if($e(i))e=i;else if(de(i))for(let t=0;t<i.length;t++){const n=Pa(i[t]);n&&(e+=n+" ")}else if(Xe(i))for(const t in i)i[t]&&(e+=t+" ");return e.trim()}const Hm="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Zm=Kc(Hm);function Uf(i){return!!i||i===""}const Bf=i=>!!(i&&i.__v_isRef===!0),zt=i=>$e(i)?i:i==null?"":de(i)||Xe(i)&&(i.toString===Of||!ye(i.toString))?Bf(i)?zt(i.value):JSON.stringify(i,Xf,2):String(i),Xf=(i,e)=>Bf(e)?Xf(i,e.value):ys(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[n,s],r)=>(t[dl(n,r)+" =>"]=s,t),{})}:Ff(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>dl(t))}:mn(e)?dl(e):Xe(e)&&!de(e)&&!Gf(e)?String(e):e,dl=(i,e="")=>{var t;return mn(i)?`Symbol(${(t=i.description)!=null?t:e})`:i};/**
* @vue/reactivity v3.5.20
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let It;class qm{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=It,!e&&It&&(this.index=(It.scopes||(It.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=It;try{return It=this,e()}finally{It=t}}}on(){++this._on===1&&(this.prevScope=It,It=this)}off(){this._on>0&&--this._on===0&&(It=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,n;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(this.effects.length=0,t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function Jm(){return It}let Ne;const fl=new WeakSet;class jf{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,It&&It.active&&It.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,fl.has(this)&&(fl.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Vf(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Iu(this),Wf(this);const e=Ne,t=ti;Ne=this,ti=!0;try{return this.fn()}finally{Kf(this),Ne=e,ti=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Qc(e);this.deps=this.depsTail=void 0,Iu(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?fl.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){ac(this)&&this.run()}get dirty(){return ac(this)}}let zf=0,Cr,wr;function Vf(i,e=!1){if(i.flags|=8,e){i.next=wr,wr=i;return}i.next=Cr,Cr=i}function qc(){zf++}function Jc(){if(--zf>0)return;if(wr){let e=wr;for(wr=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let i;for(;Cr;){let e=Cr;for(Cr=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(n){i||(i=n)}e=t}}if(i)throw i}function Wf(i){for(let e=i.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Kf(i){let e,t=i.depsTail,n=t;for(;n;){const s=n.prevDep;n.version===-1?(n===t&&(t=s),Qc(n),Qm(n)):e=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=s}i.deps=e,i.depsTail=t}function ac(i){for(let e=i.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Yf(e.dep.computed)||e.dep.version!==e.version))return!0;return!!i._dirty}function Yf(i){if(i.flags&4&&!(i.flags&16)||(i.flags&=-17,i.globalVersion===Dr)||(i.globalVersion=Dr,!i.isSSR&&i.flags&128&&(!i.deps&&!i._dirty||!ac(i))))return;i.flags|=2;const e=i.dep,t=Ne,n=ti;Ne=i,ti=!0;try{Wf(i);const s=i.fn(i._value);(e.version===0||rn(s,i._value))&&(i.flags|=128,i._value=s,e.version++)}catch(s){throw e.version++,s}finally{Ne=t,ti=n,Kf(i),i.flags&=-3}}function Qc(i,e=!1){const{dep:t,prevSub:n,nextSub:s}=i;if(n&&(n.nextSub=s,i.prevSub=void 0),s&&(s.prevSub=n,i.nextSub=void 0),t.subs===i&&(t.subs=n,!n&&t.computed)){t.computed.flags&=-5;for(let r=t.computed.deps;r;r=r.nextDep)Qc(r,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function Qm(i){const{prevDep:e,nextDep:t}=i;e&&(e.nextDep=t,i.prevDep=void 0),t&&(t.prevDep=e,i.nextDep=void 0)}let ti=!0;const $f=[];function Ui(){$f.push(ti),ti=!1}function Bi(){const i=$f.pop();ti=i===void 0?!0:i}function Iu(i){const{cleanup:e}=i;if(i.cleanup=void 0,e){const t=Ne;Ne=void 0;try{e()}finally{Ne=t}}}let Dr=0;class ep{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class eh{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Ne||!ti||Ne===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Ne)t=this.activeLink=new ep(Ne,this),Ne.deps?(t.prevDep=Ne.depsTail,Ne.depsTail.nextDep=t,Ne.depsTail=t):Ne.deps=Ne.depsTail=t,Hf(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const n=t.nextDep;n.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=n),t.prevDep=Ne.depsTail,t.nextDep=void 0,Ne.depsTail.nextDep=t,Ne.depsTail=t,Ne.deps===t&&(Ne.deps=n)}return t}trigger(e){this.version++,Dr++,this.notify(e)}notify(e){qc();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Jc()}}}function Hf(i){if(i.dep.sc++,i.sub.flags&4){const e=i.dep.computed;if(e&&!i.dep.subs){e.flags|=20;for(let n=e.deps;n;n=n.nextDep)Hf(n)}const t=i.dep.subs;t!==i&&(i.prevSub=t,t&&(t.nextSub=i)),i.dep.subs=i}}const lc=new WeakMap,Gn=Symbol(""),cc=Symbol(""),Or=Symbol("");function at(i,e,t){if(ti&&Ne){let n=lc.get(i);n||lc.set(i,n=new Map);let s=n.get(t);s||(n.set(t,s=new eh),s.map=n,s.key=t),s.track()}}function Fi(i,e,t,n,s,r){const o=lc.get(i);if(!o){Dr++;return}const a=l=>{l&&l.trigger()};if(qc(),e==="clear")o.forEach(a);else{const l=de(i),h=l&&Hc(t);if(l&&t==="length"){const c=Number(n);o.forEach((u,d)=>{(d==="length"||d===Or||!mn(d)&&d>=c)&&a(u)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),h&&a(o.get(Or)),e){case"add":l?h&&a(o.get("length")):(a(o.get(Gn)),ys(i)&&a(o.get(cc)));break;case"delete":l||(a(o.get(Gn)),ys(i)&&a(o.get(cc)));break;case"set":ys(i)&&a(o.get(Gn));break}}Jc()}function Kn(i){const e=Me(i);return e===i?e:(at(e,"iterate",Or),Kt(i)?e:e.map(it))}function La(i){return at(i=Me(i),"iterate",Or),i}const tp={__proto__:null,[Symbol.iterator](){return gl(this,Symbol.iterator,it)},concat(...i){return Kn(this).concat(...i.map(e=>de(e)?Kn(e):e))},entries(){return gl(this,"entries",i=>(i[1]=it(i[1]),i))},every(i,e){return vi(this,"every",i,e,void 0,arguments)},filter(i,e){return vi(this,"filter",i,e,t=>t.map(it),arguments)},find(i,e){return vi(this,"find",i,e,it,arguments)},findIndex(i,e){return vi(this,"findIndex",i,e,void 0,arguments)},findLast(i,e){return vi(this,"findLast",i,e,it,arguments)},findLastIndex(i,e){return vi(this,"findLastIndex",i,e,void 0,arguments)},forEach(i,e){return vi(this,"forEach",i,e,void 0,arguments)},includes(...i){return _l(this,"includes",i)},indexOf(...i){return _l(this,"indexOf",i)},join(i){return Kn(this).join(i)},lastIndexOf(...i){return _l(this,"lastIndexOf",i)},map(i,e){return vi(this,"map",i,e,void 0,arguments)},pop(){return sr(this,"pop")},push(...i){return sr(this,"push",i)},reduce(i,...e){return bu(this,"reduce",i,e)},reduceRight(i,...e){return bu(this,"reduceRight",i,e)},shift(){return sr(this,"shift")},some(i,e){return vi(this,"some",i,e,void 0,arguments)},splice(...i){return sr(this,"splice",i)},toReversed(){return Kn(this).toReversed()},toSorted(i){return Kn(this).toSorted(i)},toSpliced(...i){return Kn(this).toSpliced(...i)},unshift(...i){return sr(this,"unshift",i)},values(){return gl(this,"values",it)}};function gl(i,e,t){const n=La(i),s=n[e]();return n!==i&&!Kt(i)&&(s._next=s.next,s.next=()=>{const r=s._next();return r.value&&(r.value=t(r.value)),r}),s}const ip=Array.prototype;function vi(i,e,t,n,s,r){const o=La(i),a=o!==i&&!Kt(i),l=o[e];if(l!==ip[e]){const u=l.apply(i,r);return a?it(u):u}let h=t;o!==i&&(a?h=function(u,d){return t.call(this,it(u),d,i)}:t.length>2&&(h=function(u,d){return t.call(this,u,d,i)}));const c=l.call(o,h,n);return a&&s?s(c):c}function bu(i,e,t,n){const s=La(i);let r=t;return s!==i&&(Kt(i)?t.length>3&&(r=function(o,a,l){return t.call(this,o,a,l,i)}):r=function(o,a,l){return t.call(this,o,it(a),l,i)}),s[e](r,...n)}function _l(i,e,t){const n=Me(i);at(n,"iterate",Or);const s=n[e](...t);return(s===-1||s===!1)&&nh(t[0])?(t[0]=Me(t[0]),n[e](...t)):s}function sr(i,e,t=[]){Ui(),qc();const n=Me(i)[e].apply(i,t);return Jc(),Bi(),n}const np=Kc("__proto__,__v_isRef,__isVue"),Zf=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(mn));function sp(i){mn(i)||(i=String(i));const e=Me(this);return at(e,"has",i),e.hasOwnProperty(i)}class qf{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,n){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,r=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return r;if(t==="__v_raw")return n===(s?r?gp:tg:r?eg:Qf).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const o=de(e);if(!s){let l;if(o&&(l=tp[t]))return l;if(t==="hasOwnProperty")return sp}const a=Reflect.get(e,t,ct(e)?e:n);return(mn(t)?Zf.has(t):np(t))||(s||at(e,"get",t),r)?a:ct(a)?o&&Hc(t)?a:a.value:Xe(a)?s?ig(a):As(a):a}}class Jf extends qf{constructor(e=!1){super(!1,e)}set(e,t,n,s){let r=e[t];if(!this._isShallow){const l=cn(r);if(!Kt(n)&&!cn(n)&&(r=Me(r),n=Me(n)),!de(e)&&ct(r)&&!ct(n))return l||(r.value=n),!0}const o=de(e)&&Hc(t)?Number(t)<e.length:Fe(e,t),a=Reflect.set(e,t,n,ct(e)?e:s);return e===Me(s)&&(o?rn(n,r)&&Fi(e,"set",t,n):Fi(e,"add",t,n)),a}deleteProperty(e,t){const n=Fe(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&n&&Fi(e,"delete",t,void 0),s}has(e,t){const n=Reflect.has(e,t);return(!mn(t)||!Zf.has(t))&&at(e,"has",t),n}ownKeys(e){return at(e,"iterate",de(e)?"length":Gn),Reflect.ownKeys(e)}}class rp extends qf{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const op=new Jf,ap=new rp,lp=new Jf(!0);const hc=i=>i,xo=i=>Reflect.getPrototypeOf(i);function cp(i,e,t){return function(...n){const s=this.__v_raw,r=Me(s),o=ys(r),a=i==="entries"||i===Symbol.iterator&&o,l=i==="keys"&&o,h=s[i](...n),c=t?hc:e?ia:it;return!e&&at(r,"iterate",l?cc:Gn),{next(){const{value:u,done:d}=h.next();return d?{value:u,done:d}:{value:a?[c(u[0]),c(u[1])]:c(u),done:d}},[Symbol.iterator](){return this}}}}function To(i){return function(...e){return i==="delete"?!1:i==="clear"?void 0:this}}function hp(i,e){const t={get(s){const r=this.__v_raw,o=Me(r),a=Me(s);i||(rn(s,a)&&at(o,"get",s),at(o,"get",a));const{has:l}=xo(o),h=e?hc:i?ia:it;if(l.call(o,s))return h(r.get(s));if(l.call(o,a))return h(r.get(a));r!==o&&r.get(s)},get size(){const s=this.__v_raw;return!i&&at(Me(s),"iterate",Gn),s.size},has(s){const r=this.__v_raw,o=Me(r),a=Me(s);return i||(rn(s,a)&&at(o,"has",s),at(o,"has",a)),s===a?r.has(s):r.has(s)||r.has(a)},forEach(s,r){const o=this,a=o.__v_raw,l=Me(a),h=e?hc:i?ia:it;return!i&&at(l,"iterate",Gn),a.forEach((c,u)=>s.call(r,h(c),h(u),o))}};return Tt(t,i?{add:To("add"),set:To("set"),delete:To("delete"),clear:To("clear")}:{add(s){!e&&!Kt(s)&&!cn(s)&&(s=Me(s));const r=Me(this);return xo(r).has.call(r,s)||(r.add(s),Fi(r,"add",s,s)),this},set(s,r){!e&&!Kt(r)&&!cn(r)&&(r=Me(r));const o=Me(this),{has:a,get:l}=xo(o);let h=a.call(o,s);h||(s=Me(s),h=a.call(o,s));const c=l.call(o,s);return o.set(s,r),h?rn(r,c)&&Fi(o,"set",s,r):Fi(o,"add",s,r),this},delete(s){const r=Me(this),{has:o,get:a}=xo(r);let l=o.call(r,s);l||(s=Me(s),l=o.call(r,s)),a&&a.call(r,s);const h=r.delete(s);return l&&Fi(r,"delete",s,void 0),h},clear(){const s=Me(this),r=s.size!==0,o=s.clear();return r&&Fi(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=cp(s,i,e)}),t}function th(i,e){const t=hp(i,e);return(n,s,r)=>s==="__v_isReactive"?!i:s==="__v_isReadonly"?i:s==="__v_raw"?n:Reflect.get(Fe(t,s)&&s in n?t:n,s,r)}const up={get:th(!1,!1)},dp={get:th(!1,!0)},fp={get:th(!0,!1)};const Qf=new WeakMap,eg=new WeakMap,tg=new WeakMap,gp=new WeakMap;function _p(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function mp(i){return i.__v_skip||!Object.isExtensible(i)?0:_p(jm(i))}function As(i){return cn(i)?i:ih(i,!1,op,up,Qf)}function pp(i){return ih(i,!1,lp,dp,eg)}function ig(i){return ih(i,!0,ap,fp,tg)}function ih(i,e,t,n,s){if(!Xe(i)||i.__v_raw&&!(e&&i.__v_isReactive))return i;const r=mp(i);if(r===0)return i;const o=s.get(i);if(o)return o;const a=new Proxy(i,r===2?n:t);return s.set(i,a),a}function Es(i){return cn(i)?Es(i.__v_raw):!!(i&&i.__v_isReactive)}function cn(i){return!!(i&&i.__v_isReadonly)}function Kt(i){return!!(i&&i.__v_isShallow)}function nh(i){return i?!!i.__v_raw:!1}function Me(i){const e=i&&i.__v_raw;return e?Me(e):i}function yp(i){return!Fe(i,"__v_skip")&&Object.isExtensible(i)&&kf(i,"__v_skip",!0),i}const it=i=>Xe(i)?As(i):i,ia=i=>Xe(i)?ig(i):i;function ct(i){return i?i.__v_isRef===!0:!1}function tn(i){return Ep(i,!1)}function Ep(i,e){return ct(i)?i:new xp(i,e)}class xp{constructor(e,t){this.dep=new eh,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Me(e),this._value=t?e:it(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,n=this.__v_isShallow||Kt(e)||cn(e);e=n?e:Me(e),rn(e,t)&&(this._rawValue=e,this._value=n?e:it(e),this.dep.trigger())}}function Tp(i){return ct(i)?i.value:i}const Cp={get:(i,e,t)=>e==="__v_raw"?i:Tp(Reflect.get(i,e,t)),set:(i,e,t,n)=>{const s=i[e];return ct(s)&&!ct(t)?(s.value=t,!0):Reflect.set(i,e,t,n)}};function ng(i){return Es(i)?i:new Proxy(i,Cp)}class wp{constructor(e,t,n){this.fn=e,this.setter=t,this._value=void 0,this.dep=new eh(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Dr-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&Ne!==this)return Vf(this,!0),!0}get value(){const e=this.dep.track();return Yf(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function Rp(i,e,t=!1){let n,s;return ye(i)?n=i:(n=i.get,s=i.set),new wp(n,s,t)}const Co={},na=new WeakMap;let In;function Sp(i,e=!1,t=In){if(t){let n=na.get(t);n||na.set(t,n=[]),n.push(i)}}function vp(i,e,t=De){const{immediate:n,deep:s,once:r,scheduler:o,augmentJob:a,call:l}=t,h=E=>s?E:Kt(E)||s===!1||s===0?Di(E,1):Di(E);let c,u,d,f,g=!1,_=!1;if(ct(i)?(u=()=>i.value,g=Kt(i)):Es(i)?(u=()=>h(i),g=!0):de(i)?(_=!0,g=i.some(E=>Es(E)||Kt(E)),u=()=>i.map(E=>{if(ct(E))return E.value;if(Es(E))return h(E);if(ye(E))return l?l(E,2):E()})):ye(i)?e?u=l?()=>l(i,2):i:u=()=>{if(d){Ui();try{d()}finally{Bi()}}const E=In;In=c;try{return l?l(i,3,[f]):i(f)}finally{In=E}}:u=gi,e&&s){const E=u,T=s===!0?1/0:s;u=()=>Di(E(),T)}const m=Jm(),y=()=>{c.stop(),m&&m.active&&$c(m.effects,c)};if(r&&e){const E=e;e=(...T)=>{E(...T),y()}}let p=_?new Array(i.length).fill(Co):Co;const x=E=>{if(!(!(c.flags&1)||!c.dirty&&!E))if(e){const T=c.run();if(s||g||(_?T.some((R,I)=>rn(R,p[I])):rn(T,p))){d&&d();const R=In;In=c;try{const I=[T,p===Co?void 0:_&&p[0]===Co?[]:p,f];p=T,l?l(e,3,I):e(...I)}finally{In=R}}}else c.run()};return a&&a(x),c=new jf(u),c.scheduler=o?()=>o(x,!1):x,f=E=>Sp(E,!1,c),d=c.onStop=()=>{const E=na.get(c);if(E){if(l)l(E,4);else for(const T of E)T();na.delete(c)}},e?n?x(!0):p=c.run():o?o(x.bind(null,!0),!0):c.run(),y.pause=c.pause.bind(c),y.resume=c.resume.bind(c),y.stop=y,y}function Di(i,e=1/0,t){if(e<=0||!Xe(i)||i.__v_skip||(t=t||new Set,t.has(i)))return i;if(t.add(i),e--,ct(i))Di(i.value,e,t);else if(de(i))for(let n=0;n<i.length;n++)Di(i[n],e,t);else if(Ff(i)||ys(i))i.forEach(n=>{Di(n,e,t)});else if(Gf(i)){for(const n in i)Di(i[n],e,t);for(const n of Object.getOwnPropertySymbols(i))Object.prototype.propertyIsEnumerable.call(i,n)&&Di(i[n],e,t)}return i}/**
* @vue/runtime-core v3.5.20
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ro(i,e,t,n){try{return n?i(...n):i()}catch(s){Ma(s,e,t)}}function yi(i,e,t,n){if(ye(i)){const s=ro(i,e,t,n);return s&&Df(s)&&s.catch(r=>{Ma(r,e,t)}),s}if(de(i)){const s=[];for(let r=0;r<i.length;r++)s.push(yi(i[r],e,t,n));return s}}function Ma(i,e,t,n=!0){const s=e?e.vnode:null,{errorHandler:r,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||De;if(e){let a=e.parent;const l=e.proxy,h=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const c=a.ec;if(c){for(let u=0;u<c.length;u++)if(c[u](i,l,h)===!1)return}a=a.parent}if(r){Ui(),ro(r,null,10,[i,l,h]),Bi();return}}Ip(i,t,s,n,o)}function Ip(i,e,t,n=!0,s=!1){if(s)throw i;console.error(i)}const _t=[];let ci=-1;const xs=[];let Ji=null,ns=0;const sg=Promise.resolve();let sa=null;function rg(i){const e=sa||sg;return i?e.then(this?i.bind(this):i):e}function bp(i){let e=ci+1,t=_t.length;for(;e<t;){const n=e+t>>>1,s=_t[n],r=Gr(s);r<i||r===i&&s.flags&2?e=n+1:t=n}return e}function sh(i){if(!(i.flags&1)){const e=Gr(i),t=_t[_t.length-1];!t||!(i.flags&2)&&e>=Gr(t)?_t.push(i):_t.splice(bp(e),0,i),i.flags|=1,og()}}function og(){sa||(sa=sg.then(lg))}function Ap(i){de(i)?xs.push(...i):Ji&&i.id===-1?Ji.splice(ns+1,0,i):i.flags&1||(xs.push(i),i.flags|=1),og()}function Au(i,e,t=ci+1){for(;t<_t.length;t++){const n=_t[t];if(n&&n.flags&2){if(i&&n.id!==i.uid)continue;_t.splice(t,1),t--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function ag(i){if(xs.length){const e=[...new Set(xs)].sort((t,n)=>Gr(t)-Gr(n));if(xs.length=0,Ji){Ji.push(...e);return}for(Ji=e,ns=0;ns<Ji.length;ns++){const t=Ji[ns];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Ji=null,ns=0}}const Gr=i=>i.id==null?i.flags&2?-1:1/0:i.id;function lg(i){try{for(ci=0;ci<_t.length;ci++){const e=_t[ci];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),ro(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;ci<_t.length;ci++){const e=_t[ci];e&&(e.flags&=-2)}ci=-1,_t.length=0,ag(),sa=null,(_t.length||xs.length)&&lg()}}let Vt=null,cg=null;function ra(i){const e=Vt;return Vt=i,cg=i&&i.type.__scopeId||null,e}function Pp(i,e=Vt,t){if(!e||i._n)return i;const n=(...s)=>{n._d&&ku(-1);const r=ra(e);let o;try{o=i(...s)}finally{ra(r),n._d&&ku(1)}return o};return n._n=!0,n._c=!0,n._d=!0,n}function Pn(i,e){if(Vt===null)return i;const t=Ga(Vt),n=i.dirs||(i.dirs=[]);for(let s=0;s<e.length;s++){let[r,o,a,l=De]=e[s];r&&(ye(r)&&(r={mounted:r,updated:r}),r.deep&&Di(o),n.push({dir:r,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return i}function wn(i,e,t,n){const s=i.dirs,r=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];r&&(a.oldValue=r[o].value);let l=a.dir[n];l&&(Ui(),yi(l,t,8,[i.el,a,i,e]),Bi())}}const Lp=Symbol("_vte"),Mp=i=>i.__isTeleport,Fp=Symbol("_leaveCb");function rh(i,e){i.shapeFlag&6&&i.component?(i.transition=e,rh(i.component.subTree,e)):i.shapeFlag&128?(i.ssContent.transition=e.clone(i.ssContent),i.ssFallback.transition=e.clone(i.ssFallback)):i.transition=e}function hg(i){i.ids=[i.ids[0]+i.ids[2]+++"-",0,0]}function Rr(i,e,t,n,s=!1){if(de(i)){i.forEach((g,_)=>Rr(g,e&&(de(e)?e[_]:e),t,n,s));return}if(Sr(n)&&!s){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&Rr(i,e,t,n.component.subTree);return}const r=n.shapeFlag&4?Ga(n.component):n.el,o=s?null:r,{i:a,r:l}=i,h=e&&e.r,c=a.refs===De?a.refs={}:a.refs,u=a.setupState,d=Me(u),f=u===De?Mf:g=>Fe(d,g);if(h!=null&&h!==l){if($e(h))c[h]=null,f(h)&&(u[h]=null);else if(ct(h)){h.value=null;const g=e;g.k&&(c[g.k]=null)}}if(ye(l))ro(l,a,12,[o,c]);else{const g=$e(l),_=ct(l);if(g||_){const m=()=>{if(i.f){const y=g?f(l)?u[l]:c[l]:l.value;if(s)de(y)&&$c(y,r);else if(de(y))y.includes(r)||y.push(r);else if(g)c[l]=[r],f(l)&&(u[l]=c[l]);else{const p=[r];l.value=p,i.k&&(c[i.k]=p)}}else g?(c[l]=o,f(l)&&(u[l]=o)):_&&(l.value=o,i.k&&(c[i.k]=o))};o?(m.id=-1,Mt(m,t)):m()}}}Aa().requestIdleCallback;Aa().cancelIdleCallback;const Sr=i=>!!i.type.__asyncLoader,ug=i=>i.type.__isKeepAlive;function Dp(i,e){dg(i,"a",e)}function Op(i,e){dg(i,"da",e)}function dg(i,e,t=yt){const n=i.__wdc||(i.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return i()});if(Fa(e,n,t),t){let s=t.parent;for(;s&&s.parent;)ug(s.parent.vnode)&&Gp(n,e,t,s),s=s.parent}}function Gp(i,e,t,n){const s=Fa(e,i,n,!0);_g(()=>{$c(n[e],s)},t)}function Fa(i,e,t=yt,n=!1){if(t){const s=t[i]||(t[i]=[]),r=e.__weh||(e.__weh=(...o)=>{Ui();const a=oo(t),l=yi(e,t,i,o);return a(),Bi(),l});return n?s.unshift(r):s.push(r),r}}const ji=i=>(e,t=yt)=>{(!kr||i==="sp")&&Fa(i,(...n)=>e(...n),t)},Np=ji("bm"),fg=ji("m"),kp=ji("bu"),Up=ji("u"),gg=ji("bum"),_g=ji("um"),Bp=ji("sp"),Xp=ji("rtg"),jp=ji("rtc");function zp(i,e=yt){Fa("ec",i,e)}const Vp=Symbol.for("v-ndc");function uc(i,e,t,n){let s;const r=t,o=de(i);if(o||$e(i)){const a=o&&Es(i);let l=!1,h=!1;a&&(l=!Kt(i),h=cn(i),i=La(i)),s=new Array(i.length);for(let c=0,u=i.length;c<u;c++)s[c]=e(l?h?ia(it(i[c])):it(i[c]):i[c],c,void 0,r)}else if(typeof i=="number"){s=new Array(i);for(let a=0;a<i;a++)s[a]=e(a+1,a,void 0,r)}else if(Xe(i))if(i[Symbol.iterator])s=Array.from(i,(a,l)=>e(a,l,void 0,r));else{const a=Object.keys(i);s=new Array(a.length);for(let l=0,h=a.length;l<h;l++){const c=a[l];s[l]=e(i[c],c,l,r)}}else s=[];return s}const dc=i=>i?Ng(i)?Ga(i):dc(i.parent):null,vr=Tt(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>dc(i.parent),$root:i=>dc(i.root),$host:i=>i.ce,$emit:i=>i.emit,$options:i=>pg(i),$forceUpdate:i=>i.f||(i.f=()=>{sh(i.update)}),$nextTick:i=>i.n||(i.n=rg.bind(i.proxy)),$watch:i=>d0.bind(i)}),ml=(i,e)=>i!==De&&!i.__isScriptSetup&&Fe(i,e),Wp={get({_:i},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:n,data:s,props:r,accessCache:o,type:a,appContext:l}=i;let h;if(e[0]!=="$"){const f=o[e];if(f!==void 0)switch(f){case 1:return n[e];case 2:return s[e];case 4:return t[e];case 3:return r[e]}else{if(ml(n,e))return o[e]=1,n[e];if(s!==De&&Fe(s,e))return o[e]=2,s[e];if((h=i.propsOptions[0])&&Fe(h,e))return o[e]=3,r[e];if(t!==De&&Fe(t,e))return o[e]=4,t[e];fc&&(o[e]=0)}}const c=vr[e];let u,d;if(c)return e==="$attrs"&&at(i.attrs,"get",""),c(i);if((u=a.__cssModules)&&(u=u[e]))return u;if(t!==De&&Fe(t,e))return o[e]=4,t[e];if(d=l.config.globalProperties,Fe(d,e))return d[e]},set({_:i},e,t){const{data:n,setupState:s,ctx:r}=i;return ml(s,e)?(s[e]=t,!0):n!==De&&Fe(n,e)?(n[e]=t,!0):Fe(i.props,e)||e[0]==="$"&&e.slice(1)in i?!1:(r[e]=t,!0)},has({_:{data:i,setupState:e,accessCache:t,ctx:n,appContext:s,propsOptions:r,type:o}},a){let l,h;return!!(t[a]||i!==De&&a[0]!=="$"&&Fe(i,a)||ml(e,a)||(l=r[0])&&Fe(l,a)||Fe(n,a)||Fe(vr,a)||Fe(s.config.globalProperties,a)||(h=o.__cssModules)&&h[a])},defineProperty(i,e,t){return t.get!=null?i._.accessCache[e]=0:Fe(t,"value")&&this.set(i,e,t.value,null),Reflect.defineProperty(i,e,t)}};function Pu(i){return de(i)?i.reduce((e,t)=>(e[t]=null,e),{}):i}let fc=!0;function Kp(i){const e=pg(i),t=i.proxy,n=i.ctx;fc=!1,e.beforeCreate&&Lu(e.beforeCreate,i,"bc");const{data:s,computed:r,methods:o,watch:a,provide:l,inject:h,created:c,beforeMount:u,mounted:d,beforeUpdate:f,updated:g,activated:_,deactivated:m,beforeDestroy:y,beforeUnmount:p,destroyed:x,unmounted:E,render:T,renderTracked:R,renderTriggered:I,errorCaptured:S,serverPrefetch:A,expose:b,inheritAttrs:X,components:O,directives:B,filters:K}=e;if(h&&Yp(h,n,null),o)for(const k in o){const G=o[k];ye(G)&&(n[k]=G.bind(t))}if(s){const k=s.call(t,t);Xe(k)&&(i.data=As(k))}if(fc=!0,r)for(const k in r){const G=r[k],q=ye(G)?G.bind(t,t):ye(G.get)?G.get.bind(t,t):gi,Q=!ye(G)&&ye(G.set)?G.set.bind(t):gi,re=bn({get:q,set:Q});Object.defineProperty(n,k,{enumerable:!0,configurable:!0,get:()=>re.value,set:L=>re.value=L})}if(a)for(const k in a)mg(a[k],n,t,k);if(l){const k=ye(l)?l.call(t):l;Reflect.ownKeys(k).forEach(G=>{Qp(G,k[G])})}c&&Lu(c,i,"c");function W(k,G){de(G)?G.forEach(q=>k(q.bind(t))):G&&k(G.bind(t))}if(W(Np,u),W(fg,d),W(kp,f),W(Up,g),W(Dp,_),W(Op,m),W(zp,S),W(jp,R),W(Xp,I),W(gg,p),W(_g,E),W(Bp,A),de(b))if(b.length){const k=i.exposed||(i.exposed={});b.forEach(G=>{Object.defineProperty(k,G,{get:()=>t[G],set:q=>t[G]=q,enumerable:!0})})}else i.exposed||(i.exposed={});T&&i.render===gi&&(i.render=T),X!=null&&(i.inheritAttrs=X),O&&(i.components=O),B&&(i.directives=B),A&&hg(i)}function Yp(i,e,t=gi){de(i)&&(i=gc(i));for(const n in i){const s=i[n];let r;Xe(s)?"default"in s?r=Jo(s.from||n,s.default,!0):r=Jo(s.from||n):r=Jo(s),ct(r)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>r.value,set:o=>r.value=o}):e[n]=r}}function Lu(i,e,t){yi(de(i)?i.map(n=>n.bind(e.proxy)):i.bind(e.proxy),e,t)}function mg(i,e,t,n){let s=n.includes(".")?Pg(t,n):()=>t[n];if($e(i)){const r=e[i];ye(r)&&Cs(s,r)}else if(ye(i))Cs(s,i.bind(t));else if(Xe(i))if(de(i))i.forEach(r=>mg(r,e,t,n));else{const r=ye(i.handler)?i.handler.bind(t):e[i.handler];ye(r)&&Cs(s,r,i)}}function pg(i){const e=i.type,{mixins:t,extends:n}=e,{mixins:s,optionsCache:r,config:{optionMergeStrategies:o}}=i.appContext,a=r.get(e);let l;return a?l=a:!s.length&&!t&&!n?l=e:(l={},s.length&&s.forEach(h=>oa(l,h,o,!0)),oa(l,e,o)),Xe(e)&&r.set(e,l),l}function oa(i,e,t,n=!1){const{mixins:s,extends:r}=e;r&&oa(i,r,t,!0),s&&s.forEach(o=>oa(i,o,t,!0));for(const o in e)if(!(n&&o==="expose")){const a=$p[o]||t&&t[o];i[o]=a?a(i[o],e[o]):e[o]}return i}const $p={data:Mu,props:Fu,emits:Fu,methods:fr,computed:fr,beforeCreate:dt,created:dt,beforeMount:dt,mounted:dt,beforeUpdate:dt,updated:dt,beforeDestroy:dt,beforeUnmount:dt,destroyed:dt,unmounted:dt,activated:dt,deactivated:dt,errorCaptured:dt,serverPrefetch:dt,components:fr,directives:fr,watch:Zp,provide:Mu,inject:Hp};function Mu(i,e){return e?i?function(){return Tt(ye(i)?i.call(this,this):i,ye(e)?e.call(this,this):e)}:e:i}function Hp(i,e){return fr(gc(i),gc(e))}function gc(i){if(de(i)){const e={};for(let t=0;t<i.length;t++)e[i[t]]=i[t];return e}return i}function dt(i,e){return i?[...new Set([].concat(i,e))]:e}function fr(i,e){return i?Tt(Object.create(null),i,e):e}function Fu(i,e){return i?de(i)&&de(e)?[...new Set([...i,...e])]:Tt(Object.create(null),Pu(i),Pu(e??{})):e}function Zp(i,e){if(!i)return e;if(!e)return i;const t=Tt(Object.create(null),i);for(const n in e)t[n]=dt(i[n],e[n]);return t}function yg(){return{app:null,config:{isNativeTag:Mf,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let qp=0;function Jp(i,e){return function(n,s=null){ye(n)||(n=Tt({},n)),s!=null&&!Xe(s)&&(s=null);const r=yg(),o=new WeakSet,a=[];let l=!1;const h=r.app={_uid:qp++,_component:n,_props:s,_container:null,_context:r,_instance:null,version:D0,get config(){return r.config},set config(c){},use(c,...u){return o.has(c)||(c&&ye(c.install)?(o.add(c),c.install(h,...u)):ye(c)&&(o.add(c),c(h,...u))),h},mixin(c){return r.mixins.includes(c)||r.mixins.push(c),h},component(c,u){return u?(r.components[c]=u,h):r.components[c]},directive(c,u){return u?(r.directives[c]=u,h):r.directives[c]},mount(c,u,d){if(!l){const f=h._ceVNode||Yt(n,s);return f.appContext=r,d===!0?d="svg":d===!1&&(d=void 0),i(f,c,d),l=!0,h._container=c,c.__vue_app__=h,Ga(f.component)}},onUnmount(c){a.push(c)},unmount(){l&&(yi(a,h._instance,16),i(null,h._container),delete h._container.__vue_app__)},provide(c,u){return r.provides[c]=u,h},runWithContext(c){const u=Ts;Ts=h;try{return c()}finally{Ts=u}}};return h}}let Ts=null;function Qp(i,e){if(yt){let t=yt.provides;const n=yt.parent&&yt.parent.provides;n===t&&(t=yt.provides=Object.create(n)),t[i]=e}}function Jo(i,e,t=!1){const n=b0();if(n||Ts){let s=Ts?Ts._context.provides:n?n.parent==null||n.ce?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(s&&i in s)return s[i];if(arguments.length>1)return t&&ye(e)?e.call(n&&n.proxy):e}}const Eg={},xg=()=>Object.create(Eg),Tg=i=>Object.getPrototypeOf(i)===Eg;function e0(i,e,t,n=!1){const s={},r=xg();i.propsDefaults=Object.create(null),Cg(i,e,s,r);for(const o in i.propsOptions[0])o in s||(s[o]=void 0);t?i.props=n?s:pp(s):i.type.props?i.props=s:i.props=r,i.attrs=r}function t0(i,e,t,n){const{props:s,attrs:r,vnode:{patchFlag:o}}=i,a=Me(s),[l]=i.propsOptions;let h=!1;if((n||o>0)&&!(o&16)){if(o&8){const c=i.vnode.dynamicProps;for(let u=0;u<c.length;u++){let d=c[u];if(Da(i.emitsOptions,d))continue;const f=e[d];if(l)if(Fe(r,d))f!==r[d]&&(r[d]=f,h=!0);else{const g=ln(d);s[g]=_c(l,a,g,f,i,!1)}else f!==r[d]&&(r[d]=f,h=!0)}}}else{Cg(i,e,s,r)&&(h=!0);let c;for(const u in a)(!e||!Fe(e,u)&&((c=pn(u))===u||!Fe(e,c)))&&(l?t&&(t[u]!==void 0||t[c]!==void 0)&&(s[u]=_c(l,a,u,void 0,i,!0)):delete s[u]);if(r!==a)for(const u in r)(!e||!Fe(e,u))&&(delete r[u],h=!0)}h&&Fi(i.attrs,"set","")}function Cg(i,e,t,n){const[s,r]=i.propsOptions;let o=!1,a;if(e)for(let l in e){if(Tr(l))continue;const h=e[l];let c;s&&Fe(s,c=ln(l))?!r||!r.includes(c)?t[c]=h:(a||(a={}))[c]=h:Da(i.emitsOptions,l)||(!(l in n)||h!==n[l])&&(n[l]=h,o=!0)}if(r){const l=Me(t),h=a||De;for(let c=0;c<r.length;c++){const u=r[c];t[u]=_c(s,l,u,h[u],i,!Fe(h,u))}}return o}function _c(i,e,t,n,s,r){const o=i[t];if(o!=null){const a=Fe(o,"default");if(a&&n===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&ye(l)){const{propsDefaults:h}=s;if(t in h)n=h[t];else{const c=oo(s);n=h[t]=l.call(null,e),c()}}else n=l;s.ce&&s.ce._setProp(t,n)}o[0]&&(r&&!a?n=!1:o[1]&&(n===""||n===pn(t))&&(n=!0))}return n}const i0=new WeakMap;function wg(i,e,t=!1){const n=t?i0:e.propsCache,s=n.get(i);if(s)return s;const r=i.props,o={},a=[];let l=!1;if(!ye(i)){const c=u=>{l=!0;const[d,f]=wg(u,e,!0);Tt(o,d),f&&a.push(...f)};!t&&e.mixins.length&&e.mixins.forEach(c),i.extends&&c(i.extends),i.mixins&&i.mixins.forEach(c)}if(!r&&!l)return Xe(i)&&n.set(i,ps),ps;if(de(r))for(let c=0;c<r.length;c++){const u=ln(r[c]);Du(u)&&(o[u]=De)}else if(r)for(const c in r){const u=ln(c);if(Du(u)){const d=r[c],f=o[u]=de(d)||ye(d)?{type:d}:Tt({},d),g=f.type;let _=!1,m=!0;if(de(g))for(let y=0;y<g.length;++y){const p=g[y],x=ye(p)&&p.name;if(x==="Boolean"){_=!0;break}else x==="String"&&(m=!1)}else _=ye(g)&&g.name==="Boolean";f[0]=_,f[1]=m,(_||Fe(f,"default"))&&a.push(u)}}const h=[o,a];return Xe(i)&&n.set(i,h),h}function Du(i){return i[0]!=="$"&&!Tr(i)}const oh=i=>i==="_"||i==="_ctx"||i==="$stable",ah=i=>de(i)?i.map(hi):[hi(i)],n0=(i,e,t)=>{if(e._n)return e;const n=Pp((...s)=>ah(e(...s)),t);return n._c=!1,n},Rg=(i,e,t)=>{const n=i._ctx;for(const s in i){if(oh(s))continue;const r=i[s];if(ye(r))e[s]=n0(s,r,n);else if(r!=null){const o=ah(r);e[s]=()=>o}}},Sg=(i,e)=>{const t=ah(e);i.slots.default=()=>t},vg=(i,e,t)=>{for(const n in e)(t||!oh(n))&&(i[n]=e[n])},s0=(i,e,t)=>{const n=i.slots=xg();if(i.vnode.shapeFlag&32){const s=e._;s?(vg(n,e,t),t&&kf(n,"_",s,!0)):Rg(e,n)}else e&&Sg(i,e)},r0=(i,e,t)=>{const{vnode:n,slots:s}=i;let r=!0,o=De;if(n.shapeFlag&32){const a=e._;a?t&&a===1?r=!1:vg(s,e,t):(r=!e.$stable,Rg(e,s)),o=e}else e&&(Sg(i,e),o={default:1});if(r)for(const a in s)!oh(a)&&o[a]==null&&delete s[a]},Mt=E0;function o0(i){return a0(i)}function a0(i,e){const t=Aa();t.__VUE__=!0;const{insert:n,remove:s,patchProp:r,createElement:o,createText:a,createComment:l,setText:h,setElementText:c,parentNode:u,nextSibling:d,setScopeId:f=gi,insertStaticContent:g}=i,_=(C,w,P,F=null,M=null,D=null,H=void 0,$=null,j=!!w.dynamicChildren)=>{if(C===w)return;C&&!rr(C,w)&&(F=te(C),L(C,M,D,!0),C=null),w.patchFlag===-2&&(j=!1,w.dynamicChildren=null);const{type:U,ref:ie,shapeFlag:V}=w;switch(U){case Oa:m(C,w,P,F);break;case hn:y(C,w,P,F);break;case yl:C==null&&p(w,P,F,H);break;case mt:O(C,w,P,F,M,D,H,$,j);break;default:V&1?T(C,w,P,F,M,D,H,$,j):V&6?B(C,w,P,F,M,D,H,$,j):(V&64||V&128)&&U.process(C,w,P,F,M,D,H,$,j,Re)}ie!=null&&M?Rr(ie,C&&C.ref,D,w||C,!w):ie==null&&C&&C.ref!=null&&Rr(C.ref,null,D,C,!0)},m=(C,w,P,F)=>{if(C==null)n(w.el=a(w.children),P,F);else{const M=w.el=C.el;w.children!==C.children&&h(M,w.children)}},y=(C,w,P,F)=>{C==null?n(w.el=l(w.children||""),P,F):w.el=C.el},p=(C,w,P,F)=>{[C.el,C.anchor]=g(C.children,w,P,F,C.el,C.anchor)},x=({el:C,anchor:w},P,F)=>{let M;for(;C&&C!==w;)M=d(C),n(C,P,F),C=M;n(w,P,F)},E=({el:C,anchor:w})=>{let P;for(;C&&C!==w;)P=d(C),s(C),C=P;s(w)},T=(C,w,P,F,M,D,H,$,j)=>{w.type==="svg"?H="svg":w.type==="math"&&(H="mathml"),C==null?R(w,P,F,M,D,H,$,j):A(C,w,M,D,H,$,j)},R=(C,w,P,F,M,D,H,$)=>{let j,U;const{props:ie,shapeFlag:V,transition:se,dirs:le}=C;if(j=C.el=o(C.type,D,ie&&ie.is,ie),V&8?c(j,C.children):V&16&&S(C.children,j,null,F,M,pl(C,D),H,$),le&&wn(C,null,F,"created"),I(j,C,C.scopeId,H,F),ie){for(const be in ie)be!=="value"&&!Tr(be)&&r(j,be,null,ie[be],D,F);"value"in ie&&r(j,"value",null,ie.value,D),(U=ie.onVnodeBeforeMount)&&ri(U,F,C)}le&&wn(C,null,F,"beforeMount");const xe=l0(M,se);xe&&se.beforeEnter(j),n(j,w,P),((U=ie&&ie.onVnodeMounted)||xe||le)&&Mt(()=>{U&&ri(U,F,C),xe&&se.enter(j),le&&wn(C,null,F,"mounted")},M)},I=(C,w,P,F,M)=>{if(P&&f(C,P),F)for(let D=0;D<F.length;D++)f(C,F[D]);if(M){let D=M.subTree;if(w===D||Mg(D.type)&&(D.ssContent===w||D.ssFallback===w)){const H=M.vnode;I(C,H,H.scopeId,H.slotScopeIds,M.parent)}}},S=(C,w,P,F,M,D,H,$,j=0)=>{for(let U=j;U<C.length;U++){const ie=C[U]=$?Qi(C[U]):hi(C[U]);_(null,ie,w,P,F,M,D,H,$)}},A=(C,w,P,F,M,D,H)=>{const $=w.el=C.el;let{patchFlag:j,dynamicChildren:U,dirs:ie}=w;j|=C.patchFlag&16;const V=C.props||De,se=w.props||De;let le;if(P&&Rn(P,!1),(le=se.onVnodeBeforeUpdate)&&ri(le,P,w,C),ie&&wn(w,C,P,"beforeUpdate"),P&&Rn(P,!0),(V.innerHTML&&se.innerHTML==null||V.textContent&&se.textContent==null)&&c($,""),U?b(C.dynamicChildren,U,$,P,F,pl(w,M),D):H||G(C,w,$,null,P,F,pl(w,M),D,!1),j>0){if(j&16)X($,V,se,P,M);else if(j&2&&V.class!==se.class&&r($,"class",null,se.class,M),j&4&&r($,"style",V.style,se.style,M),j&8){const xe=w.dynamicProps;for(let be=0;be<xe.length;be++){const Ae=xe[be],et=V[Ae],tt=se[Ae];(tt!==et||Ae==="value")&&r($,Ae,et,tt,M,P)}}j&1&&C.children!==w.children&&c($,w.children)}else!H&&U==null&&X($,V,se,P,M);((le=se.onVnodeUpdated)||ie)&&Mt(()=>{le&&ri(le,P,w,C),ie&&wn(w,C,P,"updated")},F)},b=(C,w,P,F,M,D,H)=>{for(let $=0;$<w.length;$++){const j=C[$],U=w[$],ie=j.el&&(j.type===mt||!rr(j,U)||j.shapeFlag&198)?u(j.el):P;_(j,U,ie,null,F,M,D,H,!0)}},X=(C,w,P,F,M)=>{if(w!==P){if(w!==De)for(const D in w)!Tr(D)&&!(D in P)&&r(C,D,w[D],null,M,F);for(const D in P){if(Tr(D))continue;const H=P[D],$=w[D];H!==$&&D!=="value"&&r(C,D,$,H,M,F)}"value"in P&&r(C,"value",w.value,P.value,M)}},O=(C,w,P,F,M,D,H,$,j)=>{const U=w.el=C?C.el:a(""),ie=w.anchor=C?C.anchor:a("");let{patchFlag:V,dynamicChildren:se,slotScopeIds:le}=w;le&&($=$?$.concat(le):le),C==null?(n(U,P,F),n(ie,P,F),S(w.children||[],P,ie,M,D,H,$,j)):V>0&&V&64&&se&&C.dynamicChildren?(b(C.dynamicChildren,se,P,M,D,H,$),(w.key!=null||M&&w===M.subTree)&&Ig(C,w,!0)):G(C,w,P,ie,M,D,H,$,j)},B=(C,w,P,F,M,D,H,$,j)=>{w.slotScopeIds=$,C==null?w.shapeFlag&512?M.ctx.activate(w,P,F,H,j):K(w,P,F,M,D,H,j):Y(C,w,j)},K=(C,w,P,F,M,D,H)=>{const $=C.component=I0(C,F,M);if(ug(C)&&($.ctx.renderer=Re),A0($,!1,H),$.asyncDep){if(M&&M.registerDep($,W,H),!C.el){const j=$.subTree=Yt(hn);y(null,j,w,P),C.placeholder=j.el}}else W($,C,w,P,M,D,H)},Y=(C,w,P)=>{const F=w.component=C.component;if(p0(C,w,P))if(F.asyncDep&&!F.asyncResolved){k(F,w,P);return}else F.next=w,F.update();else w.el=C.el,F.vnode=w},W=(C,w,P,F,M,D,H)=>{const $=()=>{if(C.isMounted){let{next:V,bu:se,u:le,parent:xe,vnode:be}=C;{const Ut=bg(C);if(Ut){V&&(V.el=be.el,k(C,V,H)),Ut.asyncDep.then(()=>{C.isUnmounted||$()});return}}let Ae=V,et;Rn(C,!1),V?(V.el=be.el,k(C,V,H)):V=be,se&&qo(se),(et=V.props&&V.props.onVnodeBeforeUpdate)&&ri(et,xe,V,be),Rn(C,!0);const tt=Gu(C),wt=C.subTree;C.subTree=tt,_(wt,tt,u(wt.el),te(wt),C,M,D),V.el=tt.el,Ae===null&&y0(C,tt.el),le&&Mt(le,M),(et=V.props&&V.props.onVnodeUpdated)&&Mt(()=>ri(et,xe,V,be),M)}else{let V;const{el:se,props:le}=w,{bm:xe,m:be,parent:Ae,root:et,type:tt}=C,wt=Sr(w);Rn(C,!1),xe&&qo(xe),!wt&&(V=le&&le.onVnodeBeforeMount)&&ri(V,Ae,w),Rn(C,!0);{et.ce&&et.ce._def.shadowRoot!==!1&&et.ce._injectChildStyle(tt);const Ut=C.subTree=Gu(C);_(null,Ut,P,F,C,M,D),w.el=Ut.el}if(be&&Mt(be,M),!wt&&(V=le&&le.onVnodeMounted)){const Ut=w;Mt(()=>ri(V,Ae,Ut),M)}(w.shapeFlag&256||Ae&&Sr(Ae.vnode)&&Ae.vnode.shapeFlag&256)&&C.a&&Mt(C.a,M),C.isMounted=!0,w=P=F=null}};C.scope.on();const j=C.effect=new jf($);C.scope.off();const U=C.update=j.run.bind(j),ie=C.job=j.runIfDirty.bind(j);ie.i=C,ie.id=C.uid,j.scheduler=()=>sh(ie),Rn(C,!0),U()},k=(C,w,P)=>{w.component=C;const F=C.vnode.props;C.vnode=w,C.next=null,t0(C,w.props,F,P),r0(C,w.children,P),Ui(),Au(C),Bi()},G=(C,w,P,F,M,D,H,$,j=!1)=>{const U=C&&C.children,ie=C?C.shapeFlag:0,V=w.children,{patchFlag:se,shapeFlag:le}=w;if(se>0){if(se&128){Q(U,V,P,F,M,D,H,$,j);return}else if(se&256){q(U,V,P,F,M,D,H,$,j);return}}le&8?(ie&16&&J(U,M,D),V!==U&&c(P,V)):ie&16?le&16?Q(U,V,P,F,M,D,H,$,j):J(U,M,D,!0):(ie&8&&c(P,""),le&16&&S(V,P,F,M,D,H,$,j))},q=(C,w,P,F,M,D,H,$,j)=>{C=C||ps,w=w||ps;const U=C.length,ie=w.length,V=Math.min(U,ie);let se;for(se=0;se<V;se++){const le=w[se]=j?Qi(w[se]):hi(w[se]);_(C[se],le,P,null,M,D,H,$,j)}U>ie?J(C,M,D,!0,!1,V):S(w,P,F,M,D,H,$,j,V)},Q=(C,w,P,F,M,D,H,$,j)=>{let U=0;const ie=w.length;let V=C.length-1,se=ie-1;for(;U<=V&&U<=se;){const le=C[U],xe=w[U]=j?Qi(w[U]):hi(w[U]);if(rr(le,xe))_(le,xe,P,null,M,D,H,$,j);else break;U++}for(;U<=V&&U<=se;){const le=C[V],xe=w[se]=j?Qi(w[se]):hi(w[se]);if(rr(le,xe))_(le,xe,P,null,M,D,H,$,j);else break;V--,se--}if(U>V){if(U<=se){const le=se+1,xe=le<ie?w[le].el:F;for(;U<=se;)_(null,w[U]=j?Qi(w[U]):hi(w[U]),P,xe,M,D,H,$,j),U++}}else if(U>se)for(;U<=V;)L(C[U],M,D,!0),U++;else{const le=U,xe=U,be=new Map;for(U=xe;U<=se;U++){const st=w[U]=j?Qi(w[U]):hi(w[U]);st.key!=null&&be.set(st.key,U)}let Ae,et=0;const tt=se-xe+1;let wt=!1,Ut=0;const Tn=new Array(tt);for(U=0;U<tt;U++)Tn[U]=0;for(U=le;U<=V;U++){const st=C[U];if(et>=tt){L(st,M,D,!0);continue}let Rt;if(st.key!=null)Rt=be.get(st.key);else for(Ae=xe;Ae<=se;Ae++)if(Tn[Ae-xe]===0&&rr(st,w[Ae])){Rt=Ae;break}Rt===void 0?L(st,M,D,!0):(Tn[Rt-xe]=U+1,Rt>=Ut?Ut=Rt:wt=!0,_(st,w[Rt],P,null,M,D,H,$,j),et++)}const Qs=wt?c0(Tn):ps;for(Ae=Qs.length-1,U=tt-1;U>=0;U--){const st=xe+U,Rt=w[st],er=w[st+1],Eo=st+1<ie?er.el||er.placeholder:F;Tn[U]===0?_(null,Rt,P,Eo,M,D,H,$,j):wt&&(Ae<0||U!==Qs[Ae]?re(Rt,P,Eo,2):Ae--)}}},re=(C,w,P,F,M=null)=>{const{el:D,type:H,transition:$,children:j,shapeFlag:U}=C;if(U&6){re(C.component.subTree,w,P,F);return}if(U&128){C.suspense.move(w,P,F);return}if(U&64){H.move(C,w,P,Re);return}if(H===mt){n(D,w,P);for(let V=0;V<j.length;V++)re(j[V],w,P,F);n(C.anchor,w,P);return}if(H===yl){x(C,w,P);return}if(F!==2&&U&1&&$)if(F===0)$.beforeEnter(D),n(D,w,P),Mt(()=>$.enter(D),M);else{const{leave:V,delayLeave:se,afterLeave:le}=$,xe=()=>{C.ctx.isUnmounted?s(D):n(D,w,P)},be=()=>{D._isLeaving&&D[Fp](!0),V(D,()=>{xe(),le&&le()})};se?se(D,xe,be):be()}else n(D,w,P)},L=(C,w,P,F=!1,M=!1)=>{const{type:D,props:H,ref:$,children:j,dynamicChildren:U,shapeFlag:ie,patchFlag:V,dirs:se,cacheIndex:le}=C;if(V===-2&&(M=!1),$!=null&&(Ui(),Rr($,null,P,C,!0),Bi()),le!=null&&(w.renderCache[le]=void 0),ie&256){w.ctx.deactivate(C);return}const xe=ie&1&&se,be=!Sr(C);let Ae;if(be&&(Ae=H&&H.onVnodeBeforeUnmount)&&ri(Ae,w,C),ie&6)N(C.component,P,F);else{if(ie&128){C.suspense.unmount(P,F);return}xe&&wn(C,null,w,"beforeUnmount"),ie&64?C.type.remove(C,w,P,Re,F):U&&!U.hasOnce&&(D!==mt||V>0&&V&64)?J(U,w,P,!1,!0):(D===mt&&V&384||!M&&ie&16)&&J(j,w,P),F&&ue(C)}(be&&(Ae=H&&H.onVnodeUnmounted)||xe)&&Mt(()=>{Ae&&ri(Ae,w,C),xe&&wn(C,null,w,"unmounted")},P)},ue=C=>{const{type:w,el:P,anchor:F,transition:M}=C;if(w===mt){z(P,F);return}if(w===yl){E(C);return}const D=()=>{s(P),M&&!M.persisted&&M.afterLeave&&M.afterLeave()};if(C.shapeFlag&1&&M&&!M.persisted){const{leave:H,delayLeave:$}=M,j=()=>H(P,D);$?$(C.el,D,j):j()}else D()},z=(C,w)=>{let P;for(;C!==w;)P=d(C),s(C),C=P;s(w)},N=(C,w,P)=>{const{bum:F,scope:M,job:D,subTree:H,um:$,m:j,a:U}=C;Ou(j),Ou(U),F&&qo(F),M.stop(),D&&(D.flags|=8,L(H,C,w,P)),$&&Mt($,w),Mt(()=>{C.isUnmounted=!0},w)},J=(C,w,P,F=!1,M=!1,D=0)=>{for(let H=D;H<C.length;H++)L(C[H],w,P,F,M)},te=C=>{if(C.shapeFlag&6)return te(C.component.subTree);if(C.shapeFlag&128)return C.suspense.next();const w=d(C.anchor||C.el),P=w&&w[Lp];return P?d(P):w};let ge=!1;const Ce=(C,w,P)=>{C==null?w._vnode&&L(w._vnode,null,null,!0):_(w._vnode||null,C,w,null,null,null,P),w._vnode=C,ge||(ge=!0,Au(),ag(),ge=!1)},Re={p:_,um:L,m:re,r:ue,mt:K,mc:S,pc:G,pbc:b,n:te,o:i};return{render:Ce,hydrate:void 0,createApp:Jp(Ce)}}function pl({type:i,props:e},t){return t==="svg"&&i==="foreignObject"||t==="mathml"&&i==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Rn({effect:i,job:e},t){t?(i.flags|=32,e.flags|=4):(i.flags&=-33,e.flags&=-5)}function l0(i,e){return(!i||i&&!i.pendingBranch)&&e&&!e.persisted}function Ig(i,e,t=!1){const n=i.children,s=e.children;if(de(n)&&de(s))for(let r=0;r<n.length;r++){const o=n[r];let a=s[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[r]=Qi(s[r]),a.el=o.el),!t&&a.patchFlag!==-2&&Ig(o,a)),a.type===Oa&&a.patchFlag!==-1&&(a.el=o.el),a.type===hn&&!a.el&&(a.el=o.el)}}function c0(i){const e=i.slice(),t=[0];let n,s,r,o,a;const l=i.length;for(n=0;n<l;n++){const h=i[n];if(h!==0){if(s=t[t.length-1],i[s]<h){e[n]=s,t.push(n);continue}for(r=0,o=t.length-1;r<o;)a=r+o>>1,i[t[a]]<h?r=a+1:o=a;h<i[t[r]]&&(r>0&&(e[n]=t[r-1]),t[r]=n)}}for(r=t.length,o=t[r-1];r-- >0;)t[r]=o,o=e[o];return t}function bg(i){const e=i.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:bg(e)}function Ou(i){if(i)for(let e=0;e<i.length;e++)i[e].flags|=8}const h0=Symbol.for("v-scx"),u0=()=>Jo(h0);function Cs(i,e,t){return Ag(i,e,t)}function Ag(i,e,t=De){const{immediate:n,deep:s,flush:r,once:o}=t,a=Tt({},t),l=e&&n||!e&&r!=="post";let h;if(kr){if(r==="sync"){const f=u0();h=f.__watcherHandles||(f.__watcherHandles=[])}else if(!l){const f=()=>{};return f.stop=gi,f.resume=gi,f.pause=gi,f}}const c=yt;a.call=(f,g,_)=>yi(f,c,g,_);let u=!1;r==="post"?a.scheduler=f=>{Mt(f,c&&c.suspense)}:r!=="sync"&&(u=!0,a.scheduler=(f,g)=>{g?f():sh(f)}),a.augmentJob=f=>{e&&(f.flags|=4),u&&(f.flags|=2,c&&(f.id=c.uid,f.i=c))};const d=vp(i,e,a);return kr&&(h?h.push(d):l&&d()),d}function d0(i,e,t){const n=this.proxy,s=$e(i)?i.includes(".")?Pg(n,i):()=>n[i]:i.bind(n,n);let r;ye(e)?r=e:(r=e.handler,t=e);const o=oo(this),a=Ag(s,r.bind(n),t);return o(),a}function Pg(i,e){const t=e.split(".");return()=>{let n=i;for(let s=0;s<t.length&&n;s++)n=n[t[s]];return n}}const f0=(i,e)=>e==="modelValue"||e==="model-value"?i.modelModifiers:i[`${e}Modifiers`]||i[`${ln(e)}Modifiers`]||i[`${pn(e)}Modifiers`];function g0(i,e,...t){if(i.isUnmounted)return;const n=i.vnode.props||De;let s=t;const r=e.startsWith("update:"),o=r&&f0(n,e.slice(7));o&&(o.trim&&(s=t.map(c=>$e(c)?c.trim():c)),o.number&&(s=t.map(oc)));let a,l=n[a=ul(e)]||n[a=ul(ln(e))];!l&&r&&(l=n[a=ul(pn(e))]),l&&yi(l,i,6,s);const h=n[a+"Once"];if(h){if(!i.emitted)i.emitted={};else if(i.emitted[a])return;i.emitted[a]=!0,yi(h,i,6,s)}}function Lg(i,e,t=!1){const n=e.emitsCache,s=n.get(i);if(s!==void 0)return s;const r=i.emits;let o={},a=!1;if(!ye(i)){const l=h=>{const c=Lg(h,e,!0);c&&(a=!0,Tt(o,c))};!t&&e.mixins.length&&e.mixins.forEach(l),i.extends&&l(i.extends),i.mixins&&i.mixins.forEach(l)}return!r&&!a?(Xe(i)&&n.set(i,null),null):(de(r)?r.forEach(l=>o[l]=null):Tt(o,r),Xe(i)&&n.set(i,o),o)}function Da(i,e){return!i||!va(e)?!1:(e=e.slice(2).replace(/Once$/,""),Fe(i,e[0].toLowerCase()+e.slice(1))||Fe(i,pn(e))||Fe(i,e))}function Gu(i){const{type:e,vnode:t,proxy:n,withProxy:s,propsOptions:[r],slots:o,attrs:a,emit:l,render:h,renderCache:c,props:u,data:d,setupState:f,ctx:g,inheritAttrs:_}=i,m=ra(i);let y,p;try{if(t.shapeFlag&4){const E=s||n,T=E;y=hi(h.call(T,E,c,u,f,d,g)),p=a}else{const E=e;y=hi(E.length>1?E(u,{attrs:a,slots:o,emit:l}):E(u,null)),p=e.props?a:_0(a)}}catch(E){Ir.length=0,Ma(E,i,1),y=Yt(hn)}let x=y;if(p&&_!==!1){const E=Object.keys(p),{shapeFlag:T}=x;E.length&&T&7&&(r&&E.some(Yc)&&(p=m0(p,r)),x=Ps(x,p,!1,!0))}return t.dirs&&(x=Ps(x,null,!1,!0),x.dirs=x.dirs?x.dirs.concat(t.dirs):t.dirs),t.transition&&rh(x,t.transition),y=x,ra(m),y}const _0=i=>{let e;for(const t in i)(t==="class"||t==="style"||va(t))&&((e||(e={}))[t]=i[t]);return e},m0=(i,e)=>{const t={};for(const n in i)(!Yc(n)||!(n.slice(9)in e))&&(t[n]=i[n]);return t};function p0(i,e,t){const{props:n,children:s,component:r}=i,{props:o,children:a,patchFlag:l}=e,h=r.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return n?Nu(n,o,h):!!o;if(l&8){const c=e.dynamicProps;for(let u=0;u<c.length;u++){const d=c[u];if(o[d]!==n[d]&&!Da(h,d))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:n===o?!1:n?o?Nu(n,o,h):!0:!!o;return!1}function Nu(i,e,t){const n=Object.keys(e);if(n.length!==Object.keys(i).length)return!0;for(let s=0;s<n.length;s++){const r=n[s];if(e[r]!==i[r]&&!Da(t,r))return!0}return!1}function y0({vnode:i,parent:e},t){for(;e;){const n=e.subTree;if(n.suspense&&n.suspense.activeBranch===i&&(n.el=i.el),n===i)(i=e.vnode).el=t,e=e.parent;else break}}const Mg=i=>i.__isSuspense;function E0(i,e){e&&e.pendingBranch?de(i)?e.effects.push(...i):e.effects.push(i):Ap(i)}const mt=Symbol.for("v-fgt"),Oa=Symbol.for("v-txt"),hn=Symbol.for("v-cmt"),yl=Symbol.for("v-stc"),Ir=[];let Gt=null;function Ue(i=!1){Ir.push(Gt=i?null:[])}function x0(){Ir.pop(),Gt=Ir[Ir.length-1]||null}let Nr=1;function ku(i,e=!1){Nr+=i,i<0&&Gt&&e&&(Gt.hasOnce=!0)}function Fg(i){return i.dynamicChildren=Nr>0?Gt||ps:null,x0(),Nr>0&&Gt&&Gt.push(i),i}function ze(i,e,t,n,s,r){return Fg(ee(i,e,t,n,s,r,!0))}function Dg(i,e,t,n,s){return Fg(Yt(i,e,t,n,s,!0))}function Og(i){return i?i.__v_isVNode===!0:!1}function rr(i,e){return i.type===e.type&&i.key===e.key}const Gg=({key:i})=>i??null,Qo=({ref:i,ref_key:e,ref_for:t})=>(typeof i=="number"&&(i=""+i),i!=null?$e(i)||ct(i)||ye(i)?{i:Vt,r:i,k:e,f:!!t}:i:null);function ee(i,e=null,t=null,n=0,s=null,r=i===mt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:i,props:e,key:e&&Gg(e),ref:e&&Qo(e),scopeId:cg,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:n,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Vt};return a?(lh(l,t),r&128&&i.normalize(l)):t&&(l.shapeFlag|=$e(t)?8:16),Nr>0&&!o&&Gt&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&Gt.push(l),l}const Yt=T0;function T0(i,e=null,t=null,n=0,s=null,r=!1){if((!i||i===Vp)&&(i=hn),Og(i)){const a=Ps(i,e,!0);return t&&lh(a,t),Nr>0&&!r&&Gt&&(a.shapeFlag&6?Gt[Gt.indexOf(i)]=a:Gt.push(a)),a.patchFlag=-2,a}if(F0(i)&&(i=i.__vccOpts),e){e=C0(e);let{class:a,style:l}=e;a&&!$e(a)&&(e.class=Pa(a)),Xe(l)&&(nh(l)&&!de(l)&&(l=Tt({},l)),e.style=Zc(l))}const o=$e(i)?1:Mg(i)?128:Mp(i)?64:Xe(i)?4:ye(i)?2:0;return ee(i,e,t,n,s,o,r,!0)}function C0(i){return i?nh(i)||Tg(i)?Tt({},i):i:null}function Ps(i,e,t=!1,n=!1){const{props:s,ref:r,patchFlag:o,children:a,transition:l}=i,h=e?R0(s||{},e):s,c={__v_isVNode:!0,__v_skip:!0,type:i.type,props:h,key:h&&Gg(h),ref:e&&e.ref?t&&r?de(r)?r.concat(Qo(e)):[r,Qo(e)]:Qo(e):r,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:a,target:i.target,targetStart:i.targetStart,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:e&&i.type!==mt?o===-1?16:o|16:o,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:l,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&Ps(i.ssContent),ssFallback:i.ssFallback&&Ps(i.ssFallback),placeholder:i.placeholder,el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce};return l&&n&&rh(c,l.clone(c)),c}function w0(i=" ",e=0){return Yt(Oa,null,i,e)}function Ai(i="",e=!1){return e?(Ue(),Dg(hn,null,i)):Yt(hn,null,i)}function hi(i){return i==null||typeof i=="boolean"?Yt(hn):de(i)?Yt(mt,null,i.slice()):Og(i)?Qi(i):Yt(Oa,null,String(i))}function Qi(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:Ps(i)}function lh(i,e){let t=0;const{shapeFlag:n}=i;if(e==null)e=null;else if(de(e))t=16;else if(typeof e=="object")if(n&65){const s=e.default;s&&(s._c&&(s._d=!1),lh(i,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!Tg(e)?e._ctx=Vt:s===3&&Vt&&(Vt.slots._===1?e._=1:(e._=2,i.patchFlag|=1024))}else ye(e)?(e={default:e,_ctx:Vt},t=32):(e=String(e),n&64?(t=16,e=[w0(e)]):t=8);i.children=e,i.shapeFlag|=t}function R0(...i){const e={};for(let t=0;t<i.length;t++){const n=i[t];for(const s in n)if(s==="class")e.class!==n.class&&(e.class=Pa([e.class,n.class]));else if(s==="style")e.style=Zc([e.style,n.style]);else if(va(s)){const r=e[s],o=n[s];o&&r!==o&&!(de(r)&&r.includes(o))&&(e[s]=r?[].concat(r,o):o)}else s!==""&&(e[s]=n[s])}return e}function ri(i,e,t,n=null){yi(i,e,7,[t,n])}const S0=yg();let v0=0;function I0(i,e,t){const n=i.type,s=(e?e.appContext:i.appContext)||S0,r={uid:v0++,vnode:i,type:n,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new qm(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:wg(n,s),emitsOptions:Lg(n,s),emit:null,emitted:null,propsDefaults:De,inheritAttrs:n.inheritAttrs,ctx:De,data:De,props:De,attrs:De,slots:De,refs:De,setupState:De,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=g0.bind(null,r),i.ce&&i.ce(r),r}let yt=null;const b0=()=>yt||Vt;let aa,mc;{const i=Aa(),e=(t,n)=>{let s;return(s=i[t])||(s=i[t]=[]),s.push(n),r=>{s.length>1?s.forEach(o=>o(r)):s[0](r)}};aa=e("__VUE_INSTANCE_SETTERS__",t=>yt=t),mc=e("__VUE_SSR_SETTERS__",t=>kr=t)}const oo=i=>{const e=yt;return aa(i),i.scope.on(),()=>{i.scope.off(),aa(e)}},Uu=()=>{yt&&yt.scope.off(),aa(null)};function Ng(i){return i.vnode.shapeFlag&4}let kr=!1;function A0(i,e=!1,t=!1){e&&mc(e);const{props:n,children:s}=i.vnode,r=Ng(i);e0(i,n,r,e),s0(i,s,t||e);const o=r?P0(i,e):void 0;return e&&mc(!1),o}function P0(i,e){const t=i.type;i.accessCache=Object.create(null),i.proxy=new Proxy(i.ctx,Wp);const{setup:n}=t;if(n){Ui();const s=i.setupContext=n.length>1?M0(i):null,r=oo(i),o=ro(n,i,0,[i.props,s]),a=Df(o);if(Bi(),r(),(a||i.sp)&&!Sr(i)&&hg(i),a){if(o.then(Uu,Uu),e)return o.then(l=>{Bu(i,l)}).catch(l=>{Ma(l,i,0)});i.asyncDep=o}else Bu(i,o)}else kg(i)}function Bu(i,e,t){ye(e)?i.type.__ssrInlineRender?i.ssrRender=e:i.render=e:Xe(e)&&(i.setupState=ng(e)),kg(i)}function kg(i,e,t){const n=i.type;i.render||(i.render=n.render||gi);{const s=oo(i);Ui();try{Kp(i)}finally{Bi(),s()}}}const L0={get(i,e){return at(i,"get",""),i[e]}};function M0(i){const e=t=>{i.exposed=t||{}};return{attrs:new Proxy(i.attrs,L0),slots:i.slots,emit:i.emit,expose:e}}function Ga(i){return i.exposed?i.exposeProxy||(i.exposeProxy=new Proxy(ng(yp(i.exposed)),{get(e,t){if(t in e)return e[t];if(t in vr)return vr[t](i)},has(e,t){return t in e||t in vr}})):i.proxy}function F0(i){return ye(i)&&"__vccOpts"in i}const bn=(i,e)=>Rp(i,e,kr),D0="3.5.20";/**
* @vue/runtime-dom v3.5.20
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let pc;const Xu=typeof window<"u"&&window.trustedTypes;if(Xu)try{pc=Xu.createPolicy("vue",{createHTML:i=>i})}catch{}const Ug=pc?i=>pc.createHTML(i):i=>i,O0="http://www.w3.org/2000/svg",G0="http://www.w3.org/1998/Math/MathML",Pi=typeof document<"u"?document:null,ju=Pi&&Pi.createElement("template"),N0={insert:(i,e,t)=>{e.insertBefore(i,t||null)},remove:i=>{const e=i.parentNode;e&&e.removeChild(i)},createElement:(i,e,t,n)=>{const s=e==="svg"?Pi.createElementNS(O0,i):e==="mathml"?Pi.createElementNS(G0,i):t?Pi.createElement(i,{is:t}):Pi.createElement(i);return i==="select"&&n&&n.multiple!=null&&s.setAttribute("multiple",n.multiple),s},createText:i=>Pi.createTextNode(i),createComment:i=>Pi.createComment(i),setText:(i,e)=>{i.nodeValue=e},setElementText:(i,e)=>{i.textContent=e},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>Pi.querySelector(i),setScopeId(i,e){i.setAttribute(e,"")},insertStaticContent(i,e,t,n,s,r){const o=t?t.previousSibling:e.lastChild;if(s&&(s===r||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===r||!(s=s.nextSibling)););else{ju.innerHTML=Ug(n==="svg"?`<svg>${i}</svg>`:n==="mathml"?`<math>${i}</math>`:i);const a=ju.content;if(n==="svg"||n==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},k0=Symbol("_vtc");function U0(i,e,t){const n=i[k0];n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?i.removeAttribute("class"):t?i.setAttribute("class",e):i.className=e}const la=Symbol("_vod"),Bg=Symbol("_vsh"),B0={name:"show",beforeMount(i,{value:e},{transition:t}){i[la]=i.style.display==="none"?"":i.style.display,t&&e?t.beforeEnter(i):or(i,e)},mounted(i,{value:e},{transition:t}){t&&e&&t.enter(i)},updated(i,{value:e,oldValue:t},{transition:n}){!e!=!t&&(n?e?(n.beforeEnter(i),or(i,!0),n.enter(i)):n.leave(i,()=>{or(i,!1)}):or(i,e))},beforeUnmount(i,{value:e}){or(i,e)}};function or(i,e){i.style.display=e?i[la]:"none",i[Bg]=!e}const X0=Symbol(""),j0=/(^|;)\s*display\s*:/;function z0(i,e,t){const n=i.style,s=$e(t);let r=!1;if(t&&!s){if(e)if($e(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&ea(n,a,"")}else for(const o in e)t[o]==null&&ea(n,o,"");for(const o in t)o==="display"&&(r=!0),ea(n,o,t[o])}else if(s){if(e!==t){const o=n[X0];o&&(t+=";"+o),n.cssText=t,r=j0.test(t)}}else e&&i.removeAttribute("style");la in i&&(i[la]=r?n.display:"",i[Bg]&&(n.display="none"))}const zu=/\s*!important$/;function ea(i,e,t){if(de(t))t.forEach(n=>ea(i,e,n));else if(t==null&&(t=""),e.startsWith("--"))i.setProperty(e,t);else{const n=V0(i,e);zu.test(t)?i.setProperty(pn(n),t.replace(zu,""),"important"):i[n]=t}}const Vu=["Webkit","Moz","ms"],El={};function V0(i,e){const t=El[e];if(t)return t;let n=ln(e);if(n!=="filter"&&n in i)return El[e]=n;n=Nf(n);for(let s=0;s<Vu.length;s++){const r=Vu[s]+n;if(r in i)return El[e]=r}return e}const Wu="http://www.w3.org/1999/xlink";function Ku(i,e,t,n,s,r=Zm(e)){n&&e.startsWith("xlink:")?t==null?i.removeAttributeNS(Wu,e.slice(6,e.length)):i.setAttributeNS(Wu,e,t):t==null||r&&!Uf(t)?i.removeAttribute(e):i.setAttribute(e,r?"":mn(t)?String(t):t)}function Yu(i,e,t,n,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(i[e]=e==="innerHTML"?Ug(t):t);return}const r=i.tagName;if(e==="value"&&r!=="PROGRESS"&&!r.includes("-")){const a=r==="OPTION"?i.getAttribute("value")||"":i.value,l=t==null?i.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in i))&&(i.value=l),t==null&&i.removeAttribute(e),i._value=t;return}let o=!1;if(t===""||t==null){const a=typeof i[e];a==="boolean"?t=Uf(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{i[e]=t}catch{}o&&i.removeAttribute(s||e)}function ss(i,e,t,n){i.addEventListener(e,t,n)}function W0(i,e,t,n){i.removeEventListener(e,t,n)}const $u=Symbol("_vei");function K0(i,e,t,n,s=null){const r=i[$u]||(i[$u]={}),o=r[e];if(n&&o)o.value=n;else{const[a,l]=Y0(e);if(n){const h=r[e]=Z0(n,s);ss(i,a,h,l)}else o&&(W0(i,a,o,l),r[e]=void 0)}}const Hu=/(?:Once|Passive|Capture)$/;function Y0(i){let e;if(Hu.test(i)){e={};let n;for(;n=i.match(Hu);)i=i.slice(0,i.length-n[0].length),e[n[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):pn(i.slice(2)),e]}let xl=0;const $0=Promise.resolve(),H0=()=>xl||($0.then(()=>xl=0),xl=Date.now());function Z0(i,e){const t=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=t.attached)return;yi(q0(n,t.value),e,5,[n])};return t.value=i,t.attached=H0(),t}function q0(i,e){if(de(e)){const t=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{t.call(i),i._stopped=!0},e.map(n=>s=>!s._stopped&&n&&n(s))}else return e}const Zu=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&i.charCodeAt(2)>96&&i.charCodeAt(2)<123,J0=(i,e,t,n,s,r)=>{const o=s==="svg";e==="class"?U0(i,n,o):e==="style"?z0(i,t,n):va(e)?Yc(e)||K0(i,e,t,n,r):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Q0(i,e,n,o))?(Yu(i,e,n),!i.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Ku(i,e,n,o,r,e!=="value")):i._isVueCE&&(/[A-Z]/.test(e)||!$e(n))?Yu(i,ln(e),n,r,e):(e==="true-value"?i._trueValue=n:e==="false-value"&&(i._falseValue=n),Ku(i,e,n,o))};function Q0(i,e,t,n){if(n)return!!(e==="innerHTML"||e==="textContent"||e in i&&Zu(e)&&ye(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&i.tagName==="INPUT"||e==="type"&&i.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=i.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Zu(e)&&$e(t)?!1:e in i}const qu=i=>{const e=i.props["onUpdate:modelValue"]||!1;return de(e)?t=>qo(e,t):e};function ey(i){i.target.composing=!0}function Ju(i){const e=i.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Tl=Symbol("_assign"),rs={created(i,{modifiers:{lazy:e,trim:t,number:n}},s){i[Tl]=qu(s);const r=n||s.props&&s.props.type==="number";ss(i,e?"change":"input",o=>{if(o.target.composing)return;let a=i.value;t&&(a=a.trim()),r&&(a=oc(a)),i[Tl](a)}),t&&ss(i,"change",()=>{i.value=i.value.trim()}),e||(ss(i,"compositionstart",ey),ss(i,"compositionend",Ju),ss(i,"change",Ju))},mounted(i,{value:e}){i.value=e??""},beforeUpdate(i,{value:e,oldValue:t,modifiers:{lazy:n,trim:s,number:r}},o){if(i[Tl]=qu(o),i.composing)return;const a=(r||i.type==="number")&&!/^0\d/.test(i.value)?oc(i.value):i.value,l=e??"";a!==l&&(document.activeElement===i&&i.type!=="range"&&(n&&e===t||s&&i.value.trim()===l)||(i.value=l))}},ty=["ctrl","shift","alt","meta"],iy={stop:i=>i.stopPropagation(),prevent:i=>i.preventDefault(),self:i=>i.target!==i.currentTarget,ctrl:i=>!i.ctrlKey,shift:i=>!i.shiftKey,alt:i=>!i.altKey,meta:i=>!i.metaKey,left:i=>"button"in i&&i.button!==0,middle:i=>"button"in i&&i.button!==1,right:i=>"button"in i&&i.button!==2,exact:(i,e)=>ty.some(t=>i[`${t}Key`]&&!e.includes(t))},ny=(i,e)=>{const t=i._withMods||(i._withMods={}),n=e.join(".");return t[n]||(t[n]=(s,...r)=>{for(let o=0;o<e.length;o++){const a=iy[e[o]];if(a&&a(s,e))return}return i(s,...r)})},sy={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},ry=(i,e)=>{const t=i._withKeys||(i._withKeys={}),n=e.join(".");return t[n]||(t[n]=s=>{if(!("key"in s))return;const r=pn(s.key);if(e.some(o=>o===r||sy[o]===r))return i(s)})},oy=Tt({patchProp:J0},N0);let Qu;function ay(){return Qu||(Qu=o0(oy))}const ly=(...i)=>{const e=ay().createApp(...i),{mount:t}=e;return e.mount=n=>{const s=hy(n);if(!s)return;const r=e._component;!ye(r)&&!r.render&&!r.template&&(r.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,cy(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function cy(i){if(i instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&i instanceof MathMLElement)return"mathml"}function hy(i){return $e(i)?document.querySelector(i):i}const Ye={ADD:"add",REMOVE:"remove"},Ls={PROPERTYCHANGE:"propertychange"},ae={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class ao{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function uy(i,e,t){let n,s;t=t||Oi;let r=0,o=i.length,a=!1;for(;r<o;)n=r+(o-r>>1),s=+t(i[n],e),s<0?r=n+1:(o=n,a=!s);return a?r:~r}function Oi(i,e){return i>e?1:i<e?-1:0}function Xg(i,e){return i<e?1:i>e?-1:0}function ch(i,e,t){if(i[0]<=e)return 0;const n=i.length;if(e<=i[n-1])return n-1;if(typeof t=="function"){for(let s=1;s<n;++s){const r=i[s];if(r===e)return s;if(r<e)return t(e,i[s-1],r)>0?s-1:s}return n-1}if(t>0){for(let s=1;s<n;++s)if(i[s]<e)return s-1;return n-1}if(t<0){for(let s=1;s<n;++s)if(i[s]<=e)return s;return n-1}for(let s=1;s<n;++s){if(i[s]==e)return s;if(i[s]<e)return i[s-1]-e<e-i[s]?s-1:s}return n-1}function dy(i,e,t){for(;e<t;){const n=i[e];i[e]=i[t],i[t]=n,++e,--t}}function $t(i,e){const t=Array.isArray(e)?e:[e],n=t.length;for(let s=0;s<n;s++)i[i.length]=t[s]}function zi(i,e){const t=i.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(i[n]!==e[n])return!1;return!0}function fy(i,e,t){const n=e||Oi;return i.every(function(s,r){if(r===0)return!0;const o=n(i[r-1],s);return!(o>0||o===0)})}function un(){return!0}function zs(){return!1}function Ur(){}function jg(i){let e,t,n;return function(){const s=Array.prototype.slice.call(arguments);return(!t||this!==n||!zi(s,t))&&(n=this,t=s,e=i.apply(this,arguments)),e}}function zg(i){function e(){let t;try{t=i()}catch(n){return Promise.reject(n)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function Xn(i){for(const e in i)delete i[e]}function Un(i){let e;for(e in i)return!1;return!e}class qt{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class lo extends ao{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const n=this.listeners_||(this.listeners_={}),s=n[e]||(n[e]=[]);s.includes(t)||s.push(t)}dispatchEvent(e){const t=typeof e=="string",n=t?e:e.type,s=this.listeners_&&this.listeners_[n];if(!s)return;const r=t?new qt(e):e;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=s.length;h<c;++h)if("handleEvent"in s[h]?l=s[h].handleEvent(r):l=s[h].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,Ur);delete o[n]}return l}disposeInternal(){this.listeners_&&Xn(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const n=this.listeners_[e];if(!n)return;const s=n.indexOf(t);s!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[s]=Ur,++this.pendingRemovals_[e]):(n.splice(s,1),n.length===0&&delete this.listeners_[e]))}}function we(i,e,t,n,s){if(s){const o=t;t=function(a){return i.removeEventListener(e,t),o.call(n??this,a)}}else n&&n!==i&&(t=t.bind(n));const r={target:i,type:e,listener:t};return i.addEventListener(e,t),r}function ca(i,e,t,n){return we(i,e,t,n,!0)}function Oe(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),Xn(i))}class co extends lo{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(ae.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const n=e.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=we(this,e[r],t);return s}return we(this,e,t)}onceInternal(e,t){let n;if(Array.isArray(e)){const s=e.length;n=new Array(s);for(let r=0;r<s;++r)n[r]=ca(this,e[r],t)}else n=ca(this,e,t);return t.ol_key=n,n}unInternal(e,t){const n=t.ol_key;if(n)gy(n);else if(Array.isArray(e))for(let s=0,r=e.length;s<r;++s)this.removeEventListener(e[s],t);else this.removeEventListener(e,t)}}co.prototype.on;co.prototype.once;co.prototype.un;function gy(i){if(Array.isArray(i))for(let e=0,t=i.length;e<t;++e)Oe(i[e]);else Oe(i)}function ce(){throw new Error("Unimplemented abstract method.")}let _y=0;function ne(i){return i.ol_uid||(i.ol_uid=String(++_y))}class ed extends qt{constructor(e,t,n){super(e),this.key=t,this.oldValue=n}}class Ci extends co{constructor(e){super(),this.on,this.once,this.un,ne(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let n;n=`change:${e}`,this.hasListener(n)&&this.dispatchEvent(new ed(n,e,t)),n=Ls.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new ed(n,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,n){const s=this.values_||(this.values_={});if(n)s[e]=t;else{const r=s[e];s[e]=t,r!==t&&this.notify(e,r)}}setProperties(e,t){for(const n in e)this.set(n,e[n],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const n=this.values_[e];delete this.values_[e],Un(this.values_)&&(this.values_=null),t||this.notify(e,n)}}}const td={LENGTH:"length"};class wo extends qt{constructor(e,t,n){super(e),this.element=t,this.index=n}}class Nt extends Ci{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let n=0,s=this.array_.length;n<s;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,n=e.length;t<n;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let n=0,s=t.length;n<s;++n)e(t[n],n,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(td.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new wo(Ye.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let n=0,s=t.length;n<s;++n)if(t[n]===e)return this.removeAt(n)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new wo(Ye.REMOVE,t,e)),t}setAt(e,t){const n=this.getLength();if(e>=n){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const s=this.array_[e];this.array_[e]=t,this.dispatchEvent(new wo(Ye.REMOVE,s,e)),this.dispatchEvent(new wo(Ye.ADD,t,e))}updateLength_(){this.set(td.LENGTH,this.array_.length)}assertUnique_(e,t){for(let n=0,s=this.array_.length;n<s;++n)if(this.array_[n]===e&&n!==t)throw new Error("Duplicate item added to a unique collection")}}class os extends qt{constructor(e,t,n){super(e),this.map=t,this.frameState=n!==void 0?n:null}}class Li extends os{constructor(e,t,n,s,r,o){super(e,t,r),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Te={SINGLECLICK:"singleclick",CLICK:ae.CLICK,DBLCLICK:ae.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Bn=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",my=Bn.includes("safari")&&!Bn.includes("chrom"),py=my&&(Bn.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Bn)),yy=Bn.includes("webkit")&&!Bn.includes("edge"),Vg=Bn.includes("macintosh"),Ey=typeof devicePixelRatio<"u"?devicePixelRatio:1,Na=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Wg=typeof Image<"u"&&Image.prototype.decode,Kg=function(){let i=!1;try{const e=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return i}(),yc={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class xy extends lo{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=we(n,yc.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=we(n,yc.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(ae.TOUCHMOVE,this.boundHandleTouchMove_,Kg?{passive:!1}:!1)}emulateClick_(e){let t=new Li(Te.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new Li(Te.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new Li(Te.SINGLECLICK,this.map_,e);this.dispatchEvent(n)},250)}updateActivePointers_(e){const t=e,n=t.pointerId;if(t.type==Te.POINTERUP||t.type==Te.POINTERCANCEL){delete this.trackedTouches_[n];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==t.target){delete this.trackedTouches_[s];break}}else(t.type==Te.POINTERDOWN||t.type==Te.POINTERMOVE)&&(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new Li(Te.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Oe),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new Li(Te.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(we(n,Te.POINTERMOVE,this.handlePointerMove_,this),we(n,Te.POINTERUP,this.handlePointerUp_,this),we(this.element_,Te.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(we(this.element_.getRootNode(),Te.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new Li(Te.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new Li(Te.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Oe(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(ae.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Oe(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Oe),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const qi={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},rt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Z={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Le(i,e){if(!i)throw new Error(e)}const ha=1/0;class Ty{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Xn(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,n=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const s=this.keyFunction_(n);return delete this.queuedElements_[s],n}enqueue(e){Le(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=ha?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,n=this.priorities_,s=t.length,r=t[e],o=n[e],a=e;for(;e<s>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),c=h<s&&n[h]<n[l]?h:l;t[e]=t[c],n[e]=n[c],e=c}t[e]=r,n[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const n=this.elements_,s=this.priorities_,r=n[t],o=s[t];for(;t>e;){const a=this.getParentIndex_(t);if(s[a]>o)n[t]=n[a],s[t]=s[a],t=a;else break}n[t]=r,s[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,n=this.priorities_;let s=0;const r=t.length;let o,a,l;for(a=0;a<r;++a)o=t[a],l=e(o),l==ha?delete this.queuedElements_[this.keyFunction_(o)]:(n[s]=l,t[s++]=o);t.length=s,n.length=s,this.heapify_()}}class Cy extends Ty{constructor(e,t){super(n=>e.apply(null,n),n=>n[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(ae.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,n=t.getState();if(n===Z.LOADED||n===Z.ERROR||n===Z.EMPTY){n!==Z.ERROR&&t.removeEventListener(ae.CHANGE,this.boundHandleTileChange_);const s=t.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let n=0;for(;this.tilesLoading_<e&&n<t&&this.getCount()>0;){const s=this.dequeue()[0],r=s.getKey();s.getState()===Z.IDLE&&!(r in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++n,s.load())}}}function wy(i,e,t,n,s){if(!i||!(t in i.wantedTiles)||!i.wantedTiles[t][e.getKey()])return ha;const r=i.viewState.center,o=n[0]-r[0],a=n[1]-r[1];return 65536*Math.log(s)+Math.sqrt(o*o+a*a)/s}const ot={ANIMATING:0,INTERACTING:1},Qt={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Ge(i,e,t){return Math.min(Math.max(i,e),t)}function Ry(i,e,t,n,s,r){const o=s-t,a=r-n;if(o!==0||a!==0){const l=((i-t)*o+(e-n)*a)/(o*o+a*a);l>1?(t=s,n=r):l>0&&(t+=o*l,n+=a*l)}return Gi(i,e,t,n)}function Gi(i,e,t,n){const s=t-i,r=n-e;return s*s+r*r}function Sy(i){const e=i.length;for(let n=0;n<e;n++){let s=n,r=Math.abs(i[n][n]);for(let a=n+1;a<e;a++){const l=Math.abs(i[a][n]);l>r&&(r=l,s=a)}if(r===0)return null;const o=i[s];i[s]=i[n],i[n]=o;for(let a=n+1;a<e;a++){const l=-i[a][n]/i[n][n];for(let h=n;h<e+1;h++)n==h?i[a][h]=0:i[a][h]+=l*i[n][h]}}const t=new Array(e);for(let n=e-1;n>=0;n--){t[n]=i[n][e]/i[n][n];for(let s=n-1;s>=0;s--)i[s][e]-=i[s][n]*t[n]}return t}function id(i){return i*180/Math.PI}function on(i){return i*Math.PI/180}function Nn(i,e){const t=i%e;return t*e<0?t+e:t}function Ft(i,e,t){return i+t*(e-i)}function ho(i,e){const t=Math.pow(10,e);return Math.round(i*t)/t}function Ro(i,e){return Math.floor(ho(i,e))}function So(i,e){return Math.ceil(ho(i,e))}function Ec(i,e,t){if(i>=e&&i<t)return i;const n=t-e;return((i-e)%n+n)%n+e}function nd(i,e,t){return function(n,s,r,o,a){if(!n)return;if(!s&&!e)return n;const l=e?0:r[0]*s,h=e?0:r[1]*s,c=a?a[0]:0,u=a?a[1]:0;let d=i[0]+l/2+c,f=i[2]-l/2+c,g=i[1]+h/2+u,_=i[3]-h/2+u;d>f&&(d=(f+d)/2,f=d),g>_&&(g=(_+g)/2,_=g);let m=Ge(n[0],d,f),y=Ge(n[1],g,_);if(o&&t&&s){const p=30*s;m+=-p*Math.log(1+Math.max(0,d-n[0])/p)+p*Math.log(1+Math.max(0,n[0]-f)/p),y+=-p*Math.log(1+Math.max(0,g-n[1])/p)+p*Math.log(1+Math.max(0,n[1]-_)/p)}return[m,y]}}function vy(i){return i}const Ze={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function ft(i){const e=kt();for(let t=0,n=i.length;t<n;++t)Ar(e,i[t]);return e}function Iy(i,e,t){const n=Math.min.apply(null,i),s=Math.min.apply(null,e),r=Math.max.apply(null,i),o=Math.max.apply(null,e);return Ei(n,s,r,o,t)}function ka(i,e,t){return t?(t[0]=i[0]-e,t[1]=i[1]-e,t[2]=i[2]+e,t[3]=i[3]+e,t):[i[0]-e,i[1]-e,i[2]+e,i[3]+e]}function Yg(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i.slice()}function jn(i,e,t){let n,s;return e<i[0]?n=i[0]-e:i[2]<e?n=e-i[2]:n=0,t<i[1]?s=i[1]-t:i[3]<t?s=t-i[3]:s=0,n*n+s*s}function dn(i,e){return hh(i,e[0],e[1])}function gr(i,e){return i[0]<=e[0]&&e[2]<=i[2]&&i[1]<=e[1]&&e[3]<=i[3]}function hh(i,e,t){return i[0]<=e&&e<=i[2]&&i[1]<=t&&t<=i[3]}function xc(i,e){const t=i[0],n=i[1],s=i[2],r=i[3],o=e[0],a=e[1];let l=Ze.UNKNOWN;return o<t?l=l|Ze.LEFT:o>s&&(l=l|Ze.RIGHT),a<n?l=l|Ze.BELOW:a>r&&(l=l|Ze.ABOVE),l===Ze.UNKNOWN&&(l=Ze.INTERSECTING),l}function kt(){return[1/0,1/0,-1/0,-1/0]}function Ei(i,e,t,n,s){return s?(s[0]=i,s[1]=e,s[2]=t,s[3]=n,s):[i,e,t,n]}function Vs(i){return Ei(1/0,1/0,-1/0,-1/0,i)}function br(i,e){const t=i[0],n=i[1];return Ei(t,n,t,n,e)}function uh(i,e,t,n,s){const r=Vs(s);return $g(r,i,e,t,n)}function Br(i,e){return i[0]==e[0]&&i[2]==e[2]&&i[1]==e[1]&&i[3]==e[3]}function dh(i,e){return e[0]<i[0]&&(i[0]=e[0]),e[2]>i[2]&&(i[2]=e[2]),e[1]<i[1]&&(i[1]=e[1]),e[3]>i[3]&&(i[3]=e[3]),i}function Ar(i,e){e[0]<i[0]&&(i[0]=e[0]),e[0]>i[2]&&(i[2]=e[0]),e[1]<i[1]&&(i[1]=e[1]),e[1]>i[3]&&(i[3]=e[1])}function $g(i,e,t,n,s){for(;t<n;t+=s)by(i,e[t],e[t+1]);return i}function by(i,e,t){i[0]=Math.min(i[0],e),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],e),i[3]=Math.max(i[3],t)}function fh(i,e){let t;return t=e(Ua(i)),t||(t=e(Ba(i)),t)||(t=e(Xa(i)),t)||(t=e(Xi(i)),t)?t:!1}function Xr(i){let e=0;return Ws(i)||(e=Se(i)*Je(i)),e}function Ua(i){return[i[0],i[1]]}function Ba(i){return[i[2],i[1]]}function xi(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function Ay(i,e){let t;if(e==="bottom-left")t=Ua(i);else if(e==="bottom-right")t=Ba(i);else if(e==="top-left")t=Xi(i);else if(e==="top-right")t=Xa(i);else throw new Error("Invalid corner");return t}function Tc(i,e,t,n,s){const[r,o,a,l,h,c,u,d]=gh(i,e,t,n);return Ei(Math.min(r,a,h,u),Math.min(o,l,c,d),Math.max(r,a,h,u),Math.max(o,l,c,d),s)}function gh(i,e,t,n){const s=e*n[0]/2,r=e*n[1]/2,o=Math.cos(t),a=Math.sin(t),l=s*o,h=s*a,c=r*o,u=r*a,d=i[0],f=i[1];return[d-l+u,f-h-c,d-l-u,f-h+c,d+l-u,f+h+c,d+l+u,f+h-c,d-l+u,f-h-c]}function Je(i){return i[3]-i[1]}function xt(i,e,t){const n=t||kt();return Et(i,e)?(i[0]>e[0]?n[0]=i[0]:n[0]=e[0],i[1]>e[1]?n[1]=i[1]:n[1]=e[1],i[2]<e[2]?n[2]=i[2]:n[2]=e[2],i[3]<e[3]?n[3]=i[3]:n[3]=e[3]):Vs(n),n}function Xi(i){return[i[0],i[3]]}function Xa(i){return[i[2],i[3]]}function Se(i){return i[2]-i[0]}function Et(i,e){return i[0]<=e[2]&&i[2]>=e[0]&&i[1]<=e[3]&&i[3]>=e[1]}function Ws(i){return i[2]<i[0]||i[3]<i[1]}function Py(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i}function Ly(i,e,t){let n=!1;const s=xc(i,e),r=xc(i,t);if(s===Ze.INTERSECTING||r===Ze.INTERSECTING)n=!0;else{const o=i[0],a=i[1],l=i[2],h=i[3],c=e[0],u=e[1],d=t[0],f=t[1],g=(f-u)/(d-c);let _,m;r&Ze.ABOVE&&!(s&Ze.ABOVE)&&(_=d-(f-h)/g,n=_>=o&&_<=l),!n&&r&Ze.RIGHT&&!(s&Ze.RIGHT)&&(m=f-(d-l)*g,n=m>=a&&m<=h),!n&&r&Ze.BELOW&&!(s&Ze.BELOW)&&(_=d-(f-a)/g,n=_>=o&&_<=l),!n&&r&Ze.LEFT&&!(s&Ze.LEFT)&&(m=f-(d-o)*g,n=m>=a&&m<=h)}return n}function My(i,e,t,n){if(Ws(i))return Vs(t);let s=[];s=[i[0],i[1],i[2],i[1],i[2],i[3],i[0],i[3]],e(s,s,2);const r=[],o=[];for(let a=0,l=s.length;a<l;a+=2)r.push(s[a]),o.push(s[a+1]);return Iy(r,o,t)}function Hg(i,e){const t=e.getExtent(),n=xi(i);if(e.canWrapX()&&(n[0]<t[0]||n[0]>=t[2])){const s=Se(t),o=Math.floor((n[0]-t[0])/s)*s;i[0]-=o,i[2]-=o}return i}function _h(i,e,t){if(e.canWrapX()){const n=e.getExtent();if(!isFinite(i[0])||!isFinite(i[2]))return[[n[0],i[1],n[2],i[3]]];Hg(i,e);const s=Se(n);if(Se(i)>s&&!t)return[[n[0],i[1],n[2],i[3]]];if(i[0]<n[0])return[[i[0]+s,i[1],n[2],i[3]],[n[0],i[1],i[2],i[3]]];if(i[2]>n[2])return[[i[0],i[1],n[2],i[3]],[n[0],i[1],i[2]-s,i[3]]]}return[i]}function Fy(i,e){return i[0]+=+e[0],i[1]+=+e[1],i}function Zg(i,e){const t=i[0],n=i[1],s=e[0],r=e[1],o=s[0],a=s[1],l=r[0],h=r[1],c=l-o,u=h-a,d=c===0&&u===0?0:(c*(t-o)+u*(n-a))/(c*c+u*u||0);let f,g;return d<=0?(f=o,g=a):d>=1?(f=l,g=h):(f=o+d*c,g=a+d*u),[f,g]}function gt(i,e){let t=!0;for(let n=i.length-1;n>=0;--n)if(i[n]!=e[n]){t=!1;break}return t}function mh(i,e){const t=Math.cos(e),n=Math.sin(e),s=i[0]*t-i[1]*n,r=i[1]*t+i[0]*n;return i[0]=s,i[1]=r,i}function Dy(i,e){return i[0]*=e,i[1]*=e,i}function Ms(i,e){const t=i[0]-e[0],n=i[1]-e[1];return t*t+n*n}function ua(i,e){return Math.sqrt(Ms(i,e))}function Oy(i,e){return Ms(i,Zg(i,e))}function qg(i,e){if(e.canWrapX()){const t=Se(e.getExtent()),n=Gy(i,e,t);n&&(i[0]-=n*t)}return i}function Gy(i,e,t){const n=e.getExtent();let s=0;return e.canWrapX()&&(i[0]<n[0]||i[0]>n[2])&&(t=t||Se(n),s=Math.floor((i[0]-n[0])/t)),s}function Jg(i){return Math.pow(i,3)}function Ks(i){return 1-Jg(1-i)}function Ny(i){return 3*i*i-2*i*i*i}function ky(i){return i}const Uy=63710088e-1;function sd(i,e,t){t=t||Uy;const n=on(i[1]),s=on(e[1]),r=(s-n)/2,o=on(e[0]-i[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(s);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function Qg(...i){console.warn(...i)}function rd(...i){console.error(...i)}const By={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function od(i){return By[i]}const Fs={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class jr{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Fs[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const uo=6378137,ds=Math.PI*uo,Xy=[-ds,-ds,ds,ds],jy=[-180,-85,180,85],vo=uo*Math.log(Math.tan(Math.PI/2));class Yn extends jr{constructor(e){super({code:e,units:"m",extent:Xy,global:!0,worldExtent:jy,getPointResolution:function(t,n){return t/Math.cosh(n[1]/uo)}})}}const ad=[new Yn("EPSG:3857"),new Yn("EPSG:102100"),new Yn("EPSG:102113"),new Yn("EPSG:900913"),new Yn("http://www.opengis.net/def/crs/EPSG/0/3857"),new Yn("http://www.opengis.net/gml/srs/epsg.xml#3857")];function zy(i,e,t,n){const s=i.length;t=t>1?t:2,n=n??t,e===void 0&&(t>2?e=i.slice():e=new Array(s));for(let r=0;r<s;r+=n){e[r]=ds*i[r]/180;let o=uo*Math.log(Math.tan(Math.PI*(+i[r+1]+90)/360));o>vo?o=vo:o<-vo&&(o=-vo),e[r+1]=o}return e}function Vy(i,e,t,n){const s=i.length;t=t>1?t:2,n=n??t,e===void 0&&(t>2?e=i.slice():e=new Array(s));for(let r=0;r<s;r+=n)e[r]=180*i[r]/ds,e[r+1]=360*Math.atan(Math.exp(i[r+1]/uo))/Math.PI-90;return e}const Wy=6378137,ld=[-180,-90,180,90],Ky=Math.PI*Wy/180;class Sn extends jr{constructor(e,t){super({code:e,units:"degrees",extent:ld,axisOrientation:t,global:!0,metersPerUnit:Ky,worldExtent:ld})}}const cd=[new Sn("CRS:84"),new Sn("EPSG:4326","neu"),new Sn("urn:ogc:def:crs:OGC:1.3:CRS84"),new Sn("urn:ogc:def:crs:OGC:2:84"),new Sn("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Sn("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Sn("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Cc={};function Yy(i){return Cc[i]||Cc[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function $y(i,e){Cc[i]=e}let ws={};function zr(i,e,t){const n=i.getCode(),s=e.getCode();n in ws||(ws[n]={}),ws[n][s]=t}function Cl(i,e){return i in ws&&e in ws[i]?ws[i][e]:null}const da=.9996,Ht=.00669438,ja=Ht*Ht,za=ja*Ht,Mn=Ht/(1-Ht),hd=Math.sqrt(1-Ht),Ds=(1-hd)/(1+hd),e_=Ds*Ds,ph=e_*Ds,yh=ph*Ds,t_=yh*Ds,i_=1-Ht/4-3*ja/64-5*za/256,Hy=3*Ht/8+3*ja/32+45*za/1024,Zy=15*ja/256+45*za/1024,qy=35*za/3072,Jy=3/2*Ds-27/32*ph+269/512*t_,Qy=21/16*e_-55/32*yh,eE=151/96*ph-417/128*t_,tE=1097/512*yh,fa=6378137;function iE(i,e,t){const n=i-5e5,o=(t.north?e:e-1e7)/da/(fa*i_),a=o+Jy*Math.sin(2*o)+Qy*Math.sin(4*o)+eE*Math.sin(6*o)+tE*Math.sin(8*o),l=Math.sin(a),h=l*l,c=Math.cos(a),u=l/c,d=u*u,f=d*d,g=1-Ht*h,_=Math.sqrt(1-Ht*h),m=fa/_,y=(1-Ht)/g,p=Mn*c**2,x=p*p,E=n/(m*da),T=E*E,R=T*E,I=R*E,S=I*E,A=S*E,b=a-u/y*(T/2-I/24*(5+3*d+10*p-4*x-9*Mn))+A/720*(61+90*d+298*p+45*f-252*Mn-3*x);let X=(E-R/6*(1+2*d+p)+S/120*(5-2*p+28*d-3*x+8*Mn+24*f))/c;return X=Ec(X+on(n_(t.number)),-Math.PI,Math.PI),[id(X),id(b)]}const ud=-80,dd=84,nE=-180,sE=180;function rE(i,e,t){i=Ec(i,nE,sE),e<ud?e=ud:e>dd&&(e=dd);const n=on(e),s=Math.sin(n),r=Math.cos(n),o=s/r,a=o*o,l=a*a,h=on(i),c=n_(t.number),u=on(c),d=fa/Math.sqrt(1-Ht*s**2),f=Mn*r**2,g=r*Ec(h-u,-Math.PI,Math.PI),_=g*g,m=_*g,y=m*g,p=y*g,x=p*g,E=fa*(i_*n-Hy*Math.sin(2*n)+Zy*Math.sin(4*n)-qy*Math.sin(6*n)),T=da*d*(g+m/6*(1-a+f)+p/120*(5-18*a+l+72*f-58*Mn))+5e5;let R=da*(E+d*o*(_/2+y/24*(5-a+9*f+4*f**2)+x/720*(61-58*a+l+600*f-330*Mn)));return t.north||(R+=1e7),[T,R]}function n_(i){return(i-1)*6-180+3}const oE=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function s_(i){let e=0;for(const s of oE){const r=i.match(s);if(r){e=parseInt(r[1]);break}}if(!e)return null;let t=0,n=!1;return e>32700&&e<32761?t=e-32700:e>32600&&e<32661&&(n=!0,t=e-32600),t?{number:t,north:n}:null}function fd(i,e){return function(t,n,s,r){const o=t.length;s=s>1?s:2,r=r??s,n||(s>2?n=t.slice():n=new Array(o));for(let a=0;a<o;a+=r){const l=t[a],h=t[a+1],c=i(l,h,e);n[a]=c[0],n[a+1]=c[1]}return n}}function aE(i){return s_(i)?new jr({code:i,units:"m"}):null}function lE(i){const e=s_(i.getCode());return e?{forward:fd(rE,e),inverse:fd(iE,e)}:null}const cE=[lE],hE=[aE];let wc=!0;function r_(i){wc=!1}function Eh(i,e){if(e!==void 0){for(let t=0,n=i.length;t<n;++t)e[t]=i[t];e=e}else e=i.slice();return e}function Rc(i){$y(i.getCode(),i),zr(i,i,Eh)}function uE(i){i.forEach(Rc)}function ke(i){if(typeof i!="string")return i;const e=Yy(i);if(e)return e;for(const t of hE){const n=t(i);if(n)return n}return null}function ga(i,e,t,n){i=ke(i);let s;const r=i.getPointResolutionFunc();if(r){if(s=r(e,t),n&&n!==i.getUnits()){const o=i.getMetersPerUnit();o&&(s=s*o/Fs[n])}}else{const o=i.getUnits();if(o=="degrees"&&!n||n=="degrees")s=e;else{const a=Th(i,ke("EPSG:4326"));if(!a&&o!=="degrees")s=e*i.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=a(h,h,2);const c=sd(h.slice(0,2),h.slice(2,4)),u=sd(h.slice(4,6),h.slice(6,8));s=(c+u)/2}const l=n?Fs[n]:i.getMetersPerUnit();l!==void 0&&(s/=l)}}return s}function gd(i){uE(i),i.forEach(function(e){i.forEach(function(t){e!==t&&zr(e,t,Eh)})})}function dE(i,e,t,n){i.forEach(function(s){e.forEach(function(r){zr(s,r,t),zr(r,s,n)})})}function xh(i,e){return i?typeof i=="string"?ke(i):i:ke(e)}function o_(i){return function(e,t,n,s){const r=e.length;n=n!==void 0?n:2,s=s??n,t=t!==void 0?t:new Array(r);for(let o=0;o<r;o+=s){const a=i(e.slice(o,o+n)),l=a.length;for(let h=0,c=s;h<c;++h)t[o+h]=h>=l?e[o+h]:a[h]}return t}}function _d(i,e){return r_(),Va(i,"EPSG:4326","EPSG:3857")}function md(i,e){const t=Va(i,"EPSG:3857","EPSG:4326"),n=t[0];return(n<-180||n>180)&&(t[0]=Nn(n+180,360)-180),t}function kn(i,e){if(i===e)return!0;const t=i.getUnits()===e.getUnits();return(i.getCode()===e.getCode()||Th(i,e)===Eh)&&t}function Th(i,e){const t=i.getCode(),n=e.getCode();let s=Cl(t,n);if(s)return s;let r=null,o=null;for(const l of cE)r||(r=l(i)),o||(o=l(e));if(!r&&!o)return null;const a="EPSG:4326";if(o)if(r)s=wl(r.inverse,o.forward);else{const l=Cl(t,a);l&&(s=wl(l,o.forward))}else{const l=Cl(a,n);l&&(s=wl(r.inverse,l))}return s&&(Rc(i),Rc(e),zr(i,e,s)),s}function wl(i,e){return function(t,n,s,r){return n=i(t,n,s,r),e(n,n,s,r)}}function Vr(i,e){const t=ke(i),n=ke(e);return Th(t,n)}function Va(i,e,t){const n=Vr(e,t);if(!n){const s=ke(e).getCode(),r=ke(t).getCode();throw new Error(`No transform available between ${s} and ${r}`)}return n(i,void 0,i.length)}function fn(i,e){return i}function Be(i,e){return wc&&!gt(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(wc=!1,Qg("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function Wa(i,e){return i}function ei(i,e){return i}function fE(){gd(ad),gd(cd),dE(cd,ad,zy,Vy)}fE();const Ch=new Array(6);function ht(){return[1,0,0,1,0,0]}function gE(i){return Ka(i,1,0,0,1,0,0)}function Wr(i,e){const t=i[0],n=i[1],s=i[2],r=i[3],o=i[4],a=i[5],l=e[0],h=e[1],c=e[2],u=e[3],d=e[4],f=e[5];return i[0]=t*l+s*h,i[1]=n*l+r*h,i[2]=t*c+s*u,i[3]=n*c+r*u,i[4]=t*d+s*f+o,i[5]=n*d+r*f+a,i}function Ka(i,e,t,n,s,r,o){return i[0]=e,i[1]=t,i[2]=n,i[3]=s,i[4]=r,i[5]=o,i}function _E(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i}function Ke(i,e){const t=e[0],n=e[1];return e[0]=i[0]*t+i[2]*n+i[4],e[1]=i[1]*t+i[3]*n+i[5],e}function mE(i,e){const t=Math.cos(e),n=Math.sin(e);return Wr(i,Ka(Ch,t,n,-n,t,0,0))}function pd(i,e,t){return Wr(i,Ka(Ch,e,0,0,t,0,0))}function pE(i,e,t){return Wr(i,Ka(Ch,1,0,0,1,e,t))}function ii(i,e,t,n,s,r,o,a){const l=Math.sin(r),h=Math.cos(r);return i[0]=n*h,i[1]=s*l,i[2]=-n*l,i[3]=s*h,i[4]=o*n*h-a*n*l+e,i[5]=o*s*l+a*s*h+t,i}function wh(i,e){const t=yE(e);Le(t!==0,"Transformation matrix cannot be inverted");const n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5];return i[0]=o/t,i[1]=-s/t,i[2]=-r/t,i[3]=n/t,i[4]=(r*l-o*a)/t,i[5]=-(n*l-s*a)/t,i}function yE(i){return i[0]*i[3]-i[1]*i[2]}const EE=[1e5,1e5,1e5,1e5,2,2];function xE(i){return"matrix("+i.join(", ")+")"}function yd(i){return i.substring(7,i.length-1).split(",").map(parseFloat)}function TE(i,e){const t=yd(i),n=yd(e);for(let s=0;s<6;++s)if(Math.round((t[s]-n[s])*EE[s])!==0)return!1;return!0}function an(i,e,t,n,s,r,o){r=r||[],o=o||2;let a=0;for(let l=e;l<t;l+=n){const h=i[l],c=i[l+1];r[a++]=s[0]*h+s[2]*c+s[4],r[a++]=s[1]*h+s[3]*c+s[5];for(let u=2;u<o;u++)r[a++]=i[l+u]}return r&&r.length!=a&&(r.length=a),r}function Rh(i,e,t,n,s,r,o){o=o||[];const a=Math.cos(s),l=Math.sin(s),h=r[0],c=r[1];let u=0;for(let d=e;d<t;d+=n){const f=i[d]-h,g=i[d+1]-c;o[u++]=h+f*a-g*l,o[u++]=c+f*l+g*a;for(let _=d+2;_<d+n;++_)o[u++]=i[_]}return o&&o.length!=u&&(o.length=u),o}function CE(i,e,t,n,s,r,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=e;u<t;u+=n){const d=i[u]-l,f=i[u+1]-h;a[c++]=l+s*d,a[c++]=h+r*f;for(let g=u+2;g<u+n;++g)a[c++]=i[g]}return a&&a.length!=c&&(a.length=c),a}function wE(i,e,t,n,s,r,o){o=o||[];let a=0;for(let l=e;l<t;l+=n){o[a++]=i[l]+s,o[a++]=i[l+1]+r;for(let h=l+2;h<l+n;++h)o[a++]=i[h]}return o&&o.length!=a&&(o.length=a),o}const Ed=ht(),RE=[NaN,NaN];class a_ extends Ci{constructor(){super(),this.extent_=kt(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=jg((e,t,n)=>{if(!n)return this.getSimplifiedGeometry(t);const s=this.clone();return s.applyTransform(n),s.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return ce()}closestPointXY(e,t,n,s){return ce()}containsXY(e,t){return this.closestPointXY(e,t,RE,Number.MIN_VALUE)===0}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return ce()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&Vs(t),this.extentRevision_=this.getRevision()}return Py(this.extent_,e)}rotate(e,t){ce()}scale(e,t,n){ce()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return ce()}getType(){return ce()}applyTransform(e){ce()}intersectsExtent(e){return ce()}translate(e,t){ce()}transform(e,t){const n=ke(e),s=n.getUnits()=="tile-pixels"?function(r,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=Je(h)/Je(l);ii(Ed,h[0],h[3],c,-c,0,0,0);const u=an(r,0,r.length,a,Ed,o),d=Vr(n,t);return d?d(u,u,a):u}:Vr(n,t);return this.applyTransform(s),this}}class yn extends a_{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return uh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return ce()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=_a(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){ce()}setLayout(e,t,n){let s;if(e)s=_a(e);else{for(let r=0;r<n;++r){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}s=t.length,e=zn(s)}this.layout=e,this.stride=s}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(e,t){const n=this.getFlatCoordinates();if(n){const s=this.getStride();Rh(n,0,n.length,s,e,t,n),this.changed()}}scale(e,t,n){t===void 0&&(t=e),n||(n=xi(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();CE(s,0,s.length,r,e,t,n,s),this.changed()}}translate(e,t){const n=this.getFlatCoordinates();if(n){const s=this.getStride();wE(n,0,n.length,s,e,t,n),this.changed()}}}function zn(i){let e;return i==2?e="XY":i==3?e="XYZ":i==4&&(e="XYZM"),e}function _a(i){let e;return i=="XY"?e=2:i=="XYZ"||i=="XYM"?e=3:i=="XYZM"&&(e=4),e}function SE(i,e,t){const n=i.getFlatCoordinates();if(!n)return null;const s=i.getStride();return an(n,0,n.length,s,e,t)}function l_(i,e,t,n){let s=0;const r=i[t-n],o=i[t-n+1];let a=0,l=0;for(;e<t;e+=n){const h=i[e]-r,c=i[e+1]-o;s+=l*h-a*c,a=h,l=c}return s/2}function c_(i,e,t,n){let s=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];s+=l_(i,e,a,n),e=a}return s}function vE(i,e,t,n){let s=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];s+=c_(i,e,a,n),e=a[a.length-1]}return s}function xd(i,e,t,n,s,r,o){const a=i[e],l=i[e+1],h=i[t]-a,c=i[t+1]-l;let u;if(h===0&&c===0)u=e;else{const d=((s-a)*h+(r-l)*c)/(h*h+c*c);if(d>1)u=t;else if(d>0){for(let f=0;f<n;++f)o[f]=Ft(i[e+f],i[t+f],d);o.length=n;return}else u=e}for(let d=0;d<n;++d)o[d]=i[u+d];o.length=n}function Sh(i,e,t,n,s){let r=i[e],o=i[e+1];for(e+=n;e<t;e+=n){const a=i[e],l=i[e+1],h=Gi(r,o,a,l);h>s&&(s=h),r=a,o=l}return s}function vh(i,e,t,n,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];s=Sh(i,e,a,n,s),e=a}return s}function IE(i,e,t,n,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];s=vh(i,e,a,n,s),e=a[a.length-1]}return s}function Ih(i,e,t,n,s,r,o,a,l,h,c){if(e==t)return h;let u,d;if(s===0){if(d=Gi(o,a,i[e],i[e+1]),d<h){for(u=0;u<n;++u)l[u]=i[e+u];return l.length=n,d}return h}c=c||[NaN,NaN];let f=e+n;for(;f<t;)if(xd(i,f-n,f,n,o,a,c),d=Gi(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n,f+=n}else f+=n*Math.max((Math.sqrt(d)-Math.sqrt(h))/s|0,1);if(r&&(xd(i,t-n,e,n,o,a,c),d=Gi(o,a,c[0],c[1]),d<h)){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function bh(i,e,t,n,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const f=t[u];h=Ih(i,e,f,n,s,r,o,a,l,h,c),e=f}return h}function bE(i,e,t,n,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const f=t[u];h=bh(i,e,f,n,s,r,o,a,l,h,c),e=f[f.length-1]}return h}function h_(i,e,t,n){for(let s=0,r=t.length;s<r;++s)i[e++]=t[s];return e}function Ya(i,e,t,n){for(let s=0,r=t.length;s<r;++s){const o=t[s];for(let a=0;a<n;++a)i[e++]=o[a]}return e}function fo(i,e,t,n,s){s=s||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=Ya(i,e,t[o],n);s[r++]=l,e=l}return s.length=r,s}function u_(i,e,t,n,s){s=s||[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=fo(i,e,t[o],n,s[r]);l.length===0&&(l[0]=e),s[r++]=l,e=l[l.length-1]}return s.length=r,s}function nn(i,e,t,n,s){s=s!==void 0?s:[];let r=0;for(let o=e;o<t;o+=n)s[r++]=i.slice(o,o+n);return s.length=r,s}function Kr(i,e,t,n,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];s[r++]=nn(i,e,l,n,s[r]),e=l}return s.length=r,s}function Sc(i,e,t,n,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];s[r++]=l.length===1&&l[0]===e?[]:Kr(i,e,l,n,s[r]),e=l[l.length-1]}return s.length=r,s}function $a(i,e,t,n,s,r,o){const a=(t-e)/n;if(a<3){for(;e<t;e+=n)r[o++]=i[e],r[o++]=i[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-n];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let f=0;const g=i[d],_=i[d+1],m=i[u],y=i[u+1];for(let p=d+n;p<u;p+=n){const x=i[p],E=i[p+1],T=Ry(x,E,g,_,m,y);T>f&&(c=p,f=T)}f>s&&(l[(c-e)/n]=1,d+n<c&&h.push(d,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(r[o++]=i[e+u*n],r[o++]=i[e+u*n+1]);return o}function d_(i,e,t,n,s,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=$a(i,e,c,n,s,r,o),a.push(o),e=c}return o}function An(i,e){return e*Math.round(i/e)}function AE(i,e,t,n,s,r,o){if(e==t)return o;let a=An(i[e],s),l=An(i[e+1],s);e+=n,r[o++]=a,r[o++]=l;let h,c;do if(h=An(i[e],s),c=An(i[e+1],s),e+=n,e==t)return r[o++]=h,r[o++]=c,o;while(h==a&&c==l);for(;e<t;){const u=An(i[e],s),d=An(i[e+1],s);if(e+=n,u==h&&d==c)continue;const f=h-a,g=c-l,_=u-a,m=d-l;if(f*m==g*_&&(f<0&&_<f||f==_||f>0&&_>f)&&(g<0&&m<g||g==m||g>0&&m>g)){h=u,c=d;continue}r[o++]=h,r[o++]=c,a=h,l=c,h=u,c=d}return r[o++]=h,r[o++]=c,o}function Ah(i,e,t,n,s,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=AE(i,e,c,n,s,r,o),a.push(o),e=c}return o}function PE(i,e,t,n,s,r,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l],u=[];o=Ah(i,e,c,n,s,r,o,u),a.push(u),e=c[c.length-1]}return o}class Yr extends yn{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new Yr(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,n,s){return s<jn(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Sh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ih(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,n,s))}getArea(){return l_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return nn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=$a(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Yr(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ya(this.flatCoordinates,0,e,this.stride),this.changed()}}class Zt extends yn{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Zt(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){const r=this.flatCoordinates,o=Gi(e,t,r[0],r[1]);if(o<s){const a=this.stride;for(let l=0;l<a;++l)n[l]=r[l];return n.length=a,o}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return br(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return hh(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=h_(this.flatCoordinates,0,e,this.stride),this.changed()}}function LE(i,e,t,n,s){return!fh(s,function(o){return!Fn(i,e,t,n,o[0],o[1])})}function Fn(i,e,t,n,s,r){let o=0,a=i[t-n],l=i[t-n+1];for(;e<t;e+=n){const h=i[e],c=i[e+1];l<=r?c>r&&(h-a)*(r-l)-(s-a)*(c-l)>0&&o++:c<=r&&(h-a)*(r-l)-(s-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Ph(i,e,t,n,s,r){if(t.length===0||!Fn(i,e,t[0],n,s,r))return!1;for(let o=1,a=t.length;o<a;++o)if(Fn(i,t[o-1],t[o],n,s,r))return!1;return!0}function ME(i,e,t,n,s,r){if(t.length===0)return!1;for(let o=0,a=t.length;o<a;++o){const l=t[o];if(Ph(i,e,l,n,s,r))return!0;e=l[l.length-1]}return!1}function Lh(i,e,t,n,s,r,o){let a,l,h,c,u,d,f;const g=s[r+1],_=[];for(let p=0,x=t.length;p<x;++p){const E=t[p];for(c=i[E-n],d=i[E-n+1],a=e;a<E;a+=n)u=i[a],f=i[a+1],(g<=d&&f<=g||d<=g&&g<=f)&&(h=(g-d)/(f-d)*(u-c)+c,_.push(h)),c=u,d=f}let m=NaN,y=-1/0;for(_.sort(Oi),c=_[0],a=1,l=_.length;a<l;++a){u=_[a];const p=Math.abs(u-c);p>y&&(h=(c+u)/2,Ph(i,e,t,n,h,g)&&(m=h,y=p)),c=u}return isNaN(m)&&(m=s[r]),o?(o.push(m,g,y),o):[m,g,y]}function f_(i,e,t,n,s){let r=[];for(let o=0,a=t.length;o<a;++o){const l=t[o];r=Lh(i,e,l,n,s,2*o,r),e=l[l.length-1]}return r}function g_(i,e,t,n,s){let r;for(e+=n;e<t;e+=n)if(r=s(i.slice(e-n,e),i.slice(e,e+n)),r)return r;return!1}function Ha(i,e,t,n,s,r){return r=r??$g(kt(),i,e,t,n),Et(s,r)?r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:g_(i,e,t,n,function(o,a){return Ly(s,o,a)}):!1}function FE(i,e,t,n,s){for(let r=0,o=t.length;r<o;++r){if(Ha(i,e,t[r],n,s))return!0;e=t[r]}return!1}function __(i,e,t,n,s){return!!(Ha(i,e,t,n,s)||Fn(i,e,t,n,s[0],s[1])||Fn(i,e,t,n,s[0],s[3])||Fn(i,e,t,n,s[2],s[1])||Fn(i,e,t,n,s[2],s[3]))}function m_(i,e,t,n,s){if(!__(i,e,t[0],n,s))return!1;if(t.length===1)return!0;for(let r=1,o=t.length;r<o;++r)if(LE(i,t[r-1],t[r],n,s)&&!Ha(i,t[r-1],t[r],n,s))return!1;return!0}function DE(i,e,t,n,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(m_(i,e,a,n,s))return!0;e=a[a.length-1]}return!1}function OE(i,e,t,n){for(;e<t-n;){for(let s=0;s<n;++s){const r=i[e+s];i[e+s]=i[t-n+s],i[t-n+s]=r}e+=n,t-=n}}function Mh(i,e,t,n){let s=0,r=i[t-n],o=i[t-n+1];for(;e<t;e+=n){const a=i[e],l=i[e+1];s+=(a-r)*(l+o),r=a,o=l}return s===0?void 0:s>0}function Fh(i,e,t,n,s){s=s!==void 0?s:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=Mh(i,e,a,n);if(r===0){if(s&&l||!s&&!l)return!1}else if(s&&!l||!s&&l)return!1;e=a}return!0}function p_(i,e,t,n,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];if(!Fh(i,e,a,n,s))return!1;a.length&&(e=a[a.length-1])}return!0}function ma(i,e,t,n,s){s=s!==void 0?s:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],l=Mh(i,e,a,n);(r===0?s&&l||!s&&!l:s&&!l||!s&&l)&&OE(i,e,a,n),e=a}return e}function vc(i,e,t,n,s){for(let r=0,o=t.length;r<o;++r)e=ma(i,e,t[r],n,s);return e}function GE(i,e){const t=[];let n=0,s=0,r;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=Mh(i,n,l,2);if(r===void 0&&(r=h),h===r)t.push(e.slice(s,o+1));else{if(t.length===0)continue;t[t.length-1].push(e[s])}s=o+1,n=l}return t}class Ti extends yn{constructor(e,t,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&n?(this.setFlatCoordinates(t,e),this.ends_=n):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?$t(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Ti(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,s){return s<jn(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(vh(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),bh(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,n,s))}containsXY(e,t){return Ph(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return c_(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),ma(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,Kr(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=xi(this.getExtent());this.flatInteriorPoint_=Lh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Zt(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new Yr(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,n=this.ends_,s=[];let r=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new Yr(t.slice(r,l),e);s.push(h),r=l}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Fh(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=ma(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=Ah(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,n),new Ti(t,"XY",n)}getType(){return"Polygon"}intersectsExtent(e){return m_(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=fo(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function Td(i){if(Ws(i))throw new Error("Cannot create polygon from empty extent");const e=i[0],t=i[1],n=i[2],s=i[3],r=[e,t,e,s,n,s,n,t,e,t];return new Ti(r,"XY",[r.length])}function Dh(i,e,t,n){const s=Se(e)/t[0],r=Je(e)/t[1];return n?Math.min(i,Math.max(s,r)):Math.min(i,Math.min(s,r))}function Oh(i,e,t){let n=Math.min(i,e);const s=50;return n*=Math.log(1+s*Math.max(0,i/e-1))/s+1,t&&(n=Math.max(n,t),n/=Math.log(1+s*Math.max(0,t/i-1))/s+1),Ge(n,t/2,e*2)}function NE(i,e,t,n){return e=e!==void 0?e:!0,function(s,r,o,a){if(s!==void 0){const l=i[0],h=i[i.length-1],c=t?Dh(l,t,o,n):l;if(a)return e?Oh(s,c,h):Ge(s,h,c);const u=Math.min(c,s),d=Math.floor(ch(i,u,r));return i[d]>c&&d<i.length-1?i[d+1]:i[d]}}}function kE(i,e,t,n,s,r){return n=n!==void 0?n:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const c=s?Dh(e,s,l,r):e;if(h)return n?Oh(o,c,t):Ge(o,t,c);const u=1e-9,d=Math.ceil(Math.log(e/c)/Math.log(i)-u),f=-a*(.5-u)+.5,g=Math.min(c,o),_=Math.floor(Math.log(e/g)/Math.log(i)+f),m=Math.max(d,_),y=e/Math.pow(i,m);return Ge(y,t,c)}}}function Cd(i,e,t,n,s){return t=t!==void 0?t:!0,function(r,o,a,l){if(r!==void 0){const h=n?Dh(i,n,a,s):i;return!t||!l?Ge(r,e,h):Oh(r,h,e)}}}function Gh(i){if(i!==void 0)return 0}function wd(i){if(i!==void 0)return i}function UE(i){const e=2*Math.PI/i;return function(t,n){if(n)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function BE(i){const e=on(5);return function(t,n){return n||t===void 0?t:Math.abs(t)<=e?0:t}}const XE=42,Nh=256,Rl=0;class ui extends Ci{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=xh(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&r_(),e.center&&(e.center=Be(e.center,this.projection_)),e.extent&&(e.extent=ei(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in Qt)delete t[a];this.setProperties(t,!0);const n=zE(e);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=n.minZoom;const s=jE(e),r=n.constraint,o=VE(e);this.constraints_={center:s,resolution:r,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const n=this.getCenterInternal();if(n){const s=e||[0,0,0,0];t=t||[0,0,0,0];const r=this.getResolution(),o=r/2*(s[3]-t[3]+t[1]-s[1]),a=r/2*(s[0]-t[0]+t[2]-s[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let n=0;n<t.length;++n){let s=arguments[n];s.center&&(s=Object.assign({},s),s.center=Be(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=Be(s.anchor,this.getProjection())),t[n]=s}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,n;t>1&&typeof arguments[t-1]=="function"&&(n=arguments[t-1],--t);let s=0;for(;s<t&&!this.isDef();++s){const c=arguments[s];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(s===t){n&&Io(n,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;s<t;++s){const c=arguments[s],u={start:r,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||Ny,callback:n};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=Nn(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}WE(u)?u.complete=!0:r+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(ot.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ot.ANIMATING]>0}getInteracting(){return this.hints_[ot.INTERACTING]>0}cancelAnimations(){this.setHint(ot.ANIMATING,-this.hints_[ot.ANIMATING]);let e;for(let t=0,n=this.animations_.length;t<n;++t){const s=this.animations_[t];if(s[0].callback&&Io(s[0].callback,!1),!e)for(let r=0,o=s.length;r<o;++r){const a=s[r];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let n=this.animations_.length-1;n>=0;--n){const s=this.animations_[n];let r=!0;for(let o=0,a=s.length;o<a;++o){const l=s[o];if(l.complete)continue;const h=e-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):r=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],f=l.sourceCenter[1],g=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(g-d),y=f+u*(_-f);this.targetCenter_=[m,y]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(d,0,f,!0);this.targetCenter_=this.calculateCenterZoom(g,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Nn(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(r){this.animations_[n]=null,this.setHint(ot.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=s[0].callback;o&&Io(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let n;const s=this.getCenterInternal();return s!==void 0&&(n=[s[0]-t[0],s[1]-t[1]],mh(n,e-this.getRotation()),Fy(n,t)),n}calculateCenterZoom(e,t){let n;const s=this.getCenterInternal(),r=this.getResolution();if(s!==void 0&&r!==void 0){const o=t[0]-e*(t[0]-s[0])/r,a=t[1]-e*(t[1]-s[1])/r;n=[o,a]}return n}getViewportSize_(e){const t=this.viewportSize_;if(e){const n=t[0],s=t[1];return[Math.abs(n*Math.cos(e))+Math.abs(s*Math.sin(e)),Math.abs(n*Math.sin(e))+Math.abs(s*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&fn(e,this.getProjection())}getCenterInternal(){return this.get(Qt.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return Wa(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();Le(t,"The view center is not defined");const n=this.getResolution();Le(n!==void 0,"The view resolution is not defined");const s=this.getRotation();return Le(s!==void 0,"The view rotation is not defined"),Tc(t,n,s,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(Qt.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(ei(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const n=Se(e)/t[0],s=Je(e)/t[1];return Math.max(n,s)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(t/n)/Math.log(e);return function(r){return t/Math.pow(e,r*s)}}getRotation(){return this.get(Qt.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),n=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,r=Math.log(n/s)/t;return function(o){return Math.log(n/o)/t/r}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const n=this.padding_;return n&&(t=[t[0]-n[1]-n[3],t[1]-n[0]-n[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),n=this.getRotation();let s=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();s=Sl(s,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],t,n)}return{center:s.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,n,s;if(this.resolutions_){const r=ch(this.resolutions_,e,1);t=r,n=this.resolutions_[r],r==this.resolutions_.length-1?s=2:s=n/this.resolutions_[r+1]}else n=this.maxResolution_,s=this.zoomFactor_;return t+Math.log(n/e)/Math.log(s)}getResolutionForZoom(e){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];const t=Ge(Math.floor(e),0,this.resolutions_.length-2),n=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(n,Ge(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let n;if(Le(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){Le(!Ws(e),"Cannot fit empty extent provided as `geometry`");const s=ei(e,this.getProjection());n=Td(s)}else if(e.getType()==="Circle"){const s=ei(e.getExtent(),this.getProjection());n=Td(s),n.rotate(this.getRotation(),xi(s))}else n=e;this.fitInternal(n,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),n=Math.cos(t),s=Math.sin(-t),r=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=r.length;u<d;u+=o){const f=r[u]*n-r[u+1]*s,g=r[u]*s+r[u+1]*n;a=Math.min(a,f),l=Math.min(l,g),h=Math.max(h,f),c=Math.max(c,g)}return[a,l,h,c]}fitInternal(e,t){t=t||{};let n=t.size;n||(n=this.getViewportSizeMinusPadding_());const s=t.padding!==void 0?t.padding:[0,0,0,0],r=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[n[0]-s[1]-s[3],n[1]-s[0]-s[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=xi(a);d[0]+=(s[1]-s[3])/2*l,d[1]+=(s[0]-s[2])/2*l;const f=d[0]*u-d[1]*c,g=d[1]*u+d[0]*c,_=this.getConstrainedCenter([f,g],l),m=t.callback?t.callback:Ur;t.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:t.duration,easing:t.easing},m):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),Io(m,!0))}centerOn(e,t,n){this.centerOnInternal(Be(e,this.getProjection()),t,n)}centerOnInternal(e,t,n){this.setCenterInternal(Sl(e,t,n,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,n,s){let r;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-n),l=Sl(e,s,[a[0]/2+o[3],a[1]/2+o[0]],t,n);r=[e[0]-l[0],e[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=fn(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&Be(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const n=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*e,0,s,n);t&&(this.targetCenter_=this.calculateCenterZoom(r,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=Be(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const n=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+e,n);t&&(this.targetCenter_=this.calculateCenterRotate(s,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&Be(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const n=this.getAnimating()||this.getInteracting()||t,s=this.constraints_.rotation(this.targetRotation_,n),r=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,0,r,n),a=this.constraints_.center(this.targetCenter_,o,r,n,this.calculateCenterShift(this.targetCenter_,o,s,r));this.get(Qt.ROTATION)!==s&&this.set(Qt.ROTATION,s),this.get(Qt.RESOLUTION)!==o&&(this.set(Qt.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Qt.CENTER)||!gt(this.get(Qt.CENTER),a))&&this.set(Qt.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,n){e=e!==void 0?e:200;const s=t||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,s,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}n=n||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!gt(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:e,easing:Ks,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ot.INTERACTING,1)}endInteraction(e,t,n){n=n&&Be(n,this.getProjection()),this.endInteractionInternal(e,t,n)}endInteractionInternal(e,t,n){this.getInteracting()&&(this.setHint(ot.INTERACTING,-1),this.resolveConstraints(e,t,n))}getConstrainedCenter(e,t){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),n)}getConstrainedZoom(e,t){const n=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(n,t))}getConstrainedResolution(e,t){t=t||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,n)}}function Io(i,e){setTimeout(function(){i(e)},0)}function jE(i){if(i.extent!==void 0){const t=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return nd(i.extent,i.constrainOnlyCenter,t)}const e=xh(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,nd(t,!1,!1)}return vy}function zE(i){let e,t,n,o=i.minZoom!==void 0?i.minZoom:Rl,a=i.maxZoom!==void 0?i.maxZoom:28;const l=i.zoomFactor!==void 0?i.zoomFactor:2,h=i.multiWorld!==void 0?i.multiWorld:!1,c=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,u=i.showFullExtent!==void 0?i.showFullExtent:!1,d=xh(i.projection,"EPSG:3857"),f=d.getExtent();let g=i.constrainOnlyCenter,_=i.extent;if(!h&&!_&&d.isGlobal()&&(g=!1,_=f),i.resolutions!==void 0){const m=i.resolutions;t=m[o],n=m[a]!==void 0?m[a]:m[m.length-1],i.constrainResolution?e=NE(m,c,!g&&_,u):e=Cd(t,n,c,!g&&_,u)}else{const y=(f?Math.max(Se(f),Je(f)):360*Fs.degrees/d.getMetersPerUnit())/Nh/Math.pow(2,Rl),p=y/Math.pow(2,28-Rl);t=i.maxResolution,t!==void 0?o=0:t=y/Math.pow(l,o),n=i.minResolution,n===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?n=t/Math.pow(l,a):n=y/Math.pow(l,a):n=p),a=o+Math.floor(Math.log(t/n)/Math.log(l)),n=t/Math.pow(l,a-o),i.constrainResolution?e=kE(l,t,n,c,!g&&_,u):e=Cd(t,n,c,!g&&_,u)}return{constraint:e,maxResolution:t,minResolution:n,minZoom:o,zoomFactor:l}}function VE(i){if(i.enableRotation!==void 0?i.enableRotation:!0){const t=i.constrainRotation;return t===void 0||t===!0?BE():t===!1?wd:typeof t=="number"?UE(t):wd}return Gh}function WE(i){return!(i.sourceCenter&&i.targetCenter&&!gt(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function Sl(i,e,t,n,s){const r=Math.cos(-s);let o=Math.sin(-s),a=i[0]*r-i[1]*o,l=i[1]*r+i[0]*o;a+=(e[0]/2-t[0])*n,l+=(t[1]-e[1]/2)*n,o=-o;const h=a*r-l*o,c=l*r+a*o;return[h,c]}const bo="ol-hidden",go="ol-unselectable",kh="ol-control",Rd="ol-collapsed",KE=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),Sd=["style","variant","weight","size","lineHeight","family"],Ic={normal:400,bold:700},bc=function(i){const e=i.match(KE);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let n=0,s=Sd.length;n<s;++n){const r=e[n+1];r!==void 0&&(t[Sd[n]]=typeof r=="string"?r.trim():r)}return isNaN(Number(t.weight))&&t.weight in Ic&&(t.weight=Ic[t.weight]),t.families=t.family.split(/,\s?/).map(n=>n.trim().replace(/^['"]|['"]$/g,"")),t};function Ve(i,e,t,n){let s;return t&&t.length?s=t.shift():Na?s=new OffscreenCanvas(i||300,e||300):s=document.createElement("canvas"),i&&(s.width=i),e&&(s.height=e),s.getContext("2d",n)}let vl;function pa(){return vl||(vl=Ve(1,1)),vl}function Za(i){const e=i.canvas;e.width=1,e.height=1,i.clearRect(0,0,1,1)}function vd(i,e){const t=e.parentNode;t&&t.replaceChild(i,e)}function YE(i){for(;i.lastChild;)i.lastChild.remove()}function $E(i,e){const t=i.childNodes;for(let n=0;;++n){const s=t[n],r=e[n];if(!s&&!r)break;if(s!==r){if(!s){i.appendChild(r);continue}if(!r){i.removeChild(s),--n;continue}i.insertBefore(r,s)}}}class qa extends Ci{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&this.element?.remove();for(let t=0,n=this.listenerKeys.length;t<n;++t)Oe(this.listenerKeys[t]);if(this.listenerKeys.length=0,this.map_=e,e){const t=this.target_??e.getOverlayContainerStopEvent();this.element&&t.appendChild(this.element),this.render!==Ur&&this.listenerKeys.push(we(e,qi.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class HE extends qa{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;const t=e.className!==void 0?e.className:"ol-attribution",n=e.tipLabel!==void 0?e.tipLabel:"Attributions",s=e.expandClassName!==void 0?e.expandClassName:t+"-expand",r=e.collapseLabel!==void 0?e.collapseLabel:"",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=s):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(ae.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+go+" "+kh+(this.collapsed_&&this.collapsible_?" "+Rd:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=this.getMap().getAllLayers(),n=new Set(t.flatMap(s=>s.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(s=>n.add(s)):n.add(this.attributions_)),!this.overrideCollapsible_){const s=!t.some(r=>r.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(s)}return Array.from(n)}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=await Promise.all(this.collectSourceAttributions_(e).map(s=>zg(()=>s))),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!zi(t,this.renderedAttributions_)){YE(this.ulElement_);for(let s=0,r=t.length;s<r;++s){const o=document.createElement("li");o.innerHTML=t[s],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Rd),this.collapsed_?vd(this.collapseLabel_,this.label_):vd(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class ZE extends qa{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",n=e.label!==void 0?e.label:"",s=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(s));const r=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(ae.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+go+" "+kh,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(bo)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const n=t.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:Ks}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const n=t.viewState.rotation;if(n!=this.rotation_){const s="rotate("+n+"rad)";if(this.autoHide_){const r=this.element.classList.contains(bo);!r&&n===0?this.element.classList.add(bo):r&&n!==0&&this.element.classList.remove(bo)}this.label_.style.transform=s}this.rotation_=n}}class qE extends qa{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",n=e.delta!==void 0?e.delta:1,s=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",r=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=s,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(ae.CLICK,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(ae.CLICK,this.handleClick_.bind(this,-n),!1);const d=t+" "+go+" "+kh,f=this.element;f.className=d,f.appendChild(c),f.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const n=this.getMap().getView();if(!n)return;const s=n.getZoom();if(s!==void 0){const r=n.getConstrainedZoom(s+e);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:r,duration:this.duration_,easing:Ks})):n.setZoom(r)}}}function y_(i){i=i||{};const e=new Nt;return(i.zoom!==void 0?i.zoom:!0)&&e.push(new qE(i.zoomOptions)),(i.rotate!==void 0?i.rotate:!0)&&e.push(new ZE(i.rotateOptions)),(i.attribution!==void 0?i.attribution:!0)&&e.push(new HE(i.attributionOptions)),e}class JE{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let n=t-3;for(;n>0&&this.points_[n+2]>e;)n-=3;const s=this.points_[t+2]-this.points_[n+2];if(s<1e3/60)return!1;const r=this.points_[t]-this.points_[n],o=this.points_[t+1]-this.points_[n+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Ac={ACTIVE:"active"};class Ys extends Ci{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Ac.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(Ac.ACTIVE,e)}setMap(e){this.map_=e}}function QE(i,e,t){const n=i.getCenterInternal();if(n){const s=[n[0]+e[0],n[1]+e[1]];i.animateInternal({duration:t!==void 0?t:250,easing:ky,center:i.getConstrainedCenter(s)})}}function Uh(i,e,t,n){const s=i.getZoom();if(s===void 0)return;const r=i.getConstrainedZoom(s+e),o=i.getResolutionForZoom(r);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:o,anchor:t,duration:n!==void 0?n:250,easing:Ks})}class ex extends Ys{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==Te.DBLCLICK){const n=e.originalEvent,s=e.map,r=e.coordinate,o=n.shiftKey?-this.delta_:this.delta_,a=s.getView();Uh(a,o,r,this.duration_),n.preventDefault(),t=!0}return!t}}function Pc(i){const e=arguments;return function(t){let n=!0;for(let s=0,r=e.length;s<r&&(n=n&&e[s](t),!!n);++s);return n}}const tx=function(i){const e=i.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},ix=function(i){const e=i.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},nx=function(i){const e=i.map.getTargetElement(),t=e.getRootNode(),n=i.map.getOwnerDocument().activeElement;return t instanceof ShadowRoot?t.host.contains(n):e.contains(n)},E_=function(i){const e=i.map.getTargetElement(),t=e.getRootNode();return(t instanceof ShadowRoot?t.host:e).hasAttribute("tabindex")?nx(i):!0},ya=un,x_=function(i){const e=i.originalEvent;return"pointerId"in e&&e.button==0&&!(yy&&Vg&&e.ctrlKey)},Lc=zs,T_=function(i){return i.type==Te.SINGLECLICK},Bh=function(i){const e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},sx=function(i){const e=i.originalEvent;return Vg?e.metaKey:e.ctrlKey},Xh=function(i){const e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},C_=function(i){const e=i.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},Il=function(i){const e=i.originalEvent;return"pointerId"in e&&e.pointerType=="mouse"},w_=function(i){const e=i.originalEvent;return"pointerId"in e&&e.isPrimary&&e.button===0};class Vn extends Ys{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==Te.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==Te.POINTERUP){const n=this.handleUpEvent(e);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(e.type==Te.POINTERDOWN){const n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==Te.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function jh(i){const e=i.length;let t=0,n=0;for(let s=0;s<e;s++)t+=i[s].clientX,n+=i[s].clientY;return{clientX:t/e,clientY:n/e}}class rx extends Vn{constructor(e){super({stopDown:zs}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Pc(Bh,w_);this.condition_=e.onFocusOnly?Pc(E_,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const n=this.targetPointers,s=t.getEventPixel(jh(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const r=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],a=e.map.getView();Dy(r,a.getResolution()),mh(r,a.getRotation()),a.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,n=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-s*Math.cos(r),a[1]-s*Math.sin(r)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:Ks})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const n=e.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class ox extends Vn{constructor(e){e=e||{},super({stopDown:zs}),this.condition_=e.condition?e.condition:ix,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Il(e))return;const t=e.map,n=t.getView();if(n.getConstraints().rotation===Gh)return;const s=t.getSize(),r=e.pixel,o=Math.atan2(s[1]/2-r[1],r[0]-s[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return Il(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Il(e)&&x_(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class ax extends ao{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,n="px",s=this.element_.style;s.left=Math.min(e[0],t[0])+n,s.top=Math.min(e[1],t[1])+n,s.width=Math.abs(t[0]-e[0])+n,s.height=Math.abs(t[1]-e[1])+n}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const e=this.startPixel_,t=this.endPixel_,s=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new Ti([s])}getGeometry(){return this.geometry_}}const $n={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class ar extends qt{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}}class lx extends Vn{constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new ax(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??x_,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){const s=n[0]-t[0],r=n[1]-t[1];return s*s+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new ar($n.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new ar(t?$n.BOXEND:$n.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new ar($n.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new ar($n.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new ar($n.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}}class cx extends lx{constructor(e){e=e||{};const t=e.condition?e.condition:Xh;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const n=this.getMap().getView();let s=this.getGeometry();if(this.out_){const r=n.rotatedExtentForGeometry(s),o=n.getResolutionForExtentInternal(r),a=n.getResolution()/o;s=s.clone(),s.scale(a*a)}n.fitInternal(s,{duration:this.duration_,easing:Ks})}}const vn={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class hx extends Ys{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return Bh(t)&&C_(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==ae.KEYDOWN){const n=e.originalEvent,s=n.key;if(this.condition_(e)&&(s==vn.DOWN||s==vn.LEFT||s==vn.RIGHT||s==vn.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;s==vn.DOWN?h=-a:s==vn.LEFT?l=-a:s==vn.RIGHT?l=a:h=a;const c=[l,h];mh(c,o.getRotation()),QE(o,c,this.duration_),n.preventDefault(),t=!0}}return!t}}class ux extends Ys{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!sx(t)&&C_(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==ae.KEYDOWN||e.type==ae.KEYPRESS){const n=e.originalEvent,s=n.key;if(this.condition_(e)&&(s==="+"||s==="-")){const r=e.map,o=s==="+"?this.delta_:-this.delta_,a=r.getView();Uh(a,o,void 0,this.duration_),n.preventDefault(),t=!0}}return!t}}const dx=40,fx=300;class gx extends Ys{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:ya;this.condition_=e.onFocusOnly?Pc(E_,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==ae.WHEEL)return!0;const n=e.map,s=e.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let r=s.deltaY;switch(s.deltaMode){case WheelEvent.DOM_DELTA_LINE:r*=dx;break;case WheelEvent.DOM_DELTA_PAGE:r*=fx;break}if(r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=n.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_?n.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=o,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-Ge(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),Uh(t,n,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class _x extends Vn{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=zs),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const n=this.targetPointers[0],s=this.targetPointers[1],r=Math.atan2(s.clientY-n.clientY,s.clientX-n.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=r;const o=e.map,a=o.getView();a.getConstraints().rotation!==Gh&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(jh(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class mx extends Vn{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=zs),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const n=this.targetPointers[0],s=this.targetPointers[1],r=n.clientX-s.clientX,o=n.clientY-s.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(jh(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const n=e.map.getView(),s=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function px(i){i=i||{};const e=new Nt,t=new JE(-.005,.05,100);return(i.altShiftDragRotate!==void 0?i.altShiftDragRotate:!0)&&e.push(new ox),(i.doubleClickZoom!==void 0?i.doubleClickZoom:!0)&&e.push(new ex({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan!==void 0?i.dragPan:!0)&&e.push(new rx({onFocusOnly:i.onFocusOnly,kinetic:t})),(i.pinchRotate!==void 0?i.pinchRotate:!0)&&e.push(new _x),(i.pinchZoom!==void 0?i.pinchZoom:!0)&&e.push(new mx({duration:i.zoomDuration})),(i.keyboard!==void 0?i.keyboard:!0)&&(e.push(new hx),e.push(new ux({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom!==void 0?i.mouseWheelZoom:!0)&&e.push(new gx({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom!==void 0?i.shiftDragZoom:!0)&&e.push(new cx({duration:i.zoomDuration})),e}const Ie={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class R_ extends Ci{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[Ie.OPACITY]=e.opacity!==void 0?e.opacity:1,Le(typeof t[Ie.OPACITY]=="number","Layer opacity must be a number"),t[Ie.VISIBLE]=e.visible!==void 0?e.visible:!0,t[Ie.Z_INDEX]=e.zIndex,t[Ie.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[Ie.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[Ie.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[Ie.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},n=this.getZIndex();return t.opacity=Ge(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=n===void 0&&!t.managed?1/0:n,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return ce()}getLayerStatesArray(e){return ce()}getExtent(){return this.get(Ie.EXTENT)}getMaxResolution(){return this.get(Ie.MAX_RESOLUTION)}getMinResolution(){return this.get(Ie.MIN_RESOLUTION)}getMinZoom(){return this.get(Ie.MIN_ZOOM)}getMaxZoom(){return this.get(Ie.MAX_ZOOM)}getOpacity(){return this.get(Ie.OPACITY)}getSourceState(){return ce()}getVisible(){return this.get(Ie.VISIBLE)}getZIndex(){return this.get(Ie.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(Ie.EXTENT,e)}setMaxResolution(e){this.set(Ie.MAX_RESOLUTION,e)}setMinResolution(e){this.set(Ie.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(Ie.MAX_ZOOM,e)}setMinZoom(e){this.set(Ie.MIN_ZOOM,e)}setOpacity(e){Le(typeof e=="number","Layer opacity must be a number"),this.set(Ie.OPACITY,e)}setVisible(e){this.set(Ie.VISIBLE,e)}setZIndex(e){this.set(Ie.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class en extends qt{constructor(e,t){super(e),this.layer=t}}const bl={LAYERS:"layers"};class $s extends R_{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let n=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(bl.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Nt(n.slice(),{unique:!0}):Le(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Nt(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Oe),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(we(e,Ye.ADD,this.handleLayersAdd_,this),we(e,Ye.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(Oe);Xn(this.listenerKeys_);const t=e.getArray();for(let n=0,s=t.length;n<s;n++){const r=t[n];this.registerLayerListeners_(r),this.dispatchEvent(new en("addlayer",r))}this.changed()}registerLayerListeners_(e){const t=[we(e,Ls.PROPERTYCHANGE,this.handleLayerChange_,this),we(e,ae.CHANGE,this.handleLayerChange_,this)];e instanceof $s&&t.push(we(e,"addlayer",this.handleLayerGroupAdd_,this),we(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[ne(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new en("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new en("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new en("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,n=ne(t);this.listenerKeys_[n].forEach(Oe),delete this.listenerKeys_[n],this.dispatchEvent(new en("removelayer",t)),this.changed()}getLayers(){return this.get(bl.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const n=t.getArray();for(let s=0,r=n.length;s<r;++s)this.dispatchEvent(new en("removelayer",n[s]))}this.set(bl.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],n=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const s=this.getLayerState();let r=s.zIndex;!e&&s.zIndex===void 0&&(r=0);for(let o=n,a=t.length;o<a;o++){const l=t[o];l.opacity*=s.opacity,l.visible=l.visible&&s.visible,l.maxResolution=Math.min(l.maxResolution,s.maxResolution),l.minResolution=Math.max(l.minResolution,s.minResolution),l.minZoom=Math.max(l.minZoom,s.minZoom),l.maxZoom=Math.min(l.maxZoom,s.maxZoom),s.extent!==void 0&&(l.extent!==void 0?l.extent=xt(l.extent,s.extent):l.extent=s.extent),l.zIndex===void 0&&(l.zIndex=r)}return t}getSourceState(){return"ready"}}const qe={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class Ja extends R_{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(Ie.SOURCE,this.handleSourcePropertyChange_);const n=e.source?e.source:null;this.setSource(n)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(Ie.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Oe(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=we(e,ae.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const n=this.getMapInternal();!e&&n&&(e=n.getView()),e instanceof ui?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&n&&(t.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let s;if(t.layerStatesArray){if(s=t.layerStatesArray.find(o=>o.layer===this),!s)return!1}else s=this.getLayerState();const r=this.getExtent();return zh(s,t.viewState)&&(!r||Et(r,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];const t=this.getSource()?.getAttributions();if(!t)return[];const n=e instanceof ui?e.getViewStateAndExtent():e;let s=t(n);return Array.isArray(s)||(s=[s]),s}render(e,t){const n=this.getRenderer();return n.prepareFrame(e)?(this.rendered=!0,n.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(Ie.MAP,e)}getMapInternal(){return this.get(Ie.MAP)}setMap(e){this.mapPrecomposeKey_&&(Oe(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(Oe(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=we(e,qe.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=we(this,ae.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const t=e.frameState.layerStatesArray,n=this.getLayerState(!1);Le(!t.some(s=>s.layer===n.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(n)}setSource(e){this.set(Ie.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function zh(i,e){if(!i.visible)return!1;const t=e.resolution;if(t<i.minResolution||t>=i.maxResolution)return!1;const n=e.zoom;return n>i.minZoom&&n<=i.maxZoom}function S_(i,e,t=0,n=i.length-1,s=yx){for(;n>t;){if(n-t>600){const l=n-t+1,h=e-t+1,c=Math.log(l),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(l-u)/l)*(h-l/2<0?-1:1),f=Math.max(t,Math.floor(e-h*u/l+d)),g=Math.min(n,Math.floor(e+(l-h)*u/l+d));S_(i,e,f,g,s)}const r=i[e];let o=t,a=n;for(lr(i,t,e),s(i[n],r)>0&&lr(i,t,n);o<a;){for(lr(i,o,a),o++,a--;s(i[o],r)<0;)o++;for(;s(i[a],r)>0;)a--}s(i[t],r)===0?lr(i,t,a):(a++,lr(i,a,n)),a<=e&&(t=a+1),e<=a&&(n=a-1)}}function lr(i,e,t){const n=i[e];i[e]=i[t],i[t]=n}function yx(i,e){return i<e?-1:i>e?1:0}let v_=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const n=[];if(!Po(e,t))return n;const s=this.toBBox,r=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],l=t.leaf?s(a):a;Po(e,l)&&(t.leaf?n.push(a):Pl(e,l)?this._all(a,n):r.push(a))}t=r.pop()}return n}collides(e){let t=this.data;if(!Po(e,t))return!1;const n=[];for(;t;){for(let s=0;s<t.children.length;s++){const r=t.children[s],o=t.leaf?this.toBBox(r):r;if(Po(e,o)){if(t.leaf||Pl(e,o))return!0;n.push(r)}}t=n.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let n=0;n<e.length;n++)this.insert(e[n]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const n=this.data;this.data=t,t=n}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=as([]),this}remove(e,t){if(!e)return this;let n=this.data;const s=this.toBBox(e),r=[],o=[];let a,l,h;for(;n||r.length;){if(n||(n=r.pop(),l=r[r.length-1],a=o.pop(),h=!0),n.leaf){const c=Ex(e,n.children,t);if(c!==-1)return n.children.splice(c,1),r.push(n),this._condense(r),this}!h&&!n.leaf&&Pl(n,s)?(r.push(n),o.push(a),a=0,l=n,n=n.children[0]):l?(a++,n=l.children[a],h=!1):n=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,s){const r=n-t+1;let o=this._maxEntries,a;if(r<=o)return a=as(e.slice(t,n+1)),Hn(a,this.toBBox),a;s||(s=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,s-1))),a=as([]),a.leaf=!1,a.height=s;const l=Math.ceil(r/o),h=l*Math.ceil(Math.sqrt(o));Id(e,t,n,h,this.compareMinX);for(let c=t;c<=n;c+=h){const u=Math.min(c+h-1,n);Id(e,c,u,l,this.compareMinY);for(let d=c;d<=u;d+=l){const f=Math.min(d+l-1,u);a.children.push(this._build(e,d,f,s-1))}}return Hn(a,this.toBBox),a}_chooseSubtree(e,t,n,s){for(;s.push(t),!(t.leaf||s.length-1===n);){let r=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){const h=t.children[l],c=Al(h),u=Cx(e,h)-c;u<o?(o=u,r=c<r?c:r,a=h):u===o&&c<r&&(r=c,a=h)}t=a||t.children[0]}return t}_insert(e,t,n){const s=n?e:this.toBBox(e),r=[],o=this._chooseSubtree(s,this.data,t,r);for(o.children.push(e),mr(o,s);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(s,r,t)}_split(e,t){const n=e[t],s=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,s);const o=this._chooseSplitIndex(n,r,s),a=as(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,Hn(n,this.toBBox),Hn(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(n,a)}_splitRoot(e,t){this.data=as([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Hn(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let s,r=1/0,o=1/0;for(let a=t;a<=n-t;a++){const l=_r(e,0,a,this.toBBox),h=_r(e,a,n,this.toBBox),c=wx(l,h),u=Al(l)+Al(h);c<r?(r=c,s=a,o=u<o?u:o):c===r&&u<o&&(o=u,s=a)}return s||n-t}_chooseSplitAxis(e,t,n){const s=e.leaf?this.compareMinX:xx,r=e.leaf?this.compareMinY:Tx,o=this._allDistMargin(e,t,n,s),a=this._allDistMargin(e,t,n,r);o<a&&e.children.sort(s)}_allDistMargin(e,t,n,s){e.children.sort(s);const r=this.toBBox,o=_r(e,0,t,r),a=_r(e,n-t,n,r);let l=Ao(o)+Ao(a);for(let h=t;h<n-t;h++){const c=e.children[h];mr(o,e.leaf?r(c):c),l+=Ao(o)}for(let h=n-t-1;h>=t;h--){const c=e.children[h];mr(a,e.leaf?r(c):c),l+=Ao(a)}return l}_adjustParentBBoxes(e,t,n){for(let s=n;s>=0;s--)mr(t[s],e)}_condense(e){for(let t=e.length-1,n;t>=0;t--)e[t].children.length===0?t>0?(n=e[t-1].children,n.splice(n.indexOf(e[t]),1)):this.clear():Hn(e[t],this.toBBox)}};function Ex(i,e,t){if(!t)return e.indexOf(i);for(let n=0;n<e.length;n++)if(t(i,e[n]))return n;return-1}function Hn(i,e){_r(i,0,i.children.length,e,i)}function _r(i,e,t,n,s){s||(s=as(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=e;r<t;r++){const o=i.children[r];mr(s,i.leaf?n(o):o)}return s}function mr(i,e){return i.minX=Math.min(i.minX,e.minX),i.minY=Math.min(i.minY,e.minY),i.maxX=Math.max(i.maxX,e.maxX),i.maxY=Math.max(i.maxY,e.maxY),i}function xx(i,e){return i.minX-e.minX}function Tx(i,e){return i.minY-e.minY}function Al(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function Ao(i){return i.maxX-i.minX+(i.maxY-i.minY)}function Cx(i,e){return(Math.max(e.maxX,i.maxX)-Math.min(e.minX,i.minX))*(Math.max(e.maxY,i.maxY)-Math.min(e.minY,i.minY))}function wx(i,e){const t=Math.max(i.minX,e.minX),n=Math.max(i.minY,e.minY),s=Math.min(i.maxX,e.maxX),r=Math.min(i.maxY,e.maxY);return Math.max(0,s-t)*Math.max(0,r-n)}function Pl(i,e){return i.minX<=e.minX&&i.minY<=e.minY&&e.maxX<=i.maxX&&e.maxY<=i.maxY}function Po(i,e){return e.minX<=i.maxX&&e.minY<=i.maxY&&e.maxX>=i.minX&&e.maxY>=i.minY}function as(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Id(i,e,t,n,s){const r=[e,t];for(;r.length;){if(t=r.pop(),e=r.pop(),t-e<=n)continue;const o=e+Math.ceil((t-e)/n/2)*n;S_(i,o,e,t,s),r.push(e,o,o,t)}}const Vh=[NaN,NaN,NaN,0];let Ll;function Rx(){return Ll||(Ll=Ve(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),Ll}const Sx=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,vx=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Ix=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,bx=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function Lo(i,e){return i.endsWith("%")?Number(i.substring(0,i.length-1))/e:Number(i)}function Pr(i){throw new Error('failed to parse "'+i+'" as color')}function I_(i){if(i.toLowerCase().startsWith("rgb")){const r=i.match(vx)||i.match(Sx)||i.match(Ix);if(r){const o=r[4],a=100/255;return[Ge(Lo(r[1],a)+.5|0,0,255),Ge(Lo(r[2],a)+.5|0,0,255),Ge(Lo(r[3],a)+.5|0,0,255),o!==void 0?Ge(Lo(o,100),0,1):1]}Pr(i)}if(i.startsWith("#")){if(bx.test(i)){const r=i.substring(1),o=r.length<=4?1:2,a=[0,0,0,255];for(let l=0,h=r.length;l<h;l+=o){let c=parseInt(r.substring(l,l+o),16);o===1&&(c+=c<<4),a[l/o]=c}return a[3]=a[3]/255,a}Pr(i)}const e=Rx();e.fillStyle="#abcdef";let t=e.fillStyle;e.fillStyle=i,e.fillStyle===t&&(e.fillStyle="#fedcba",t=e.fillStyle,e.fillStyle=i,e.fillStyle===t&&Pr(i));const n=e.fillStyle;if(n.startsWith("#")||n.startsWith("rgba"))return I_(n);e.clearRect(0,0,1,1),e.fillRect(0,0,1,1);const s=Array.from(e.getImageData(0,0,1,1).data);return s[3]=ho(s[3]/255,3),s}function Ax(i){return typeof i=="string"?i:Kh(i)}const Px=1024,cr={};let Ml=0;function Lx(i){if(i.length===4)return i;const e=i.slice();return e[3]=1,e}function Fl(i){return i>.0031308?Math.pow(i,1/2.4)*269.025-14.025:i*3294.6}function Dl(i){return i>.2068965?Math.pow(i,3):(i-4/29)*(108/841)}function Ol(i){return i>10.314724?Math.pow((i+14.025)/269.025,2.4):i/3294.6}function Gl(i){return i>.0088564?Math.pow(i,1/3):i/(108/841)+4/29}function bd(i){const e=Ol(i[0]),t=Ol(i[1]),n=Ol(i[2]),s=Gl(e*.222488403+t*.716873169+n*.06060791),r=500*(Gl(e*.452247074+t*.399439023+n*.148375274)-s),o=200*(s-Gl(e*.016863605+t*.117638439+n*.865350722)),a=Math.atan2(o,r)*(180/Math.PI);return[116*s-16,Math.sqrt(r*r+o*o),a<0?a+360:a,i[3]]}function Mx(i){const e=(i[0]+16)/116,t=i[1],n=i[2]*Math.PI/180,s=Dl(e),r=Dl(e+t/500*Math.cos(n)),o=Dl(e-t/200*Math.sin(n)),a=Fl(r*3.021973625-s*1.617392459-o*.404875592),l=Fl(r*-.943766287+s*1.916279586+o*.027607165),h=Fl(r*.069407491-s*.22898585+o*1.159737864);return[Ge(a+.5|0,0,255),Ge(l+.5|0,0,255),Ge(h+.5|0,0,255),i[3]]}function Wh(i){if(i==="none")return Vh;if(cr.hasOwnProperty(i))return cr[i];if(Ml>=Px){let t=0;for(const n in cr)(t++&3)===0&&(delete cr[n],--Ml)}const e=I_(i);e.length!==4&&Pr(i);for(const t of e)isNaN(t)&&Pr(i);return cr[i]=e,++Ml,e}function gn(i){return Array.isArray(i)?i:Wh(i)}function Kh(i){let e=i[0];e!=(e|0)&&(e=e+.5|0);let t=i[1];t!=(t|0)&&(t=t+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const s=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+e+","+t+","+n+","+s+")"}function Ad(i){return i[0]>0&&i[1]>0}function Fx(i,e,t){return t===void 0&&(t=[0,0]),t[0]=i[0]*e+.5|0,t[1]=i[1]*e+.5|0,t}function We(i,e){return Array.isArray(i)?i:(e===void 0?e=[i,i]:(e[0]=i,e[1]=i),e)}let Wn=0;const lt=1<<Wn++,_e=1<<Wn++,pt=1<<Wn++,Ot=1<<Wn++,_n=1<<Wn++,fs=1<<Wn++,Mo=Math.pow(2,Wn)-1,Yh={[lt]:"boolean",[_e]:"number",[pt]:"string",[Ot]:"color",[_n]:"number[]",[fs]:"size"},Dx=Object.keys(Yh).map(Number).sort(Oi);function Ox(i){return i in Yh}function gs(i){const e=[];for(const t of Dx)pr(i,t)&&e.push(Yh[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function pr(i,e){return(i&e)===e}function Wi(i,e){return i===e}class He{constructor(e,t){if(!Ox(e))throw new Error(`literal expressions must have a specific type, got ${gs(e)}`);this.type=e,this.value=t}}class b_{constructor(e,t,...n){this.type=e,this.operator=t,this.args=n}}function $h(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function Qe(i,e,t){switch(typeof i){case"boolean":{if(Wi(e,pt))return new He(pt,i?"true":"false");if(!pr(e,lt))throw new Error(`got a boolean, but expected ${gs(e)}`);return new He(lt,i)}case"number":{if(Wi(e,fs))return new He(fs,We(i));if(Wi(e,lt))return new He(lt,!!i);if(Wi(e,pt))return new He(pt,i.toString());if(!pr(e,_e))throw new Error(`got a number, but expected ${gs(e)}`);return new He(_e,i)}case"string":{if(Wi(e,Ot))return new He(Ot,Wh(i));if(Wi(e,lt))return new He(lt,!!i);if(!pr(e,pt))throw new Error(`got a string, but expected ${gs(e)}`);return new He(pt,i)}}if(!Array.isArray(i))throw new Error("expression must be an array or a primitive value");if(i.length===0)throw new Error("empty expression");if(typeof i[0]=="string")return Kx(i,e,t);for(const n of i)if(typeof n!="number")throw new Error("expected an array of numbers");if(Wi(e,fs)){if(i.length!==2)throw new Error(`expected an array of two values for a size, got ${i.length}`);return new He(fs,i)}if(Wi(e,Ot)){if(i.length===3)return new He(Ot,[...i,1]);if(i.length===4)return new He(Ot,i);throw new Error(`expected an array of 3 or 4 values for a color, got ${i.length}`)}if(!pr(e,_n))throw new Error(`got an array of numbers, but expected ${gs(e)}`);return new He(_n,i)}const v={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},Gx={[v.Get]:he(me(1,1/0),Pd),[v.Var]:he(me(1,1),Nx),[v.Has]:he(me(1,1/0),Pd),[v.Id]:he(kx,Zn),[v.Concat]:he(me(2,1/0),Pe(pt)),[v.GeometryType]:he(Ux,Zn),[v.LineMetric]:he(Zn),[v.Resolution]:he(Nl,Zn),[v.Zoom]:he(Nl,Zn),[v.Time]:he(Nl,Zn),[v.Any]:he(me(2,1/0),Pe(lt)),[v.All]:he(me(2,1/0),Pe(lt)),[v.Not]:he(me(1,1),Pe(lt)),[v.Equal]:he(me(2,2),Pe(Mo)),[v.NotEqual]:he(me(2,2),Pe(Mo)),[v.GreaterThan]:he(me(2,2),Pe(_e)),[v.GreaterThanOrEqualTo]:he(me(2,2),Pe(_e)),[v.LessThan]:he(me(2,2),Pe(_e)),[v.LessThanOrEqualTo]:he(me(2,2),Pe(_e)),[v.Multiply]:he(me(2,1/0),Ld),[v.Coalesce]:he(me(2,1/0),Ld),[v.Divide]:he(me(2,2),Pe(_e)),[v.Add]:he(me(2,1/0),Pe(_e)),[v.Subtract]:he(me(2,2),Pe(_e)),[v.Clamp]:he(me(3,3),Pe(_e)),[v.Mod]:he(me(2,2),Pe(_e)),[v.Pow]:he(me(2,2),Pe(_e)),[v.Abs]:he(me(1,1),Pe(_e)),[v.Floor]:he(me(1,1),Pe(_e)),[v.Ceil]:he(me(1,1),Pe(_e)),[v.Round]:he(me(1,1),Pe(_e)),[v.Sin]:he(me(1,1),Pe(_e)),[v.Cos]:he(me(1,1),Pe(_e)),[v.Atan]:he(me(1,2),Pe(_e)),[v.Sqrt]:he(me(1,1),Pe(_e)),[v.Match]:he(me(4,1/0),Md,Xx),[v.Between]:he(me(3,3),Pe(_e)),[v.Interpolate]:he(me(6,1/0),Md,jx),[v.Case]:he(me(3,1/0),Bx,zx),[v.In]:he(me(2,2),Vx),[v.Number]:he(me(1,1/0),Pe(Mo)),[v.String]:he(me(1,1/0),Pe(Mo)),[v.Array]:he(me(1,1/0),Pe(_e)),[v.Color]:he(me(1,4),Pe(_e)),[v.Band]:he(me(1,3),Pe(_e)),[v.Palette]:he(me(2,2),Wx),[v.ToString]:he(me(1,1),Pe(lt|_e|pt|Ot))};function Pd(i,e,t){const n=i.length-1,s=new Array(n);for(let r=0;r<n;++r){const o=i[r+1];switch(typeof o){case"number":{s[r]=new He(_e,o);break}case"string":{s[r]=new He(pt,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}r===0&&t.properties.add(String(o))}return s}function Nx(i,e,t){const n=i[1];if(typeof n!="string")throw new Error("expected a string argument for var operation");return t.variables.add(n),[new He(pt,n)]}function kx(i,e,t){t.featureId=!0}function Ux(i,e,t){t.geometryType=!0}function Nl(i,e,t){t.mapState=!0}function Zn(i,e,t){const n=i[0];if(i.length!==1)throw new Error(`expected no arguments for ${n} operation`);return[]}function me(i,e){return function(t,n,s){const r=t[0],o=t.length-1;if(i===e){if(o!==i){const a=i===1?"":"s";throw new Error(`expected ${i} argument${a} for ${r}, got ${o}`)}}else if(o<i||o>e){const a=e===1/0?`${i} or more`:`${i} to ${e}`;throw new Error(`expected ${a} arguments for ${r}, got ${o}`)}}}function Ld(i,e,t){const n=i.length-1,s=new Array(n);for(let r=0;r<n;++r){const o=Qe(i[r+1],e,t);s[r]=o}return s}function Pe(i){return function(e,t,n){const s=e.length-1,r=new Array(s);for(let o=0;o<s;++o){const a=Qe(e[o+1],i,n);r[o]=a}return r}}function Bx(i,e,t){const n=i[0],s=i.length-1;if(s%2===0)throw new Error(`expected an odd number of arguments for ${n}, got ${s} instead`)}function Md(i,e,t){const n=i[0],s=i.length-1;if(s%2===1)throw new Error(`expected an even number of arguments for operation ${n}, got ${s} instead`)}function Xx(i,e,t){const n=i.length-1,s=pt|_e|lt,r=Qe(i[1],s,t),o=Qe(i[i.length-1],e,t),a=new Array(n-2);for(let l=0;l<n-2;l+=2){try{const h=Qe(i[l+2],r.type,t);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+1} of match expression: ${h.message}`)}try{const h=Qe(i[l+3],o.type,t);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+2} of match expression: ${h.message}`)}}return[r,...a,o]}function jx(i,e,t){const n=i[1];let s;switch(n[0]){case"linear":s=1;break;case"exponential":const l=n[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);s=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(n)}`)}const r=new He(_e,s);let o;try{o=Qe(i[2],_e,t)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){try{const h=Qe(i[l+3],_e,t);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${h.message}`)}try{const h=Qe(i[l+4],e,t);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${h.message}`)}}return[r,o,...a]}function zx(i,e,t){const n=Qe(i[i.length-1],e,t),s=new Array(i.length-1);for(let r=0;r<s.length-1;r+=2){try{const o=Qe(i[r+1],lt,t);s[r]=o}catch(o){throw new Error(`failed to parse argument ${r} of case expression: ${o.message}`)}try{const o=Qe(i[r+2],n.type,t);s[r+1]=o}catch(o){throw new Error(`failed to parse argument ${r+1} of case expression: ${o.message}`)}}return s[s.length-1]=n,s}function Vx(i,e,t){let n=i[2];if(!Array.isArray(n))throw new Error('the second argument for the "in" operator must be an array');let s;if(typeof n[0]=="string"){if(n[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(n[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');n=n[1],s=pt}else s=_e;const r=new Array(n.length);for(let a=0;a<r.length;a++)try{const l=Qe(n[a],s,t);r[a]=l}catch(l){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${l.message}`)}return[Qe(i[1],s,t),...r]}function Wx(i,e,t){let n;try{n=Qe(i[1],_e,t)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}const s=i[2];if(!Array.isArray(s))throw new Error("the second argument of palette must be an array");const r=new Array(s.length);for(let o=0;o<r.length;o++){let a;try{a=Qe(s[o],Ot,t)}catch(l){throw new Error(`failed to parse color at index ${o} in palette expression: ${l.message}`)}if(!(a instanceof He))throw new Error(`the palette color at index ${o} must be a literal value`);r[o]=a}return[n,...r]}function he(...i){return function(e,t,n){const s=e[0];let r;for(let o=0;o<i.length;o++){const a=i[o](e,t,n);if(o==i.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");r=a}}return new b_(t,s,...r)}}function Kx(i,e,t){const n=i[0],s=Gx[n];if(!s)throw new Error(`unknown operator: ${n}`);return s(i,e,t)}function A_(i){if(!i)return"";const e=i.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return A_(i.getGeometries()[0]);default:return""}}function P_(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Vi(i,e,t){const n=Qe(i,e,t);return ni(n)}function ni(i,e){if(i instanceof He){if(i.type===Ot&&typeof i.value=="string"){const n=Wh(i.value);return function(){return n}}return function(){return i.value}}const t=i.operator;switch(t){case v.Number:case v.String:case v.Coalesce:return Yx(i);case v.Get:case v.Var:case v.Has:return $x(i);case v.Id:return n=>n.featureId;case v.GeometryType:return n=>n.geometryType;case v.Concat:{const n=i.args.map(s=>ni(s));return s=>"".concat(...n.map(r=>r(s).toString()))}case v.Resolution:return n=>n.resolution;case v.Any:case v.All:case v.Between:case v.In:case v.Not:return Zx(i);case v.Equal:case v.NotEqual:case v.LessThan:case v.LessThanOrEqualTo:case v.GreaterThan:case v.GreaterThanOrEqualTo:return Hx(i);case v.Multiply:case v.Divide:case v.Add:case v.Subtract:case v.Clamp:case v.Mod:case v.Pow:case v.Abs:case v.Floor:case v.Ceil:case v.Round:case v.Sin:case v.Cos:case v.Atan:case v.Sqrt:return qx(i);case v.Case:return Jx(i);case v.Match:return Qx(i);case v.Interpolate:return eT(i);case v.ToString:return tT(i);default:throw new Error(`Unsupported operator ${t}`)}}function Yx(i,e){const t=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=ni(i.args[r]);switch(t){case v.Coalesce:return r=>{for(let o=0;o<n;++o){const a=s[o](r);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case v.Number:case v.String:return r=>{for(let o=0;o<n;++o){const a=s[o](r);if(typeof a===t)return a}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function $x(i,e){const n=i.args[0].value;switch(i.operator){case v.Get:return s=>{const r=i.args;let o=s.properties[n];for(let a=1,l=r.length;a<l;++a){const c=r[a].value;o=o[c]}return o};case v.Var:return s=>s.variables[n];case v.Has:return s=>{const r=i.args;if(!(n in s.properties))return!1;let o=s.properties[n];for(let a=1,l=r.length;a<l;++a){const c=r[a].value;if(!o||!Object.hasOwn(o,c))return!1;o=o[c]}return!0};default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function Hx(i,e){const t=i.operator,n=ni(i.args[0]),s=ni(i.args[1]);switch(t){case v.Equal:return r=>n(r)===s(r);case v.NotEqual:return r=>n(r)!==s(r);case v.LessThan:return r=>n(r)<s(r);case v.LessThanOrEqualTo:return r=>n(r)<=s(r);case v.GreaterThan:return r=>n(r)>s(r);case v.GreaterThanOrEqualTo:return r=>n(r)>=s(r);default:throw new Error(`Unsupported comparison operator ${t}`)}}function Zx(i,e){const t=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=ni(i.args[r]);switch(t){case v.Any:return r=>{for(let o=0;o<n;++o)if(s[o](r))return!0;return!1};case v.All:return r=>{for(let o=0;o<n;++o)if(!s[o](r))return!1;return!0};case v.Between:return r=>{const o=s[0](r),a=s[1](r),l=s[2](r);return o>=a&&o<=l};case v.In:return r=>{const o=s[0](r);for(let a=1;a<n;++a)if(o===s[a](r))return!0;return!1};case v.Not:return r=>!s[0](r);default:throw new Error(`Unsupported logical operator ${t}`)}}function qx(i,e){const t=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=ni(i.args[r]);switch(t){case v.Multiply:return r=>{let o=1;for(let a=0;a<n;++a)o*=s[a](r);return o};case v.Divide:return r=>s[0](r)/s[1](r);case v.Add:return r=>{let o=0;for(let a=0;a<n;++a)o+=s[a](r);return o};case v.Subtract:return r=>s[0](r)-s[1](r);case v.Clamp:return r=>{const o=s[0](r),a=s[1](r);if(o<a)return a;const l=s[2](r);return o>l?l:o};case v.Mod:return r=>s[0](r)%s[1](r);case v.Pow:return r=>Math.pow(s[0](r),s[1](r));case v.Abs:return r=>Math.abs(s[0](r));case v.Floor:return r=>Math.floor(s[0](r));case v.Ceil:return r=>Math.ceil(s[0](r));case v.Round:return r=>Math.round(s[0](r));case v.Sin:return r=>Math.sin(s[0](r));case v.Cos:return r=>Math.cos(s[0](r));case v.Atan:return n===2?r=>Math.atan2(s[0](r),s[1](r)):r=>Math.atan(s[0](r));case v.Sqrt:return r=>Math.sqrt(s[0](r));default:throw new Error(`Unsupported numeric operator ${t}`)}}function Jx(i,e){const t=i.args.length,n=new Array(t);for(let s=0;s<t;++s)n[s]=ni(i.args[s]);return s=>{for(let r=0;r<t-1;r+=2)if(n[r](s))return n[r+1](s);return n[t-1](s)}}function Qx(i,e){const t=i.args.length,n=new Array(t);for(let s=0;s<t;++s)n[s]=ni(i.args[s]);return s=>{const r=n[0](s);for(let o=1;o<t-1;o+=2)if(r===n[o](s))return n[o+1](s);return n[t-1](s)}}function eT(i,e){const t=i.args.length,n=new Array(t);for(let s=0;s<t;++s)n[s]=ni(i.args[s]);return s=>{const r=n[0](s),o=n[1](s);let a,l;for(let h=2;h<t;h+=2){const c=n[h](s);let u=n[h+1](s);const d=Array.isArray(u);if(d&&(u=Lx(u)),c>=o)return h===2?u:d?iT(r,o,a,l,c,u):yr(r,o,a,l,c,u);a=c,l=u}return l}}function tT(i,e){const t=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=ni(i.args[r]);switch(t){case v.ToString:return r=>{const o=s[0](r);return i.args[0].type===Ot?Kh(o):o.toString()};default:throw new Error(`Unsupported convert operator ${t}`)}}function yr(i,e,t,n,s,r){const o=s-t;if(o===0)return n;const a=e-t,l=i===1?a/o:(Math.pow(i,a)-1)/(Math.pow(i,o)-1);return n+l*(r-n)}function iT(i,e,t,n,s,r){if(s-t===0)return n;const a=bd(n),l=bd(r);let h=l[2]-a[2];h>180?h-=360:h<-180&&(h+=360);const c=[yr(i,e,t,a[0],s,l[0]),yr(i,e,t,a[1],s,l[1]),a[2]+yr(i,e,t,0,s,h),yr(i,e,t,n[3],s,r[3])];return Mx(c)}const Ee={IDLE:0,LOADING:1,LOADED:2,ERROR:3};function nT(i,e,t){const n=i;let s=!0,r=!1,o=!1;const a=[ca(n,ae.LOAD,function(){o=!0,r||e()})];return n.src&&Wg?(r=!0,n.decode().then(function(){s&&e()}).catch(function(l){s&&(o?e():t())})):a.push(ca(n,ae.ERROR,t)),function(){s=!1,a.forEach(Oe)}}function sT(i,e){return new Promise((t,n)=>{function s(){o(),t(i)}function r(){o(),n(new Error("Image load error"))}function o(){i.removeEventListener("load",s),i.removeEventListener("error",r)}i.addEventListener("load",s),i.addEventListener("error",r)})}function rT(i,e){return e&&(i.src=e),i.src&&Wg?new Promise((t,n)=>i.decode().then(()=>t(i)).catch(s=>i.complete&&i.width?t(i):n(s))):sT(i)}class oT{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const n=this.cache_[t];(e++&3)===0&&!n.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,n){const s=kl(e,t,n);return s in this.cache_?this.cache_[s]:null}getPattern(e,t,n){const s=kl(e,t,n);return s in this.patternCache_?this.patternCache_[s]:null}set(e,t,n,s,r){const o=kl(e,t,n),a=o in this.cache_;this.cache_[o]=s,r&&(s.getImageState()===Ee.IDLE&&s.load(),s.getImageState()===Ee.LOADING?s.ready().then(()=>{this.patternCache_[o]=pa().createPattern(s.getImage(1),"repeat")}):this.patternCache_[o]=pa().createPattern(s.getImage(1),"repeat")),a||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function kl(i,e,t){const n=t?gn(t):"null";return e+":"+i+":"+n}const Wt=new oT;let hr=null;class L_ extends lo{constructor(e,t,n,s,r){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=n,this.canvas_={},this.color_=r,this.imageState_=s===void 0?Ee.IDLE:s,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===Ee.LOADED){hr||(hr=Ve(1,1,void 0,{willReadFrequently:!0})),hr.drawImage(this.image_,0,0);try{hr.getImageData(0,0,1,1),this.tainted_=!1}catch{hr=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(ae.CHANGE)}handleImageError_(){this.imageState_=Ee.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Ee.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],n=Ve(e,t);n.fillRect(0,0,e,t),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===Ee.IDLE){this.image_||this.initializeImage_(),this.imageState_=Ee.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&rT(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==Ee.LOADED)return;const t=this.image_,n=Ve(Math.ceil(t.width*e),Math.ceil(t.height*e)),s=n.canvas;n.scale(e,e),n.drawImage(t,0,0),n.globalCompositeOperation="multiply",n.fillStyle=Ax(this.color_),n.fillRect(0,0,s.width/e,s.height/e),n.globalCompositeOperation="destination-in",n.drawImage(t,0,0),this.canvas_[e]=s}ready(){return this.ready_||(this.ready_=new Promise(e=>{if(this.imageState_===Ee.LOADED||this.imageState_===Ee.ERROR)e();else{const t=()=>{(this.imageState_===Ee.LOADED||this.imageState_===Ee.ERROR)&&(this.removeEventListener(ae.CHANGE,t),e())};this.addEventListener(ae.CHANGE,t)}})),this.ready_}}function Hh(i,e,t,n,s,r){let o=e===void 0?void 0:Wt.get(e,t,s);return o||(o=new L_(i,i&&"src"in i?i.src||void 0:e,t,n,s),Wt.set(e,t,s,o,r)),r&&o&&!Wt.getPattern(e,t,s)&&Wt.set(e,t,s,o,r),o}function fi(i){return i?Array.isArray(i)?Kh(i):typeof i=="object"&&"src"in i?aT(i):i:null}function aT(i){if(!i.offset||!i.size)return Wt.getPattern(i.src,"anonymous",i.color);const e=i.src+":"+i.offset,t=Wt.getPattern(e,void 0,i.color);if(t)return t;const n=Wt.get(i.src,"anonymous",null);if(n.getImageState()!==Ee.LOADED)return null;const s=Ve(i.size[0],i.size[1]);return s.drawImage(n.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),Hh(s.canvas,e,void 0,Ee.LOADED,i.color,!0),Wt.getPattern(e,void 0,i.color)}const M_="10px sans-serif",bt="#000",Os="round",Ni=[],ki=0,Gs="round",$r=10,Hr="#000",Zr="center",Ea="middle",Dn=[0,0,0,0],qr=1,ls=new Ci;let ur=null,Fd;const Mc={},lT=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function cT(i,e,t){return`${i} ${e} 16px "${t}"`}const hT=function(){let e,t;async function n(r){await t.ready;const o=await t.load(r);if(o.length===0)return!1;const a=bc(r),l=a.families[0].toLowerCase(),h=a.weight;return o.some(c=>{const u=c.family.replace(/^['"]|['"]$/g,"").toLowerCase(),d=Ic[c.weight]||c.weight;return u===l&&c.style===a.style&&d==h})}async function s(){await t.ready;let r=!0;const o=ls.getProperties(),a=Object.keys(o).filter(l=>o[l]<100);for(let l=a.length-1;l>=0;--l){const h=a[l];let c=o[h];c<100&&(await n(h)?(Xn(Mc),ls.set(h,100)):(c+=10,ls.set(h,c,!0),c<100&&(r=!1)))}e=void 0,r||(e=setTimeout(s,100))}return async function(r){t||(t=Na?self.fonts:document.fonts);const o=bc(r);if(!o)return;const a=o.families;let l=!1;for(const h of a){if(lT.has(h))continue;const c=cT(o.style,o.weight,h);ls.get(c)===void 0&&(ls.set(c,0,!0),l=!0)}l&&(clearTimeout(e),e=setTimeout(s,100))}}(),uT=function(){let i;return function(e){let t=Mc[e];if(t==null){if(Na){const n=bc(e),s=F_(e,"g");t=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=e,document.body.appendChild(i),t=i.offsetHeight,document.body.removeChild(i);Mc[e]=t}return t}}();function F_(i,e){return ur||(ur=Ve(1,1)),i!=Fd&&(ur.font=i,Fd=ur.font),ur.measureText(e)}function D_(i,e){return F_(i,e).width}function Dd(i,e,t){if(e in t)return t[e];const n=e.split(`
`).reduce((s,r)=>Math.max(s,D_(i,r)),0);return t[e]=n,n}function dT(i,e){const t=[],n=[],s=[];let r=0,o=0,a=0,l=0;for(let h=0,c=e.length;h<=c;h+=2){const u=e[h];if(u===`
`||h===c){r=Math.max(r,o),s.push(o),o=0,a+=l,l=0;continue}const d=e[h+1]||i.font,f=D_(d,u);t.push(f),o+=f;const g=uT(d);n.push(g),l=Math.max(l,g)}return{width:r,height:a,widths:t,heights:n,lineWidths:s}}function fT(i,e,t,n,s,r,o,a,l,h,c){i.save(),t!==1&&(i.globalAlpha===void 0?i.globalAlpha=u=>u.globalAlpha*=t:i.globalAlpha*=t),e&&i.transform.apply(i,e),n.contextInstructions?(i.translate(l,h),i.scale(c[0],c[1]),gT(n,i)):c[0]<0||c[1]<0?(i.translate(l,h),i.scale(c[0],c[1]),i.drawImage(n,s,r,o,a,0,0,o,a)):i.drawImage(n,s,r,o,a,l,h,o*c[0],a*c[1]),i.restore()}function gT(i,e){const t=i.contextInstructions;for(let n=0,s=t.length;n<s;n+=2)Array.isArray(t[n+1])?e[t[n]].apply(e,t[n+1]):e[t[n]]=t[n+1]}class Qa{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=We(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Qa({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return ce()}getImage(e){return ce()}getHitDetectionImage(){return ce()}getPixelRatio(e){return 1}getImageState(){return ce()}getImageSize(){return ce()}getOrigin(){return ce()}getSize(){return ce()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=We(e)}listenImageChange(e){ce()}load(){ce()}unlistenImageChange(e){ce()}ready(){return Promise.resolve()}}class el extends Qa{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?Ee.LOADING:Ee.LOADED,this.imageState_===Ee.LOADING&&this.ready().then(()=>this.imageState_=Ee.LOADED),this.render()}clone(){const e=this.getScale(),t=new el({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),n=this.getScaleArray();return[e[0]/2-t[0]/n[0],e[1]/2+t[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){const t=this.fill_?.getKey(),n=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${t}`+Object.values(this.renderOptions_).join(",");let s=Wt.get(n,null,null)?.getImage(1);if(!s){const r=this.renderOptions_,o=Math.ceil(r.size*e),a=Ve(o,o);this.draw_(r,a,e),s=a.canvas,Wt.set(n,null,null,new L_(s,void 0,null,Ee.LOADED,null))}return s}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,n){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let s=this.radius,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const R=s;s=r,r=R}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=r*Math.sin(a),h=Math.sqrt(r*r-l*l),c=s-h,u=Math.sqrt(l*l+c*c),d=u/l;if(e==="miter"&&d<=n)return d*t;const f=t/2/d,g=t/2*(c/u),m=Math.sqrt((s+f)*(s+f)+g*g)-s;if(this.radius2_===void 0||e==="bevel")return m*2;const y=s*Math.sin(a),p=Math.sqrt(s*s-y*y),x=r-p,T=Math.sqrt(y*y+x*x)/y;if(T<=n){const R=T*t/2-r-s;return 2*Math.max(m,R)}return m*2}createRenderOptions(){let e=Os,t=Gs,n=0,s=null,r=0,o,a=0;this.stroke_&&(o=fi(this.stroke_.getColor()??Hr),a=this.stroke_.getWidth()??qr,s=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??Gs,e=this.stroke_.getLineCap()??Os,n=this.stroke_.getMiterLimit()??$r);const l=this.calculateLineJoinSize_(t,a,n),h=Math.max(this.radius,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:e,lineDash:s,lineDashOffset:r,lineJoin:t,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,n){if(t.scale(n,n),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let s=this.fill_.getColor();s===null&&(s=bt),t.fillStyle=fi(s),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let n=this.fill_.getColor(),s=0;typeof n=="string"&&(n=gn(n)),n===null?s=1:Array.isArray(n)&&(s=n.length===4?n[3]:1),s===0&&(t=Ve(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const n=this.radius;if(t===1/0)e.arc(0,0,n,0,2*Math.PI);else{const s=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(t*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const l=r+a*o,h=a%2===0?n:s;e.lineTo(h*Math.cos(l),h*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=bt,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Hs extends el{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new Hs({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius=e,this.render()}}class _i{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new _i({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const t=Hh(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===Ee.IDLE&&t.load(),t.getImageState()===Ee.LOADING&&(this.patternImage_=t)}this.color_=e}getKey(){const e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?ne(e):typeof e=="object"&&"src"in e?e.src+":"+e.offset:gn(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function Od(i,e,t,n){return t!==void 0&&n!==void 0?[t/i,n/e]:t!==void 0?t/i:n!==void 0?n/e:1}class tl extends Qa{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,n=e.rotation!==void 0?e.rotation:0,s=e.scale!==void 0?e.scale:1,r=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:n,scale:s,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:r,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;let a=e.src;Le(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||ne(o)),Le(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),Le(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(e.src!==void 0?l=Ee.IDLE:o!==void 0&&("complete"in o?o.complete?l=o.src?Ee.LOADED:Ee.IDLE:l=Ee.LOADING:l=Ee.LOADED),this.color_=e.color!==void 0?gn(e.color):null,this.iconImage_=Hh(o,a,this.crossOrigin_,l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.initialOptions_,e.width!==void 0||e.height!==void 0){let h,c;if(e.size)[h,c]=e.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=e;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const f=this.iconImage_.getSize();this.setScale(Od(f[0],f[1],e.width,e.height))};this.listenImageChange(d);return}}h!==void 0&&this.setScale(Od(h,c,e.width,e.height))}}clone(){let e,t,n;return this.initialOptions_?(t=this.initialOptions_.width,n=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new tl({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=s[0]),this.anchorYUnits_=="fraction"&&(e[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+s[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),n=this.getScaleArray();return[e[0]-t[0]/n[0],e[1]+t[1]/n[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),n=this.iconImage_.getSize();if(!t||!n)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=n[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=n[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==Ee.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==Ee.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(ae.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(ae.CHANGE,e)}ready(){return this.iconImage_.ready()}}class mi{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new mi({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}class Lt{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=Gd,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new Lt({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Gd,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function _T(i){let e;if(typeof i=="function")e=i;else{let t;Array.isArray(i)?t=i:(Le(typeof i.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[i]),e=function(){return t}}return e}let Ul=null;function O_(i,e){if(!Ul){const t=new _i({color:"rgba(255,255,255,0.4)"}),n=new mi({color:"#3399CC",width:1.25});Ul=[new Lt({image:new Hs({fill:t,stroke:n,radius:5}),fill:t,stroke:n})]}return Ul}function Zh(){const i={},e=[255,255,255,1],t=[0,153,255,1],n=3;return i.Polygon=[new Lt({fill:new _i({color:[255,255,255,.5]})})],i.MultiPolygon=i.Polygon,i.LineString=[new Lt({stroke:new mi({color:e,width:n+2})}),new Lt({stroke:new mi({color:t,width:n})})],i.MultiLineString=i.LineString,i.Circle=i.Polygon.concat(i.LineString),i.Point=[new Lt({image:new Hs({radius:n*2,fill:new _i({color:t}),stroke:new mi({color:e,width:n/2})}),zIndex:1/0})],i.MultiPoint=i.Point,i.GeometryCollection=i.Polygon.concat(i.LineString,i.Point),i}function Gd(i){return i.getGeometry()}const mT="#333";class il{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=We(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new _i({color:mT}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new il({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=We(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}function pT(i){return!0}function yT(i){const e=$h(),t=ET(i,e),n=P_();return function(s,r){if(n.properties=s.getPropertiesInternal(),n.resolution=r,e.featureId){const o=s.getId();o!==void 0?n.featureId=o:n.featureId=null}return e.geometryType&&(n.geometryType=A_(s.getGeometry())),t(n)}}function Nd(i){const e=$h(),t=i.length,n=new Array(t);for(let o=0;o<t;++o)n[o]=Fc(i[o],e);const s=P_(),r=new Array(t);return function(o,a){if(s.properties=o.getPropertiesInternal(),s.resolution=a,e.featureId){const h=o.getId();h!==void 0?s.featureId=h:s.featureId=null}let l=0;for(let h=0;h<t;++h){const c=n[h](s);c&&(r[l]=c,l+=1)}return r.length=l,r}}function ET(i,e){const t=i.length,n=new Array(t);for(let s=0;s<t;++s){const r=i[s],o="filter"in r?Vi(r.filter,lt,e):pT;let a;if(Array.isArray(r.style)){const l=r.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=Fc(r.style[h],e)}else a=[Fc(r.style,e)];n[s]={filter:o,styles:a}}return function(s){const r=[];let o=!1;for(let a=0;a<t;++a){const l=n[a].filter;if(l(s)&&!(i[a].else&&o)){o=!0;for(const h of n[a].styles){const c=h(s);c&&r.push(c)}}}return r}}function Fc(i,e){const t=Jr(i,"",e),n=Qr(i,"",e),s=xT(i,e),r=TT(i,e),o=At(i,"z-index",e);if(!t&&!n&&!s&&!r&&!Un(i))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(i));const a=new Lt;return function(l){let h=!0;if(t){const c=t(l);c&&(h=!1),a.setFill(c)}if(n){const c=n(l);c&&(h=!1),a.setStroke(c)}if(s){const c=s(l);c&&(h=!1),a.setText(c)}if(r){const c=r(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function Jr(i,e,t){let n;if(e+"fill-pattern-src"in i)n=ST(i,e+"fill-",t);else{if(i[e+"fill-color"]==="none")return r=>null;n=qh(i,e+"fill-color",t)}if(!n)return null;const s=new _i;return function(r){const o=n(r);return o===Vh?null:(s.setColor(o),s)}}function Qr(i,e,t){const n=At(i,e+"stroke-width",t),s=qh(i,e+"stroke-color",t);if(!n&&!s)return null;const r=Mi(i,e+"stroke-line-cap",t),o=Mi(i,e+"stroke-line-join",t),a=G_(i,e+"stroke-line-dash",t),l=At(i,e+"stroke-line-dash-offset",t),h=At(i,e+"stroke-miter-limit",t),c=new mi;return function(u){if(s){const d=s(u);if(d===Vh)return null;c.setColor(d)}if(n&&c.setWidth(n(u)),r){const d=r(u);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(d)}if(o){const d=o(u);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(d)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function xT(i,e){const t="text-",n=Mi(i,t+"value",e);if(!n)return null;const s=Jr(i,t,e),r=Jr(i,t+"background-",e),o=Qr(i,t,e),a=Qr(i,t+"background-",e),l=Mi(i,t+"font",e),h=At(i,t+"max-angle",e),c=At(i,t+"offset-x",e),u=At(i,t+"offset-y",e),d=Rs(i,t+"overflow",e),f=Mi(i,t+"placement",e),g=At(i,t+"repeat",e),_=nl(i,t+"scale",e),m=Rs(i,t+"rotate-with-view",e),y=At(i,t+"rotation",e),p=Mi(i,t+"align",e),x=Mi(i,t+"justify",e),E=Mi(i,t+"baseline",e),T=Rs(i,t+"keep-upright",e),R=G_(i,t+"padding",e),I=sl(i,t+"declutter-mode"),S=new il({declutterMode:I});return function(A){if(S.setText(n(A)),s&&S.setFill(s(A)),r&&S.setBackgroundFill(r(A)),o&&S.setStroke(o(A)),a&&S.setBackgroundStroke(a(A)),l&&S.setFont(l(A)),h&&S.setMaxAngle(h(A)),c&&S.setOffsetX(c(A)),u&&S.setOffsetY(u(A)),d&&S.setOverflow(d(A)),f){const b=f(A);if(b!=="point"&&b!=="line")throw new Error("Expected point or line for text-placement");S.setPlacement(b)}if(g&&S.setRepeat(g(A)),_&&S.setScale(_(A)),m&&S.setRotateWithView(m(A)),y&&S.setRotation(y(A)),p){const b=p(A);if(b!=="left"&&b!=="center"&&b!=="right"&&b!=="end"&&b!=="start")throw new Error("Expected left, right, center, start, or end for text-align");S.setTextAlign(b)}if(x){const b=x(A);if(b!=="left"&&b!=="right"&&b!=="center")throw new Error("Expected left, right, or center for text-justify");S.setJustify(b)}if(E){const b=E(A);if(b!=="bottom"&&b!=="top"&&b!=="middle"&&b!=="alphabetic"&&b!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");S.setTextBaseline(b)}return R&&S.setPadding(R(A)),T&&S.setKeepUpright(T(A)),S}}function TT(i,e){return"icon-src"in i?CT(i,e):"shape-points"in i?wT(i,e):"circle-radius"in i?RT(i,e):null}function CT(i,e){const t="icon-",n=t+"src",s=N_(i[n],n),r=xa(i,t+"anchor",e),o=nl(i,t+"scale",e),a=At(i,t+"opacity",e),l=xa(i,t+"displacement",e),h=At(i,t+"rotation",e),c=Rs(i,t+"rotate-with-view",e),u=Ud(i,t+"anchor-origin"),d=Bd(i,t+"anchor-x-units"),f=Bd(i,t+"anchor-y-units"),g=AT(i,t+"color"),_=IT(i,t+"cross-origin"),m=bT(i,t+"offset"),y=Ud(i,t+"offset-origin"),p=Ta(i,t+"width"),x=Ta(i,t+"height"),E=vT(i,t+"size"),T=sl(i,t+"declutter-mode"),R=new tl({src:s,anchorOrigin:u,anchorXUnits:d,anchorYUnits:f,color:g,crossOrigin:_,offset:m,offsetOrigin:y,height:x,width:p,size:E,declutterMode:T});return function(I){return a&&R.setOpacity(a(I)),l&&R.setDisplacement(l(I)),h&&R.setRotation(h(I)),c&&R.setRotateWithView(c(I)),o&&R.setScale(o(I)),r&&R.setAnchor(r(I)),R}}function wT(i,e){const t="shape-",n=t+"points",s=t+"radius",r=Dc(i[n],n),o=Dc(i[s],s),a=Jr(i,t,e),l=Qr(i,t,e),h=nl(i,t+"scale",e),c=xa(i,t+"displacement",e),u=At(i,t+"rotation",e),d=Rs(i,t+"rotate-with-view",e),f=Ta(i,t+"radius2"),g=Ta(i,t+"angle"),_=sl(i,t+"declutter-mode"),m=new el({points:r,radius:o,radius2:f,angle:g,declutterMode:_});return function(y){return a&&m.setFill(a(y)),l&&m.setStroke(l(y)),c&&m.setDisplacement(c(y)),u&&m.setRotation(u(y)),d&&m.setRotateWithView(d(y)),h&&m.setScale(h(y)),m}}function RT(i,e){const t="circle-",n=Jr(i,t,e),s=Qr(i,t,e),r=At(i,t+"radius",e),o=nl(i,t+"scale",e),a=xa(i,t+"displacement",e),l=At(i,t+"rotation",e),h=Rs(i,t+"rotate-with-view",e),c=sl(i,t+"declutter-mode"),u=new Hs({radius:5,declutterMode:c});return function(d){return r&&u.setRadius(r(d)),n&&u.setFill(n(d)),s&&u.setStroke(s(d)),a&&u.setDisplacement(a(d)),l&&u.setRotation(l(d)),h&&u.setRotateWithView(h(d)),o&&u.setScale(o(d)),u}}function At(i,e,t){if(!(e in i))return;const n=Vi(i[e],_e,t);return function(s){return Dc(n(s),e)}}function Mi(i,e,t){if(!(e in i))return null;const n=Vi(i[e],pt,t);return function(s){return N_(n(s),e)}}function ST(i,e,t){const n=Mi(i,e+"pattern-src",t),s=kd(i,e+"pattern-offset",t),r=kd(i,e+"pattern-size",t),o=qh(i,e+"color",t);return function(a){return{src:n(a),offset:s&&s(a),size:r&&r(a),color:o&&o(a)}}}function Rs(i,e,t){if(!(e in i))return null;const n=Vi(i[e],lt,t);return function(s){const r=n(s);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${e}`);return r}}function qh(i,e,t){if(!(e in i))return null;const n=Vi(i[e],Ot,t);return function(s){return k_(n(s),e)}}function G_(i,e,t){if(!(e in i))return null;const n=Vi(i[e],_n,t);return function(s){return _o(n(s),e)}}function xa(i,e,t){if(!(e in i))return null;const n=Vi(i[e],_n,t);return function(s){const r=_o(n(s),e);if(r.length!==2)throw new Error(`Expected two numbers for ${e}`);return r}}function kd(i,e,t){if(!(e in i))return null;const n=Vi(i[e],_n,t);return function(s){return U_(n(s),e)}}function nl(i,e,t){if(!(e in i))return null;const n=Vi(i[e],_n|_e,t);return function(s){return PT(n(s),e)}}function Ta(i,e){const t=i[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function vT(i,e){const t=i[e];if(t!==void 0){if(typeof t=="number")return We(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function IT(i,e){const t=i[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function Ud(i,e){const t=i[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function Bd(i,e){const t=i[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function bT(i,e){const t=i[e];if(t!==void 0)return _o(t,e)}function sl(i,e){const t=i[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function AT(i,e){const t=i[e];if(t!==void 0)return k_(t,e)}function _o(i,e){if(!Array.isArray(i))throw new Error(`Expected an array for ${e}`);const t=i.length;for(let n=0;n<t;++n)if(typeof i[n]!="number")throw new Error(`Expected an array of numbers for ${e}`);return i}function N_(i,e){if(typeof i!="string")throw new Error(`Expected a string for ${e}`);return i}function Dc(i,e){if(typeof i!="number")throw new Error(`Expected a number for ${e}`);return i}function k_(i,e){if(typeof i=="string")return i;const t=_o(i,e),n=t.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function U_(i,e){const t=_o(i,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}function PT(i,e){return typeof i=="number"?i:U_(i,e)}const Xd={RENDER_ORDER:"renderOrder"};class B_ extends Ja{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Xd.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const n=this.getDeclutter();n in e.declutter||(e.declutter[n]=new v_(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(Xd.RENDER_ORDER,e)}setStyle(e){this.style_=e===void 0?O_:e;const t=LT(e);this.styleFunction_=e===null?void 0:_T(t),this.changed()}setDeclutter(e){this.declutter_=e?String(e):void 0,this.changed()}}function LT(i){if(i===void 0)return O_;if(!i)return null;if(typeof i=="function"||i instanceof Lt)return i;if(!Array.isArray(i))return Nd([i]);if(i.length===0)return[];const e=i.length,t=i[0];if(t instanceof Lt){const s=new Array(e);for(let r=0;r<e;++r){const o=i[r];if(!(o instanceof Lt))throw new Error("Expected a list of style instances");s[r]=o}return s}if("style"in t){const s=new Array(e);for(let r=0;r<e;++r){const o=i[r];if(!("style"in o))throw new Error("Expected a list of rules with a style property");s[r]=o}return yT(s)}return Nd(i)}class Lr extends qt{constructor(e,t,n,s){super(e),this.inversePixelTransform=t,this.frameState=n,this.context=s}}class MT extends ao{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){ce()}calculateMatrices2D(e){const t=e.viewState,n=e.coordinateToPixelTransform,s=e.pixelToCoordinateTransform;ii(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),wh(s,n)}forEachFeatureAtCoordinate(e,t,n,s,r,o,a,l){let h;const c=t.viewState;function u(E,T,R,I){return r.call(o,T,E?R:null,I)}const d=c.projection,f=qg(e.slice(),d),g=[[0,0]];if(d.canWrapX()&&s){const E=d.getExtent(),T=Se(E);g.push([-T,0],[T,0])}const _=t.layerStatesArray,m=_.length,y=[],p=[];for(let E=0;E<g.length;E++)for(let T=m-1;T>=0;--T){const R=_[T],I=R.layer;if(I.hasRenderer()&&zh(R,c)&&a.call(l,I)){const S=I.getRenderer(),A=I.getSource();if(S&&A){const b=A.getWrapX()?f:e,X=u.bind(null,R.managed);p[0]=b[0]+g[E][0],p[1]=b[1]+g[E][1],h=S.forEachFeatureAtCoordinate(p,t,n,X,y)}if(h)return h}}if(y.length===0)return;const x=1/y.length;return y.forEach((E,T)=>E.distanceSq+=T*x),y.sort((E,T)=>E.distanceSq-T.distanceSq),y.some(E=>h=E.callback(E.feature,E.layer,E.geometry)),h}hasFeatureAtCoordinate(e,t,n,s,r,o){return this.forEachFeatureAtCoordinate(e,t,n,s,un,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(e){ce()}scheduleExpireIconCache(e){Wt.canExpireCache()&&e.postRenderFunctions.push(FT)}}function FT(i,e){Wt.expire()}class DT extends MT{constructor(e){super(e),this.fontChangeListenerKey_=we(ls,Ls.PROPERTYCHANGE,e.redrawText,e),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=go+" ol-layers";const n=e.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const n=this.getMap();if(n.hasListener(e)){const s=new Lr(e,void 0,t);n.dispatchEvent(s)}}disposeInternal(){Oe(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(qe.PRECOMPOSE,e);const t=e.layerStatesArray.sort((a,l)=>a.zIndex-l.zIndex);t.some(a=>a.layer instanceof B_&&a.layer.getDeclutter())&&(e.declutter={});const s=e.viewState;this.children_.length=0;const r=[];let o=null;for(let a=0,l=t.length;a<l;++a){const h=t[a];e.layerIndex=a;const c=h.layer,u=c.getSourceState();if(!zh(h,s)||u!="ready"&&u!="undefined"){c.unrender();continue}const d=c.render(e,o);d&&(d!==o&&(this.children_.push(d),o=d),r.push(h))}this.declutter(e,r),$E(this.element_,this.children_),this.dispatchRenderEvent(qe.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let n=t.length-1;n>=0;--n){const s=t[n],r=s.layer;r.getDeclutter()&&r.renderDeclutter(e,s)}t.forEach(n=>n.layer.renderDeferred(e))}}}function X_(i){if(i instanceof Ja){i.setMapInternal(null);return}i instanceof $s&&i.getLayers().forEach(X_)}function j_(i,e){if(i instanceof Ja){i.setMapInternal(e);return}if(i instanceof $s){const t=i.getLayers().getArray();for(let n=0,s=t.length;n<s;++n)j_(t[n],e)}}let OT=class extends Ci{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=GT(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:Ey,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=ht(),this.pixelToCoordinateTransform_=ht(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||y_(),this.interactions=t.interactions||px({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new Cy(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(rt.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(rt.VIEW,this.handleViewChanged_),this.addChangeListener(rt.SIZE,this.handleSizeChanged_),this.addChangeListener(rt.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const n=this;e.view&&!(e.view instanceof ui)&&e.view.then(function(s){n.setView(new ui(s))}),this.controls.addEventListener(Ye.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(Ye.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(Ye.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(Ye.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(Ye.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(Ye.REMOVE,s=>{const r=s.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){j_(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,n){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(e);n=n!==void 0?n:{};const r=n.hitTolerance!==void 0?n.hitTolerance:0,o=n.layerFilter!==void 0?n.layerFilter:un,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,r,a,t,null,o,null)}getFeaturesAtPixel(e,t){const n=[];return this.forEachFeatureAtPixel(e,function(s){n.push(s)},t),n}getAllLayers(){const e=[];function t(n){n.forEach(function(s){s instanceof $s?t(s.getLayers()):e.push(s)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const s=t.layerFilter!==void 0?t.layerFilter:un,r=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,r,o,s,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const n=this.viewport_.getBoundingClientRect(),s=this.getSize(),r=n.width/s[0],o=n.height/s[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-n.left)/r,(a.clientY-n.top)/o]}getTarget(){return this.get(rt.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return fn(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?Ke(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(rt.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof Nt){t.setLayers(e);return}const n=t.getLayers();n.clear(),n.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const s=e[t];if(!s.visible)continue;const r=s.layer.getRenderer();if(r&&!r.ready)return!0;const o=s.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=Be(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?Ke(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(rt.SIZE)}getView(){return this.get(rt.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,n,s){return wy(this.frameState_,e,t,n,s)}handleBrowserEvent(e,t){t=t||e.type;const n=new Li(t,this,e);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,n=t.type;if(n===yc.POINTERDOWN||n===ae.WHEEL||n===ae.KEYDOWN){const s=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():s,o=t.target,a=r instanceof ShadowRoot?r.host===o?r.host.ownerDocument:r:r===s?s.documentElement:r;if(this.overlayContainerStopEvent_.contains(o)||!a.contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const s=this.getInteractions().getArray().slice();for(let r=s.length-1;r>=0;r--){const o=s[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let s=this.maxTilesLoading_,r=s;if(e){const o=e.viewHints;if(o[ot.ANIMATING]||o[ot.INTERACTING]){const a=Date.now()-e.time>8;s=a?0:8,r=a?0:2}}t.getTilesLoading()<s&&(t.reprioritize(),t.loadMoreTiles(s,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(qe.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(qe.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new os(qi.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new os(qi.LOADSTART,this,e))));const n=this.postRenderFunctions_;if(e)for(let s=0,r=n.length;s<r;++s)n[s](this,e);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,s=this.targetChangeHandlerKeys_.length;n<s;++n)Oe(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(ae.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ae.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new DT(this)),this.mapBrowserEventHandler_=new xy(this,this.moveTolerance_);for(const r in Te)this.mapBrowserEventHandler_.addEventListener(Te[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(ae.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ae.WHEEL,this.boundHandleBrowserEvent_,Kg?{passive:!1}:!1);let n;if(this.keyboardEventTarget_)n=this.keyboardEventTarget_;else{const r=t.getRootNode();n=r instanceof ShadowRoot?r.host:t}this.targetChangeHandlerKeys_=[we(n,ae.KEYDOWN,this.handleBrowserEvent,this),we(n,ae.KEYPRESS,this.handleBrowserEvent,this)];const s=t.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Oe(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Oe(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=we(e,Ls.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=we(e,ae.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Oe),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new en("addlayer",e)),this.layerGroupPropertyListenerKeys_=[we(e,Ls.PROPERTYCHANGE,this.render,this),we(e,ae.CHANGE,this.render,this),we(e,"addlayer",this.handleLayerAdd_,this),we(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;const e=this.frameState_.layerStatesArray;for(let t=0,n=e.length;t<n;++t){const s=e[t].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){X_(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),n=this.getView(),s=this.frameState_;let r=null;if(t!==void 0&&Ad(t)&&n&&n.isDef()){const o=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:Tc(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:ne(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=Tc(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),s&&(!this.previousExtent_||!Ws(this.previousExtent_)&&!Br(r.extent,this.previousExtent_))&&(this.dispatchEvent(new os(qi.MOVESTART,this,s)),this.previousExtent_=Vs(this.previousExtent_)),this.previousExtent_&&!r.viewHints[ot.ANIMATING]&&!r.viewHints[ot.INTERACTING]&&!Br(r.extent,this.previousExtent_)&&(this.dispatchEvent(new os(qi.MOVEEND,this,r)),Yg(r.extent,this.previousExtent_))),this.dispatchEvent(new os(qi.POSTRENDER,this,r)),this.renderComplete_=(this.hasListener(qi.LOADSTART)||this.hasListener(qi.LOADEND)||this.hasListener(qe.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new en("removelayer",t)),this.set(rt.LAYERGROUP,e)}setSize(e){this.set(rt.SIZE,e)}setTarget(e){this.set(rt.TARGET,e)}setView(e){if(!e||e instanceof ui){this.set(rt.VIEW,e);return}this.set(rt.VIEW,new ui);const t=this;e.then(function(n){t.setView(new ui(n))})}updateSize(){const e=this.getTargetElement();let t;if(e){const s=getComputedStyle(e),r=e.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),o=e.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(r)&&!isNaN(o)&&(t=[Math.max(0,r),Math.max(0,o)],!Ad(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Qg("No map visible because the map container's width or height are 0."))}const n=this.getSize();t&&(!n||!zi(t,n))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};function GT(i){let e=null;i.keyboardEventTarget!==void 0&&(e=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const t={},n=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new $s({layers:i.layers});t[rt.LAYERGROUP]=n,t[rt.TARGET]=i.target,t[rt.VIEW]=i.view instanceof ui?i.view:new ui;let s;i.controls!==void 0&&(Array.isArray(i.controls)?s=new Nt(i.controls.slice()):(Le(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=i.controls));let r;i.interactions!==void 0&&(Array.isArray(i.interactions)?r=new Nt(i.interactions.slice()):(Le(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=i.interactions));let o;return i.overlays!==void 0?Array.isArray(i.overlays)?o=new Nt(i.overlays.slice()):(Le(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=i.overlays):o=new Nt,{controls:s,interactions:r,keyboardEventTarget:e,overlays:o,values:t}}class Jh extends lo{constructor(e,t,n){super(),n=n||{},this.tileCoord=e,this.state=t,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(ae.CHANGE)}release(){this.setState(Z.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==Z.EMPTY){if(this.state!==Z.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}}load(){ce()}getAlpha(e,t){if(!this.transition_)return 1;let n=this.transitionStarts_[e];if(!n)n=t,this.transitionStarts_[e]=n;else if(n===-1)return 1;const s=t-n+1e3/60;return s>=this.transition_?1:Jg(s/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}function Ns(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}function Oc(i){return i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Float32Array||i instanceof DataView?i:null}const NT=new Error("disposed");let qn=null;function kT(i){qn||(qn=Ve(i.width,i.height,void 0,{willReadFrequently:!0}));const e=qn.canvas,t=i.width;e.width!==t&&(e.width=t);const n=i.height;return e.height!==n&&(e.height=n),qn.clearRect(0,0,t,n),qn.drawImage(i,0,0),qn.getImageData(0,0,t,n).data}const UT=[256,256];class eo extends Jh{constructor(e){const t=Z.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=Ns(this.data_);return e?[e.width,e.height]:UT}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==Z.IDLE&&this.state!==Z.ERROR)return;this.state=Z.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=Z.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=Z.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(NT),this.controller_=null),super.disposeInternal()}}class rl extends Jh{constructor(e,t,n,s,r,o){super(e,t,o),this.crossOrigin_=s,this.src_=n,this.key=n,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(e){this.image_=e,this.state=Z.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=Z.ERROR,this.unlistenImage_(),this.image_=BT(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=Z.LOADED:this.state=Z.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==Z.ERROR&&(this.state=Z.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Z.IDLE&&(this.state=Z.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=nT(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function BT(){const i=Ve(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}class ol{constructor(e,t,n,s){this.minX=e,this.maxX=t,this.minY=n,this.maxY=s}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function Jn(i,e,t,n,s){return s!==void 0?(s.minX=i,s.maxX=e,s.minY=t,s.maxY=n,s):new ol(i,e,t,n)}let Bl;const Ss=[];function jd(i,e,t,n,s){i.beginPath(),i.moveTo(0,0),i.lineTo(e,t),i.lineTo(n,s),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(e,n)+1,Math.max(t,s)),i.restore()}function Xl(i,e){return Math.abs(i[e*4]-210)>2||Math.abs(i[e*4+3]-.75*255)>2}function XT(){if(Bl===void 0){const i=Ve(6,6,Ss);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",jd(i,4,5,4,0),jd(i,4,5,0,5);const e=i.getImageData(0,0,3,3).data;Bl=Xl(e,0)||Xl(e,4)||Xl(e,8),Za(i),Ss.push(i.canvas)}return Bl}function zd(i,e,t,n){const s=Va(t,e,i);let r=ga(e,n,t);const o=e.getMetersPerUnit();o!==void 0&&(r*=o);const a=i.getMetersPerUnit();a!==void 0&&(r/=a);const l=i.getExtent();if(!l||dn(l,s)){const h=ga(i,r,s)/r;isFinite(h)&&h>0&&(r/=h)}return r}function z_(i,e,t,n){const s=xi(t);let r=zd(i,e,s,n);return(!isFinite(r)||r<=0)&&fh(t,function(o){return r=zd(i,e,o,n),isFinite(r)&&r>0}),r}function jT(i,e,t,n,s,r,o,a,l,h,c,u,d,f){const g=Ve(Math.round(t*i),Math.round(t*e),Ss);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(t,t);function _(T){return Math.round(T*t)/t}g.globalCompositeOperation="lighter";const m=kt();l.forEach(function(T,R,I){dh(m,T.extent)});let y;const p=t/n,x=(u?1:1+Math.pow(2,-24))/p;y=Ve(Math.round(Se(m)*p),Math.round(Je(m)*p),Ss),u||(y.imageSmoothingEnabled=!1),l.forEach(function(T,R,I){if(T.image.width>0&&T.image.height>0){if(T.clipExtent){y.save();const O=(T.clipExtent[0]-m[0])*p,B=-(T.clipExtent[3]-m[3])*p,K=Se(T.clipExtent)*p,Y=Je(T.clipExtent)*p;y.rect(u?O:Math.round(O),u?B:Math.round(B),u?K:Math.round(O+K)-Math.round(O),u?Y:Math.round(B+Y)-Math.round(B)),y.clip()}const S=(T.extent[0]-m[0])*p,A=-(T.extent[3]-m[3])*p,b=Se(T.extent)*p,X=Je(T.extent)*p;y.drawImage(T.image,h,h,T.image.width-2*h,T.image.height-2*h,u?S:Math.round(S),u?A:Math.round(A),u?b:Math.round(S+b)-Math.round(S),u?X:Math.round(A+X)-Math.round(A)),T.clipExtent&&y.restore()}});const E=Xi(o);return a.getTriangles().forEach(function(T,R,I){const S=T.source,A=T.target;let b=S[0][0],X=S[0][1],O=S[1][0],B=S[1][1],K=S[2][0],Y=S[2][1];const W=_((A[0][0]-E[0])/r),k=_(-(A[0][1]-E[1])/r),G=_((A[1][0]-E[0])/r),q=_(-(A[1][1]-E[1])/r),Q=_((A[2][0]-E[0])/r),re=_(-(A[2][1]-E[1])/r),L=b,ue=X;b=0,X=0,O-=L,B-=ue,K-=L,Y-=ue;const z=[[O,B,0,0,G-W],[K,Y,0,0,Q-W],[0,0,O,B,q-k],[0,0,K,Y,re-k]],N=Sy(z);if(!N)return;if(g.save(),g.beginPath(),XT()||!u){g.moveTo(G,q);const te=4,ge=W-G,Ce=k-q;for(let Re=0;Re<te;Re++)g.lineTo(G+_((Re+1)*ge/te),q+_(Re*Ce/(te-1))),Re!=te-1&&g.lineTo(G+_((Re+1)*ge/te),q+_((Re+1)*Ce/(te-1)));g.lineTo(Q,re)}else g.moveTo(G,q),g.lineTo(W,k),g.lineTo(Q,re);g.clip(),g.transform(N[0],N[2],N[1],N[3],W,k),g.translate(m[0]-L,m[3]-ue);let J;if(y)J=y.canvas,g.scale(x,-x);else{const te=l[0],ge=te.extent;J=te.image,g.scale(Se(ge)/J.width,-Je(ge)/J.height)}g.drawImage(J,0,0),g.restore()}),y&&(Za(y),Ss.push(y.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(T,R,I){const S=T.target,A=(S[0][0]-E[0])/r,b=-(S[0][1]-E[1])/r,X=(S[1][0]-E[0])/r,O=-(S[1][1]-E[1])/r,B=(S[2][0]-E[0])/r,K=-(S[2][1]-E[1])/r;g.beginPath(),g.moveTo(X,O),g.lineTo(A,b),g.lineTo(B,K),g.closePath(),g.stroke()}),g.restore()),g.canvas}const zT=10,Vd=.25;class V_{constructor(e,t,n,s,r,o,a){this.sourceProj_=e,this.targetProj_=t;let l={};const h=a?o_(x=>Ke(a,Va(x,this.targetProj_,this.sourceProj_))):Vr(this.targetProj_,this.sourceProj_);this.transformInv_=function(x){const E=x[0]+"/"+x[1];return l[E]||(l[E]=h(x)),l[E]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&Se(s)>=Se(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Se(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Se(this.targetProj_.getExtent()):null;const c=Xi(n),u=Xa(n),d=Ba(n),f=Ua(n),g=this.transformInv_(c),_=this.transformInv_(u),m=this.transformInv_(d),y=this.transformInv_(f),p=zT+(o?Math.max(0,Math.ceil(Math.log2(Xr(n)/(o*o*256*256)))):0);if(this.addQuad_(c,u,d,f,g,_,m,y,p),this.wrapsXInSource_){let x=1/0;this.triangles_.forEach(function(E,T,R){x=Math.min(x,E.source[0][0],E.source[1][0],E.source[2][0])}),this.triangles_.forEach(E=>{if(Math.max(E.source[0][0],E.source[1][0],E.source[2][0])-x>this.sourceWorldWidth_/2){const T=[[E.source[0][0],E.source[0][1]],[E.source[1][0],E.source[1][1]],[E.source[2][0],E.source[2][1]]];T[0][0]-x>this.sourceWorldWidth_/2&&(T[0][0]-=this.sourceWorldWidth_),T[1][0]-x>this.sourceWorldWidth_/2&&(T[1][0]-=this.sourceWorldWidth_),T[2][0]-x>this.sourceWorldWidth_/2&&(T[2][0]-=this.sourceWorldWidth_);const R=Math.min(T[0][0],T[1][0],T[2][0]);Math.max(T[0][0],T[1][0],T[2][0])-R<this.sourceWorldWidth_/2&&(E.source=T)}})}l={}}addTriangle_(e,t,n,s,r,o){this.triangles_.push({source:[s,r,o],target:[e,t,n]})}addQuad_(e,t,n,s,r,o,a,l,h){const c=ft([r,o,a,l]),u=this.sourceWorldWidth_?Se(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&u>.5&&u<1;let g=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=ft([e,t,n,s]);g=Se(m)/this.targetWorldWidth_>Vd||g}!f&&this.sourceProj_.isGlobal()&&u&&(g=u>Vd||g)}if(!g&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Et(c,this.maxSourceExtent_))return;let _=0;if(!g&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)g=!0;else if(_=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(h>0){if(!g){const m=[(e[0]+n[0])/2,(e[1]+n[1])/2],y=this.transformInv_(m);let p;f?p=(Nn(r[0],d)+Nn(a[0],d))/2-Nn(y[0],d):p=(r[0]+a[0])/2-y[0];const x=(r[1]+a[1])/2-y[1];g=p*p+x*x>this.errorThresholdSquared_}if(g){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){const m=[(t[0]+n[0])/2,(t[1]+n[1])/2],y=this.transformInv_(m),p=[(s[0]+e[0])/2,(s[1]+e[1])/2],x=this.transformInv_(p);this.addQuad_(e,t,m,p,r,o,y,x,h-1),this.addQuad_(p,m,n,s,x,y,a,l,h-1)}else{const m=[(e[0]+t[0])/2,(e[1]+t[1])/2],y=this.transformInv_(m),p=[(n[0]+s[0])/2,(n[1]+s[1])/2],x=this.transformInv_(p);this.addQuad_(e,m,p,s,r,y,x,l,h-1),this.addQuad_(m,t,n,p,y,o,a,x,h-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(_&11)==0&&this.addTriangle_(e,n,s,r,a,l),(_&14)==0&&this.addTriangle_(e,n,t,r,a,o),_&&((_&13)==0&&this.addTriangle_(t,s,e,o,l,r),(_&7)==0&&this.addTriangle_(t,s,n,o,l,a))}calculateSourceExtent(){const e=kt();return this.triangles_.forEach(function(t,n,s){const r=t.source;Ar(e,r[0]),Ar(e,r[1]),Ar(e,r[2])}),e}getTriangles(){return this.triangles_}}const W_=.5;class Qh extends Jh{constructor(e,t,n,s,r,o,a,l,h,c,u,d){super(r,Z.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=s,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const f=s.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const m=g?xt(f,g):f;if(Xr(m)===0){this.state=Z.EMPTY;return}const y=e.getExtent();y&&(_?_=xt(_,y):_=y);const p=s.getResolution(this.wrappedTileCoord_[0]),x=z_(e,n,m,p);if(!isFinite(x)||x<=0){this.state=Z.EMPTY;return}const E=c!==void 0?c:W_;if(this.triangulation_=new V_(e,n,m,_,x*E,p),this.triangulation_.getTriangles().length===0){this.state=Z.EMPTY;return}this.sourceZ_=t.getZForResolution(x);let T=this.triangulation_.calculateSourceExtent();if(_&&(e.canWrapX()?(T[1]=Ge(T[1],_[1],_[3]),T[3]=Ge(T[3],_[1],_[3])):T=xt(T,_)),!Xr(T))this.state=Z.EMPTY;else{let R=0,I=0;e.canWrapX()&&(R=Se(y),I=Math.floor((T[0]-y[0])/R)),_h(T.slice(),e,!0).forEach(A=>{const b=t.getTileRangeForExtentAndZ(A,this.sourceZ_);for(let X=b.minX;X<=b.maxX;X++)for(let O=b.minY;O<=b.maxY;O++){const B=h(this.sourceZ_,X,O,a);if(B){const K=I*R;this.sourceTiles_.push({tile:B,offset:K})}}++I}),this.sourceTiles_.length===0&&(this.state=Z.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{const n=t.tile;if(n&&n.getState()==Z.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);s[0]+=t.offset,s[2]+=t.offset;const r=this.clipExtent_?.slice();r&&(r[0]+=t.offset,r[2]+=t.offset),e.push({extent:s,clipExtent:r,image:n.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=Z.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),s=typeof n=="number"?n:n[0],r=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=jT(s,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=Z.LOADED}this.changed()}load(){if(this.state==Z.IDLE){this.state=Z.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const n=t.getState();if(n==Z.IDLE||n==Z.LOADING){e++;const s=we(t,ae.CHANGE,r=>{const o=t.getState();(o==Z.LOADED||o==Z.ERROR||o==Z.EMPTY)&&(Oe(s),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t},n,s){t.getState()==Z.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Oe),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Za(this.canvas_.getContext("2d")),Ss.push(this.canvas_),this.canvas_=null),super.release()}}class K_{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof ao&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const n=this.entries_[e];return Le(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(e){const t=this.entries_[e];return Le(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.key_;return e}getValues(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){Le(!(e in this.entries_),"Tried to set a value for a key that is used already");const n={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[e]=n,++this.count_}setSize(e){this.highWaterMark=e}}function ks(i,e,t,n){return n!==void 0?(n[0]=i,n[1]=e,n[2]=t,n):[i,e,t]}function Y_(i,e,t){return i+"/"+e+"/"+t}function cs(i){return Y_(i[0],i[1],i[2])}function VT(i){return WT(i[0],i[1],i[2])}function WT(i,e,t){return(e<<i)+t}function KT(i,e){const t=i[0],n=i[1],s=i[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const r=e.getFullTileRange(t);return r?r.containsXY(n,s):!0}class $_{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(pa(),{get:(e,t)=>{if(typeof pa()[t]=="function")return this.push_(t),this.pushMethodArgs_},set:(e,t,n)=>(this.push_(t,n),!0)})}push_(...e){const t=this.instructions_,n=this.zIndex+this.offset_;t[n]||(t[n]=[]),t[n].push(...e)}pushMethodArgs_=(...e)=>(this.push_(e),this);pushFunction(e){this.push_(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let n=0,s=t.length;n<s;++n){const r=t[n];if(typeof r=="function"){r(e);continue}const o=t[++n];if(typeof e[r]=="function")e[r](...o);else{if(typeof o=="function"){e[r]=o(e);continue}e[r]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const YT=5;class H_ extends co{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=YT}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(e){return ce()}getData(e){return null}prepareFrame(e){return ce()}renderFrame(e,t){return ce()}forEachFeatureAtCoordinate(e,t,n,s,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===Ee.LOADED||t.getState()===Ee.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=Ee.LOADED&&t!=Ee.ERROR&&e.addEventListener(ae.CHANGE,this.boundHandleImageChange_),t==Ee.IDLE&&(e.load(),t=e.getState()),t==Ee.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const Wd=[];let hs=null;function $T(){hs=Ve(1,1,void 0,{willReadFrequently:!0})}class Z_ extends H_{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=ht(),this.pixelTransform=ht(),this.inversePixelTransform=ht(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,n){hs||$T(),hs.clearRect(0,0,1,1);let s;try{hs.drawImage(e,t,n,1,1,0,0,1,1),s=hs.getImageData(0,0,1,1).data}catch{return hs=null,null}return s}getBackground(e){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(e.viewState.resolution)),n||void 0}useContainer(e,t,n){const s=this.getLayer().getClassName();let r,o;if(e&&e.className===s&&(!n||e&&e.style.backgroundColor&&zi(gn(e.style.backgroundColor),gn(n)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&TE(o.canvas.style.transform,t)?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=s;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=Ve();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(e,t,n){const s=Xi(n),r=Xa(n),o=Ba(n),a=Ua(n);Ke(t.coordinateToPixelTransform,s),Ke(t.coordinateToPixelTransform,r),Ke(t.coordinateToPixelTransform,o),Ke(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;Ke(l,s),Ke(l,r),Ke(l,o),Ke(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}prepareContainer(e,t){const n=e.extent,s=e.viewState.resolution,r=e.viewState.rotation,o=e.pixelRatio,a=Math.round(Se(n)/s*o),l=Math.round(Je(n)/s*o);ii(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/o,1/o,r,-a/2,-l/2),wh(this.inversePixelTransform,this.pixelTransform);const h=xE(this.pixelTransform);if(this.useContainer(t,h,this.getBackground(e)),!this.containerReused){const c=this.context.canvas;c.width!=a||c.height!=l?(c.width=a,c.height=l):this.context.clearRect(0,0,a,l),h!==c.style.transform&&(c.style.transform=h)}}dispatchRenderEvent_(e,t,n){const s=this.getLayer();if(s.hasListener(e)){const r=new Lr(e,this.inversePixelTransform,n,t);s.dispatchEvent(r)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(qe.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(qe.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new $_),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(qe.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(qe.POSTRENDER,this.context,e))}getRenderTransform(e,t,n,s,r,o,a){const l=r/2,h=o/2,c=s/t,u=-c,d=-e[0]+a,f=-e[1];return ii(this.tempTransform,l,h,c,u,-n,d,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function jl(i,e,t,n,s){return`${ne(i)},${e},${Y_(t,n,s)}`}function zl(i,e,t){if(!(t in i))return i[t]=new Set([e]),!0;const n=i[t],s=n.has(e);return s||n.add(e),!s}function HT(i,e,t){const n=i[t];return n?n.delete(e):!1}function Kd(i,e){const t=i.layerStatesArray[i.layerIndex];t.extent&&(e=xt(e,ei(t.extent,i.viewState.projection)));const n=t.layer.getRenderSource();if(!n.getWrapX()){const s=n.getTileGridForProjection(i.viewState.projection).getExtent();s&&(e=xt(e,s))}return e}class ZT extends Z_{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=kt(),this.tempTileRange_=new ol(0,0,0,0),this.tempTileCoord_=ks(0,0,0);const n=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new K_(n),this.maxStaleKeys=n*.5}getTileCache(){return this.tileCache_}getOrCreateTile(e,t,n,s){const r=this.tileCache_,a=this.getLayer().getSource(),l=jl(a,a.getKey(),e,t,n);let h;if(r.containsKey(l))h=r.get(l);else{if(h=a.getTile(e,t,n,s.pixelRatio,s.viewState.projection),!h)return null;r.set(l,h)}return h}getTile(e,t,n,s){const r=this.getOrCreateTile(e,t,n,s);return r||null}getData(e){const t=this.frameState;if(!t)return null;const n=this.getLayer(),s=Ke(t.pixelToCoordinateTransform,e.slice()),r=n.getExtent();if(r&&!dn(r,s))return null;const o=t.viewState,a=n.getRenderSource(),l=a.getTileGridForProjection(o.projection),h=a.getTilePixelRatio(t.pixelRatio);for(let c=l.getZForResolution(o.resolution);c>=l.getMinZoom();--c){const u=l.getTileCoordForCoordAndZ(s,c),d=this.getTile(c,u[1],u[2],t);if(!d||d.getState()!==Z.LOADED)continue;const f=l.getOrigin(c),g=We(l.getTileSize(c)),_=l.getResolution(c);let m;if(d instanceof rl||d instanceof Qh)m=d.getImage();else if(d instanceof eo){if(m=Ns(d.getData()),!m)continue}else continue;const y=Math.floor(h*((s[0]-f[0])/_-u[1]*g[0])),p=Math.floor(h*((f[1]-s[1])/_-u[2]*g[1])),x=Math.round(h*a.getGutterForProjection(o.projection));return this.getImageData(m,y+x,p+x)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const n=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==n&&(this.renderedSourceRevision_=n,this.renderedSourceKey_===t.getKey()&&this.tileCache_.clear()):this.renderedSourceRevision_=n,!0}enqueueTiles(e,t,n,s,r){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=ne(l);c in e.wantedTiles||(e.wantedTiles[c]={});const u=e.wantedTiles[c],d=a.getMapInternal(),f=Math.max(n-r,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection)),g=o.rotation,_=g?gh(o.center,o.resolution,g,e.size):void 0;for(let m=n;m>=f;--m){const y=h.getTileRangeForExtentAndZ(t,m,this.tempTileRange_),p=h.getResolution(m);for(let x=y.minX;x<=y.maxX;++x)for(let E=y.minY;E<=y.maxY;++E){if(g&&!h.tileCoordIntersectsViewport([m,x,E],_))continue;const T=this.getTile(m,x,E,e);if(!T||!zl(s,T,m))continue;const I=T.getKey();if(u[I]=!0,T.getState()===Z.IDLE&&!e.tileQueue.isKeyQueued(I)){const S=ks(m,x,E,this.tempTileCoord_);e.tileQueue.enqueue([T,c,h.getTileCoordCenter(S),p])}}}}findStaleTile_(e,t){const n=this.tileCache_,s=e[0],r=e[1],o=e[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){const h=jl(this.getLayer().getSource(),a[l],s,r,o);if(n.containsKey(h)){const c=n.peek(h);if(c.getState()===Z.LOADED)return c.endTransition(ne(this)),zl(t,c,s),!0}}return!1}findAltTiles_(e,t,n,s){const r=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!r)return!1;let o=!0;const a=this.tileCache_,l=this.getLayer().getRenderSource(),h=l.getKey();for(let c=r.minX;c<=r.maxX;++c)for(let u=r.minY;u<=r.maxY;++u){const d=jl(l,h,n,c,u);let f=!1;if(a.containsKey(d)){const g=a.peek(d);g.getState()===Z.LOADED&&(zl(s,g,n),f=!0)}f||(o=!1)}return o}renderFrame(e,t){this.renderComplete=!0;const n=e.layerStatesArray[e.layerIndex],s=e.viewState,r=s.projection,o=s.resolution,a=s.center,l=e.pixelRatio,h=this.getLayer(),c=h.getSource(),u=c.getTileGridForProjection(r),d=u.getZForResolution(o,c.zDirection),f=u.getResolution(d),g=c.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==g&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=g):this.renderedSourceKey_=g;let _=e.extent;const m=c.getTilePixelRatio(l);this.prepareContainer(e,t);const y=this.context.canvas.width,p=this.context.canvas.height,x=n.extent&&ei(n.extent);x&&(_=xt(_,ei(n.extent)));const E=f*y/2/m,T=f*p/2/m,R=[a[0]-E,a[1]-T,a[0]+E,a[1]+T],I={};this.renderedTiles.length=0;const S=h.getPreload();if(e.nextExtent){const G=u.getZForResolution(s.nextResolution,c.zDirection),q=Kd(e,e.nextExtent);this.enqueueTiles(e,q,G,I,S)}const A=Kd(e,_);if(this.enqueueTiles(e,A,d,I,0),S>0&&setTimeout(()=>{this.enqueueTiles(e,A,d-1,I,S-1)},0),!(d in I))return this.container;const b=ne(this),X=e.time;for(const G of I[d]){const q=G.getState();if(q===Z.EMPTY)continue;const Q=G.tileCoord;if(q===Z.LOADED&&G.getAlpha(b,X)===1){G.endTransition(b);continue}if(q!==Z.ERROR&&(this.renderComplete=!1),this.findStaleTile_(Q,I)){HT(I,G,d),e.animate=!0;continue}if(this.findAltTiles_(u,Q,d+1,I))continue;const ue=u.getMinZoom();for(let z=d-1;z>=ue&&!this.findAltTiles_(u,Q,z,I);--z);}const O=f/o*l/m,B=this.getRenderContext(e);ii(this.tempTransform,y/2,p/2,O,O,0,-y/2,-p/2),n.extent&&this.clipUnrotated(B,e,x),c.getInterpolate()||(B.imageSmoothingEnabled=!1),this.preRender(B,e);const K=Object.keys(I).map(Number);K.sort(Oi);let Y;const W=[],k=[];for(let G=K.length-1;G>=0;--G){const q=K[G],Q=c.getTilePixelSize(q,l,r),L=u.getResolution(q)/f,ue=Q[0]*L*O,z=Q[1]*L*O,N=u.getTileCoordForCoordAndZ(Xi(R),q),J=u.getTileCoordExtent(N),te=Ke(this.tempTransform,[m*(J[0]-R[0])/f,m*(R[3]-J[3])/f]),ge=m*c.getGutterForProjection(r);for(const Ce of I[q]){if(Ce.getState()!==Z.LOADED)continue;const Re=Ce.tileCoord,Jt=N[1]-Re[1],C=Math.round(te[0]-(Jt-1)*ue),w=N[2]-Re[2],P=Math.round(te[1]-(w-1)*z),F=Math.round(te[0]-Jt*ue),M=Math.round(te[1]-w*z),D=C-F,H=P-M,$=K.length===1;let j=!1;Y=[F,M,F+D,M,F+D,M+H,F,M+H];for(let U=0,ie=W.length;U<ie;++U)if(!$&&q<k[U]){const V=W[U];Et([F,M,F+D,M+H],[V[0],V[3],V[4],V[7]])&&(j||(B.save(),j=!0),B.beginPath(),B.moveTo(Y[0],Y[1]),B.lineTo(Y[2],Y[3]),B.lineTo(Y[4],Y[5]),B.lineTo(Y[6],Y[7]),B.moveTo(V[6],V[7]),B.lineTo(V[4],V[5]),B.lineTo(V[2],V[3]),B.lineTo(V[0],V[1]),B.clip())}W.push(Y),k.push(q),this.drawTile(Ce,e,F,M,D,H,ge,$),j&&B.restore(),this.renderedTiles.unshift(Ce),this.updateUsedTiles(e.usedTiles,c,Ce)}}if(this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!Br(this.renderedExtent_,R),this.renderedExtent_=R,this.renderedPixelRatio=l,this.postRender(this.context,e),n.extent&&B.restore(),B.imageSmoothingEnabled=!0,this.renderComplete){const G=(q,Q)=>{const re=ne(c),L=Q.wantedTiles[re],ue=L?Object.keys(L).length:0;this.updateCacheSize(ue),this.tileCache_.expireCache()};e.postRenderFunctions.push(G)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,n,s,r,o,a,l){let h;if(e instanceof eo){if(h=Ns(e.getData()),!h)throw new Error("Rendering array data is not yet supported")}else h=this.getTileImage(e);if(!h)return;const c=this.getRenderContext(t),u=ne(this),d=t.layerStatesArray[t.layerIndex],f=d.opacity*(l?e.getAlpha(u,t.time):1),g=f!==c.globalAlpha;g&&(c.save(),c.globalAlpha=f),c.drawImage(h,a,a,h.width-2*a,h.height-2*a,n,s,r,o),g&&c.restore(),f!==d.opacity?t.animate=!0:l&&e.endTransition(u)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,n){const s=ne(t);s in e||(e[s]={}),e[s][n.getKey()]=!0}}const Fo={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class q_ extends Ja{constructor(e){e=e||{};const t=Object.assign({},e),n=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=n,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(Fo.PRELOAD)}setPreload(e){this.set(Fo.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Fo.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Fo.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}class Yd extends q_{constructor(e){super(e)}createRenderer(){return new ZT(this,{cacheSize:this.getCacheSize()})}}function Zs(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function J_(i,e){return i[0]=e[0],i[1]=e[1],i[4]=e[2],i[5]=e[3],i[12]=e[4],i[13]=e[5],i}function Gc(i,e,t,n,s,r,o){o=o??Zs();const a=1/(i-e),l=1/(t-n),h=1/(s-r);return o[0]=-2*a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*l,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*h,o[11]=0,o[12]=(i+e)*a,o[13]=(n+t)*l,o[14]=(r+s)*h,o[15]=1,o}function $d(i,e,t,n,s){return s=s??Zs(),s[0]=i[0]*e,s[1]=i[1]*e,s[2]=i[2]*e,s[3]=i[3]*e,s[4]=i[4]*t,s[5]=i[5]*t,s[6]=i[6]*t,s[7]=i[7]*t,s[8]=i[8]*n,s[9]=i[9]*n,s[10]=i[10]*n,s[11]=i[11]*n,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s}function qT(i,e,t,n,s){s=s??Zs();let r,o,a,l,h,c,u,d,f,g,_,m;return i===s?(s[12]=i[0]*e+i[4]*t+i[8]*n+i[12],s[13]=i[1]*e+i[5]*t+i[9]*n+i[13],s[14]=i[2]*e+i[6]*t+i[10]*n+i[14],s[15]=i[3]*e+i[7]*t+i[11]*n+i[15]):(r=i[0],o=i[1],a=i[2],l=i[3],h=i[4],c=i[5],u=i[6],d=i[7],f=i[8],g=i[9],_=i[10],m=i[11],s[0]=r,s[1]=o,s[2]=a,s[3]=l,s[4]=h,s[5]=c,s[6]=u,s[7]=d,s[8]=f,s[9]=g,s[10]=_,s[11]=m,s[12]=r*e+h*t+f*n+i[12],s[13]=o*e+c*t+g*n+i[13],s[14]=a*e+u*t+_*n+i[14],s[15]=l*e+d*t+m*n+i[15]),s}function JT(i,e,t,n){return n=n??Zs(),n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=i,n[13]=e,n[14]=t,n[15]=1,n}const eu=34962,tu=34963,iu=35044,QT=5121,eC=5123,tC=5125,Q_=5126,Hd=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function iC(i,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!py},e);const t=Hd.length;for(let n=0;n<t;++n)try{const s=i.getContext(Hd[n],e);if(s)return s}catch{}return null}const nC={STATIC_DRAW:iu};class em{constructor(e,t){this.array_=null,this.type_=e,Le(e===eu||e===tu,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:nC.STATIC_DRAW}ofSize(e){return this.array_=new(Do(this.type_))(e),this}fromArray(e){return this.array_=Do(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(Do(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}setArray(e){const t=Do(this.type_);if(!(e instanceof t))throw new Error(`Expected ${t}`);this.array_=e}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function Do(i){switch(i){case eu:return Float32Array;case tu:return Uint32Array;default:return Float32Array}}const Oo={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},sC=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,rC=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class Zd{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e.vertexShader||sC),t.compileShader(n);const s=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(s,e.fragmentShader||rC),t.compileShader(s),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,n),t.attachShader(this.renderTargetProgram_,s),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const r=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(e){const t=this.getGL(),n=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const s=0,r=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE,h=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,s,r,n[0],n[1],o,a,l,h),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n[0],n[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,n,s){const r=this.getGL(),o=e.size;if(r.bindFramebuffer(r.FRAMEBUFFER,t?t.getFrameBuffer():null),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.renderTargetTexture_),!t){const l=ne(r.canvas);if(!e.renderTargets[l]){const h=r.getContextAttributes();h&&h.preserveDrawingBuffer&&(r.clearColor(0,0,0,0),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.bindBuffer(r.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),r.useProgram(this.renderTargetProgram_),r.enableVertexAttribArray(this.renderTargetAttribLocation_),r.vertexAttribPointer(this.renderTargetAttribLocation_,2,r.FLOAT,!1,0,0),r.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),r.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;r.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),n&&n(r,e),r.drawArrays(r.TRIANGLES,0,6),s&&s(r,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let n,s=1;this.uniforms_.forEach(function(r){if(n=typeof r.value=="function"?r.value(e):r.value,n instanceof HTMLCanvasElement||n instanceof ImageData)r.texture||(r.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${s}`]),t.bindTexture(t.TEXTURE_2D,r.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,n.width,n.height,0,t.UNSIGNED_BYTE,new Uint8Array(n.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.uniform1i(r.location,s++);else if(Array.isArray(n))switch(n.length){case 2:t.uniform2f(r.location,n[0],n[1]);return;case 3:t.uniform3f(r.location,n[0],n[1],n[2]);return;case 4:t.uniform4f(r.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(r.location,n)})}}const Ki={TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},Er={UNSIGNED_BYTE:QT,UNSIGNED_SHORT:eC,UNSIGNED_INT:tC,FLOAT:Q_},Ca={};function qd(i){return"shared/"+i}let Jd=0;function oC(){const i="unique/"+Jd;return Jd+=1,i}function aC(i){let e=Ca[i];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:iC(t)},Ca[i]=e}return e.users+=1,e.context}function lC(i){const e=Ca[i];if(!e||(e.users-=1,e.users>0))return;const t=e.context,n=t.getExtension("WEBGL_lose_context");n&&n.loseContext();const s=t.canvas;s.width=1,s.height=1,delete Ca[i]}class cC extends ao{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?qd(e.canvasCacheKey):oC(),this.gl_=aC(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(Oo.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(Oo.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=ht(),this.offsetScaleMatrix_=ht(),this.tmpMat4_=Zs(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(n=>new Zd({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new Zd({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now(),this.maxAttributeCount_=this.gl_.getParameter(this.gl_.MAX_VERTEX_ATTRIBS)}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===qd(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,n=ne(e);let s=this.bufferCache_[n];if(!s){const r=t.createBuffer();s={buffer:e,webGlBuffer:r},this.bufferCache_[n]=s}t.bindBuffer(e.getType(),s.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=ne(e);delete this.bufferCache_[t]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(Oo.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(Oo.RESTORED,this.boundHandleWebGLContextRestored_),lC(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,n){const s=this.gl_,r=this.getCanvas(),o=e.size,a=e.pixelRatio;(r.width!==o[0]*a||r.height!==o[1]*a)&&(r.width=o[0]*a,r.height=o[1]*a,r.style.width=o[0]+"px",r.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);s.bindTexture(s.TEXTURE_2D,null),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,t?s.ZERO:s.ONE_MINUS_SRC_ALPHA),n?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}bindFrameBuffer(e,t){const n=this.getGL();n.bindFramebuffer(n.FRAMEBUFFER,e),t&&n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)}bindInitialFrameBuffer(){const e=this.getGL(),t=this.postProcessPasses_[0].getFrameBuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);const n=this.postProcessPasses_[0].getRenderTargetTexture();e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}bindTexture(e,t,n){const s=this.gl_;s.activeTexture(s.TEXTURE0+t),s.bindTexture(s.TEXTURE_2D,e),s.uniform1i(this.getUniformLocation(n),t)}bindAttribute(e,t,n){const s=this.getGL();this.bindBuffer(e);const r=this.getAttributeLocation(t);s.enableVertexAttribArray(r),s.vertexAttribPointer(r,n,s.FLOAT,!1,0,0)}prepareDrawToRenderTarget(e,t,n,s){const r=this.gl_,o=t.getSize();r.bindFramebuffer(r.FRAMEBUFFER,t.getFramebuffer()),r.bindRenderbuffer(r.RENDERBUFFER,t.getDepthbuffer()),r.viewport(0,0,o[0],o[1]),r.bindTexture(r.TEXTURE_2D,t.getTexture()),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,n?r.ZERO:r.ONE_MINUS_SRC_ALPHA),s?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}drawElements(e,t){const n=this.gl_;this.getExtension("OES_element_index_uint");const s=n.UNSIGNED_INT,r=4,o=t-e,a=e*r;n.drawElements(n.TRIANGLES,o,s,a)}finalizeDraw(e,t,n){for(let s=0,r=this.postProcessPasses_.length;s<r;s++)s===r-1?this.postProcessPasses_[s].apply(e,null,t,n):this.postProcessPasses_[s].apply(e,this.postProcessPasses_[s+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,n=e.viewState.rotation,s=e.pixelRatio;this.setUniformFloatValue(Ki.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Ki.ZOOM,e.viewState.zoom),this.setUniformFloatValue(Ki.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(Ki.PIXEL_RATIO,s),this.setUniformFloatVec2(Ki.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(Ki.ROTATION,n)}applyHitDetectionUniform(e){const t=this.getUniformLocation(Ki.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(Ki.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let n,s=0;this.uniforms_.forEach(r=>{if(n=typeof r.value=="function"?r.value(e):r.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData||n instanceof WebGLTexture){n instanceof WebGLTexture&&!r.texture?(r.prevValue=void 0,r.texture=n):r.texture||(r.prevValue=void 0,r.texture=t.createTexture()),this.bindTexture(r.texture,s,r.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const o=!(n instanceof HTMLImageElement)||n.complete;!(n instanceof WebGLTexture)&&o&&r.prevValue!==n&&(r.prevValue=n,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),s++}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(r.name,J_(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:t.uniform2f(this.getUniformLocation(r.name),n[0],n[1]);return;case 3:t.uniform3f(this.getUniformLocation(r.name),n[0],n[1],n[2]);return;case 4:t.uniform4f(this.getUniformLocation(r.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(this.getUniformLocation(r.name),n)})}useProgram(e,t){this.disableAllAttributes_(),this.gl_.useProgram(e),this.currentProgram_=e,t&&(this.applyFrameState(t),this.applyUniforms(t))}compileShader(e,t){const n=this.gl_,s=n.createShader(t);return n.shaderSource(s,e),n.compileShader(s),s}getProgram(e,t){const n=this.gl_,s=this.compileShader(e,n.FRAGMENT_SHADER),r=this.compileShader(t,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,s),n.attachShader(o,r),n.linkProgram(o),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getShaderParameter(r,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(r)}`;throw new Error(a)}if(n.deleteShader(r),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=ne(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=ne(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const n=e.size,s=e.viewState.rotation,r=e.viewState.resolution,o=e.viewState.center;return ii(t,0,0,2/(r*n[0]),2/(r*n[1]),-s,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}disableAllAttributes_(){for(let e=0;e<this.maxAttributeCount_;e++)this.gl_.disableVertexAttribArray(e)}enableAttributeArray_(e,t,n,s,r){const o=this.getAttributeLocation(e);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,t,n,!1,s,r))}enableAttributes(e){const t=hC(e);let n=0;for(let s=0;s<e.length;s++){const r=e[s];this.enableAttributeArray_(r.name,r.size,r.type||Q_,t,n),n+=r.size*tm(r.type)}}handleWebGLContextLost(e){Xn(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,n,s){const r=this.gl_;n=n||r.createTexture();const o=s?r.NEAREST:r.LINEAR;r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);const a=0,l=r.RGBA,h=0,c=r.RGBA,u=r.UNSIGNED_BYTE;return t instanceof Uint8Array?r.texImage2D(r.TEXTURE_2D,a,l,e[0],e[1],h,c,u,t):t?r.texImage2D(r.TEXTURE_2D,a,l,c,u,t):r.texImage2D(r.TEXTURE_2D,a,l,e[0],e[1],h,c,u,null),n}}function hC(i){let e=0;for(let t=0;t<i.length;t++){const n=i[t];e+=n.size*tm(n.type)}return e}function tm(i){switch(i){case Er.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Er.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Er.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Er.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class uC extends lo{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter=e.gutter||0,this.helper=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(ae.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===Z.LOADED,this.loaded)this.uploadTile();else{if(e instanceof rl){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(ae.CHANGE,this.handleTileChange_)}}uploadTile(){ce()}setReady(){this.ready=!0,this.dispatchEvent(ae.CHANGE)}handleTileChange_(){this.tile.getState()===Z.LOADED&&(this.loaded=!0,this.uploadTile())}setHelper(e){this.helper=e,this.helper&&this.loaded&&this.uploadTile()}disposeInternal(){this.setHelper(null),this.tile.removeEventListener(ae.CHANGE,this.handleTileChange_)}}function im(i,e,t){const n=t?i.LINEAR:i.NEAREST;i.bindTexture(i.TEXTURE_2D,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n)}function dC(i,e,t,n){im(i,e,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t)}function Qd(i,e,t,n,s,r){const o=i.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,i.getExtension("OES_texture_float"),l=i.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),im(o,e,r&&l);const h=t.byteLength/n[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(s){case 1:{u=o.LUMINANCE;break}case 2:{u=o.LUMINANCE_ALPHA;break}case 3:{u=o.RGB;break}case 4:{u=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${s}`)}const d=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,u,n[0],n[1],0,u,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,d)}let us=null;function fC(){us=Ve(1,1,void 0,{willReadFrequently:!0})}class gC extends uC{constructor(e){super(e),this.textures=[],this.renderSize_=We(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new em(eu,iu);t.fromArray([0,1,1,1,1,0,0,0]),this.helper.flushBufferData(t),this.coords=t,this.setTile(e.tile)}setHelper(e){const t=this.helper?.getGL();if(t){this.helper.deleteBuffer(this.coords);for(let n=0;n<this.textures.length;++n)t.deleteTexture(this.textures[n])}super.setHelper(e),e&&e.flushBufferData(this.coords)}uploadTile(){const e=this.helper,t=e.getGL(),n=this.tile;this.textures.length=0;let s;n instanceof rl||n instanceof Qh?s=n.getImage():s=n.getData();const r=Ns(s);if(r){const p=t.createTexture();this.textures.push(p),this.bandCount=4,dC(t,p,r,n.interpolate),this.setReady();return}s=Oc(s);const o=n.getSize(),a=[o[0]+2*this.gutter,o[1]+2*this.gutter],l=s instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,d=s.byteLength/a[1];this.bandCount=Math.floor(d/u/a[0]);const f=Math.ceil(this.bandCount/4);if(f===1){const p=t.createTexture();this.textures.push(p),Qd(e,p,s,a,this.bandCount,n.interpolate),this.setReady();return}const g=new Array(f);for(let p=0;p<f;++p){const x=t.createTexture();this.textures.push(x);const E=p<f-1?4:(this.bandCount-1)%4+1;g[p]=new c(h*E)}let _=0,m=0;const y=a[0]*this.bandCount;for(let p=0;p<a[1];++p){for(let x=0;x<y;++x){const E=s[m+x],T=Math.floor(_/this.bandCount),R=x%this.bandCount,I=Math.floor(R/4),S=g[I],A=S.length/h,b=R%4;S[T*A+b]=E,++_}m+=d/u}for(let p=0;p<f;++p){const x=this.textures[p],E=g[p],T=E.length/h;Qd(e,x,E,a,T,n.interpolate)}this.setReady()}getImagePixelData_(e,t,n){const s=this.gutter,r=this.renderSize_[0],o=this.renderSize_[1];us||fC(),us.clearRect(0,0,1,1);const a=e.width,l=e.height,h=a-2*s,c=l-2*s,u=s+Math.floor(h*(t/r)),d=s+Math.floor(c*(n/o));let f;try{us.drawImage(e,u,d,1,1,0,0,1,1),f=us.getImageData(0,0,1,1).data}catch{return us=null,null}return f}getArrayPixelData_(e,t,n,s){const r=this.gutter,o=this.renderSize_[0],a=this.renderSize_[1],l=t[0],h=t[1],c=l+2*r,u=h+2*r,d=r+Math.floor(l*(n/o)),f=r+Math.floor(h*(s/a));if(e instanceof DataView){const _=e.byteLength/(c*u),m=_*(f*c+d),y=e.buffer.slice(m,m+_);return new DataView(y)}const g=this.bandCount*(f*c+d);return e.slice(g,g+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof eo){const n=this.tile.getData(),s=Oc(n);if(s){const r=this.tile.getSize();return this.getArrayPixelData_(s,r,e,t)}return this.getImagePixelData_(Ns(n),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}class nu extends H_{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=ht(),this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},e.addChangeListener(Ie.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(qe.PRECOMPOSE)){const s=new Lr(qe.PRECOMPOSE,void 0,t,e);n.dispatchEvent(s)}}dispatchPostComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(qe.POSTCOMPOSE)){const s=new Lr(qe.POSTCOMPOSE,void 0,t,e);n.dispatchEvent(s)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,n=-1,s;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof nu)){t=!0;continue}const c=l.getClassName();if((t||c!==s)&&(n+=1,t=!1),s=c,h===this)break}const r="map/"+e.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(r)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new cC({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:r}),s&&(this.helper.getCanvas().className=s),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}clearCache(){}disposeInternal(){this.clearCache(),this.removeHelper(),this.getLayer()?.removeChangeListener(Ie.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(e,t,n){const s=this.getLayer();if(s.hasListener(e)){ii(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const r=new Lr(e,this.inversePixelTransform_,n,t);s.dispatchEvent(r)}}preRender(e,t){this.dispatchRenderEvent_(qe.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(qe.POSTRENDER,e,t)}}const _C={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};function ef(i){return 1/(i+2)}function mC(){return{tileIds:new Set,representationsByZ:{}}}function tf(i,e){return i.tileIds.has(ne(e))}function nf(i,e,t){const n=i.representationsByZ;t in n||(n[t]=new Set),n[t].add(e),i.tileIds.add(ne(e.tile))}function Vl(i,e){const t=i.layerStatesArray[i.layerIndex];t.extent&&(e=xt(e,ei(t.extent,i.viewState.projection)));const n=t.layer.getRenderSource();if(!n.getWrapX()){const s=n.getTileGridForProjection(i.viewState.projection).getExtent();s&&(e=xt(e,s))}return e}function Nc(i,e){return`${ne(i)},${i.getKey()},${i.getRevision()},${cs(e)}`}class pC extends nu{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=ht(),this.tempMat4=Zs(),this.tempTileRange_=new ol(0,0,0,0),this.tempTileCoord_=ks(0,0,0),this.tempSize_=[0,0];const n=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new K_(n),this.frameState=null,this.renderedProjection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}prepareFrameInternal(e){this.renderedProjection_?e.viewState.projection!==this.renderedProjection_&&(this.clearCache(),this.renderedProjection_=e.viewState.projection):this.renderedProjection_=e.viewState.projection;const n=this.getLayer().getRenderSource();return!n||Ws(Vl(e,e.extent))?!1:n.getState()==="ready"}createTileRepresentation(e){return ce()}enqueueTiles(e,t,n,s,r){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=l.getGutterForProjection(o.projection),u=ne(l);u in e.wantedTiles||(e.wantedTiles[u]={});const d=e.wantedTiles[u],f=this.tileRepresentationCache,g=a.getMapInternal(),_=Math.max(n-r,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),g?g.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection)),m=o.rotation,y=m?gh(o.center,o.resolution,m,e.size):void 0;for(let p=n;p>=_;--p){const x=h.getTileRangeForExtentAndZ(t,p,this.tempTileRange_),E=h.getResolution(p);for(let T=x.minX;T<=x.maxX;++T)for(let R=x.minY;R<=x.maxY;++R){if(m&&!h.tileCoordIntersectsViewport([p,T,R],y))continue;const I=ks(p,T,R,this.tempTileCoord_),S=Nc(l,I);let A,b;if(f.containsKey(S)&&(A=f.get(S),b=A.tile),(!A||A.tile.key!==l.getKey())&&(b=l.getTile(p,T,R,e.pixelRatio,o.projection),!b)||tf(s,b))continue;A?A.setTile(b):(A=this.createTileRepresentation({tile:b,grid:h,helper:this.helper,gutter:c}),f.set(S,A)),nf(s,A,p);const X=b.getKey();d[X]=!0,b.getState()===Z.IDLE&&(e.tileQueue.isKeyQueued(X)||e.tileQueue.enqueue([b,u,h.getTileCoordCenter(I),E]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,n,s,r,o,a,l,h,c,u){}renderTileMask(e,t,n,s){}drawTile_(e,t,n,s,r,o,a){if(!t.ready)return;const h=t.tile.tileCoord,c=cs(h),u=c in o?o[c]:1,d=a.getResolution(n),f=We(a.getTileSize(n),this.tempSize_),g=a.getOrigin(n),_=a.getTileCoordExtent(h),m=u<1?-1:ef(n);u<1&&(e.animate=!0);const y=e.viewState,p=y.center[0],x=y.center[1],E=f[0]+2*s,T=f[1]+2*s,R=E/T,I=(p-g[0])/(f[0]*d),S=(g[1]-x)/(f[1]*d),A=y.resolution/d,b=h[1],X=h[2];gE(this.tileTransform_),pd(this.tileTransform_,2/(e.size[0]*A/E),-2/(e.size[1]*A/E)),mE(this.tileTransform_,y.rotation),pd(this.tileTransform_,1,1/R),pE(this.tileTransform_,(f[0]*(b-I)-s)/E,(f[1]*(X-S)-s)/T),this.renderTile(t,this.tileTransform_,e,r,d,f,g,_,m,s,u)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const n=e.viewState,s=this.getLayer(),r=s.getRenderSource(),o=r.getTileGridForProjection(n.projection),a=r.getGutterForProjection(n.projection),l=Vl(e,e.extent),h=o.getZForResolution(n.resolution,r.zDirection),c=mC(),u=s.getPreload();if(e.nextExtent){const x=o.getZForResolution(n.nextResolution,r.zDirection),E=Vl(e,e.nextExtent);this.enqueueTiles(e,E,x,c,u)}this.enqueueTiles(e,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(e,l,h-1,c,u-1)},0);const d={};let f=!1;const g=c.representationsByZ;if(h in g){const x=ne(this),E=e.time;for(const T of g[h]){const R=T.tile;if(R.getState()===Z.EMPTY)continue;const I=R.tileCoord;if(T.ready){const b=R.getAlpha(x,E);if(b===1){R.endTransition(x);continue}f=!0;const X=cs(I);d[X]=b}if(this.renderComplete=!1,this.findAltTiles_(o,I,h+1,c))continue;const A=o.getMinZoom();for(let b=h-1;b>=A&&!this.findAltTiles_(o,I,b,c);--b);}}const _=Object.keys(g).map(Number).sort(Xg);if(this.beforeTilesMaskRender(e))for(let x=0,E=_.length;x<E;++x){const T=_[x];for(const R of g[T]){const I=R.tile.tileCoord;if(cs(I)in d)continue;const A=o.getTileCoordExtent(I);this.renderTileMask(R,T,A,ef(T))}}this.beforeTilesRender(e,f);for(let x=0,E=_.length;x<E;++x){const T=_[x];for(const R of g[T]){const I=R.tile.tileCoord;cs(I)in d||this.drawTile_(e,R,T,a,l,d,o)}}if(h in g)for(const x of g[h]){const E=x.tile.tileCoord;cs(E)in d&&this.drawTile_(e,x,h,a,l,d,o)}this.beforeFinalize(e),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const y=this.helper.getCanvas(),p=this.tileRepresentationCache;for(;p.canExpireCache();)p.pop().dispose();return this.postRender(t,e),y}beforeFinalize(e){}findAltTiles_(e,t,n,s){const r=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!r)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=r.minX;h<=r.maxX;++h)for(let c=r.minY;c<=r.maxY;++c){const u=Nc(l,[n,h,c]);let d=!1;if(a.containsKey(u)){const f=a.get(u);f.ready&&!tf(s,f.tile)&&(nf(s,f,n),d=!0)}d||(o=!1)}return o}clearCache(){super.clearCache();const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}afterHelperCreated(){super.afterHelperCreated(),this.tileRepresentationCache.forEach(e=>e.setHelper(this.helper))}disposeInternal(){super.disposeInternal(),delete this.frameState}}const fe={..._C,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},ta={TEXTURE_COORD:"a_textureCoord"},yC=[{name:ta.TEXTURE_COORD,size:2,type:Er.FLOAT}];class EC extends pC{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new em(tu,iu),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){if(super.reset(e),this.helper){const t=this.helper.getGL();for(const n of this.paletteTextures_)n.delete(t)}if(this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_);const t=this.helper.getGL();for(const n of this.paletteTextures_)n.getTexture(t)}}afterHelperCreated(){super.afterHelperCreated();const e=this.helper.getGL();for(const t of this.paletteTextures_)t.getTexture(e);this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const e=this.helper.getGL();for(const t of this.paletteTextures_)t.delete(e)}super.removeHelper()}createTileRepresentation(e){return new gC(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,n,s,r,o,a,l,h,c,u){const d=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(yC);let f=0;for(;f<e.textures.length;){const R=`${fe.TILE_TEXTURE_ARRAY}[${f}]`;this.helper.bindTexture(e.textures[f],f,R),++f}for(let R=0;R<this.paletteTextures_.length;++R){const I=this.paletteTextures_[R],S=I.getTexture(d);this.helper.bindTexture(S,f,I.name),++f}const g=n.viewState,_=o[0]+2*c,m=o[1]+2*c,p=e.tile.tileCoord,x=p[1],E=p[2];this.helper.setUniformMatrixValue(fe.TILE_TRANSFORM,J_(this.tempMat4,t)),this.helper.setUniformFloatValue(fe.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(fe.DEPTH,h);let T=s;c>0&&(T=l,xt(T,s,T)),this.helper.setUniformFloatVec4(fe.RENDER_EXTENT,T),this.helper.setUniformFloatValue(fe.RESOLUTION,g.resolution),this.helper.setUniformFloatValue(fe.ZOOM,g.zoom),this.helper.setUniformFloatValue(fe.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(fe.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(fe.TEXTURE_RESOLUTION,r),this.helper.setUniformFloatValue(fe.TEXTURE_ORIGIN_X,a[0]+x*o[0]*r-c*r),this.helper.setUniformFloatValue(fe.TEXTURE_ORIGIN_Y,a[1]-E*o[1]*r+c*r),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const n=this.frameState;if(!n)return null;const s=this.getLayer(),r=Ke(n.pixelToCoordinateTransform,e.slice()),o=n.viewState,a=s.getExtent();if(a&&!dn(ei(a,o.projection),r))return null;const l=s.getSources(ft([r]),o.resolution);let h,c,u;for(h=l.length-1;h>=0;--h)if(c=l[h],c.getState()==="ready"){if(u=c.getTileGridForProjection(o.projection),c.getWrapX())break;const f=u.getExtent();if(!f||dn(f,r))break}if(h<0)return null;const d=this.tileRepresentationCache;for(let f=u.getZForResolution(o.resolution);f>=u.getMinZoom();--f){const g=u.getTileCoordForCoordAndZ(r,f),_=Nc(c,g);if(!d.containsKey(_))continue;const m=d.get(_);if(m.tile.getState()===Z.EMPTY)return null;if(!m.loaded)continue;const p=u.getOrigin(f),x=We(u.getTileSize(f)),E=u.getResolution(f),T=(r[0]-p[0])/E-g[1]*x[0],R=(p[1]-r[1])/E-g[2]*x[1];return m.getPixelData(T,R)}return null}disposeInternal(){const e=this.helper;if(e){const t=e.getGL();for(const n of this.paletteTextures_)n.delete(t);this.paletteTextures_.length=0,t.deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}class xC{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}delete(e){this.texture_&&e.deleteTexture(this.texture_),this.texture_=null}}function TC(i,e){return`operator_${i}_${Object.keys(e.functions).length}`}function to(i){const e=i.toString();return e.includes(".")?e:e+".0"}function su(i){if(i.length<2||i.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${i.length}(${i.map(to).join(", ")})`}function CC(i){const e=gn(i),t=e.length>3?e[3]:1;return su([e[0]/255,e[1]/255,e[2]/255,t])}function wC(i){const e=We(i);return su(e)}const Wl={};let RC=0;function nm(i){return i in Wl||(Wl[i]=RC++),Wl[i]}function SC(i){return to(nm(i))}function sm(i){return"u_var_"+i}function vC(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}const Kl="getBandValue",rm="u_paletteTextures",IC="featureId",bC="geometryType",AC=-9999999;function PC(i,e,t,n){const s=Qe(i,e,t);return ru(s,e,n)}function ve(i){return(e,t,n)=>{const s=t.args.length,r=new Array(s);for(let o=0;o<s;++o)r[o]=ru(t.args[o],n,e);return i(r,e)}}const LC={[v.Get]:(i,e)=>{const n=e.args[0].value;return n in i.properties||(i.properties[n]={name:n,type:e.type}),"a_prop_"+n},[v.Id]:i=>(i.featureId=!0,"a_"+IC),[v.GeometryType]:i=>(i.geometryType=!0,"a_"+bC),[v.LineMetric]:()=>"currentLineMetric",[v.Var]:(i,e)=>{const n=e.args[0].value;return n in i.variables||(i.variables[n]={name:n,type:e.type}),sm(n)},[v.Has]:(i,e)=>{const n=e.args[0].value;return n in i.properties||(i.properties[n]={name:n,type:e.type}),`(a_prop_${n} != ${to(AC)})`},[v.Resolution]:()=>"u_resolution",[v.Zoom]:()=>"u_zoom",[v.Time]:()=>"u_time",[v.Any]:ve(i=>`(${i.join(" || ")})`),[v.All]:ve(i=>`(${i.join(" && ")})`),[v.Not]:ve(([i])=>`(!${i})`),[v.Equal]:ve(([i,e])=>`(${i} == ${e})`),[v.NotEqual]:ve(([i,e])=>`(${i} != ${e})`),[v.GreaterThan]:ve(([i,e])=>`(${i} > ${e})`),[v.GreaterThanOrEqualTo]:ve(([i,e])=>`(${i} >= ${e})`),[v.LessThan]:ve(([i,e])=>`(${i} < ${e})`),[v.LessThanOrEqualTo]:ve(([i,e])=>`(${i} <= ${e})`),[v.Multiply]:ve(i=>`(${i.join(" * ")})`),[v.Divide]:ve(([i,e])=>`(${i} / ${e})`),[v.Add]:ve(i=>`(${i.join(" + ")})`),[v.Subtract]:ve(([i,e])=>`(${i} - ${e})`),[v.Clamp]:ve(([i,e,t])=>`clamp(${i}, ${e}, ${t})`),[v.Mod]:ve(([i,e])=>`mod(${i}, ${e})`),[v.Pow]:ve(([i,e])=>`pow(${i}, ${e})`),[v.Abs]:ve(([i])=>`abs(${i})`),[v.Floor]:ve(([i])=>`floor(${i})`),[v.Ceil]:ve(([i])=>`ceil(${i})`),[v.Round]:ve(([i])=>`floor(${i} + 0.5)`),[v.Sin]:ve(([i])=>`sin(${i})`),[v.Cos]:ve(([i])=>`cos(${i})`),[v.Atan]:ve(([i,e])=>e!==void 0?`atan(${i}, ${e})`:`atan(${i})`),[v.Sqrt]:ve(([i])=>`sqrt(${i})`),[v.Match]:ve(i=>{const e=i[0],t=i[i.length-1];let n=null;for(let s=i.length-3;s>=1;s-=2){const r=i[s],o=i[s+1];n=`(${e} == ${r} ? ${o} : ${n||t})`}return n}),[v.Between]:ve(([i,e,t])=>`(${i} >= ${e} && ${i} <= ${t})`),[v.Interpolate]:ve(([i,e,...t])=>{let n="";for(let s=0;s<t.length-2;s+=2){const r=t[s],o=n||t[s+1],a=t[s+2],l=t[s+3];let h;i===to(1)?h=`(${e} - ${r}) / (${a} - ${r})`:h=`(pow(${i}, (${e} - ${r})) - 1.0) / (pow(${i}, (${a} - ${r})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[v.Case]:ve(i=>{const e=i[i.length-1];let t=null;for(let n=i.length-3;n>=0;n-=2){const s=i[n],r=i[n+1];t=`(${s} ? ${r} : ${t||e})`}return t}),[v.In]:ve(([i,...e],t)=>{const n=TC("in",t),s=[];for(let r=0;r<e.length;r+=1)s.push(`  if (inputValue == ${e[r]}) { return true; }`);return t.functions[n]=`bool ${n}(float inputValue) {
${s.join(`
`)}
  return false;
}`,`${n}(${i})`}),[v.Array]:ve(i=>`vec${i.length}(${i.join(", ")})`),[v.Color]:ve(i=>{if(i.length===1)return`vec4(vec3(${i[0]} / 255.0), 1.0)`;if(i.length===2)return`vec4(vec3(${i[0]} / 255.0), ${i[1]})`;const e=i.slice(0,3).map(n=>`${n} / 255.0`);if(i.length===3)return`vec4(${e.join(", ")}, 1.0)`;const t=i[3];return`vec4(${e.join(", ")}, ${t})`}),[v.Band]:ve(([i,e,t],n)=>{if(!(Kl in n.functions)){let s="";const r=n.bandCount||1;for(let o=0;o<r;o++){const a=Math.floor(o/4);let l=o%4;o===r-1&&l===1&&(l=3);const h=`${fe.TILE_TEXTURE_ARRAY}[${a}]`;s+=`  if (band == ${o+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[Kl]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${fe.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${fe.TEXTURE_PIXEL_HEIGHT};
${s}
}`}return`${Kl}(${i}, ${e??"0.0"}, ${t??"0.0"})`}),[v.Palette]:(i,e)=>{const[t,...n]=e.args,s=n.length,r=new Uint8Array(s*4);for(let h=0;h<n.length;h++){const c=n[h].value,u=gn(c),d=h*4;r[d]=u[0],r[d+1]=u[1],r[d+2]=u[2],r[d+3]=u[3]*255}i.paletteTextures||(i.paletteTextures=[]);const o=`${rm}[${i.paletteTextures.length}]`,a=new xC(o,r);i.paletteTextures.push(a);const l=ru(t,_e,i);return`texture2D(${o}, vec2((${l} + 0.5) / ${s}.0, 0.5))`}};function ru(i,e,t){if(i instanceof b_){const n=LC[i.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(i.operator)}`);return n(t,i,e)}if((i.type&_e)>0)return to(i.value);if((i.type&lt)>0)return i.value.toString();if((i.type&pt)>0)return SC(i.value.toString());if((i.type&Ot)>0)return CC(i.value);if((i.type&_n)>0)return su(i.value);if((i.type&fs)>0)return wC(i.value);throw new Error(`Unexpected expression ${i.value} (expected type ${gs(e)})`)}function Qn(i,e,t){const n=$h();return PC(e,t,n,i)}function sf(i,e){const t=`
    attribute vec2 ${ta.TEXTURE_COORD};
    uniform mat4 ${fe.TILE_TRANSFORM};
    uniform float ${fe.TEXTURE_PIXEL_WIDTH};
    uniform float ${fe.TEXTURE_PIXEL_HEIGHT};
    uniform float ${fe.TEXTURE_RESOLUTION};
    uniform float ${fe.TEXTURE_ORIGIN_X};
    uniform float ${fe.TEXTURE_ORIGIN_Y};
    uniform float ${fe.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${ta.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${fe.TEXTURE_ORIGIN_X} + ${fe.TEXTURE_RESOLUTION} * ${fe.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${fe.TEXTURE_ORIGIN_Y} - ${fe.TEXTURE_RESOLUTION} * ${fe.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${fe.TILE_TRANSFORM} * vec4(${ta.TEXTURE_COORD}, ${fe.DEPTH}, 1.0);
    }
  `,n={...vC(),bandCount:e},s=[];if(i.color!==void 0){const u=Qn(n,i.color,Ot);s.push(`color = ${u};`)}if(i.contrast!==void 0){const u=Qn(n,i.contrast,_e);s.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.exposure!==void 0){const u=Qn(n,i.exposure,_e);s.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.saturation!==void 0){const u=Qn(n,i.saturation,_e);s.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(i.gamma!==void 0){const u=Qn(n,i.gamma,_e);s.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(i.brightness!==void 0){const u=Qn(n,i.brightness,_e);s.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const r={},o=Object.keys(n.variables).length;if(o>1&&!i.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let u=0;u<o;++u){const d=n.variables[Object.keys(n.variables)[u]];if(!(d.name in i.variables))throw new Error(`Missing '${d.name}' in style variables`);const f=sm(d.name);r[f]=function(){let g=i.variables[d.name];return typeof g=="string"&&(g=nm(g)),g!==void 0?g:-9999999}}const a=Object.keys(r).map(function(u){return`uniform float ${u};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${fe.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${rm}[${n.paletteTextures.length}];`);const h=Object.keys(n.functions).map(function(u){return n.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${fe.RENDER_EXTENT};
    uniform float ${fe.TRANSITION_ALPHA};
    uniform float ${fe.TEXTURE_PIXEL_WIDTH};
    uniform float ${fe.TEXTURE_PIXEL_HEIGHT};
    uniform float ${fe.RESOLUTION};
    uniform float ${fe.ZOOM};

    ${a.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${fe.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${fe.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${fe.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${fe.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${fe.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${s.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${fe.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:c,uniforms:r,paletteTextures:n.paletteTextures}}class om extends q_{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.styleVariables_=this.style_.variables||{},this.handleSourceUpdate_(),this.addChangeListener(Ie.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();const e=this.getSource();if(e)if(e.getState()==="loading"){const t=()=>{e.getState()==="ready"&&(e.removeEventListener("change",t),this.setStyle(this.style_))};e.addEventListener("change",t)}else this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=sf(this.style_,this.getSourceBandCount_());return new EC(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.getCacheSize(),paletteTextures:e.paletteTextures})}renderSources(e,t){const n=this.getRenderer();let s;for(let r=0,o=t.length;r<o;++r)this.renderedSource_=t[r],n.prepareFrame(e)&&(s=n.renderFrame(e));return s}render(e,t){this.rendered=!0;const n=e.viewState,s=this.getSources(e.extent,n.resolution);let r=!0;for(let a=0,l=s.length;a<l;++a){const h=s[a],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}r=r&&c=="ready"}const o=this.renderSources(e,s);if(this.getRenderer().renderComplete&&r)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!s.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){if(this.styleVariables_=e.variables||{},this.style_=e,this.hasRenderer()){const t=sf(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}om.prototype.dispose;class am{drawCustom(e,t,n,s,r){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,n){}drawFeature(e,t,n){}drawGeometryCollection(e,t,n){}drawLineString(e,t,n){}drawMultiLineString(e,t,n){}drawMultiPoint(e,t,n){}drawMultiPolygon(e,t,n){}drawPoint(e,t,n){}drawPolygon(e,t,n){}drawText(e,t,n){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const oe={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Go=[oe.FILL],sn=[oe.STROKE],On=[oe.BEGIN_PATH],rf=[oe.CLOSE_PATH];class mo extends am{constructor(e,t,n,s){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(n){return n*t})}appendFlatPointCoordinates(e,t){const n=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=e.length;a<l;a+=t)s[0]=e[a],s[1]=e[a+1],dn(n,s)&&(r[o++]=s[0],r[o++]=s[1]);return o}appendFlatLineCoordinates(e,t,n,s,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(t+=s);let c=e[t],u=e[t+1];const d=this.tmpCoordinate_;let f=!0,g,_,m;for(g=t+s;g<n;g+=s)d[0]=e[g],d[1]=e[g+1],m=xc(h,d),m!==_?(f&&(a[l++]=c,a[l++]=u,f=!1),a[l++]=d[0],a[l++]=d[1]):m===Ze.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],f=!1):f=!0,c=d[0],u=d[1],_=m;return(r&&f||g===t+s)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(e,t,n,s,r){for(let o=0,a=n.length;o<a;++o){const l=n[o],h=this.appendFlatLineCoordinates(e,t,l,s,!1,!1);r.push(h),t=l}return t}drawCustom(e,t,n,s,r){this.beginGeometry(e,t,r);const o=e.getType(),a=e.getStride(),l=this.coordinates.length;let h,c,u,d,f;switch(o){case"MultiPolygon":h=e.getOrientedFlatCoordinates(),d=[];const g=e.getEndss();f=0;for(let _=0,m=g.length;_<m;++_){const y=[];f=this.drawCustomCoordinates_(h,f,g[_],a,y),d.push(y)}this.instructions.push([oe.CUSTOM,l,d,e,n,Sc,r]),this.hitDetectionInstructions.push([oe.CUSTOM,l,d,e,s||n,Sc,r]);break;case"Polygon":case"MultiLineString":u=[],h=o=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),f=this.drawCustomCoordinates_(h,0,e.getEnds(),a,u),this.instructions.push([oe.CUSTOM,l,u,e,n,Kr,r]),this.hitDetectionInstructions.push([oe.CUSTOM,l,u,e,s||n,Kr,r]);break;case"LineString":case"Circle":h=e.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([oe.CUSTOM,l,c,e,n,nn,r]),this.hitDetectionInstructions.push([oe.CUSTOM,l,c,e,s||n,nn,r]);break;case"MultiPoint":h=e.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,a),c>l&&(this.instructions.push([oe.CUSTOM,l,c,e,n,nn,r]),this.hitDetectionInstructions.push([oe.CUSTOM,l,c,e,s||n,nn,r]));break;case"Point":h=e.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([oe.CUSTOM,l,c,e,n,void 0,r]),this.hitDetectionInstructions.push([oe.CUSTOM,l,c,e,s||n,void 0,r]);break}this.endGeometry(t)}beginGeometry(e,t,n){this.beginGeometryInstruction1_=[oe.BEGIN_GEOMETRY,t,0,e,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[oe.BEGIN_GEOMETRY,t,0,e,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const n=e.length;let s,r,o=-1;for(t=0;t<n;++t)s=e[t],r=s[0],r==oe.END_GEOMETRY?o=t:r==oe.BEGIN_GEOMETRY&&(s[2]=t,dy(this.hitDetectionInstructions,o,t),o=-1)}fillStyleToState(e,t={}){if(e){const n=e.getColor();t.fillPatternScale=n&&typeof n=="object"&&"src"in n?this.pixelRatio:1,t.fillStyle=fi(n||bt)}else t.fillStyle=void 0;return t}strokeStyleToState(e,t={}){if(e){const n=e.getColor();t.strokeStyle=fi(n||Hr);const s=e.getLineCap();t.lineCap=s!==void 0?s:Os;const r=e.getLineDash();t.lineDash=r?r.slice():Ni;const o=e.getLineDashOffset();t.lineDashOffset=o||ki;const a=e.getLineJoin();t.lineJoin=a!==void 0?a:Gs;const l=e.getWidth();t.lineWidth=l!==void 0?l:qr;const h=e.getMiterLimit();t.miterLimit=h!==void 0?h:$r,t.lineWidth>this.maxLineWidth&&(this.maxLineWidth=t.lineWidth,this.bufferedMaxExtent_=null)}else t.strokeStyle=void 0,t.lineCap=void 0,t.lineDash=null,t.lineDashOffset=void 0,t.lineJoin=void 0,t.lineWidth=void 0,t.miterLimit=void 0;return t}setFillStrokeStyle(e,t){const n=this.state;this.fillStyleToState(e,n),this.strokeStyleToState(t,n)}createFill(e){const t=e.fillStyle,n=[oe.SET_FILL_STYLE,t];return typeof t!="string"&&n.push(e.fillPatternScale),n}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[oe.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash?this.applyPixelRatio(e.lineDash):null,e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const n=e.fillStyle;(typeof n!="string"||e.currentFillStyle!=n)&&(this.instructions.push(t.call(this,e)),e.currentFillStyle=n)}updateStrokeStyle(e,t){const n=e.strokeStyle,s=e.lineCap,r=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,h=e.miterLimit;(e.currentStrokeStyle!=n||e.currentLineCap!=s||r!=e.currentLineDash&&!zi(e.currentLineDash,r)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=h)&&(t.call(this,e),e.currentStrokeStyle=n,e.currentLineCap=s,e.currentLineDash=r,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=h)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[oe.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Yg(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;ka(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class MC extends mo{constructor(e,t,n,s){super(e,t,n,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,n){if(!this.image_||this.maxExtent&&!dn(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,n);const s=e.getFlatCoordinates(),r=e.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,r);this.instructions.push([oe.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([oe.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,n){if(!this.image_)return;this.beginGeometry(e,t,n);const s=e.getFlatCoordinates(),r=[];for(let l=0,h=s.length;l<h;l+=e.getStride())(!this.maxExtent||dn(this.maxExtent,s.slice(l,l+2)))&&r.push(s[l],s[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,2);this.instructions.push([oe.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([oe.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const n=e.getAnchor(),s=e.getSize(),r=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=e.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=s[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}class FC extends mo{constructor(e,t,n,s){super(e,t,n,s)}drawFlatCoordinates_(e,t,n,s){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,n,s,!1,!1),a=[oe.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(e,t,n){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(e,t,n),this.hitDetectionInstructions.push([oe.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Ni,ki],On);const a=e.getFlatCoordinates(),l=e.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(sn),this.endGeometry(t)}drawMultiLineString(e,t,n){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(e,t,n),this.hitDetectionInstructions.push([oe.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Ni,ki],On);const a=e.getEnds(),l=e.getFlatCoordinates(),h=e.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinates_(l,c,a[u],h);this.hitDetectionInstructions.push(sn),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(sn),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(sn),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(On)}}class of extends mo{constructor(e,t,n,s){super(e,t,n,s)}drawFlatCoordinatess_(e,t,n,s){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=n.length;this.instructions.push(On),this.hitDetectionInstructions.push(On);for(let h=0;h<l;++h){const c=n[h],u=this.coordinates.length,d=this.appendFlatLineCoordinates(e,t,c,s,!0,!a),f=[oe.MOVE_TO_LINE_TO,u,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push(rf),this.hitDetectionInstructions.push(rf)),t=c}return o&&(this.instructions.push(Go),this.hitDetectionInstructions.push(Go)),a&&(this.instructions.push(sn),this.hitDetectionInstructions.push(sn)),t}drawCircle(e,t,n){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([oe.SET_FILL_STYLE,bt]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([oe.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Ni,ki]);const a=e.getFlatCoordinates(),l=e.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[oe.CIRCLE,h];this.instructions.push(On,c),this.hitDetectionInstructions.push(On,c),s.fillStyle!==void 0&&(this.instructions.push(Go),this.hitDetectionInstructions.push(Go)),s.strokeStyle!==void 0&&(this.instructions.push(sn),this.hitDetectionInstructions.push(sn)),this.endGeometry(t)}drawPolygon(e,t,n){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([oe.SET_FILL_STYLE,bt]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([oe.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Ni,ki]);const a=e.getEnds(),l=e.getOrientedFlatCoordinates(),h=e.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(t)}drawMultiPolygon(e,t,n){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([oe.SET_FILL_STYLE,bt]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([oe.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Ni,ki]);const a=e.getEndss(),l=e.getOrientedFlatCoordinates(),h=e.getStride();let c=0;for(let u=0,d=a.length;u<d;++u)c=this.drawFlatCoordinatess_(l,c,a[u],h);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let n=0,s=t.length;n<s;++n)t[n]=An(t[n],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;this.updateFillStyle(e,this.createFill),this.updateStrokeStyle(e,this.applyStroke)}}function DC(i,e,t,n,s){const r=[];let o=t,a=0,l=e.slice(t,2);for(;a<i&&o+s<n;){const[h,c]=l.slice(-2),u=e[o+s],d=e[o+s+1],f=Math.sqrt((u-h)*(u-h)+(d-c)*(d-c));if(a+=f,a>=i){const g=(i-a+f)/f,_=Ft(h,u,g),m=Ft(c,d,g);l.push(_,m),r.push(l),l=[_,m],a==i&&(o+=s),a=0}else if(a<i)l.push(e[o+s],e[o+s+1]),o+=s;else{const g=f-a,_=Ft(h,u,g/f),m=Ft(c,d,g/f);l.push(_,m),r.push(l),l=[_,m],a=0,o+=s}}return a>0&&r.push(l),r}function OC(i,e,t,n,s){let r=t,o=t,a=0,l=0,h=t,c,u,d,f,g,_,m,y,p,x;for(u=t;u<n;u+=s){const E=e[u],T=e[u+1];g!==void 0&&(p=E-g,x=T-_,f=Math.sqrt(p*p+x*x),m!==void 0&&(l+=d,c=Math.acos((m*p+y*x)/(d*f)),c>i&&(l>a&&(a=l,r=h,o=u),l=0,h=u-s)),d=f,m=p,y=x),g=E,_=T}return l+=f,l>a?[h,u]:[r,o]}const wa={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class GC extends mo{constructor(e,t,n,s){super(e,t,n,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[bt]={fillStyle:bt},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,n){const s=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!s&&!r)return;const a=this.coordinates;let l=a.length;const h=e.getType();let c=null,u=e.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!Et(this.maxExtent,e.getExtent()))return;let d;if(c=e.getFlatCoordinates(),h=="LineString")d=[c.length];else if(h=="MultiLineString")d=e.getEnds();else if(h=="Polygon")d=e.getEnds().slice(0,1);else if(h=="MultiPolygon"){const m=e.getEndss();d=[];for(let y=0,p=m.length;y<p;++y)d.push(m[y][0])}this.beginGeometry(e,t,n);const f=o.repeat,g=f?void 0:o.textAlign;let _=0;for(let m=0,y=d.length;m<y;++m){let p;f?p=DC(f*this.resolution,c,_,d[m],u):p=[c.slice(_,d[m])];for(let x=0,E=p.length;x<E;++x){const T=p[x];let R=0,I=T.length;if(g==null){const A=OC(o.maxAngle,T,0,T.length,2);R=A[0],I=A[1]}for(let A=R;A<I;A+=u)a.push(T[A],T[A+1]);const S=a.length;_=d[m],this.drawChars_(l,S),l=S}}this.endGeometry(t)}else{let d=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=e.getFlatCoordinates();break;case"LineString":c=e.getFlatMidpoint();break;case"Circle":c=e.getCenter();break;case"MultiLineString":c=e.getFlatMidpoints(),u=2;break;case"Polygon":c=e.getFlatInteriorPoint(),o.overflow||d.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const E=e.getFlatInteriorPoints();c=[];for(let T=0,R=E.length;T<R;T+=3)o.overflow||d.push(E[T+2]/this.resolution),c.push(E[T],E[T+1]);if(c.length===0)return;u=2;break}const f=this.appendFlatPointCoordinates(c,u);if(f===l)return;if(d&&(f-l)/2!==c.length/u){let E=l/2;d=d.filter((T,R)=>{const I=a[(E+R)*2]===c[R*u]&&a[(E+R)*2+1]===c[R*u+1];return I||--E,I})}this.saveTextStates_();const g=o.backgroundFill?this.createFill(this.fillStyleToState(o.backgroundFill)):null,_=o.backgroundStroke?this.createStroke(this.strokeStyleToState(o.backgroundStroke)):null;this.beginGeometry(e,t,n);let m=o.padding;if(m!=Dn&&(o.scale[0]<0||o.scale[1]<0)){let E=o.padding[0],T=o.padding[1],R=o.padding[2],I=o.padding[3];o.scale[0]<0&&(T=-T,I=-I),o.scale[1]<0&&(E=-E,R=-R),m=[E,T,R,I]}const y=this.pixelRatio;this.instructions.push([oe.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,m==Dn?Dn:m.map(function(E){return E*y}),g,_,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const p=1/y,x=g?g.slice(0):null;x&&(x[1]=bt),this.hitDetectionInstructions.push([oe.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[p,p],NaN,this.declutterMode_,this.declutterImageWithText_,m,x,_,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?bt:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,n=this.textFillState_,s=this.strokeKey_;e&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:t.font,textAlign:t.textAlign||Zr,justify:t.justify,textBaseline:t.textBaseline||Ea,scale:t.scale});const o=this.fillKey_;n&&(o in this.fillStates||(this.fillStates[o]={fillStyle:n.fillStyle}))}drawChars_(e,t){const n=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=wa[s.textBaseline],c=this.textOffsetY_*l,u=this.text_,d=n?n.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([oe.DRAW_CHARS,e,t,h,s.overflow,a,s.maxAngle,l,c,r,d*l,u,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([oe.DRAW_CHARS,e,t,h,s.overflow,a&&bt,s.maxAngle,l,c,r,d*l,u,o,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(e,t){let n,s,r;if(!e)this.text_="";else{const o=e.getFill();o?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=fi(o.getColor()||bt)):(s=null,this.textFillState_=s);const a=e.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const _=a.getLineDash(),m=a.getLineDashOffset(),y=a.getWidth(),p=a.getMiterLimit();r.lineCap=a.getLineCap()||Os,r.lineDash=_?_.slice():Ni,r.lineDashOffset=m===void 0?ki:m,r.lineJoin=a.getLineJoin()||Gs,r.lineWidth=y===void 0?qr:y,r.miterLimit=p===void 0?$r:p,r.strokeStyle=fi(a.getColor()||Hr)}n=this.textState_;const l=e.getFont()||M_;hT(l);const h=e.getScaleArray();n.overflow=e.getOverflow(),n.font=l,n.maxAngle=e.getMaxAngle(),n.placement=e.getPlacement(),n.textAlign=e.getTextAlign(),n.repeat=e.getRepeat(),n.justify=e.getJustify(),n.textBaseline=e.getTextBaseline()||Ea,n.backgroundFill=e.getBackgroundFill(),n.backgroundStroke=e.getBackgroundStroke(),n.padding=e.getPadding()||Dn,n.scale=h===void 0?[1,1]:h;const c=e.getOffsetX(),u=e.getOffsetY(),d=e.getRotateWithView(),f=e.getKeepUpright(),g=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textKeepUpright_=f===void 0?!0:f,this.textRotation_=g===void 0?0:g,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:ne(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?typeof s.fillStyle=="string"?s.fillStyle:"|"+ne(s.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const NC={Circle:of,Default:mo,Image:MC,LineString:FC,Polygon:of,Text:GC};class kC{constructor(e,t,n,s){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=s,this.resolution_=n,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const n=this.buildersByZIndex_[t];for(const s in n){const r=n[s].finish();e[t][s]=r}}return e}getBuilder(e,t){const n=e!==void 0?e.toString():"0";let s=this.buildersByZIndex_[n];s===void 0&&(s={},this.buildersByZIndex_[n]=s);let r=s[t];if(r===void 0){const o=NC[t];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[t]=r}return r}}function ou(i,e,t,n){let s=i[e],r=i[e+1],o=0;for(let a=e+n;a<t;a+=n){const l=i[a],h=i[a+1];o+=Math.sqrt((l-s)*(l-s)+(h-r)*(h-r)),s=l,r=h}return o}function UC(i,e,t,n,s,r,o,a,l,h,c,u,d=!0){let f=i[e],g=i[e+1],_=0,m=0,y=0,p=0;function x(){_=f,m=g,e+=n,f=i[e],g=i[e+1],p+=y,y=Math.sqrt((f-_)*(f-_)+(g-m)*(g-m))}do x();while(e<t-n&&p+y<r);let E=y===0?0:(r-p)/y;const T=Ft(_,f,E),R=Ft(m,g,E),I=e-n,S=p,A=r+a*l(h,s,c);for(;e<t-n&&p+y<A;)x();E=y===0?0:(A-p)/y;const b=Ft(_,f,E),X=Ft(m,g,E);let O=!1;if(d)if(u){const k=[T,R,b,X];Rh(k,0,4,2,u,k,k),O=k[0]>k[2]}else O=T>b;const B=Math.PI,K=[],Y=I+n===e;e=I,y=0,p=S,f=i[e],g=i[e+1];let W;if(Y){x(),W=Math.atan2(g-m,f-_),O&&(W+=W>0?-B:B);const k=(b+T)/2,G=(X+R)/2;return K[0]=[k,G,(A-r)/2,W,s],K}s=s.replace(/\n/g," ");for(let k=0,G=s.length;k<G;){x();let q=Math.atan2(g-m,f-_);if(O&&(q+=q>0?-B:B),W!==void 0){let N=q-W;if(N+=N>B?-2*B:N<-B?2*B:0,Math.abs(N)>o)return null}W=q;const Q=k;let re=0;for(;k<G;++k){const N=O?G-k-1:k,J=a*l(h,s[N],c);if(e+n<t&&p+y<r+re+J/2)break;re+=J}if(k===Q)continue;const L=O?s.substring(G-Q,G-k):s.substring(Q,k);E=y===0?0:(r+re/2-p)/y;const ue=Ft(_,f,E),z=Ft(m,g,E);K.push([ue,z,re/2,q,L]),r+=re}return K}const es=kt(),Yi=[],Ii=[],bi=[],$i=[];function af(i){return i[3].declutterBox}const lf=new RegExp("[-----]");function Yl(i,e){return e==="start"?e=lf.test(i)?"right":"left":e==="end"&&(e=lf.test(i)?"left":"right"),wa[e]}function BC(i,e,t){return t>0&&i.push(`
`,""),i.push(e,""),i}function XC(i,e,t){return t%2===0&&(i+=e),i}class jC{constructor(e,t,n,s,r){this.overlaps=n,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=ht(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new $_:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,n,s){const r=e+t+n+s;if(this.labels_[r])return this.labels_[r];const o=s?this.strokeStates[s]:null,a=n?this.fillStates[n]:null,l=this.textStates[t],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=l.justify?wa[l.justify]:Yl(Array.isArray(e)?e[0]:e,l.textAlign||Zr),d=s&&o.lineWidth?o.lineWidth:0,f=Array.isArray(e)?e:String(e).split(`
`).reduce(BC,[]),{width:g,height:_,widths:m,heights:y,lineWidths:p}=dT(l,f),x=g+d,E=[],T=(x+2)*c[0],R=(_+d)*c[1],I={width:T<0?Math.floor(T):Math.ceil(T),height:R<0?Math.floor(R):Math.ceil(R),contextInstructions:E};(c[0]!=1||c[1]!=1)&&E.push("scale",c),s&&(E.push("strokeStyle",o.strokeStyle),E.push("lineWidth",d),E.push("lineCap",o.lineCap),E.push("lineJoin",o.lineJoin),E.push("miterLimit",o.miterLimit),E.push("setLineDash",[o.lineDash]),E.push("lineDashOffset",o.lineDashOffset)),n&&E.push("fillStyle",a.fillStyle),E.push("textBaseline","middle"),E.push("textAlign","center");const S=.5-u;let A=u*x+S*d;const b=[],X=[];let O=0,B=0,K=0,Y=0,W;for(let k=0,G=f.length;k<G;k+=2){const q=f[k];if(q===`
`){B+=O,O=0,A=u*x+S*d,++Y;continue}const Q=f[k+1]||l.font;Q!==W&&(s&&b.push("font",Q),n&&X.push("font",Q),W=Q),O=Math.max(O,y[K]);const re=[q,A+S*m[K]+u*(m[K]-p[Y]),.5*(d+O)+B];A+=m[K],s&&b.push("strokeText",re),n&&X.push("fillText",re),++K}return Array.prototype.push.apply(E,b),Array.prototype.push.apply(E,X),this.labels_[r]=I,I}replayTextBackground_(e,t,n,s,r,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,n),e.lineTo.apply(e,s),e.lineTo.apply(e,r),e.lineTo.apply(e,t),o&&(this.alignAndScaleFill_=o[2],e.fillStyle=o[1],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,n,s,r,o,a,l,h,c,u,d,f,g,_,m){a*=d[0],l*=d[1];let y=n-a,p=s-l;const x=r+h>e?e-h:r,E=o+c>t?t-c:o,T=g[3]+x*d[0]+g[1],R=g[0]+E*d[1]+g[2],I=y-g[3],S=p-g[0];(_||u!==0)&&(Yi[0]=I,$i[0]=I,Yi[1]=S,Ii[1]=S,Ii[0]=I+T,bi[0]=Ii[0],bi[1]=S+R,$i[1]=bi[1]);let A;return u!==0?(A=ii(ht(),n,s,1,1,u,-n,-s),Ke(A,Yi),Ke(A,Ii),Ke(A,bi),Ke(A,$i),Ei(Math.min(Yi[0],Ii[0],bi[0],$i[0]),Math.min(Yi[1],Ii[1],bi[1],$i[1]),Math.max(Yi[0],Ii[0],bi[0],$i[0]),Math.max(Yi[1],Ii[1],bi[1],$i[1]),es)):Ei(Math.min(I,I+T),Math.min(S,S+R),Math.max(I,I+T),Math.max(S,S+R),es),f&&(y=Math.round(y),p=Math.round(p)),{drawImageX:y,drawImageY:p,drawImageW:x,drawImageH:E,originX:h,originY:c,declutterBox:{minX:es[0],minY:es[1],maxX:es[2],maxY:es[3],value:m},canvasTransform:A,scale:d}}replayImageOrLabel_(e,t,n,s,r,o,a){const l=!!(o||a),h=s.declutterBox,c=a?a[2]*s.scale[0]/2:0;return h.minX-c<=t[0]&&h.maxX+c>=0&&h.minY-c<=t[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(e,Yi,Ii,bi,$i,o,a),fT(e,s.canvasTransform,r,n,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const n=Ke(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;e.save(),e.translate(n[0]%s,n[1]%s),t!==1&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],t[1]&&(e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6]))}drawLabelWithPointPlacement_(e,t,n,s){const r=this.textStates[t],o=this.createLabel(e,t,s,n),a=this.strokeStates[n],l=this.pixelRatio,h=Yl(Array.isArray(e)?e[0]:e,r.textAlign||Zr),c=wa[r.textBaseline||Ea],u=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*r.scale[0],f=h*d+2*(.5-h)*u,g=c*o.height/l+2*(.5-c)*u;return{label:o,anchorX:f,anchorY:g}}execute_(e,t,n,s,r,o,a,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&zi(n,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=an(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),_E(this.renderedTransform_,n));let u=0;const d=s.length;let f=0,g,_,m,y,p,x,E,T,R,I,S,A,b,X=0,O=0;const B=this.coordinateCache_,K=this.viewRotation_,Y=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,W={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:K},k=this.instructions!=s||this.overlaps?0:200;let G,q,Q,re;for(;u<d;){const L=s[u];switch(L[0]){case oe.BEGIN_GEOMETRY:G=L[1],re=L[3],G.getGeometry()?a!==void 0&&!Et(a,re.getExtent())?u=L[2]+1:++u:u=L[2],h&&(h.zIndex=L[4]);break;case oe.BEGIN_PATH:X>k&&(this.fill_(e),X=0),O>k&&(e.stroke(),O=0),!X&&!O&&(e.beginPath(),p=NaN,x=NaN),++u;break;case oe.CIRCLE:f=L[1];const z=c[f],N=c[f+1],J=c[f+2],te=c[f+3],ge=J-z,Ce=te-N,Re=Math.sqrt(ge*ge+Ce*Ce);e.moveTo(z+Re,N),e.arc(z,N,Re,0,2*Math.PI,!0),++u;break;case oe.CLOSE_PATH:e.closePath(),++u;break;case oe.CUSTOM:f=L[1],g=L[2];const Jt=L[3],C=L[4],w=L[5];W.geometry=Jt,W.feature=G,u in B||(B[u]=[]);const P=B[u];w?w(c,f,g,2,P):(P[0]=c[f],P[1]=c[f+1],P.length=2),h&&(h.zIndex=L[6]),C(P,W),++u;break;case oe.DRAW_IMAGE:f=L[1],g=L[2],R=L[3],_=L[4],m=L[5];let F=L[6];const M=L[7],D=L[8],H=L[9],$=L[10];let j=L[11];const U=L[12];let ie=L[13];y=L[14]||"declutter";const V=L[15];if(!R&&L.length>=20){I=L[19],S=L[20],A=L[21],b=L[22];const Bt=this.drawLabelWithPointPlacement_(I,S,A,b);R=Bt.label,L[3]=R;const Cn=L[23];_=(Bt.anchorX-Cn)*this.pixelRatio,L[4]=_;const Xt=L[24];m=(Bt.anchorY-Xt)*this.pixelRatio,L[5]=m,F=R.height,L[6]=F,ie=R.width,L[13]=ie}let se;L.length>25&&(se=L[25]);let le,xe,be;L.length>17?(le=L[16],xe=L[17],be=L[18]):(le=Dn,xe=null,be=null),$&&Y?j+=K:!$&&!Y&&(j-=K);let Ae=0;for(;f<g;f+=2){if(se&&se[Ae++]<ie/this.pixelRatio)continue;const Bt=this.calculateImageOrLabelDimensions_(R.width,R.height,c[f],c[f+1],ie,F,_,m,D,H,j,U,r,le,!!xe||!!be,G),Cn=[e,t,R,Bt,M,xe,be];if(l){let Xt,si,jt;if(V){const je=g-f;if(!V[je]){V[je]={args:Cn,declutterMode:y};continue}const ut=V[je];Xt=ut.args,si=ut.declutterMode,delete V[je],jt=af(Xt)}let wi,Ri;if(Xt&&(si!=="declutter"||!l.collides(jt))&&(wi=!0),(y!=="declutter"||!l.collides(Bt.declutterBox))&&(Ri=!0),si==="declutter"&&y==="declutter"){const je=wi&&Ri;wi=je,Ri=je}wi&&(si!=="none"&&l.insert(jt),this.replayImageOrLabel_.apply(this,Xt)),Ri&&(y!=="none"&&l.insert(Bt.declutterBox),this.replayImageOrLabel_.apply(this,Cn))}else this.replayImageOrLabel_.apply(this,Cn)}++u;break;case oe.DRAW_CHARS:const et=L[1],tt=L[2],wt=L[3],Ut=L[4];b=L[5];const Tn=L[6],Qs=L[7],st=L[8];A=L[9];const Rt=L[10];I=L[11],Array.isArray(I)&&(I=I.reduce(XC,"")),S=L[12];const er=[L[13],L[13]];y=L[14]||"declutter";const Eo=L[15],hl=this.textStates[S],tr=hl.font,ir=[hl.scale[0]*Qs,hl.scale[1]*Qs];let nr;tr in this.widths_?nr=this.widths_[tr]:(nr={},this.widths_[tr]=nr);const Ru=ou(c,et,tt,2),Su=Math.abs(ir[0])*Dd(tr,I,nr);if(Ut||Su<=Ru){const Bt=this.textStates[S].textAlign,Cn=(Ru-Su)*Yl(I,Bt),Xt=UC(c,et,tt,2,I,Cn,Tn,Math.abs(ir[0]),Dd,tr,nr,Y?0:this.viewRotation_,Eo);e:if(Xt){const si=[];let jt,wi,Ri,je,ut;if(A)for(jt=0,wi=Xt.length;jt<wi;++jt){ut=Xt[jt],Ri=ut[4],je=this.createLabel(Ri,S,"",A),_=ut[2]+(ir[0]<0?-Rt:Rt),m=wt*je.height+(.5-wt)*2*Rt*ir[1]/ir[0]-st;const Si=this.calculateImageOrLabelDimensions_(je.width,je.height,ut[0],ut[1],je.width,je.height,_,m,0,0,ut[3],er,!1,Dn,!1,G);if(l&&y==="declutter"&&l.collides(Si.declutterBox))break e;si.push([e,t,je,Si,1,null,null])}if(b)for(jt=0,wi=Xt.length;jt<wi;++jt){ut=Xt[jt],Ri=ut[4],je=this.createLabel(Ri,S,b,""),_=ut[2],m=wt*je.height-st;const Si=this.calculateImageOrLabelDimensions_(je.width,je.height,ut[0],ut[1],je.width,je.height,_,m,0,0,ut[3],er,!1,Dn,!1,G);if(l&&y==="declutter"&&l.collides(Si.declutterBox))break e;si.push([e,t,je,Si,1,null,null])}l&&y!=="none"&&l.load(si.map(af));for(let Si=0,Bm=si.length;Si<Bm;++Si)this.replayImageOrLabel_.apply(this,si[Si])}}++u;break;case oe.END_GEOMETRY:if(o!==void 0){G=L[1];const Bt=o(G,re,y);if(Bt)return Bt}++u;break;case oe.FILL:k?X++:this.fill_(e),++u;break;case oe.MOVE_TO_LINE_TO:for(f=L[1],g=L[2],q=c[f],Q=c[f+1],e.moveTo(q,Q),p=q+.5|0,x=Q+.5|0,f+=2;f<g;f+=2)q=c[f],Q=c[f+1],E=q+.5|0,T=Q+.5|0,(f==g-2||E!==p||T!==x)&&(e.lineTo(q,Q),p=E,x=T);++u;break;case oe.SET_FILL_STYLE:this.alignAndScaleFill_=L[2],X&&(this.fill_(e),X=0,O&&(e.stroke(),O=0)),e.fillStyle=L[1],++u;break;case oe.SET_STROKE_STYLE:O&&(e.stroke(),O=0),this.setStrokeStyle_(e,L),++u;break;case oe.STROKE:k?O++:e.stroke(),++u;break;default:++u;break}}X&&this.fill_(e),O&&e.stroke()}execute(e,t,n,s,r,o){this.viewRotation_=s,this.execute_(e,t,n,this.instructions,r,void 0,void 0,o)}executeHitDetection(e,t,n,s,r){return this.viewRotation_=n,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,s,r)}}const Ln=["Polygon","Circle","LineString","Image","Text","Default"],lm=["Image","Text"],zC=Ln.filter(i=>!lm.includes(i));class VC{constructor(e,t,n,s,r,o,a){this.maxExtent_=e,this.overlaps_=s,this.pixelRatio_=n,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=ht(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(r,a)}clip(e,t){const n=this.getClipCoords(t);e.beginPath(),e.moveTo(n[0],n[1]),e.lineTo(n[2],n[3]),e.lineTo(n[4],n[5]),e.lineTo(n[6],n[7]),e.clip()}createExecutors_(e,t){for(const n in e){let s=this.executorsByZIndex_[n];s===void 0&&(s={},this.executorsByZIndex_[n]=s);const r=e[n];for(const o in r){const a=r[o];s[o]=new jC(this.resolution_,this.pixelRatio_,this.overlaps_,a,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const n=this.executorsByZIndex_[t];for(let s=0,r=e.length;s<r;++s)if(e[s]in n)return!0}return!1}forEachFeatureAtCoordinate(e,t,n,s,r,o){s=Math.round(s);const a=s*2+1,l=ii(this.hitDetectionTransform_,s+.5,s+.5,1/t,-1/t,-n,-e[0],-e[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Ve(a,a));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=kt(),Ar(u,e),ka(u,t*(this.renderBuffer_+s),u));const d=WC(s);let f;function g(T,R,I){const S=c.getImageData(0,0,a,a).data;for(let A=0,b=d.length;A<b;A++)if(S[d[A]]>0){if(!o||I==="none"||f!=="Image"&&f!=="Text"||o.includes(T)){const X=(d[A]-3)/4,O=s-X%a,B=s-(X/a|0),K=r(T,R,O*O+B*B);if(K)return K}c.clearRect(0,0,a,a);break}}const _=Object.keys(this.executorsByZIndex_).map(Number);_.sort(Oi);let m,y,p,x,E;for(m=_.length-1;m>=0;--m){const T=_[m].toString();for(p=this.executorsByZIndex_[T],y=Ln.length-1;y>=0;--y)if(f=Ln[y],x=p[f],x!==void 0&&(E=x.executeHitDetection(c,l,n,g,u),E))return E}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const n=t[0],s=t[1],r=t[2],o=t[3],a=[n,s,n,o,r,o,r,s];return an(a,0,8,2,e,a),a}isEmpty(){return Un(this.executorsByZIndex_)}execute(e,t,n,s,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(a?Xg:Oi),o=o||Ln;const h=Ln.length;for(let c=0,u=l.length;c<u;++c){const d=l[c].toString(),f=this.executorsByZIndex_[d];for(let g=0,_=o.length;g<_;++g){const m=o[g],y=f[m];if(y!==void 0){const p=a===null?void 0:y.getZIndexContext(),x=p?p.getContext():e,E=this.maxExtent_&&m!=="Image"&&m!=="Text";if(E&&(x.save(),this.clip(x,n)),!p||m==="Text"||m==="Image"?y.execute(x,t,n,s,r,a):p.pushFunction(T=>y.execute(T,t,n,s,r,a)),E&&x.restore(),p){p.offset();const T=l[c]*h+Ln.indexOf(m);this.deferredZIndexContexts_[T]||(this.deferredZIndexContexts_[T]=[]),this.deferredZIndexContexts_[T].push(p)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(Oi);for(let n=0,s=t.length;n<s;++n)e[t[n]].forEach(r=>{r.draw(this.renderedContext_),r.clear()}),e[t[n]].length=0}}const $l={};function WC(i){if($l[i]!==void 0)return $l[i];const e=i*2+1,t=i*i,n=new Array(t+1);for(let r=0;r<=i;++r)for(let o=0;o<=i;++o){const a=r*r+o*o;if(a>t)break;let l=n[a];l||(l=[],n[a]=l),l.push(((i+r)*e+(i+o))*4+3),r>0&&l.push(((i-r)*e+(i+o))*4+3),o>0&&(l.push(((i+r)*e+(i-o))*4+3),r>0&&l.push(((i-r)*e+(i-o))*4+3))}const s=[];for(let r=0,o=n.length;r<o;++r)n[r]&&s.push(...n[r]);return $l[i]=s,s}class KC extends am{constructor(e,t,n,s,r,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=n,this.transform_=s,this.transformRotation_=s?ho(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=ht()}drawImages_(e,t,n,s){if(!this.image_)return;const r=an(e,t,n,s,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=r.length;c<u;c+=2){const d=r[c]-this.imageAnchorX_,f=r[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=d+this.imageAnchorX_,_=f+this.imageAnchorY_;ii(a,g,_,1,1,h,-g,-_),o.save(),o.transform.apply(o,a),o.translate(g,_),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,n,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=an(e,t,n,s,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<n;t+=s){const l=r[t]+this.textOffsetX_,h=r[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(e,t,n,s,r){const o=this.context_,a=an(e,t,n,s,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),n}drawRings_(e,t,n,s){for(let r=0,o=n.length;r<o;++r)t=this.moveToLineTo_(e,t,n[r],s,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Et(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=SE(e,this.transform_,this.pixelCoordinates_),n=t[2]-t[0],s=t[3]-t[1],r=Math.sqrt(n*n+s*s),o=this.context_;o.beginPath(),o.arc(t[0],t[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const n=t.getGeometryFunction()(e);n&&(this.setStyle(t),this.drawGeometry(n))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let n=0,s=t.length;n<s;++n)this.drawGeometry(t[n])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(t,0,t.length,n),this.text_!==""&&this.drawText_(t,0,t.length,n)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(t,0,t.length,n),this.text_!==""&&this.drawText_(t,0,t.length,n)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Et(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,n=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(n,0,n.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(Et(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,s=e.getFlatCoordinates();let r=0;const o=e.getEnds(),a=e.getStride();n.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(s,r,o[l],a,!1);n.stroke()}if(this.text_!==""){const n=e.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Et(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Et(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,n=e.getOrientedFlatCoordinates();let s=0;const r=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=r.length;a<l;++a){const h=r[a];s=this.drawRings_(n,s,h,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,n=this.contextFillState_;n?n.fillStyle!=e.fillStyle&&(n.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=e.lineCap&&(n.lineCap=e.lineCap,t.lineCap=e.lineCap),zi(n.lineDash,e.lineDash)||t.setLineDash(n.lineDash=e.lineDash),n.lineDashOffset!=e.lineDashOffset&&(n.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),n.lineJoin!=e.lineJoin&&(n.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),n.lineWidth!=e.lineWidth&&(n.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),n.miterLimit!=e.miterLimit&&(n.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),n.strokeStyle!=e.strokeStyle&&(n.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,n=this.contextTextState_,s=e.textAlign?e.textAlign:Zr;n?(n.font!=e.font&&(n.font=e.font,t.font=e.font),n.textAlign!=s&&(n.textAlign=s,t.textAlign=s),n.textBaseline!=e.textBaseline&&(n.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=s,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:s,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const n=e.getColor();this.fillState_={fillStyle:fi(n||bt)}}if(!t)this.strokeState_=null;else{const n=t.getColor(),s=t.getLineCap(),r=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),h=t.getMiterLimit(),c=r||Ni;this.strokeState_={lineCap:s!==void 0?s:Os,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||ki)*this.pixelRatio_,lineJoin:a!==void 0?a:Gs,lineWidth:(l!==void 0?l:qr)*this.pixelRatio_,miterLimit:h!==void 0?h:$r,strokeStyle:fi(n||Hr)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const n=e.getPixelRatio(this.pixelRatio_),s=e.getAnchor(),r=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*n,this.imageAnchorY_=s[1]*n,this.imageHeight_=t[1]*n,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=t[0]*n}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const f=t.getColor();this.textFillState_={fillStyle:fi(f||bt)}}const n=e.getStroke();if(!n)this.textStrokeState_=null;else{const f=n.getColor(),g=n.getLineCap(),_=n.getLineDash(),m=n.getLineDashOffset(),y=n.getLineJoin(),p=n.getWidth(),x=n.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:Os,lineDash:_||Ni,lineDashOffset:m||ki,lineJoin:y!==void 0?y:Gs,lineWidth:p!==void 0?p:qr,miterLimit:x!==void 0?x:$r,strokeStyle:fi(f||Hr)}}const s=e.getFont(),r=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),h=e.getScaleArray(),c=e.getText(),u=e.getTextAlign(),d=e.getTextBaseline();this.textState_={font:s!==void 0?s:M_,textAlign:u!==void 0?u:Zr,textBaseline:d!==void 0?d:Ea},this.text_=c!==void 0?Array.isArray(c)?c.reduce((f,g,_)=>f+=_%2?" ":g,""):c:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const di=.5;function YC(i,e,t,n,s,r,o,a,l){const h=s,c=i[0]*di,u=i[1]*di,d=Ve(c,u);d.imageSmoothingEnabled=!1;const f=d.canvas,g=new KC(d,di,s,null,o,a,null),_=t.length,m=Math.floor((256*256*256-1)/_),y={};for(let x=1;x<=_;++x){const E=t[x-1],T=E.getStyleFunction()||n;if(!T)continue;let R=T(E,r);if(!R)continue;Array.isArray(R)||(R=[R]);const S=(x*m).toString(16).padStart(7,"#00000");for(let A=0,b=R.length;A<b;++A){const X=R[A],O=X.getGeometryFunction()(E);if(!O||!Et(h,O.getExtent()))continue;const B=X.clone(),K=B.getFill();K&&K.setColor(S);const Y=B.getStroke();Y&&(Y.setColor(S),Y.setLineDash(null)),B.setText(void 0);const W=X.getImage();if(W){const Q=W.getImageSize();if(!Q)continue;const re=Ve(Q[0],Q[1],void 0,{alpha:!1}),L=re.canvas;re.fillStyle=S,re.fillRect(0,0,L.width,L.height),B.setImage(new tl({img:L,anchor:W.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:W.getOrigin(),opacity:1,size:W.getSize(),scale:W.getScale(),rotation:W.getRotation(),rotateWithView:W.getRotateWithView()}))}const k=B.getZIndex()||0;let G=y[k];G||(G={},y[k]=G,G.Polygon=[],G.Circle=[],G.LineString=[],G.Point=[]);const q=O.getType();if(q==="GeometryCollection"){const Q=O.getGeometriesArrayRecursive();for(let re=0,L=Q.length;re<L;++re){const ue=Q[re];G[ue.getType().replace("Multi","")].push(ue,B)}}else G[q.replace("Multi","")].push(O,B)}}const p=Object.keys(y).map(Number).sort(Oi);for(let x=0,E=p.length;x<E;++x){const T=y[p[x]];for(const R in T){const I=T[R];for(let S=0,A=I.length;S<A;S+=2){g.setStyle(I[S+1]);for(let b=0,X=e.length;b<X;++b)g.setTransform(e[b]),g.drawGeometry(I[S])}}}return d.getImageData(0,0,f.width,f.height)}function $C(i,e,t){const n=[];if(t){const s=Math.floor(Math.round(i[0])*di),r=Math.floor(Math.round(i[1])*di),o=(Ge(s,0,t.width-1)+Ge(r,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],c=t.data[o+2]+256*(l+256*a),u=Math.floor((256*256*256-1)/e.length);c&&c%u===0&&n.push(e[c/u-1])}return n}const HC=.5,cm={Point:nw,LineString:ew,Polygon:rw,MultiPoint:sw,MultiLineString:tw,MultiPolygon:iw,GeometryCollection:QC,Circle:qC};function ZC(i,e){return parseInt(ne(i),10)-parseInt(ne(e),10)}function cf(i,e){const t=hm(i,e);return t*t}function hm(i,e){return HC*i/e}function qC(i,e,t,n,s){const r=t.getFill(),o=t.getStroke();if(r||o){const l=i.getBuilder(t.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(e,n,s)}const a=t.getText();if(a&&a.getText()){const l=i.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,n)}}function hf(i,e,t,n,s,r,o,a){const l=[],h=t.getImage();if(h){let d=!0;const f=h.getImageState();f==Ee.LOADED||f==Ee.ERROR?d=!1:f==Ee.IDLE&&h.load(),d&&l.push(h.ready())}const c=t.getFill();c&&c.loading()&&l.push(c.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>s(null)),JC(i,e,t,n,r,o,a),u}function JC(i,e,t,n,s,r,o){const a=t.getGeometryFunction()(e);if(!a)return;const l=a.simplifyTransformed(n,s);if(t.getRenderer())um(i,l,t,e,o);else{const c=cm[l.getType()];c(i,l,t,e,o,r)}}function um(i,e,t,n,s){if(e.getType()=="GeometryCollection"){const o=e.getGeometries();for(let a=0,l=o.length;a<l;++a)um(i,o[a],t,n,s);return}i.getBuilder(t.getZIndex(),"Default").drawCustom(e,n,t.getRenderer(),t.getHitDetectionRenderer(),s)}function QC(i,e,t,n,s,r){const o=e.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=cm[o[a].getType()];h(i,o[a],t,n,s,r)}}function ew(i,e,t,n,s){const r=t.getStroke();if(r){const a=i.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(e,n,s)}const o=t.getText();if(o&&o.getText()){const a=i.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,n,s)}}function tw(i,e,t,n,s){const r=t.getStroke();if(r){const a=i.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(e,n,s)}const o=t.getText();if(o&&o.getText()){const a=i.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,n,s)}}function iw(i,e,t,n,s){const r=t.getFill(),o=t.getStroke();if(o||r){const l=i.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(e,n,s)}const a=t.getText();if(a&&a.getText()){const l=i.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,n,s)}}function nw(i,e,t,n,s,r){const o=t.getImage(),a=t.getText(),l=a&&a.getText(),h=r&&o&&l?{}:void 0;if(o){if(o.getImageState()!=Ee.LOADED)return;const c=i.getBuilder(t.getZIndex(),"Image");c.setImageStyle(o,h),c.drawPoint(e,n,s)}if(l){const c=i.getBuilder(t.getZIndex(),"Text");c.setTextStyle(a,h),c.drawText(e,n,s)}}function sw(i,e,t,n,s,r){const o=t.getImage(),a=o&&o.getOpacity()!==0,l=t.getText(),h=l&&l.getText(),c=r&&a&&h?{}:void 0;if(a){if(o.getImageState()!=Ee.LOADED)return;const u=i.getBuilder(t.getZIndex(),"Image");u.setImageStyle(o,c),u.drawMultiPoint(e,n,s)}if(h){const u=i.getBuilder(t.getZIndex(),"Text");u.setTextStyle(l,c),u.drawText(e,n,s)}}function rw(i,e,t,n,s){const r=t.getFill(),o=t.getStroke();if(r||o){const l=i.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(e,n,s)}const a=t.getText();if(a&&a.getText()){const l=i.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,n,s)}}class ow extends Z_{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=kt(),this.wrappedRenderedExtent_=kt(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,n){const s=t.extent,r=t.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),u=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),f=t.pixelRatio,g=t.viewHints,_=!(g[ot.ANIMATING]||g[ot.INTERACTING]),m=this.context,y=Math.round(Se(s)/a*f),p=Math.round(Je(s)/a*f),x=u.getWrapX()&&l.canWrapX(),E=x?Se(c):null,T=x?Math.ceil((s[2]-c[2])/E)+1:1;let R=x?Math.floor((s[0]-c[0])/E):0;do{let I=this.getRenderTransform(o,a,0,f,y,p,R*E);t.declutter&&(I=I.slice(0)),e.execute(m,[m.canvas.width,m.canvas.height],I,h,_,n===void 0?Ln:n?lm:zC,n?d&&t.declutter[d]:void 0)}while(++R<T)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Ve(this.context.canvas.width,this.context.canvas.height,Wd))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,Za(this.context),Wd.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const n=e.layerStatesArray[e.layerIndex];this.opacity_=n.opacity;const s=e.viewState;this.prepareContainer(e,t);const r=this.context,o=this.replayGroup_;let a=o&&!o.isEmpty();if(!a&&!(this.getLayer().hasListener(qe.PRERENDER)||this.getLayer().hasListener(qe.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(r,e),s.projection,this.clipped_=!1,a&&n.extent&&this.clipping){const l=ei(n.extent);a=Et(l,e.extent),this.clipped_=a&&!gr(l,e.extent),this.clipped_&&this.clipUnrotated(r,e,l)}return a&&this.renderWorlds(o,e,this.getLayer().getDeclutter()?!1:void 0),!e.declutter&&this.clipped_&&r.restore(),this.postRender(r,e),this.renderedRotation_!==s.rotation&&(this.renderedRotation_=s.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=this.frameState.size.slice(),s=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=n[0]*di,d=n[1]*di;c.push(this.getRenderTransform(s,r,o,di,u,d,0).slice());const f=h.getSource(),g=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!gr(g,l)){let _=l[0];const m=Se(g);let y=0,p;for(;_<g[0];)--y,p=m*y,c.push(this.getRenderTransform(s,r,o,di,u,d,p).slice()),_+=m;for(y=0,_=l[2];_>g[2];)++y,p=m*y,c.push(this.getRenderTransform(s,r,o,di,u,d,p).slice()),_-=m}this.hitDetectionImageData_=YC(n,c,this.renderedFeatures_,h.getStyleFunction(),l,r,o,cf(r,this.renderedPixelRatio_))}t($C(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,n,s,r){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),h={},c=function(d,f,g){const _=ne(d),m=h[_];if(m){if(m!==!0&&g<m.distanceSq){if(g===0)return h[_]=!0,r.splice(r.lastIndexOf(m),1),s(d,l,f);m.geometry=f,m.distanceSq=g}}else{if(g===0)return h[_]=!0,s(d,l,f);r.push(h[_]={feature:d,layer:l,geometry:f,distanceSq:g,callback:s})}},u=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,o,a,n,c,u?t.declutter?.[u]?.all().map(d=>d.value):null)}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),n=t.getSource();if(!n)return!1;const s=e.viewHints[ot.ANIMATING],r=e.viewHints[ot.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&s||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,h=e.viewState,c=h.projection,u=h.resolution,d=e.pixelRatio,f=t.getRevision(),g=t.getRenderBuffer();let _=t.getRenderOrder();_===void 0&&(_=ZC);const m=h.center.slice(),y=ka(l,g*u),p=y.slice(),x=[y.slice()],E=c.getExtent();if(n.getWrapX()&&c.canWrapX()&&!gr(E,e.extent)){const K=Se(E),Y=Math.max(Se(y)/2,K);y[0]=E[0]-Y,y[2]=E[2]+Y,qg(m,c);const W=Hg(x[0],c);W[0]<E[0]&&W[2]<E[2]?x.push([W[0]+K,W[1],W[2]+K,W[3]]):W[0]>E[0]&&W[2]>E[2]&&x.push([W[0]-K,W[1],W[2]-K,W[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==_&&this.renderedFrameDeclutter_===!!e.declutter&&gr(this.wrappedRenderedExtent_,y))return zi(this.renderedExtent_,p)||(this.hitDetectionImageData_=null,this.renderedExtent_=p),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const T=new kC(hm(u,d),y,u,d);let R;for(let K=0,Y=x.length;K<Y;++K)n.loadFeatures(x[K],u,c);const I=cf(u,d);let S=!0;const A=(K,Y)=>{let W;const k=K.getStyleFunction()||t.getStyleFunction();if(k&&(W=k(K,u)),W){const G=this.renderFeature(K,I,W,T,R,this.getLayer().getDeclutter(),Y);S=S&&!G}},b=Wa(y),X=n.getFeaturesInExtent(b);_&&X.sort(_);for(let K=0,Y=X.length;K<Y;++K)A(X[K],K);this.renderedFeatures_=X,this.ready=S;const O=T.finish(),B=new VC(y,u,d,n.getOverlaps(),O,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=_,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=p,this.wrappedRenderedExtent_=y,this.renderedCenter_=m,this.renderedProjection_=c,this.renderedPixelRatio_=d,this.replayGroup_=B,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,n,s,r,o,a){if(!n)return!1;let l=!1;if(Array.isArray(n))for(let h=0,c=n.length;h<c;++h)l=hf(s,e,n[h],t,this.boundHandleStyleImageChange_,r,o,a)||l;else l=hf(s,e,n,t,this.boundHandleStyleImageChange_,r,o,a);return l}}class io extends B_{constructor(e){super(e)}createRenderer(){return new ow(this)}}let aw=!1;function lw(i,e,t,n,s,r,o){const a=new XMLHttpRequest;a.open("GET",typeof i=="function"?i(t,n,s):i,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=aw,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=e.getType();try{let c;h=="text"||h=="json"?c=a.responseText:h=="xml"?c=a.responseXML||a.responseText:h=="arraybuffer"&&(c=a.response),c?r(e.readFeatures(c,{extent:t,featureProjection:s}),e.readProjection(c)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function uf(i,e){return function(t,n,s,r,o){lw(i,e,t,n,s,(a,l)=>{this.addFeatures(a),r!==void 0&&r(a)},()=>{this.changed(),o!==void 0&&o()})}}function cw(i,e){return[[-1/0,-1/0,1/0,1/0]]}class Pt extends Ci{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new Pt(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const n=this.getStyle();return n&&e.setStyle(n),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Oe(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=we(e,ae.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?hw(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function hw(i){if(typeof i=="function")return i;let e;return Array.isArray(i)?e=i:(Le(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[i]),function(){return e}}function dm(i,e,t,n){const s=[];let r=kt();for(let o=0,a=t.length;o<a;++o){const l=t[o];r=uh(i,e,l[0],n),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=l[l.length-1]}return s}function Ra(i,e,t,n,s,r,o){let a,l;const h=(t-e)/n;if(h===1)a=e;else if(h===2)a=e,l=s;else if(h!==0){let c=i[e],u=i[e+1],d=0;const f=[0];for(let m=e+n;m<t;m+=n){const y=i[m],p=i[m+1];d+=Math.sqrt((y-c)*(y-c)+(p-u)*(p-u)),f.push(d),c=y,u=p}const g=s*d,_=uy(f,g);_<0?(l=(g-f[-_-2])/(f[-_-1]-f[-_-2]),a=e+(-_-2)*n):a=e+_*n}o=o>1?o:2,r=r||new Array(o);for(let c=0;c<o;++c)r[c]=a===void 0?NaN:l===void 0?i[a+c]:Ft(i[a+c],i[a+n+c],l);return r}function kc(i,e,t,n,s,r){if(t==e)return null;let o;if(s<i[e+n-1])return r?(o=i.slice(e,e+n),o[n-1]=s,o):null;if(i[t-1]<s)return r?(o=i.slice(t-n,t),o[n-1]=s,o):null;if(s==i[e+n-1])return i.slice(e,e+n);let a=e/n,l=t/n;for(;a<l;){const d=a+l>>1;s<i[(d+1)*n-1]?l=d:a=d+1}const h=i[a*n-1];if(s==h)return i.slice((a-1)*n,(a-1)*n+n);const c=i[(a+1)*n-1],u=(s-h)/(c-h);o=[];for(let d=0;d<n-1;++d)o.push(Ft(i[(a-1)*n+d],i[a*n+d],u));return o.push(s),o}function uw(i,e,t,n,s,r,o){if(o)return kc(i,e,t[t.length-1],n,s,r);let a;if(s<i[n-1])return r?(a=i.slice(0,n),a[n-1]=s,a):null;if(i[i.length-1]<s)return r?(a=i.slice(i.length-n),a[n-1]=s,a):null;for(let l=0,h=t.length;l<h;++l){const c=t[l];if(e!=c){if(s<i[e+n-1])return null;if(s<=i[c-1])return kc(i,e,c,n,s,!1);e=c}}return null}class al extends yn{constructor(e,t,n){super(),n!==void 0&&t===void 0?this.setFlatCoordinates(n,e):(t=t||0,this.setCenterAndRadius(e,t,n))}clone(){const e=new al(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){const r=this.flatCoordinates,o=e-r[0],a=t-r[1],l=o*o+a*a;if(l<s){if(l===0)for(let h=0;h<this.stride;++h)n[h]=r[h];else{const h=this.getRadius()/Math.sqrt(l);n[0]=r[0]+h*o,n[1]=r[1]+h*a;for(let c=2;c<this.stride;++c)n[c]=r[c]}return n.length=this.stride,l}return s}containsXY(e,t){const n=this.flatCoordinates,s=e-n[0],r=t-n[1];return s*s+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,n=t[this.stride]-t[0];return Ei(t[0]-n,t[1]-n,t[0]+n,t[1]+n,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(Et(e,t)){const n=this.getCenter();return e[0]<=n[0]&&e[2]>=n[0]||e[1]<=n[1]&&e[3]>=n[1]?!0:fh(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,n=this.flatCoordinates[t]-this.flatCoordinates[0],s=e.slice();s[t]=s[0]+n;for(let r=1;r<t;++r)s[t+r]=e[r];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(e,t,n){this.setLayout(n,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let r=h_(s,0,e,this.stride);s[r++]=s[0]+t;for(let o=1,a=this.stride;o<a;++o)s[r++]=s[o];s.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const n=this.getCenter(),s=this.getStride();this.setCenter(Rh(n,0,n.length,s,e,t,n)),this.changed()}}al.prototype.transform;class no extends a_{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Oe),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let t=0,n=e.length;t<n;++t)this.changeEventsKeys_.push(we(e[t],ae.CHANGE,this.changed,this))}clone(){const e=new no(Hl(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,n,s){if(s<jn(this.getExtent(),e,t))return s;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)s=r[o].closestPointXY(e,t,n,s);return s}containsXY(e,t){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)if(n[s].containsXY(e,t))return!0;return!1}computeExtent(e){Vs(e);const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)dh(e,t[n].getExtent());return e}getGeometries(){return Hl(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)t[n].getType()===this.getType()?e=e.concat(t[n].getGeometriesArrayRecursive()):e.push(t[n]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],n=this.geometries_;let s=!1;for(let r=0,o=n.length;r<o;++r){const a=n[r],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(s=!0)}return s?new no(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)if(t[n].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].rotate(e,t);this.changed()}scale(e,t,n){n||(n=xi(this.getExtent()));const s=this.geometries_;for(let r=0,o=s.length;r<o;++r)s[r].scale(e,t,n);this.changed()}setGeometries(e){this.setGeometriesArray(Hl(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)t[n].applyTransform(e);this.changed()}translate(e,t){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Hl(i){return i.map(e=>e.clone())}class pi extends yn{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){$t(this.flatCoordinates,e),this.changed()}clone(){const e=new pi(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){return s<jn(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Sh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ih(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,n,s))}forEachSegment(e){return g_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,kc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return nn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return Ra(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return ou(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=$a(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new pi(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return Ha(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,this.getExtent())}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ya(this.flatCoordinates,0,e,this.stride),this.changed()}}class Us extends yn{constructor(e,t,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&n)this.setFlatCoordinates(t,e),this.ends_=n;else{const s=e,r=[],o=[];for(let l=0,h=s.length;l<h;++l){const c=s[l];$t(r,c.getFlatCoordinates()),o.push(r.length)}const a=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(a,r),this.ends_=o}}appendLineString(e){$t(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Us(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,s){return s<jn(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(vh(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),bh(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,n,s))}getCoordinateAtM(e,t,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,n=n!==void 0?n:!1,uw(this.flatCoordinates,0,this.ends_,this.stride,e,t,n))}getCoordinates(){return Kr(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new pi(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,n=this.layout,s=[];let r=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=new pi(e.slice(r,l),n);s.push(h),r=l}return s}getLength(){const e=this.ends_;let t=0,n=0;for(let s=0,r=e.length;s<r;++s)n+=ou(this.flatCoordinates,t,e[s],this.stride),t=e[s];return n}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let n=0;const s=this.ends_,r=this.stride;for(let o=0,a=s.length;o<a;++o){const l=s[o],h=Ra(t,n,l,r,.5);$t(e,h),n=l}return e}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=d_(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,n),new Us(t,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(e){return FE(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=fo(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}class po extends yn{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){$t(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new po(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){if(s<jn(this.getExtent(),e,t))return s;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const h=Gi(e,t,r[a],r[a+1]);if(h<s){s=h;for(let c=0;c<o;++c)n[c]=r[a+c];n.length=o}}return s}getCoordinates(){return nn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new Zt(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,n=this.stride,s=[];for(let r=0,o=e.length;r<o;r+=n){const a=new Zt(e.slice(r,r+n),t);s.push(a)}return s}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,n=this.stride;for(let s=0,r=t.length;s<r;s+=n){const o=t[s],a=t[s+1];if(hh(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ya(this.flatCoordinates,0,e,this.stride),this.changed()}}class Bs extends yn{constructor(e,t,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(e[0])){const s=e,r=[],o=[];for(let a=0,l=s.length;a<l;++a){const h=s[a],c=r.length,u=h.getEnds();for(let d=0,f=u.length;d<f;++d)u[d]+=c;$t(r,h.getFlatCoordinates()),o.push(u)}t=s.length===0?this.getLayout():s[0].getLayout(),e=r,n=o}t!==void 0&&n?(this.setFlatCoordinates(t,e),this.endss_=n):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;$t(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let s=0,r=t.length;s<r;++s)t[s]+=n}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let s=0;s<e;++s)t[s]=this.endss_[s].slice();const n=new Bs(this.flatCoordinates.slice(),this.layout,t);return n.applyProperties(this),n}closestPointXY(e,t,n,s){return s<jn(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(IE(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),bE(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,n,s))}containsXY(e,t){return ME(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return vE(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),vc(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,Sc(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=dm(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=f_(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new po(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;p_(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=vc(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=PE(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,n),new Bs(t,"XY",n)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const r=this.endss_[e-1];t=r[r.length-1]}const n=this.endss_[e].slice(),s=n[n.length-1];if(t!==0)for(let r=0,o=n.length;r<o;++r)n[r]-=t;return new Ti(this.flatCoordinates.slice(t,s),this.layout,n)}getPolygons(){const e=this.layout,t=this.flatCoordinates,n=this.endss_,s=[];let r=0;for(let o=0,a=n.length;o<a;++o){const l=n[o].slice(),h=l[l.length-1];if(r!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=r;const c=new Ti(t.slice(r,h),e,l);s.push(c),r=h}return s}getType(){return"MultiPolygon"}intersectsExtent(e){return DE(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=u_(this.flatCoordinates,0,e,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const s=n[n.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const df=ht();class Dt{constructor(e,t,n,s,r,o){this.styleFunction,this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=r,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?br(this.flatCoordinates_):uh(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=xi(this.getExtent());this.flatInteriorPoints_=Lh(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=GE(this.flatCoordinates_,this.ends_),t=dm(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=f_(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Ra(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const n=this.ends_;for(let s=0,r=n.length;s<r;++s){const o=n[s],a=Ra(e,t,o,2,.5);$t(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=ke(e);const t=e.getExtent(),n=e.getWorldExtent();if(t&&n){const s=Je(n)/Je(t);ii(df,n[0],n[3],s,-s,0,0,0),an(this.flatCoordinates_,0,this.flatCoordinates_.length,2,df,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new Dt(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=jg((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const n=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":n.length=$a(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,n,0),s=[n.length];break;case"MultiLineString":s=[],n.length=d_(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,n,0,s);break;case"Polygon":s=[],n.length=Ah(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),n,0,s);break}return s&&(this.simplifiedGeometry_=new Dt(this.type_,n,s,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}Dt.prototype.getFlatCoordinates=Dt.prototype.getOrientedFlatCoordinates;class Uc{constructor(e){this.rbush_=new v_(e),this.items_={}}insert(e,t){const n={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(n),this.items_[ne(t)]=n}load(e,t){const n=new Array(t.length);for(let s=0,r=t.length;s<r;s++){const o=e[s],a=t[s],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};n[s]=l,this.items_[ne(a)]=l}this.rbush_.load(n)}remove(e){const t=ne(e),n=this.items_[t];return delete this.items_[t],this.rbush_.remove(n)!==null}update(e,t){const n=this.items_[ne(t)],s=[n.minX,n.minY,n.maxX,n.maxY];Br(s,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(s){return s.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let n;for(let s=0,r=e.length;s<r;s++)if(n=t(e[s]),n)return n;return n}isEmpty(){return Un(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return Ei(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}class fm extends Ci{constructor(e){super(),this.projection=ke(e.projection),this.attributions_=ff(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(n,s){t.viewResolver=n,t.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=ff(e),this.changed()}setState(e){this.state_=e,this.changed()}}function ff(i){return i?typeof i=="function"?i:(Array.isArray(i)||(i=[i]),e=>i):null}const vt={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class Hi extends qt{constructor(e,t,n){super(e),this.feature=t,this.features=n}}class Sa extends fm{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Ur,this.format_=e.format||null,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(Le(this.format_,"`format` must be set when `url` is set"),this.loader_=uf(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:cw;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new Uc:null,this.loadedExtentsRtree_=new Uc,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,s;Array.isArray(e.features)?s=e.features:e.features&&(n=e.features,s=n.getArray()),!t&&n===void 0&&(n=new Nt(s)),s!==void 0&&this.addFeaturesInternal(s),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=ne(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const n=e.getGeometry();if(n){const s=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new Hi(vt.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof Dt||(this.featureChangeKeys_[e]=[we(t,ae.CHANGE,this.handleFeatureChange_,this),we(t,Ls.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let n=!0;if(t.getId()!==void 0){const s=String(t.getId());if(!(s in this.idIndex_))this.idIndex_[s]=t;else if(t instanceof Dt){const r=this.idIndex_[s];r instanceof Dt?Array.isArray(r)?r.push(t):this.idIndex_[s]=[r,t]:n=!1}else n=!1}return n&&(Le(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),n}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],n=[],s=[];for(let r=0,o=e.length;r<o;r++){const a=e[r],l=ne(a);this.addToIndex_(l,a)&&n.push(a)}for(let r=0,o=n.length;r<o;r++){const a=n[r],l=ne(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();t.push(c),s.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,s),this.hasListener(vt.ADDFEATURE))for(let r=0,o=n.length;r<o;r++)this.dispatchEvent(new Hi(vt.ADDFEATURE,n[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(vt.ADDFEATURE,function(n){t||(t=!0,e.push(n.feature),t=!1)}),this.addEventListener(vt.REMOVEFEATURE,function(n){t||(t=!0,e.remove(n.feature),t=!1)}),e.addEventListener(Ye.ADD,n=>{t||(t=!0,this.addFeature(n.element),t=!1)}),e.addEventListener(Ye.REMOVE,n=>{t||(t=!0,this.removeFeature(n.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(Oe);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(n=>{this.removeFeatureInternal(n)});for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new Hi(vt.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const n=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(n,function(s){const r=s.getGeometry();if(r instanceof Dt||r.intersectsCoordinate(e))return t(s)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(n){const s=n.getGeometry();if(s instanceof Dt||s.intersectsExtent(e)){const r=t(n);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),Un(this.nullGeometryFeatures_)||$t(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(n){t.push(n)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const s=_h(e,t);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const n=e[0],s=e[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||un,this.featuresRtree_.forEachInExtent(l,function(h){if(t(h)){const c=h.getGeometry(),u=a;if(a=c instanceof Dt?0:c.closestPointXY(n,s,o,a),a<u){r=h;const d=Math.sqrt(a);l[0]=n-d,l[1]=s-d,l[2]=n+d,l[3]=s+d}}}),r}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,n=ne(t),s=t.getGeometry();if(!s)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[n]=t);else{const o=s.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const r=t.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[n]=t;this.changed(),this.dispatchEvent(new Hi(vt.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:ne(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Un(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,n){const s=this.loadedExtentsRtree_,r=this.strategy_(e,t,n);for(let o=0,a=r.length;o<a;++o){const l=r[o];s.forEachInExtent(l,function(c){return gr(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Hi(vt.FEATURESLOADSTART)),this.loader_.call(this,l,t,n,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new Hi(vt.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Hi(vt.FEATURESLOADERROR))}),s.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_,n=t.forEachInExtent(e,function(s){if(Br(s.extent,e))return s});n&&t.remove(n)}removeFeatures(e){let t=!1;for(let n=0,s=e.length;n<s;++n)t=this.removeFeatureInternal(e[n])||t;t&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=ne(e);if(!(t in this.uidIndex_))return!1;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.featureChangeKeys_[t]?.forEach(Oe),delete this.featureChangeKeys_[t];const s=e.getId();if(s!==void 0){const r=s.toString(),o=this.idIndex_[r];o===e?delete this.idIndex_[r]:Array.isArray(o)&&(o.splice(o.indexOf(e),1),o.length===1&&(this.idIndex_[r]=o[0]))}return delete this.uidIndex_[t],this.hasListener(vt.REMOVEFEATURE)&&this.dispatchEvent(new Hi(vt.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(const t in this.idIndex_)if(this.idIndex_[t]===e){delete this.idIndex_[t];break}}setLoader(e){this.loader_=e}setUrl(e){Le(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(uf(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}}const ts=[0,0,0],Zi=5;class au{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,Le(fy(this.resolutions_,(s,r)=>r-s),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(!t)t=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,Le(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=e.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Xi(n)),Le(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,Le(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Nh,Le(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((s,r)=>{const o=new ol(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(e,t,n){const s=this.getTileRangeForExtentAndZ(e,t);for(let r=s.minX,o=s.maxX;r<=o;++r)for(let a=s.minY,l=s.maxY;a<=l;++a)n([t,r,a])}forEachTileCoordParentTileRange(e,t,n,s){let r,o,a,l=null,h=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,s);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),r=Jn(o,o,a,a,n)):r=this.getTileRangeForExtentAndZ(l,h,n),t(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,n){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const r=e[1]*2,o=e[2]*2;return Jn(r,r+1,o,o+1,t)}const s=this.getTileCoordExtent(e,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,n){if(t>this.maxZoom||t<this.minZoom)return null;const s=e[0],r=e[1],o=e[2];if(t===s)return Jn(r,o,r,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-s),h=Math.floor(r*l),c=Math.floor(o*l);if(t<s)return Jn(h,h,c,c,n);const u=Math.floor(l*(r+1))-1,d=Math.floor(l*(o+1))-1;return Jn(h,u,c,d,n)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,n)}getTileRangeForExtentAndZ(e,t,n){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,ts);const s=ts[1],r=ts[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,ts);const o=ts[1],a=ts[2];return Jn(s,o,r,a,n)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),n=this.getResolution(e[0]),s=We(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*s[0]*n,t[1]-(e[2]+.5)*s[1]*n]}getTileCoordExtent(e,t){const n=this.getOrigin(e[0]),s=this.getResolution(e[0]),r=We(this.getTileSize(e[0]),this.tmpSize_),o=n[0]+e[1]*r[0]*s,a=n[1]-(e[2]+1)*r[1]*s,l=o+r[0]*s,h=a+r[1]*s;return Ei(o,a,l,h,t)}getTileCoordForCoordAndResolution(e,t,n){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,n)}getTileCoordForXYAndResolution_(e,t,n,s,r){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=We(this.getTileSize(o),this.tmpSize_);let c=a*(e-l[0])/n/h[0],u=a*(l[1]-t)/n/h[1];return s?(c=So(c,Zi)-1,u=So(u,Zi)-1):(c=Ro(c,Zi),u=Ro(u,Zi)),ks(o,c,u,r)}getTileCoordForXYAndZ_(e,t,n,s,r){const o=this.getOrigin(n),a=this.getResolution(n),l=We(this.getTileSize(n),this.tmpSize_);let h=(e-o[0])/a/l[0],c=(o[1]-t)/a/l[1];return s?(h=So(h,Zi)-1,c=So(c,Zi)-1):(h=Ro(h,Zi),c=Ro(c,Zi)),ks(n,h,c,r)}getTileCoordForCoordAndZ(e,t,n){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,n)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const n=ch(this.resolutions_,e,t||0);return Ge(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return __(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,n=new Array(t);for(let s=this.minZoom;s<t;++s)n[s]=this.getTileRangeForExtentAndZ(e,s);this.fullTileRanges_=n}}function lu(i){let e=i.getDefaultTileGrid();return e||(e=gw(i),i.setDefaultTileGrid(e)),e}function dw(i,e,t){const n=e[0],s=i.getTileCoordCenter(e),r=ll(t);if(!dn(r,s)){const o=Se(r),a=Math.ceil((r[0]-s[0])/o);return s[0]+=o*a,i.getTileCoordForCoordAndZ(s,n)}return e}function fw(i,e,t,n){n=n!==void 0?n:"top-left";const s=_m(i,e,t);return new au({extent:i,origin:Ay(i,n),resolutions:s,tileSize:t})}function gm(i){const e=i||{},t=e.extent||ke("EPSG:3857").getExtent(),n={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:_m(t,e.maxZoom,e.tileSize,e.maxResolution)};return new au(n)}function _m(i,e,t,n){e=e!==void 0?e:XE,t=We(t!==void 0?t:Nh);const s=Je(i),r=Se(i);n=n>0?n:Math.max(r/t[0],s/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function gw(i,e,t,n){const s=ll(i);return fw(s,e,t,n)}function ll(i){i=ke(i);let e=i.getExtent();if(!e){const t=180*Fs.degrees/i.getMetersPerUnit();e=Ei(-t,-t,t,t)}return e}const _w=/\{z\}/g,mw=/\{x\}/g,pw=/\{y\}/g,yw=/\{-y\}/g;function Ew(i,e,t,n,s){return i.replace(_w,e.toString()).replace(mw,t.toString()).replace(pw,n.toString()).replace(yw,function(){if(s===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(s-n).toString()})}function xw(i){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(i);if(t){const n=t[1].charCodeAt(0),s=t[2].charCodeAt(0);let r;for(r=n;r<=s;++r)e.push(i.replace(t[0],String.fromCharCode(r)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(i),t){const n=parseInt(t[2],10);for(let s=parseInt(t[1],10);s<=n;s++)e.push(i.replace(t[0],s.toString()));return e}return e.push(i),e}function Tw(i,e){return function(t,n,s){if(!t)return;let r;const o=t[0];if(e){const a=e.getFullTileRange(o);a&&(r=a.getHeight()-1)}return Ew(i,o,t[1],t[2],r)}}function Cw(i,e){const t=i.length,n=new Array(t);for(let s=0;s<t;++s)n[s]=Tw(i[s],e);return ww(n)}function ww(i){return i.length===1?i[0]:function(e,t,n){if(!e)return;const s=VT(e),r=Nn(s,i.length);return i[r](e,t,n)}}class mm extends fm{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&We(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||ne(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,n,s,r){return ce()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:lu(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,n){const s=this.getTileGridForProjection(n),r=this.getTilePixelRatio(t),o=We(s.getTileSize(e),this.tmpSize);return r==1?o:Fx(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){const n=t!==void 0?t:this.getProjection(),s=t!==void 0?this.getTileGridForProjection(n):this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(e=dw(s,e,n)),KT(e,s)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class pm extends qt{constructor(e,t){super(e),this.tile=t}}const vs={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class cu extends mm{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===cu.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,n=ne(t),s=t.getState();let r;s==Z.LOADING?(this.tileLoadingKeys_[n]=!0,r=vs.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],r=s==Z.ERROR?vs.TILELOADERROR:s==Z.LOADED?vs.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new pm(r,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=xw(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Cw(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,n){}}class Rw extends cu{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Sw,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:rl,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!kn(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||kn(t,e)))return this.tileGrid;const n=ne(e);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=lu(e)),this.tileGridForProjection[n]}createTile_(e,t,n,s,r,o){const a=[e,t,n],l=this.getTileCoordForTileUrlFunction(a,r),h=l?this.tileUrlFunction(l,s,r):void 0,c=new this.tileClass(a,h!==void 0?Z.IDLE:Z.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(ae.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,n,s,r){const o=this.getProjection();if(!o||!r||kn(o,r))return this.getTileInternal(e,t,n,s,o||r);const a=[e,t,n],l=this.getKey(),h=this.getTileGridForProjection(o),c=this.getTileGridForProjection(r),u=this.getTileCoordForTileUrlFunction(a,r),d=new Qh(o,h,r,c,a,u,this.getTilePixelRatio(s),this.getGutter(),(f,g,_,m)=>this.getTileInternal(f,g,_,m,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return d.key=l,d}getTileInternal(e,t,n,s,r){const o=this.getKey();return this.createTile_(e,t,n,s,r,o)}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){const n=ke(e);if(n){const s=ne(n);s in this.tileGridForProjection||(this.tileGridForProjection[s]=t)}}}function Sw(i,e){i.getImage().src=e}class ym extends Rw{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",n=e.tileGrid!==void 0?e.tileGrid:gm({extent:ll(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const vw='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Iw extends ym{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[vw];const n=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",s=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:n,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:s,wrapX:e.wrapX,zDirection:e.zDirection})}}function nt(i){return(e,...t)=>bw(i,e,t)}function qs(i,e){return nt(Em(i,e).get)}const{apply:bw,getOwnPropertyDescriptor:Em,getPrototypeOf:hu,ownKeys:Aw}=Reflect,{iterator:yo,toStringTag:Pw}=Symbol,Lw=Object,{create:uu,defineProperty:Mw}=Lw,Fw=Array,Dw=Fw.prototype,xm=Dw[yo],Ow=nt(xm),Tm=ArrayBuffer,Gw=Tm.prototype;qs(Gw,"byteLength");const gf=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;gf&&qs(gf.prototype,"byteLength");const Cm=hu(Uint8Array);Cm.from;const Ct=Cm.prototype;Ct[yo];nt(Ct.keys);nt(Ct.values);nt(Ct.entries);nt(Ct.set);nt(Ct.reverse);nt(Ct.fill);nt(Ct.copyWithin);nt(Ct.sort);nt(Ct.slice);nt(Ct.subarray);qs(Ct,"buffer");qs(Ct,"byteOffset");qs(Ct,"length");qs(Ct,Pw);const Nw=Uint8Array,wm=Uint16Array,du=Uint32Array,kw=Float32Array,so=hu([][yo]()),Rm=nt(so.next),Uw=nt(function*(){}().next),Bw=hu(so),Xw=DataView.prototype,jw=nt(Xw.getUint16),fu=WeakMap,Sm=fu.prototype,vm=nt(Sm.get),zw=nt(Sm.set),Im=new fu,Vw=uu(null,{next:{value:function(){const e=vm(Im,this);return Rm(e)}},[yo]:{value:function(){return this}}});function Ww(i){if(i[yo]===xm&&so.next===Rm)return i;const e=uu(Vw);return zw(Im,e,Ow(i)),e}const Kw=new fu,Yw=uu(Bw,{next:{value:function(){const e=vm(Kw,this);return Uw(e)},writable:!0,configurable:!0}});for(const i of Aw(so))i!=="next"&&Mw(Yw,i,Em(so,i));const bm=new Tm(4),$w=new kw(bm),Hw=new du(bm),oi=new wm(512),ai=new Nw(512);for(let i=0;i<256;++i){const e=i-127;e<-24?(oi[i]=0,oi[i|256]=32768,ai[i]=24,ai[i|256]=24):e<-14?(oi[i]=1024>>-e-14,oi[i|256]=1024>>-e-14|32768,ai[i]=-e-1,ai[i|256]=-e-1):e<=15?(oi[i]=e+15<<10,oi[i|256]=e+15<<10|32768,ai[i]=13,ai[i|256]=13):e<128?(oi[i]=31744,oi[i|256]=64512,ai[i]=24,ai[i|256]=24):(oi[i]=31744,oi[i|256]=64512,ai[i]=13,ai[i|256]=13)}const gu=new du(2048);for(let i=1;i<1024;++i){let e=i<<13,t=0;for(;(e&8388608)===0;)e<<=1,t-=8388608;e&=-8388609,t+=947912704,gu[i]=e|t}for(let i=1024;i<2048;++i)gu[i]=939524096+(i-1024<<13);const Js=new du(64);for(let i=1;i<31;++i)Js[i]=i<<23;Js[31]=1199570944;Js[32]=2147483648;for(let i=33;i<63;++i)Js[i]=2147483648+(i-32<<23);Js[63]=3347054592;const Am=new wm(64);for(let i=1;i<64;++i)i!==32&&(Am[i]=1024);function Zw(i){const e=i>>10;return Hw[0]=gu[Am[e]+(i&1023)]+Js[e],$w[0]}function Pm(i,e,...t){return Zw(jw(i,e,...Ww(t)))}function Lm(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var No={exports:{}},_f;function qw(){if(_f)return No.exports;_f=1;function i(e,t,n){const s=n&&n.debug||!1;s&&console.log("[xml-utils] getting "+t+" in "+e);const r=typeof e=="object"?e.outer:e,o=r.slice(0,r.indexOf(">")+1),a=['"',"'"];for(let l=0;l<a.length;l++){const h=a[l],c=t+"\\="+h+"([^"+h+"]*)"+h;s&&console.log("[xml-utils] pattern:",c);const d=new RegExp(c).exec(o);if(s&&console.log("[xml-utils] match:",d),d)return d[1]}}return No.exports=i,No.exports.default=i,No.exports}var Jw=qw();const Zl=Lm(Jw);var ko={exports:{}},Uo={exports:{}},Bo={exports:{}},mf;function Qw(){if(mf)return Bo.exports;mf=1;function i(e,t,n){const r=new RegExp(t).exec(e.slice(n));return r?n+r.index:-1}return Bo.exports=i,Bo.exports.default=i,Bo.exports}var Xo={exports:{}},pf;function e1(){if(pf)return Xo.exports;pf=1;function i(e,t,n){const r=new RegExp(t).exec(e.slice(n));return r?n+r.index+r[0].length-1:-1}return Xo.exports=i,Xo.exports.default=i,Xo.exports}var jo={exports:{}},yf;function t1(){if(yf)return jo.exports;yf=1;function i(e,t){const n=new RegExp(t,"g"),s=e.match(n);return s?s.length:0}return jo.exports=i,jo.exports.default=i,jo.exports}var Ef;function i1(){if(Ef)return Uo.exports;Ef=1;const i=Qw(),e=e1(),t=t1();function n(s,r,o){const a=o&&o.debug||!1,l=!(o&&typeof o.nested===!1),h=o&&o.startIndex||0;a&&console.log("[xml-utils] starting findTagByName with",r," and ",o);const c=i(s,`<${r}[ 
>/]`,h);if(a&&console.log("[xml-utils] start:",c),c===-1)return;const u=s.slice(c+r.length);let d=e(u,"^[^<]*[ /]>",0);const f=d!==-1&&u[d-1]==="/";if(a&&console.log("[xml-utils] selfClosing:",f),f===!1)if(l){let y=0,p=1,x=0;for(;(d=e(u,"[ /]"+r+">",y))!==-1;){const E=u.substring(y,d+1);if(p+=t(E,"<"+r+`[ 
	>]`),x+=t(E,"</"+r+">"),x>=p)break;y=d}}else d=e(u,"[ /]"+r+">",0);const g=c+r.length+d+1;if(a&&console.log("[xml-utils] end:",g),g===-1)return;const _=s.slice(c,g);let m;return f?m=null:m=_.slice(_.indexOf(">")+1,_.lastIndexOf("<")),{inner:m,outer:_,start:c,end:g}}return Uo.exports=n,Uo.exports.default=n,Uo.exports}var xf;function n1(){if(xf)return ko.exports;xf=1;const i=i1();function e(t,n,s){const r=[],o=s&&s.debug||!1,a=s&&typeof s.nested=="boolean"?s.nested:!0;let l=s&&s.startIndex||0,h;for(;h=i(t,n,{debug:o,startIndex:l});)a?l=h.start+1+n.length:l=h.end,r.push(h);return o&&console.log("findTagsByName found",r.length,"tags"),r}return ko.exports=e,ko.exports.default=e,ko.exports}var s1=n1();const r1=Lm(s1),Mr={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},li={};for(const i in Mr)Mr.hasOwnProperty(i)&&(li[Mr[i]]=parseInt(i,10));const o1=[li.BitsPerSample,li.ExtraSamples,li.SampleFormat,li.StripByteCounts,li.StripOffsets,li.StripRowCounts,li.TileByteCounts,li.TileOffsets,li.SubIFDs],ql={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},pe={};for(const i in ql)ql.hasOwnProperty(i)&&(pe[ql[i]]=parseInt(i,10));const St={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},a1={Unspecified:0},nv={AddCompression:1},sv={None:0,Deflate:1,Zstandard:2},l1={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function c1(i,e){const{width:t,height:n}=i,s=new Uint8Array(t*n*3);let r;for(let o=0,a=0;o<i.length;++o,a+=3)r=256-i[o]/e*256,s[a]=r,s[a+1]=r,s[a+2]=r;return s}function h1(i,e){const{width:t,height:n}=i,s=new Uint8Array(t*n*3);let r;for(let o=0,a=0;o<i.length;++o,a+=3)r=i[o]/e*256,s[a]=r,s[a+1]=r,s[a+2]=r;return s}function u1(i,e){const{width:t,height:n}=i,s=new Uint8Array(t*n*3),r=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<i.length;++a,l+=3){const h=i[a];s[l]=e[h]/65536*256,s[l+1]=e[h+r]/65536*256,s[l+2]=e[h+o]/65536*256}return s}function d1(i){const{width:e,height:t}=i,n=new Uint8Array(e*t*3);for(let s=0,r=0;s<i.length;s+=4,r+=3){const o=i[s],a=i[s+1],l=i[s+2],h=i[s+3];n[r]=255*((255-o)/256)*((255-h)/256),n[r+1]=255*((255-a)/256)*((255-h)/256),n[r+2]=255*((255-l)/256)*((255-h)/256)}return n}function f1(i){const{width:e,height:t}=i,n=new Uint8ClampedArray(e*t*3);for(let s=0,r=0;s<i.length;s+=3,r+=3){const o=i[s],a=i[s+1],l=i[s+2];n[r]=o+1.402*(l-128),n[r+1]=o-.34414*(a-128)-.71414*(l-128),n[r+2]=o+1.772*(a-128)}return n}const g1=.95047,_1=1,m1=1.08883;function p1(i){const{width:e,height:t}=i,n=new Uint8Array(e*t*3);for(let s=0,r=0;s<i.length;s+=3,r+=3){const o=i[s+0],a=i[s+1]<<24>>24,l=i[s+2]<<24>>24;let h=(o+16)/116,c=a/500+h,u=h-l/200,d,f,g;c=g1*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),h=_1*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),u=m1*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),d=c*3.2406+h*-1.5372+u*-.4986,f=c*-.9689+h*1.8758+u*.0415,g=c*.0557+h*-.204+u*1.057,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,n[r]=Math.max(0,Math.min(1,d))*255,n[r+1]=Math.max(0,Math.min(1,f))*255,n[r+2]=Math.max(0,Math.min(1,g))*255}return n}const y1="modulepreload",E1=function(i){return"/dinamap-les/"+i},Tf={},En=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let l=function(h){return Promise.all(h.map(c=>Promise.resolve(c).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");s=l(t.map(h=>{if(h=E1(h),h in Tf)return;Tf[h]=!0;const c=h.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${u}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":y1,c||(d.as="script"),d.crossOrigin="",d.href=h,a&&d.setAttribute("nonce",a),document.head.appendChild(d),c)return new Promise((f,g)=>{d.addEventListener("load",f),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${h}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return e().catch(r)})},Mm=new Map;function xn(i,e){Array.isArray(i)||(i=[i]),i.forEach(t=>Mm.set(t,e))}async function Fm(i){const e=Mm.get(i.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${i.Compression}`);const t=await e();return new t(i)}xn([void 0,1],()=>En(()=>import("./raw-in9isEBO.js"),__vite__mapDeps([0,1])).then(i=>i.default));xn(5,()=>En(()=>import("./lzw-_aCqfs4w.js"),__vite__mapDeps([2,1])).then(i=>i.default));xn(6,()=>{throw new Error("old style JPEG compression is not supported.")});xn(7,()=>En(()=>import("./jpeg-CKYXsxFN.js"),__vite__mapDeps([3,1])).then(i=>i.default));xn([8,32946],()=>En(()=>import("./deflate-B9JhHpvg.js"),__vite__mapDeps([4,5,1])).then(i=>i.default));xn(32773,()=>En(()=>import("./packbits-DDWKfGV_.js"),__vite__mapDeps([6,1])).then(i=>i.default));xn(34887,()=>En(()=>import("./lerc-DjPtvjVj.js"),__vite__mapDeps([7,5,1])).then(async i=>(await i.zstd.init(),i)).then(i=>i.default));xn(50001,()=>En(()=>import("./webimage-DBgUwIbt.js"),__vite__mapDeps([8,1])).then(i=>i.default));function cl(i,e,t,n=1){return new(Object.getPrototypeOf(i)).constructor(e*t*n)}function x1(i,e,t,n,s){const r=e/n,o=t/s;return i.map(a=>{const l=cl(a,n,s);for(let h=0;h<s;++h){const c=Math.min(Math.round(o*h),t-1);for(let u=0;u<n;++u){const d=Math.min(Math.round(r*u),e-1),f=a[c*e+d];l[h*n+u]=f}}return l})}function Is(i,e,t){return(1-t)*i+t*e}function T1(i,e,t,n,s){const r=e/n,o=t/s;return i.map(a=>{const l=cl(a,n,s);for(let h=0;h<s;++h){const c=o*h,u=Math.floor(c),d=Math.min(Math.ceil(c),t-1);for(let f=0;f<n;++f){const g=r*f,_=g%1,m=Math.floor(g),y=Math.min(Math.ceil(g),e-1),p=a[u*e+m],x=a[u*e+y],E=a[d*e+m],T=a[d*e+y],R=Is(Is(p,x,_),Is(E,T,_),c%1);l[h*n+f]=R}}return l})}function C1(i,e,t,n,s,r="nearest"){switch(r.toLowerCase()){case"nearest":return x1(i,e,t,n,s);case"bilinear":case"linear":return T1(i,e,t,n,s);default:throw new Error(`Unsupported resampling method: '${r}'`)}}function w1(i,e,t,n,s,r){const o=e/n,a=t/s,l=cl(i,n,s,r);for(let h=0;h<s;++h){const c=Math.min(Math.round(a*h),t-1);for(let u=0;u<n;++u){const d=Math.min(Math.round(o*u),e-1);for(let f=0;f<r;++f){const g=i[c*e*r+d*r+f];l[h*n*r+u*r+f]=g}}}return l}function R1(i,e,t,n,s,r){const o=e/n,a=t/s,l=cl(i,n,s,r);for(let h=0;h<s;++h){const c=a*h,u=Math.floor(c),d=Math.min(Math.ceil(c),t-1);for(let f=0;f<n;++f){const g=o*f,_=g%1,m=Math.floor(g),y=Math.min(Math.ceil(g),e-1);for(let p=0;p<r;++p){const x=i[u*e*r+m*r+p],E=i[u*e*r+y*r+p],T=i[d*e*r+m*r+p],R=i[d*e*r+y*r+p],I=Is(Is(x,E,_),Is(T,R,_),c%1);l[h*n*r+f*r+p]=I}}}return l}function S1(i,e,t,n,s,r,o="nearest"){switch(o.toLowerCase()){case"nearest":return w1(i,e,t,n,s,r);case"bilinear":case"linear":return R1(i,e,t,n,s,r);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function v1(i,e,t){let n=0;for(let s=e;s<t;++s)n+=i[s];return n}function Bc(i,e,t){switch(i){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function I1(i,e){return(i===1||i===2)&&e<=32&&e%8===0?!1:!(i===3&&(e===16||e===32||e===64))}function b1(i,e,t,n,s,r,o){const a=new DataView(i),l=t===2?o*r:o*r*n,h=t===2?1:n,c=Bc(e,s,l),u=parseInt("1".repeat(s),2);if(e===1){let d;t===1?d=n*s:d=s;let f=r*d;(f&7)!==0&&(f=f+7&-8);for(let g=0;g<o;++g){const _=g*f;for(let m=0;m<r;++m){const y=_+m*h*s;for(let p=0;p<h;++p){const x=y+p*s,E=(g*r+m)*h+p,T=Math.floor(x/8),R=x%8;if(R+s<=8)c[E]=a.getUint8(T)>>8-s-R&u;else if(R+s<=16)c[E]=a.getUint16(T)>>16-s-R&u;else if(R+s<=24){const I=a.getUint16(T)<<8|a.getUint8(T+2);c[E]=I>>24-s-R&u}else c[E]=a.getUint32(T)>>32-s-R&u}}}}return c.buffer}class Dm{constructor(e,t,n,s,r,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=n,this.littleEndian=s,this.tiles=r?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,n=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(s,r){return Pm(this,s,r)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const n=this.getSampleFormat(e),s=this.getBitsPerSample(e);return Bc(n,s,t)}async getTileOrStrip(e,t,n,s,r){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:h}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=n*o*a+t*o+e);let c,u;this.isTiled?(c=this.fileDirectory.TileOffsets[l],u=this.fileDirectory.TileByteCounts[l]):(c=this.fileDirectory.StripOffsets[l],u=this.fileDirectory.StripByteCounts[l]);const d=(await this.source.fetch([{offset:c,length:u}],r))[0];let f;return h===null||!h[l]?(f=(async()=>{let g=await s.decode(this.fileDirectory,d);const _=this.getSampleFormat(),m=this.getBitsPerSample();return I1(_,m)&&(g=b1(g,_,this.planarConfiguration,this.getSamplesPerPixel(),m,this.getTileWidth(),this.getBlockHeight(t))),g})(),h!==null&&(h[l]=f)):f=h[l],{x:e,y:t,sample:n,data:await f}}async _readRaster(e,t,n,s,r,o,a,l,h){const c=this.getTileWidth(),u=this.getTileHeight(),d=this.getWidth(),f=this.getHeight(),g=Math.max(Math.floor(e[0]/c),0),_=Math.min(Math.ceil(e[2]/c),Math.ceil(d/c)),m=Math.max(Math.floor(e[1]/u),0),y=Math.min(Math.ceil(e[3]/u),Math.ceil(f/u)),p=e[2]-e[0];let x=this.getBytesPerPixel();const E=[],T=[];for(let S=0;S<t.length;++S)this.planarConfiguration===1?E.push(v1(this.fileDirectory.BitsPerSample,0,t[S])/8):E.push(0),T.push(this.getReaderForSample(t[S]));const R=[],{littleEndian:I}=this;for(let S=m;S<y;++S)for(let A=g;A<_;++A){let b;this.planarConfiguration===1&&(b=this.getTileOrStrip(A,S,0,r,h));for(let X=0;X<t.length;++X){const O=X,B=t[X];this.planarConfiguration===2&&(x=this.getSampleByteSize(B),b=this.getTileOrStrip(A,S,B,r,h));const K=b.then(Y=>{const W=Y.data,k=new DataView(W),G=this.getBlockHeight(Y.y),q=Y.y*u,Q=Y.x*c,re=q+G,L=(Y.x+1)*c,ue=T[O],z=Math.min(G,G-(re-e[3]),f-q),N=Math.min(c,c-(L-e[2]),d-Q);for(let J=Math.max(0,e[1]-q);J<z;++J)for(let te=Math.max(0,e[0]-Q);te<N;++te){const ge=(J*c+te)*x,Ce=ue.call(k,ge+E[O],I);let Re;s?(Re=(J+q-e[1])*p*t.length+(te+Q-e[0])*t.length+O,n[Re]=Ce):(Re=(J+q-e[1])*p+te+Q-e[0],n[O][Re]=Ce)}});R.push(K)}}if(await Promise.all(R),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let S;return s?S=S1(n,e[2]-e[0],e[3]-e[1],o,a,t.length,l):S=C1(n,e[2]-e[0],e[3]-e[1],o,a,l),S.width=o,S.height=a,S}return n.width=o||e[2]-e[0],n.height=a||e[3]-e[1],n}async readRasters({window:e,samples:t=[],interleave:n,pool:s=null,width:r,height:o,resampleMethod:a,fillValue:l,signal:h}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=c[2]-c[0],d=c[3]-c[1],f=u*d,g=this.getSamplesPerPixel();if(!t||!t.length)for(let p=0;p<g;++p)t.push(p);else for(let p=0;p<t.length;++p)if(t[p]>=g)return Promise.reject(new RangeError(`Invalid sample index '${t[p]}'.`));let _;if(n){const p=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,x=Math.max.apply(null,this.fileDirectory.BitsPerSample);_=Bc(p,x,f*t.length),l&&_.fill(l)}else{_=[];for(let p=0;p<t.length;++p){const x=this.getArrayForSample(t[p],f);Array.isArray(l)&&p<l.length?x.fill(l[p]):l&&!Array.isArray(l)&&x.fill(l),_.push(x)}}const m=s||await Fm(this.fileDirectory);return await this._readRaster(c,t,_,n,m,r,o,a,h)}async readRGB({window:e,interleave:t=!0,pool:n=null,width:s,height:r,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const h=e||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===St.RGB){let y=[0,1,2];if(this.fileDirectory.ExtraSamples!==a1.Unspecified&&a){y=[];for(let p=0;p<this.fileDirectory.BitsPerSample.length;p+=1)y.push(p)}return this.readRasters({window:e,interleave:t,samples:y,pool:n,width:s,height:r,resampleMethod:o,signal:l})}let u;switch(c){case St.WhiteIsZero:case St.BlackIsZero:case St.Palette:u=[0];break;case St.CMYK:u=[0,1,2,3];break;case St.YCbCr:case St.CIELab:u=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const d={window:h,interleave:!0,samples:u,pool:n,width:s,height:r,resampleMethod:o,signal:l},{fileDirectory:f}=this,g=await this.readRasters(d),_=2**this.fileDirectory.BitsPerSample[0];let m;switch(c){case St.WhiteIsZero:m=c1(g,_);break;case St.BlackIsZero:m=h1(g,_);break;case St.Palette:m=u1(g,f.ColorMap);break;case St.CMYK:m=d1(g);break;case St.YCbCr:m=f1(g);break;case St.CIELab:m=p1(g);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const y=new Uint8Array(m.length/3),p=new Uint8Array(m.length/3),x=new Uint8Array(m.length/3);for(let E=0,T=0;E<m.length;E+=3,++T)y[T]=m[E],p[T]=m[E+1],x[T]=m[E+2];m=[y,p,x]}return m.width=g.width,m.height=g.height,m}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let s=r1(n,"Item");e===null?s=s.filter(r=>Zl(r,"sample")===void 0):s=s.filter(r=>Number(Zl(r,"sample"))===e);for(let r=0;r<s.length;++r){const o=s[r];t[Zl(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(n)return n[1]===0&&n[4]===0?[n[0],-n[5],n[10]]:[Math.sqrt(n[0]*n[0]+n[4]*n[4]),-Math.sqrt(n[1]*n[1]+n[5]*n[5]),n[10]];if(e){const[s,r,o]=e.getResolution();return[s*e.getWidth()/this.getWidth(),r*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),n=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[s,r,o,a,l,h,c,u]=this.fileDirectory.ModelTransformation,f=[[0,0],[0,t],[n,0],[n,t]].map(([m,y])=>[a+s*m+r*y,u+l*m+h*y]),g=f.map(m=>m[0]),_=f.map(m=>m[1]);return[Math.min(...g),Math.min(..._),Math.max(...g),Math.max(..._)]}else{const s=this.getOrigin(),r=this.getResolution(),o=s[0],a=s[1],l=o+r[0]*n,h=a+r[1]*t;return[Math.min(o,l),Math.min(a,h),Math.max(o,l),Math.max(a,h)]}}}class A1{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const n=this.getUint32(e,t),s=this.getUint32(e+4,t);let r;if(t){if(r=n+2**32*s,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}if(r=2**32*n+s,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}getInt64(e,t){let n=0;const s=(this._dataView.getUint8(e+(t?7:0))&128)>0;let r=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));s&&(r?a!==0&&(a=~(a-1)&255,r=!1):a=~a&255),n+=a*256**o}return s&&(n=-n),n}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return Pm(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class P1{constructor(e,t,n,s){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=n,this._bigTiff=s}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),n=this.readUint32(e+4);let s;if(this._littleEndian){if(s=t+2**32*n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*t+n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}readInt64(e){let t=0;const n=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let s=!0;for(let r=0;r<8;r++){let o=this._dataView.getUint8(e+(this._littleEndian?r:7-r));n&&(s?o!==0&&(o=~(o-1)&255,s=!1):o=~o&255),t+=o*256**r}return n&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const L1=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class M1{constructor(e=L1,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(n=>{En(()=>import("./decoder-tqM1uIvc.js"),[]).then(s=>{n(s.create)})}),this._awaitingDecoder.then(n=>{this._awaitingDecoder=null,this.workers=[];for(let s=0;s<e;s++)this.workers.push({worker:n(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?Fm(e).then(n=>n.decode(e,t)):new Promise(n=>{const s=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];s.idle=!1;const r=this.messageId++,o=a=>{a.data.id===r&&(s.idle=!0,n(a.data.decoded),s.worker.removeEventListener("message",o))};s.worker.addEventListener("message",o),s.worker.postMessage({fileDirectory:e,buffer:t,id:r},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const Cf=`\r
\r
`;function Om(i){if(typeof Object.fromEntries<"u")return Object.fromEntries(i);const e={};for(const[t,n]of i)e[t.toLowerCase()]=n;return e}function F1(i){const e=i.split(`\r
`).map(t=>{const n=t.split(":").map(s=>s.trim());return n[0]=n[0].toLowerCase(),n});return Om(e)}function D1(i){const[e,...t]=i.split(";").map(s=>s.trim()),n=t.map(s=>s.split("="));return{type:e,params:Om(n)}}function Xc(i){let e,t,n;return i&&([,e,t,n]=i.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),n=parseInt(n,10)),{start:e,end:t,total:n}}function O1(i,e){let t=null;const n=new TextDecoder("ascii"),s=[],r=`--${e}`,o=`${r}--`;for(let a=0;a<10;++a)n.decode(new Uint8Array(i,a,r.length))===r&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<i.byteLength;){const a=n.decode(new Uint8Array(i,t,Math.min(r.length+1024,i.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(r))throw new Error("Part does not start with boundary");const l=a.substr(r.length+2);if(l.length===0)break;const h=l.indexOf(Cf),c=F1(l.substr(0,h)),{start:u,end:d,total:f}=Xc(c["content-range"]),g=t+r.length+h+Cf.length,_=parseInt(d,10)+1-parseInt(u,10);s.push({headers:c,data:i.slice(g,g+_),offset:u,length:_,fileSize:f}),t=g+_+4}return s}class _u{async fetch(e,t=void 0){return Promise.all(e.map(n=>this.fetchSlice(n,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class G1 extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){const s=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:s}):this._set(e,{value:t,expiry:s}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const n=e[t],[s,r]=n;this._deleteIfExpired(s,r)===!1&&(yield[s,r.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const n=e[t],[s,r]=n;this.cache.has(s)||this._deleteIfExpired(s,r)===!1&&(yield[s,r.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[n,s]of this.entriesAscending())e.call(t,s,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function N1(i){return new Promise(e=>setTimeout(e,i))}function k1(i,e){const t=Array.isArray(i)?i:Array.from(i),n=Array.isArray(e)?e:Array.from(e);return t.map((s,r)=>[s,n[r]])}class Xs extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,Xs),this.name="AbortError"}}class U1 extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const B1=U1;class X1{constructor(e,t,n=null){this.offset=e,this.length=t,this.data=n}get top(){return this.offset+this.length}}class wf{constructor(e,t,n){this.offset=e,this.length=t,this.blockIds=n}}class j1 extends _u{constructor(e,{blockSize:t=65536,cacheSize:n=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new G1({maxSize:n,onEviction:(s,r)=>{this.evictedBlocks.set(s,r)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const n=[],s=[],r=[];this.evictedBlocks.clear();for(const{offset:d,length:f}of e){let g=d+f;const{fileSize:_}=this;_!==null&&(g=Math.min(g,_));const m=Math.floor(d/this.blockSize)*this.blockSize;for(let y=m;y<g;y+=this.blockSize){const p=Math.floor(y/this.blockSize);!this.blockCache.has(p)&&!this.blockRequests.has(p)&&(this.blockIdsToFetch.add(p),s.push(p)),this.blockRequests.has(p)&&n.push(this.blockRequests.get(p)),r.push(p)}}await N1(),this.fetchBlocks(t);const o=[];for(const d of s)this.blockRequests.has(d)&&o.push(this.blockRequests.get(d));await Promise.allSettled(n),await Promise.allSettled(o);const a=[],l=r.filter(d=>this.abortedBlockIds.has(d)||!this.blockCache.has(d));if(l.forEach(d=>this.blockIdsToFetch.add(d)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const d of l){const f=this.blockRequests.get(d);if(!f)throw new Error(`Block ${d} is not in the block requests`);a.push(f)}await Promise.allSettled(a)}if(t&&t.aborted)throw new Xs("Request was aborted");const h=r.map(d=>this.blockCache.get(d)||this.evictedBlocks.get(d)),c=h.filter(d=>!d);if(c.length)throw new B1(c,"Request failed");const u=new Map(k1(r,h));return this.readSliceData(e,u)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(t,e);for(let s=0;s<t.length;++s){const r=t[s];for(const o of r.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await n)[s],l=o*this.blockSize,h=l-a.offset,c=Math.min(h+this.blockSize,a.data.byteLength),u=a.data.slice(h,c),d=new X1(l,u.byteLength,u,o);this.blockCache.set(o,d),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let n=[],s=null;const r=[];for(const o of t)s===null||s+1===o?(n.push(o),s=o):(r.push(new wf(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[o],s=o);return r.push(new wf(n[0]*this.blockSize,n.length*this.blockSize,n)),r}readSliceData(e,t){return e.map(n=>{let s=n.offset+n.length;this.fileSize!==null&&(s=Math.min(this.fileSize,s));const r=Math.floor(n.offset/this.blockSize),o=Math.floor(s/this.blockSize),a=new ArrayBuffer(n.length),l=new Uint8Array(a);for(let h=r;h<=o;++h){const c=t.get(h),u=c.offset-n.offset,d=c.top-s;let f=0,g=0,_;u<0?f=-u:u>0&&(g=u),d<0?_=c.length-f:_=s-c.offset-f;const m=new Uint8Array(c.data,f,_);l.set(m,g)}return a})}}class mu{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class pu{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class z1 extends mu{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class V1 extends pu{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const n=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new z1(n)}}class W1 extends mu{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class K1 extends pu{constructRequest(e,t){return new Promise((n,s)=>{const r=new XMLHttpRequest;r.open("GET",this.url),r.responseType="arraybuffer";for(const[o,a]of Object.entries(e))r.setRequestHeader(o,a);r.onload=()=>{const o=r.response;n(new W1(r,o))},r.onerror=s,r.onabort=()=>s(new Xs("Request aborted")),r.send(),t&&(t.aborted&&r.abort(),t.addEventListener("abort",()=>r.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const Jl={};class Y1 extends mu{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class $1 extends pu{constructor(e){super(e),this.parsedUrl=Jl.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Jl)}constructRequest(e,t){return new Promise((n,s)=>{const r=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const h=[];o.on("data",c=>{h.push(c)}),o.on("end",()=>{const c=Buffer.concat(h).buffer;l(c)}),o.on("error",s)});n(new Y1(o,a))});r.on("error",s),t&&(t.aborted&&r.destroy(new Xs("Request aborted")),t.addEventListener("abort",()=>r.destroy(new Xs("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class yu extends _u{constructor(e,t,n,s){super(),this.client=e,this.headers=t,this.maxRanges=n,this.allowFullFile=s,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(n=>this.fetchSlice(n,t))))}async fetchSlices(e,t){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:s,length:r})=>`${s}-${s+r}`).join(",")}`},signal:t});if(n.ok)if(n.status===206){const{type:s,params:r}=D1(n.getHeader("content-type"));if(s==="multipart/byteranges"){const u=O1(await n.getData(),r.boundary);return this._fileSize=u[0].fileSize||null,u}const o=await n.getData(),{start:a,end:l,total:h}=Xc(n.getHeader("content-range"));this._fileSize=h||null;const c=[{data:o,offset:a,length:l-a}];if(e.length>1){const u=await Promise.all(e.slice(1).map(d=>this.fetchSlice(d,t)));return c.concat(u)}return c}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const s=await n.getData();return this._fileSize=s.byteLength,[{data:s,offset:0,length:s.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:n,length:s}=e,r=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+s}`},signal:t});if(r.ok)if(r.status===206){const o=await r.getData(),{total:a}=Xc(r.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:n,length:s}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await r.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Eu(i,{blockSize:e,cacheSize:t}){return e===null?i:new j1(i,{blockSize:e,cacheSize:t})}function H1(i,{headers:e={},credentials:t,maxRanges:n=0,allowFullFile:s=!1,...r}={}){const o=new V1(i,t),a=new yu(o,e,n,s);return Eu(a,r)}function Z1(i,{headers:e={},maxRanges:t=0,allowFullFile:n=!1,...s}={}){const r=new K1(i),o=new yu(r,e,t,n);return Eu(o,s)}function q1(i,{headers:e={},maxRanges:t=0,allowFullFile:n=!1,...s}={}){const r=new $1(i),o=new yu(r,e,t,n);return Eu(o,s)}function jc(i,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?H1(i,t):typeof XMLHttpRequest<"u"?Z1(i,t):q1(i,t)}class J1 extends _u{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((n,s)=>{const r=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>n(a.target.result),o.onerror=s,o.onabort=s,o.readAsArrayBuffer(r),t&&t.addEventListener("abort",()=>o.abort())})}}function Q1(i){return new J1(i)}function zc(i){switch(i){case pe.BYTE:case pe.ASCII:case pe.SBYTE:case pe.UNDEFINED:return 1;case pe.SHORT:case pe.SSHORT:return 2;case pe.LONG:case pe.SLONG:case pe.FLOAT:case pe.IFD:return 4;case pe.RATIONAL:case pe.SRATIONAL:case pe.DOUBLE:case pe.LONG8:case pe.SLONG8:case pe.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${i}`)}}function eR(i){const e=i.GeoKeyDirectory;if(!e)return null;const t={};for(let n=4;n<=e[3]*4;n+=4){const s=l1[e[n]],r=e[n+1]?Mr[e[n+1]]:null,o=e[n+2],a=e[n+3];let l=null;if(!r)l=a;else{if(l=i[r],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${s}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[s]=l}return t}function is(i,e,t,n){let s=null,r=null;const o=zc(e);switch(e){case pe.BYTE:case pe.ASCII:case pe.UNDEFINED:s=new Uint8Array(t),r=i.readUint8;break;case pe.SBYTE:s=new Int8Array(t),r=i.readInt8;break;case pe.SHORT:s=new Uint16Array(t),r=i.readUint16;break;case pe.SSHORT:s=new Int16Array(t),r=i.readInt16;break;case pe.LONG:case pe.IFD:s=new Uint32Array(t),r=i.readUint32;break;case pe.SLONG:s=new Int32Array(t),r=i.readInt32;break;case pe.LONG8:case pe.IFD8:s=new Array(t),r=i.readUint64;break;case pe.SLONG8:s=new Array(t),r=i.readInt64;break;case pe.RATIONAL:s=new Uint32Array(t*2),r=i.readUint32;break;case pe.SRATIONAL:s=new Int32Array(t*2),r=i.readInt32;break;case pe.FLOAT:s=new Float32Array(t),r=i.readFloat32;break;case pe.DOUBLE:s=new Float64Array(t),r=i.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===pe.RATIONAL||e===pe.SRATIONAL)for(let a=0;a<t;a+=2)s[a]=r.call(i,n+a*o),s[a+1]=r.call(i,n+(a*o+4));else for(let a=0;a<t;++a)s[a]=r.call(i,n+a*o);return e===pe.ASCII?new TextDecoder("utf-8").decode(s):s}class tR{constructor(e,t,n){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=n}}class zo extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Gm{async readRasters(e={}){const{window:t,width:n,height:s}=e;let{resX:r,resY:o,bbox:a}=e;const l=await this.getImage();let h=l;const c=await this.getImageCount(),u=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(n||s){if(t){const[g,_]=l.getOrigin(),[m,y]=l.getResolution();a=[g+t[0]*m,_+t[1]*y,g+t[2]*m,_+t[3]*y]}const f=a||u;if(n){if(r)throw new Error("Both width and resX passed");r=(f[2]-f[0])/n}if(s){if(o)throw new Error("Both width and resY passed");o=(f[3]-f[1])/s}}if(r||o){const f=[];for(let g=0;g<c;++g){const _=await this.getImage(g),{SubfileType:m,NewSubfileType:y}=_.fileDirectory;(g===0||m===2||y&1)&&f.push(_)}f.sort((g,_)=>g.getWidth()-_.getWidth());for(let g=0;g<f.length;++g){const _=f[g],m=(u[2]-u[0])/_.getWidth(),y=(u[3]-u[1])/_.getHeight();if(h=_,r&&r>m||o&&o>y)break}}let d=t;if(a){const[f,g]=l.getOrigin(),[_,m]=h.getResolution(l);d=[Math.round((a[0]-f)/_),Math.round((a[1]-g)/m),Math.round((a[2]-f)/_),Math.round((a[3]-g)/m)],d=[Math.min(d[0],d[2]),Math.min(d[1],d[3]),Math.max(d[0],d[2]),Math.max(d[1],d[3])]}return h.readRasters({...e,window:d})}}class js extends Gm{constructor(e,t,n,s,r={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=n,this.firstIFDOffset=s,this.cache=r.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const n=this.bigTiff?4048:1024;return new P1((await this.source.fetch([{offset:e,length:typeof t<"u"?t:n}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,n=this.bigTiff?8:2;let s=await this.getSlice(e);const r=this.bigTiff?s.readUint64(e):s.readUint16(e),o=r*t+(this.bigTiff?16:6);s.covers(e,o)||(s=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let u=0;u<r;l+=t,++u){const d=s.readUint16(l),f=s.readUint16(l+2),g=this.bigTiff?s.readUint64(l+4):s.readUint32(l+4);let _,m;const y=zc(f),p=l+(this.bigTiff?12:8);if(y*g<=(this.bigTiff?8:4))_=is(s,f,g,p);else{const x=s.readOffset(p),E=zc(f)*g;if(s.covers(x,E))_=is(s,f,g,x);else{const T=await this.getSlice(x,E);_=is(T,f,g,x)}}g===1&&o1.indexOf(d)===-1&&!(f===pe.RATIONAL||f===pe.SRATIONAL)?m=_[0]:m=_,a[Mr[d]]=m}const h=eR(a),c=s.readOffset(e+n+t*r);return new tR(a,h,c)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof zo?new zo(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new zo(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new Dm(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(n){if(n instanceof zo)t=!1;else throw n}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",n=t.length+100;let s=await this.getSlice(e,n);if(t===is(s,pe.ASCII,t.length,e)){const o=is(s,pe.ASCII,n,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>n&&(s=await this.getSlice(e,a));const l=is(s,pe.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(h=>h.length>0).map(h=>h.split("=")).forEach(([h,c])=>{this.ghostValues[h]=c})}return this.ghostValues}static async fromSource(e,t,n){const s=(await e.fetch([{offset:0,length:1024}],n))[0],r=new A1(s),o=r.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=r.getUint16(2,a);let h;if(l===42)h=!1;else if(l===43){if(h=!0,r.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=h?r.getUint64(8,a):r.getUint32(4,a);return new js(e,a,h,c,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class iR extends Gm{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,n=0;for(let s=0;s<this.imageFiles.length;s++){const r=this.imageFiles[s];for(let o=0;o<this.imageCounts[s];o++){if(e===t){const a=await r.requestIFD(n);return new Dm(a.fileDirectory,a.geoKeyDirectory,r.dataView,r.littleEndian,r.cache,r.source)}t++,n++}n=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,n)=>t+n,0),this.imageCount}}async function nR(i,e={},t){return js.fromSource(jc(i,e),t)}async function sR(i,e){return js.fromSource(Q1(i),e)}async function rR(i,e=[],t={},n){const s=await js.fromSource(jc(i,t),n),r=await Promise.all(e.map(o=>js.fromSource(jc(o,t))));return new iR(s,r)}const oR=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,aR=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class lR{constructor(e){this.gl_=e,this.program_=Vc(e,aR,oR),this.positionLocation=e.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=e.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=e.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=e.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=e.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.positions),e.STATIC_DRAW),this.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.texcoords),e.STATIC_DRAW)}drawImage(e,t,n,s,r,o,a,l,h,c,u,d,f){const g=this.gl_;l===void 0&&(l=s),h===void 0&&(h=r),o===void 0&&(o=t),a===void 0&&(a=n),c===void 0&&(c=o),u===void 0&&(u=a),d===void 0&&(d=g.canvas.width),f===void 0&&(f=g.canvas.height),g.bindTexture(g.TEXTURE_2D,e),g.useProgram(this.program_),g.bindBuffer(g.ARRAY_BUFFER,this.positionBuffer),g.enableVertexAttribArray(this.positionLocation),g.vertexAttribPointer(this.positionLocation,2,g.FLOAT,!1,0,0),g.bindBuffer(g.ARRAY_BUFFER,this.texcoordBuffer),g.enableVertexAttribArray(this.texcoordLocation),g.vertexAttribPointer(this.texcoordLocation,2,g.FLOAT,!1,0,0);let _=Gc(0,d,0,f,-1,1);_=qT(_,l,h,0),_=$d(_,c,u,1),g.uniformMatrix4fv(this.matrixLocation,!1,_);let m=JT(s/t,r/n,0);m=$d(m,o/t,a/n,1),g.uniformMatrix4fv(this.textureMatrixLocation,!1,m),g.uniform1i(this.textureLocation,0),g.drawArrays(g.TRIANGLES,0,this.positions.length/2)}}function Rf(i,e,t){const n=i.createShader(e);if(n===null)throw new Error("Shader compilation failed");if(i.shaderSource(n,t),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS)){const s=i.getShaderInfoLog(n);throw s===null?new Error("Shader info log creation failed"):new Error(s)}return n}function Vc(i,e,t){const n=i.createProgram(),s=Rf(i,i.VERTEX_SHADER,t),r=Rf(i,i.FRAGMENT_SHADER,e);if(n===null)throw new Error("Program creation failed");if(i.attachShader(n,s),i.attachShader(n,r),i.linkProgram(n),!i.getProgramParameter(n,i.LINK_STATUS))throw i.getProgramInfoLog(n)===null?new Error("Program info log creation failed"):new Error;return n}const cR=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,hR=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,uR=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,dR=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function fR(i,e,t,n){let s;return t&&t.length?s=t.shift():Na?s=new OffscreenCanvas(i||300,e||300):s=document.createElement("canvas"),i&&(s.width=i),e&&(s.height=e),s.getContext("webgl",n)}function gR(i){const e=i.canvas;e.width=1,e.height=1,i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT)}const Sf=[];function _R(i,e,t,n,s,r,o,a,l,h,c,u,d,f){const g=Math.round(n*e),_=Math.round(n*t);i.canvas.width=g,i.canvas.height=_;let m,y;if(y=i.createTexture(),i.bindTexture(i.TEXTURE_2D,y),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),d?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,g,_,0,i.RGBA,c,null),m=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,m),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,y,0),m===null)throw new Error("Could not create framebuffer");if(y===null)throw new Error("Could not create texture");if(l.length===0)return{width:g,height:_,framebuffer:m,texture:y};const p=kt();l.forEach(function(b,X,O){dh(p,b.extent)});let x,E,T;const R=1/s;{if(x=i.createTexture(),y===null)throw new Error("Could not create texture");E=Math.round(Se(p)*R),T=Math.round(Je(p)*R);const b=i.getParameter(i.MAX_TEXTURE_SIZE),X=Math.max(E,T),O=X>b?b/X:1,B=Math.round(E*O),K=Math.round(T*O);i.bindTexture(i.TEXTURE_2D,x),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),d?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,B,K,0,i.RGBA,c,null);const Y=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,Y),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,x,0);const W=new lR(i);l.forEach(function(k,G,q){const Q=(k.extent[0]-p[0])*R*O,re=-(k.extent[3]-p[3])*R*O,L=Se(k.extent)*R*O,ue=Je(k.extent)*R*O;if(i.bindFramebuffer(i.FRAMEBUFFER,Y),i.viewport(0,0,B,K),k.clipExtent){const z=(k.clipExtent[0]-p[0])*R*O,N=-(k.clipExtent[3]-p[3])*R*O,J=Se(k.clipExtent)*R*O,te=Je(k.clipExtent)*R*O;i.enable(i.SCISSOR_TEST),i.scissor(d?z:Math.round(z),d?N:Math.round(N),d?J:Math.round(z+J)-Math.round(z),d?te:Math.round(N+te)-Math.round(N))}W.drawImage(k.texture,k.width,k.height,h,h,k.width-2*h,k.height-2*h,d?Q:Math.round(Q),d?re:Math.round(re),d?L:Math.round(Q+L)-Math.round(Q),d?ue:Math.round(re+ue)-Math.round(re),B,K),i.disable(i.SCISSOR_TEST)}),i.deleteFramebuffer(Y)}const I=Xi(o),S=Xi(p),A=b=>{const X=(b[0][0]-I[0])/r*n,O=-(b[0][1]-I[1])/r*n,B=(b[1][0]-I[0])/r*n,K=-(b[1][1]-I[1])/r*n,Y=(b[2][0]-I[0])/r*n,W=-(b[2][1]-I[1])/r*n;return{u1:B,v1:K,u0:X,v0:O,u2:Y,v2:W}};i.bindFramebuffer(i.FRAMEBUFFER,m),i.viewport(0,0,g,_);{const b=[],X=[],O=Vc(i,dR,uR);i.useProgram(O);const B=i.getUniformLocation(O,"u_texture");i.bindTexture(i.TEXTURE_2D,x),i.uniform1i(B,0),a.getTriangles().forEach(function(Q,re,L){const ue=Q.source,z=Q.target,{u1:N,v1:J,u0:te,v0:ge,u2:Ce,v2:Re}=A(z),Jt=(ue[0][0]-S[0])/s/E,C=-(ue[0][1]-S[1])/s/T,w=(ue[1][0]-S[0])/s/E,P=-(ue[1][1]-S[1])/s/T,F=(ue[2][0]-S[0])/s/E,M=-(ue[2][1]-S[1])/s/T;b.push(N,J,te,ge,Ce,Re),X.push(w,P,Jt,C,F,M)});const K=Gc(0,g,_,0,-1,1),Y=i.getUniformLocation(O,"u_matrix");i.uniformMatrix4fv(Y,!1,K);const W=i.getAttribLocation(O,"a_position"),k=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,k),i.bufferData(i.ARRAY_BUFFER,new Float32Array(b),i.STATIC_DRAW),i.vertexAttribPointer(W,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(W);const G=i.getAttribLocation(O,"a_texcoord"),q=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,q),i.bufferData(i.ARRAY_BUFFER,new Float32Array(X),i.STATIC_DRAW),i.vertexAttribPointer(G,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(G),i.drawArrays(i.TRIANGLES,0,b.length/2)}if(u){const b=Vc(i,hR,cR);i.useProgram(b);const X=Gc(0,g,_,0,-1,1),O=i.getUniformLocation(b,"u_matrix");i.uniformMatrix4fv(O,!1,X);const B=Array.isArray(u)?u:[0,0,0,255],K=i.getUniformLocation(b,"u_val");i.uniform4fv(K,B);const Y=i.getAttribLocation(b,"a_position"),W=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,W),i.vertexAttribPointer(Y,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(Y);const k=a.getTriangles().reduce(function(G,q){const Q=q.target,{u1:re,v1:L,u0:ue,v0:z,u2:N,v2:J}=A(Q);return G.concat([re,L,ue,z,ue,z,N,J,N,J,re,L])},[]);i.bufferData(i.ARRAY_BUFFER,new Float32Array(k),i.STATIC_DRAW),i.drawArrays(i.LINES,0,k.length/2)}return{width:g,height:_,framebuffer:m,texture:y}}class mR extends eo{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:e.interpolate,transition:e.transition}),this.renderEdges_=e.renderEdges!==void 0?e.renderEdges:!1,this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=e.sourceProj,n=t.getExtent(),s=e.sourceTileGrid.getExtent();this.clipExtent_=t.canWrapX()?s?xt(n,s):n:s;const r=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),o=this.targetTileGrid_.getExtent();let a=this.sourceTileGrid_.getExtent();const l=o?xt(r,o):r;if(Xr(l)===0){this.state=Z.EMPTY;return}n&&(a?a=xt(a,n):a=n);const h=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),c=e.targetProj,u=z_(t,c,l,h);if(!isFinite(u)||u<=0){this.state=Z.EMPTY;return}const d=e.errorThreshold!==void 0?e.errorThreshold:W_;if(this.triangulation_=new V_(t,c,l,a,u*d,h,e.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=Z.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(u);let f=this.triangulation_.calculateSourceExtent();if(a&&(t.canWrapX()?(f[1]=Ge(f[1],a[1],a[3]),f[3]=Ge(f[3],a[1],a[3])):f=xt(f,a)),!Xr(f))this.state=Z.EMPTY;else{let g=0,_=0;t.canWrapX()&&(g=Se(n),_=Math.floor((f[0]-n[0])/g)),_h(f.slice(),t,!0).forEach(y=>{const p=this.sourceTileGrid_.getTileRangeForExtentAndZ(y,this.sourceZ_),x=e.getTileFunction;for(let E=p.minX;E<=p.maxX;E++)for(let T=p.minY;T<=p.maxY;T++){const R=x(this.sourceZ_,E,T,this.pixelRatio_);if(R){const I=_*g;this.sourceTiles_.push({tile:R,offset:I})}}++_}),this.sourceTiles_.length===0&&(this.state=Z.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];let t=!1;if(this.sourceTiles_.forEach(E=>{const T=E.tile;if(!T||T.getState()!==Z.LOADED)return;const R=T.getSize(),I=this.gutter_;let S;const A=Oc(T.getData());A?S=A:(t=!0,S=kT(Ns(T.getData())));const b=[R[0]+2*I,R[1]+2*I],X=S instanceof Float32Array,O=b[0]*b[1],B=X?Float32Array:Uint8ClampedArray,K=new B(S.buffer),Y=B.BYTES_PER_ELEMENT,W=Y*K.length/O,k=K.byteLength/b[1],G=Math.floor(k/Y/b[0]),q=this.sourceTileGrid_.getTileCoordExtent(T.tileCoord);q[0]+=E.offset,q[2]+=E.offset;const Q=this.clipExtent_?.slice();Q&&(Q[0]+=E.offset,Q[2]+=E.offset),e.push({extent:q,clipExtent:Q,data:K,dataType:B,bytesPerPixel:W,pixelSize:b,bandCount:G})}),this.sourceTiles_.length=0,e.length===0){this.state=Z.ERROR,this.changed();return}const n=this.wrappedTileCoord_[0],s=this.targetTileGrid_.getTileSize(n),r=typeof s=="number"?s:s[0],o=typeof s=="number"?s:s[1],a=r*this.pixelRatio_,l=o*this.pixelRatio_,h=this.targetTileGrid_.getResolution(n),c=this.sourceTileGrid_.getResolution(this.sourceZ_),u=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),d=e[0].bandCount,f=new e[0].dataType(d*a*l),g=fR(a,l,Sf,{premultipliedAlpha:!1,antialias:!1});let _;const m=g.RGBA;let y;e[0].dataType==Float32Array?(y=g.FLOAT,g.getExtension("WEBGL_color_buffer_float"),g.getExtension("OES_texture_float"),g.getExtension("EXT_float_blend"),_=g.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(y=g.UNSIGNED_BYTE,_=this.interpolate);const p=4,x=Math.ceil(d/p);for(let E=x-1;E>=0;--E){const T=[];for(let B=0,K=e.length;B<K;++B){const Y=e[B],W=Y.pixelSize,k=W[0],G=W[1],q=new Y.dataType(p*k*G),Q=Y.data;let re=E*p;for(let ue=0,z=q.length;ue<z;ue+=p)q[ue]=Q[re],q[ue+1]=Q[re+1],q[ue+2]=Q[re+2],q[ue+3]=Q[re+3],re+=d;const L=g.createTexture();g.bindTexture(g.TEXTURE_2D,L),_?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR)):(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST)),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texImage2D(g.TEXTURE_2D,0,m,k,G,0,m,y,q),T.push({extent:Y.extent,clipExtent:Y.clipExtent,texture:L,width:k,height:G})}const{framebuffer:R,width:I,height:S}=_R(g,r,o,this.pixelRatio_,c,h,u,this.triangulation_,T,this.gutter_,y,this.renderEdges_,_),A=I,b=S*p,X=new e[0].dataType(A*b);g.bindFramebuffer(g.FRAMEBUFFER,R),g.readPixels(0,0,I,S,g.RGBA,y,X);let O=E*p;for(let B=0,K=X.length;B<K;B+=p){const Y=(A-1-(B/b|0))*b+B%b;f[O]=X[Y],f[O+1]=X[Y+1],f[O+2]=X[Y+2],f[O+3]=X[Y+3],O+=d}}if(gR(g),Sf.push(g.canvas),t){const E=Ve(r,o),T=new ImageData(f,r);E.putImageData(T,0,0),this.reprojData_=E.canvas}else this.reprojData_=f;this.reprojSize_=[Math.round(a),Math.round(l)],this.state=Z.LOADED,this.changed()}load(){if(this.state!==Z.IDLE&&this.state!==Z.ERROR)return;this.state=Z.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const n=t.getState();if(n!==Z.IDLE&&n!==Z.LOADING)return;e++;const s=we(t,ae.CHANGE,()=>{const r=t.getState();(r==Z.LOADED||r==Z.ERROR||r==Z.EMPTY)&&(Oe(s),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t}){t.getState()==Z.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(Oe),this.sourcesListenerKeys_=null}}class pR extends mm{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let n=e.tileGrid;n===void 0&&t&&(n=gm({extent:ll(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:n,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?We(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.crossOrigin_=e.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?We(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return(!t||kn(t,e))&&!this.transformMatrix?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,n,s,r){const o=this.tileGrid||this.getTileGridForProjection(r||s),a=Math.max.apply(null,o.getResolutions().map((f,g)=>{const _=We(o.getTileSize(g)),m=this.getTileSize(g);return Math.max(m[0]/_[0],m[1]/_[1])})),l=this.getTileGridForProjection(s),h=[e,t,n],c=this.getTileCoordForTileUrlFunction(h,s),u=Object.assign({sourceProj:r||s,sourceTileGrid:o,targetProj:s,targetTileGrid:l,tileCoord:h,wrappedTileCoord:c,pixelRatio:a,gutter:this.gutter_,getTileFunction:(f,g,_,m)=>this.getTile(f,g,_,m),transformMatrix:this.transformMatrix},this.tileOptions),d=new mR(u);return d.key=this.getKey(),d}getTile(e,t,n,s,r){const o=this.getProjection();if(r&&(o&&!kn(o,r)||this.transformMatrix))return this.getReprojTile_(e,t,n,r,o);const a=this.getTileSize(e),l=this.loader_,h=new AbortController,c={signal:h.signal,crossOrigin:this.crossOrigin_},u=this.getTileCoordForTileUrlFunction([e,t,n]);if(!u)return null;const d=u[0],f=u[1],g=u[2],_=this.getTileGrid()?.getFullTileRange(d);_&&(c.maxY=_.getHeight()-1);function m(){return zg(function(){return l(d,f,g,c)})}const y=Object.assign({tileCoord:[e,t,n],loader:m,size:a,controller:h},this.tileOptions),p=new eo(y);return p.key=this.getKey(),p.addEventListener(ae.CHANGE,this.handleTileChange_),p}handleTileChange_(e){const t=e.target,n=ne(t),s=t.getState();let r;s==Z.LOADING?(this.tileLoadingKeys_[n]=!0,r=vs.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],r=s==Z.ERROR?vs.TILELOADERROR:s==Z.LOADED?vs.TILELOADEND:void 0),r&&this.dispatchEvent(new pm(r,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||kn(t,e))&&!this.transformMatrix)return this.tileGrid;const n=ne(e);return n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=lu(e)),this.tileGridForProjection_[n]}setTileGridForProjection(e,t){const n=ke(e);if(n){const s=ne(n);s in this.tileGridForProjection_||(this.tileGridForProjection_[s]=t)}}}function yR(i){return((i.fileDirectory.NewSubfileType||0)&4)===4}function ER(i,e){if(!i)return!1;if(i===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,n=St;return t===n.CMYK||t===n.YCbCr||t===n.CIELab||t===n.ICCLab}const vf="STATISTICS_MAXIMUM",If="STATISTICS_MINIMUM",Ql=256;let ec;function xR(){return ec||(ec=new M1),ec}function TR(i){try{return i.getBoundingBox(!0)}catch{return[0,0,i.getWidth(),i.getHeight()]}}function CR(i){try{return i.getOrigin().slice(0,2)}catch{return[0,i.getHeight()]}}function wR(i,e){try{return i.getResolution(e)}catch{return[e.getWidth()/i.getWidth(),e.getHeight()/i.getHeight()]}}function RR(i){const e=i.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let n=ke(t);if(!n){const s=od(e.ProjLinearUnitsGeoKey);s&&(n=new jr({code:t,units:s}))}return n}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const t="EPSG:"+e.GeographicTypeGeoKey;let n=ke(t);if(!n){const s=od(e.GeogAngularUnitsGeoKey);s&&(n=new jr({code:t,units:s}))}return n}return null}function SR(i){return i.getImageCount().then(function(e){const t=new Array(e);for(let n=0;n<e;++n)t[n]=i.getImage(n);return Promise.all(t)})}function vR(i,e){let t;return i.blob?t=sR(i.blob):i.overviews?t=rR(i.url,i.overviews,e):t=nR(i.url,e),t.then(SR)}function xr(i,e,t,n,s){if(Array.isArray(i)){const r=i.length;if(!Array.isArray(e)||r!=e.length){const o=new Error(n);throw s(o),o}for(let o=0;o<r;++o)xr(i[o],e[o],t,n,s);return}if(e=e,Math.abs(i-e)>t*i)throw new Error(n)}function IR(i){return i instanceof Int8Array?-128:i instanceof Int16Array?-32768:i instanceof Int32Array?-2147483648:i instanceof Float32Array?12e-39:0}function bR(i){return i instanceof Int8Array?127:i instanceof Uint8Array||i instanceof Uint8ClampedArray?255:i instanceof Int16Array?32767:i instanceof Uint16Array?65535:i instanceof Int32Array?2147483647:i instanceof Uint32Array?4294967295:i instanceof Float32Array?34e37:255}class AR extends pR{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(r=>r.url).join(","));const n=this,s=new Array(t);for(let r=0;r<t;++r)s[r]=vR(this.sourceInfo_[r],this.sourceOptions_);Promise.all(s).then(function(r){n.configure_(r)}).catch(function(r){rd(r),n.error_=r,n.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let n=t.length-1;n>=0;--n){const s=t[n],r=RR(s);if(r){this.projection=r;break}}}determineTransformMatrix(e){const t=e[0];for(let n=t.length-1;n>=0;--n){const r=t[n].fileDirectory.ModelTransformation;if(r){const[o,a,l,h,c,u,d,f]=r,g=Wr(Wr([1/Math.sqrt(o*o+c*c),0,0,-1/Math.sqrt(a*a+u*u),h,f],[o,c,a,u,0,0]),[1,0,0,1,-h,-f]);this.transformMatrix=g,this.addAlpha_=!0;break}}}configure_(e){let t,n,s,r,o;const a=new Array(e.length),l=new Array(e.length),h=new Array(e.length);let c=0;const u=e.length;for(let m=0;m<u;++m){const y=[],p=[];e[m].forEach(A=>{yR(A)?p.push(A):y.push(A)});const x=y.length;if(p.length>0&&p.length!==x)throw new Error(`Expected one mask per image found ${p.length} masks and ${x} images`);let E,T;const R=new Array(x),I=new Array(x),S=new Array(x);l[m]=new Array(x),h[m]=new Array(x);for(let A=0;A<x;++A){const b=y[A],X=b.getGDALNoData();h[m][A]=b.getGDALMetadata(0),l[m][A]=X;const O=this.sourceInfo_[m].bands;a[m]=O?O.length:b.getSamplesPerPixel();const B=x-(A+1);E||(E=TR(b)),T||(T=CR(b));const K=wR(b,y[0]);S[B]=K[0];const Y=[b.getTileWidth(),b.getTileHeight()];Y[0]!==Y[1]&&Y[1]<Ql&&(Y[0]=Ql,Y[1]=Ql),R[B]=Y;const W=K[0]/Math.abs(K[1]);I[B]=[Y[0],Y[1]/W]}if(t?xt(t,E,t):t=E,!n)n=T;else{const A=`Origin mismatch for source ${m}, got [${T}] but expected [${n}]`;xr(n,T,0,A,this.viewRejector)}if(!o)o=S,this.resolutionFactors_[m]=1;else{o.length-c>S.length&&(c=o.length-S.length);const A=o[o.length-1]/S[S.length-1];this.resolutionFactors_[m]=A;const b=S.map(O=>O*=A),X=`Resolution mismatch for source ${m}, got [${b}] but expected [${o}]`;xr(o.slice(c,o.length),b,.02,X,this.viewRejector)}s?xr(s.slice(c,s.length),I,.01,`Tile size mismatch for source ${m}`,this.viewRejector):s=I,r?xr(r.slice(c,r.length),R,0,`Tile size mismatch for source ${m}`,this.viewRejector):r=R,this.sourceImagery_[m]=y.reverse(),this.sourceMasks_[m]=p.reverse()}for(let m=0,y=this.sourceImagery_.length;m<y;++m){const p=this.sourceImagery_[m];for(;p.length<o.length;)p.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=h;e:for(let m=0;m<u;++m){if(this.sourceInfo_[m].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[m].length){this.addAlpha_=!0;break}const y=l[m],p=this.sourceInfo_[m].bands;if(p){for(let x=0;x<p.length;++x)if(y[p[x]-1]!==null){this.addAlpha_=!0;break e}continue}for(let x=0;x<y.length;++x)if(y[x]!==null){this.addAlpha_=!0;break e}}let d=this.addAlpha_?1:0;for(let m=0;m<u;++m)d+=a[m];this.bandCount=d;const f=new au({extent:t,minZoom:c,origin:n,resolutions:o,tileSizes:s});this.tileGrid=f,this.setTileSizes(r),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const g=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]);let _=t;if(this.transformMatrix){const m=wh(ht(),this.transformMatrix.slice()),y=o_(p=>Ke(m,p));_=My(t,y)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:fn(xi(_),this.projection),extent:Wa(_,this.projection),zoom:g})}loadTile_(e,t,n,s){const r=this.getTileSize(e),o=this.sourceImagery_.length,a=new Array(o*2),l=this.nodataValues_,h=this.sourceInfo_,c=xR();for(let u=0;u<o;++u){const d=h[u],f=this.resolutionFactors_[u],g=[Math.round(t*(r[0]*f)),Math.round(n*(r[1]*f)),Math.round((t+1)*(r[0]*f)),Math.round((n+1)*(r[1]*f))],_=this.sourceImagery_[u][e];let m;d.bands&&(m=d.bands.map(function(T){return T-1}));let y;"nodata"in d&&d.nodata!==null?y=d.nodata:m?y=m.map(function(T){return l[u][T]}):y=l[u];const p={window:g,width:r[0],height:r[1],samples:m,fillValue:y,pool:c,interleave:!1,signal:s.signal};ER(this.convertToRGB_,_)?a[u]=_.readRGB(p):a[u]=_.readRasters(p);const x=o+u,E=this.sourceMasks_[u][e];if(!E){a[x]=Promise.resolve(null);continue}a[x]=E.readRasters({window:g,width:r[0],height:r[1],samples:[0],pool:c,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,r)).catch(function(u){throw rd(u),u})}composeTile_(e,t){const n=this.metadata_,s=this.sourceInfo_,r=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,h=this.normalize_,c=this.addAlpha_,u=e[0]*e[1],d=u*o;let f;h?f=new Uint8Array(d):f=new Float32Array(d);let g=0;for(let _=0;_<u;++_){let m=c;for(let y=0;y<r;++y){const p=s[y];let x=p.min,E=p.max,T,R;if(h){const I=n[y][0];x===void 0&&(I&&If in I?x=parseFloat(I[If]):x=IR(t[y][0])),E===void 0&&(I&&vf in I?E=parseFloat(I[vf]):E=bR(t[y][0])),T=255/(E-x),R=-x*T}for(let I=0;I<a[y];++I){const S=t[y][I][_];let A;if(h?A=Ge(T*S+R,0,255):A=S,!c)f[g]=A;else{let b=p.nodata;if(b===void 0){let O;p.bands?O=p.bands[I]-1:O=I,b=l[y][O]}const X=isNaN(b);(!X&&S!==b||X&&!isNaN(S))&&(m=!1,f[g]=A)}g++}if(!m){const I=r+y,S=t[I];S&&!S[0][_]&&(m=!0)}}c&&(m||(f[g]=255),g++)}return f}}const tc="units",PR=[1,2,5],dr=25.4/.28;class LR extends qa{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const n=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+go,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(tc,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(tc)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(tc,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,n=e.projection,s=this.getUnits(),r=s=="degrees"?"degrees":"m";let o=ga(n,e.resolution,t,r);const a=this.minWidth_*(this.dpi_||dr)/dr,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||dr)/dr:void 0;let h=a*o,c="";if(s=="degrees"){const x=Fs.degrees;h*=x,h<x/60?(c="",o*=3600):h<x?(c="",o*=60):c=""}else if(s=="imperial")h<.9144?(c="in",o/=.0254):h<1609.344?(c="ft",o/=.3048):(c="mi",o/=1609.344);else if(s=="nautical")o/=1852,c="NM";else if(s=="metric")h<1e-6?(c="nm",o*=1e9):h<.001?(c="m",o*=1e6):h<1?(c="mm",o*=1e3):h<1e3?c="m":(c="km",o/=1e3);else if(s=="us")h<.9144?(c="in",o*=39.37):h<1609.344?(c="ft",o/=.30480061):(c="mi",o/=1609.3472);else throw new Error("Invalid units");let u=3*Math.floor(Math.log(a*o)/Math.log(10)),d,f,g,_=0,m,y;for(;;){g=Math.floor(u/3);const x=Math.pow(10,g);if(d=PR[(u%3+3)%3]*x,f=Math.round(d/o),isNaN(f)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&f>=l){d=_,f=m,g=y;break}else if(f>=a)break;_=d,m=f,y=g,++u}const p=this.scaleBar_?this.createScaleBar(f,d,c):d.toFixed(g<0?-g:0)+" "+c;this.renderedHTML_!=p&&(this.innerElement_.innerHTML=p,this.renderedHTML_=p),this.renderedWidth_!=f&&(this.innerElement_.style.width=f+"px",this.renderedWidth_=f),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,n){const s=this.getScaleForResolution(),r=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),o=this.scaleBarSteps_,a=e/o,l=[this.createMarker("absolute")];for(let c=0;c<o;++c){const u=c%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${u}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(c%2===0||o===2?this.createStepText(c,e,!1,t,n):"")+"</div>")}return l.push(this.createStepText(o,e,!0,t,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+r+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,n,s,r){const a=(e===0?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+r),l=e===0?-3:t/this.scaleBarSteps_*-1,h=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${e===0?"left":"center"};min-width: ${h}px;left: ${n?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=ga(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||dr,n=1e3/25.4;return e*n*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}const Vo={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class Wo extends qt{constructor(e,t){super(e),this.feature=t}}function MR(i,e){const t=[];for(let n=0;n<e.length;++n){const r=e[n].getGeometry();Nm(i,r,t)}return t}function Ko(i,e){return Gi(i[0],i[1],e[0],e[1])}function _s(i,e){const t=i.length;return e<0?i[e+t]:e>=t?i[e-t]:i[e]}function Yo(i,e,t){let n,s;e<t?(n=e,s=t):(n=t,s=e);const r=Math.ceil(n),o=Math.floor(s);if(r>o){const l=ms(i,n),h=ms(i,s);return Ko(l,h)}let a=0;if(n<r){const l=ms(i,n),h=_s(i,r);a+=Ko(l,h)}if(o<s){const l=_s(i,o),h=ms(i,s);a+=Ko(l,h)}for(let l=r;l<o-1;++l){const h=_s(i,l),c=_s(i,l+1);a+=Ko(h,c)}return a}function Nm(i,e,t){if(e instanceof pi){$o(i,e.getCoordinates(),!1,t);return}if(e instanceof Us){const n=e.getCoordinates();for(let s=0,r=n.length;s<r;++s)$o(i,n[s],!1,t);return}if(e instanceof Ti){const n=e.getCoordinates();for(let s=0,r=n.length;s<r;++s)$o(i,n[s],!0,t);return}if(e instanceof Bs){const n=e.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,l=o.length;a<l;++a)$o(i,o[a],!0,t)}return}if(e instanceof no){const n=e.getGeometries();for(let s=0;s<n.length;++s)Nm(i,n[s],t);return}}const ic={index:-1,endIndex:NaN};function FR(i,e,t,n){const s=i[0],r=i[1];let o=1/0,a=-1,l=NaN;for(let u=0;u<e.targets.length;++u){const d=e.targets[u],f=d.coordinates;let g=1/0,_;for(let m=0;m<f.length-1;++m){const y=f[m],p=f[m+1],x=km(s,r,y,p);x.squaredDistance<g&&(g=x.squaredDistance,_=m+x.along)}g<o&&(o=g,d.ring&&e.targetIndex===u&&(d.endIndex>d.startIndex?_<d.startIndex&&(_+=f.length):d.endIndex<d.startIndex&&_>d.startIndex&&(_-=f.length)),l=_,a=u)}const h=e.targets[a];let c=h.ring;if(e.targetIndex===a&&c){const u=ms(h.coordinates,l),d=t.getPixelFromCoordinate(u);ua(d,e.startPx)>n&&(c=!1)}if(c){const u=h.coordinates,d=u.length,f=h.startIndex,g=l;if(f<g){const _=Yo(u,f,g);Yo(u,f,g-d)<_&&(l-=d)}else{const _=Yo(u,f,g);Yo(u,f,g+d)<_&&(l+=d)}}return ic.index=a,ic.endIndex=l,ic}function $o(i,e,t,n){const s=i[0],r=i[1];for(let o=0,a=e.length-1;o<a;++o){const l=e[o],h=e[o+1],c=km(s,r,l,h);if(c.squaredDistance===0){const u=o+c.along;n.push({coordinates:e,ring:t,startIndex:u,endIndex:u});return}}}const nc={along:0,squaredDistance:0};function km(i,e,t,n){const s=t[0],r=t[1],o=n[0],a=n[1],l=o-s,h=a-r;let c=0,u=s,d=r;return(l!==0||h!==0)&&(c=Ge(((i-s)*l+(e-r)*h)/(l*l+h*h),0,1),u+=l*c,d+=h*c),nc.along=c,nc.squaredDistance=ho(Gi(i,e,u,d),10),nc}function ms(i,e){const t=i.length;let n=Math.floor(e);const s=e-n;n>=t?n-=t:n<0&&(n+=t);let r=n+1;r>=t&&(r-=t);const o=i[n],a=o[0],l=o[1],h=i[r],c=h[0]-a,u=h[1]-l;return[a+c*s,l+u*s]}class DR extends Vn{constructor(e){const t=e;t.stopDown||(t.stopDown=zs),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=GR(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:un,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let n=e.geometryFunction;if(!n){const s=this.mode_;if(s==="Circle")n=(r,o,a)=>{const l=o||new al([NaN,NaN]),h=Be(r[0]),c=Ms(h,Be(r[r.length-1]));return l.setCenterAndRadius(h,Math.sqrt(c),this.geometryLayout_),l};else{let r;s==="Point"?r=Zt:s==="LineString"?r=pi:s==="Polygon"&&(r=Ti),n=(o,a,l)=>(a?s==="Polygon"?o[0].length?a.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(o,this.geometryLayout_):a=new r(o,this.geometryLayout_),a)}}this.geometryFunction_=n,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new io({source:new Sa({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:OR(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Bh,this.freehandCondition_,e.freehand?this.freehandCondition_=ya:this.freehandCondition_=e.freehandCondition?e.freehandCondition:Xh,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(Ac.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=ya:t=e:t=Lc,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===ae.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===Te.POINTERMOVE,n=!0;return!this.freehand_&&this.lastDragTime_&&e.type===Te.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===Te.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),n=!1):this.freehand_&&e.type===Te.POINTERDOWN?n=!1:t&&this.getPointerCount()<2?(n=e.type===Te.POINTERMOVE,n&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===Te.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===Te.DBLCLICK&&(n=!1),super.handleEvent(e)&&n}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Li(Te.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),n=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),s=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),r=ft([n,s]),o=this.traceSource_.getFeaturesInExtent(r);if(o.length===0)return;const a=MR(e.coordinate,o);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const n=e.startIndex<=e.endIndex,s=e.startIndex<=t;n===s?n&&t>e.endIndex||!n&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(n&&t<e.endIndex||!n&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let n=0;if(e<t){const s=Math.ceil(e);let r=Math.floor(t);r===t&&(r-=1),n=r-s+1}else{const s=Math.floor(e);let r=Math.ceil(t);r===t&&(r+=1),n=s-r+1}n>0&&this.removeLastPoints_(n)}addTracedCoordinates_(e,t,n){if(t===n)return;const s=[];if(t<n){const r=Math.ceil(t);let o=Math.floor(n);o===n&&(o-=1);for(let a=r;a<=o;++a)s.push(_s(e.coordinates,a))}else{const r=Math.floor(t);let o=Math.ceil(n);o===n&&(o+=1);for(let a=r;a>=o;--a)s.push(_s(e.coordinates,a))}s.length&&this.appendCoordinates(s)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&ua(t.startPx,e.pixel)<this.snapTolerance_)return;const n=FR(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==n.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const a=t.targets[n.index];this.addTracedCoordinates_(a,a.startIndex,n.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,n.endIndex)}t.targetIndex=n.index;const s=t.targets[t.targetIndex];s.endIndex=n.endIndex;const r=ms(s.coordinates,s.endIndex),o=this.getMap().getPixelFromCoordinate(r);e.coordinate=r,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const n=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(e.coordinate),!s&&this.freehand_?this.finishDrawing():!this.freehand_&&(!s||this.mode_==="Point")&&(this.atFinish_(e.pixel,n)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,n=e.pixel,s=t[0]-n[0],r=t[1]-n[1],o=s*s+r*r;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let n=!1;if(this.sketchFeature_){let s=!1,r=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")n=!0;else if(o==="Circle")n=this.sketchCoords_.length===2;else if(o==="LineString")s=!t&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const a=this.sketchCoords_;s=a[0].length>this.minPoints_,r=[a[0][0],a[0][a[0].length-2]],t?r=[a[0][0]]:r=[a[0][0],a[0][a[0].length-2]]}if(s){const a=this.getMap();for(let l=0,h=r.length;l<h;l++){const c=r[l],u=a.getPixelFromCoordinate(c),d=e[0]-u[0],f=e[1]-u[1],g=this.freehand_?1:this.snapTolerance_;if(n=Math.sqrt(d*d+f*f)<=g,n){this.finishCoordinate_=c;break}}}}return n}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Pt(new Zt(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new Pt);const t=e.getLinearRing(0);let n=this.sketchLine_.getGeometry();n?(n.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),n.changed()):(n=new pi(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(n))}startDrawing_(e){const t=this.getMap().getView().getProjection(),n=_a(this.geometryLayout_);for(;e.length<n;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Pt(new pi(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new Pt,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new Wo(Vo.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),n=this.sketchFeature_.getGeometry(),s=t.getView().getProjection(),r=_a(this.geometryLayout_);let o,a;for(;e.length<r;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],a=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,a=o[o.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,n,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),n.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(n):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection();let s,r;const o=this.mode_;return o==="LineString"||o==="Circle"?(this.finishCoordinate_=e.slice(),r=this.sketchCoords_,r.length>=this.maxPoints_&&(this.freehand_?r.pop():s=!0),r.push(e.slice()),this.geometryFunction_(r,t,n)):o==="Polygon"&&(r=this.sketchCoords_[0],r.length>=this.maxPoints_&&(this.freehand_?r.pop():s=!0),r.push(e.slice()),s&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,t,n)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),s?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection(),s=this.mode_;for(let r=0;r<e;++r){let o;if(s==="LineString"||s==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const a=this.finishCoordinate_.slice();o[o.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(o,t,n),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(s==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const a=this.sketchLine_.getGeometry();if(o.length>=2){const l=o[o.length-2].slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}a.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,n)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const n=e.getGeometry(),s=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,n,s)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,n,s),t=n.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new po([t])):this.type_==="MultiLineString"?e.setGeometry(new Us([t])):this.type_==="MultiPolygon"&&e.setGeometry(new Bs([t])),this.dispatchEvent(new Wo(Vo.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new Wo(Vo.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,n=!this.sketchFeature_;n&&this.startDrawing_(e[0]);let s;if(t==="LineString"||t==="Circle")s=this.sketchCoords_;else if(t==="Polygon")s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;n&&s.shift(),s.pop();for(let o=0;o<e.length;o++)this.addToDrawing_(e[o]);const r=e[e.length-1];this.sketchFeature_=this.addToDrawing_(r),this.modifyDrawing_(r)}extend(e){const n=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=n.getCoordinates();const s=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=s.slice(),this.sketchCoords_.push(s.slice()),this.sketchPoint_=new Pt(new Zt(s)),this.updateSketchFeatures_(),this.dispatchEvent(new Wo(Vo.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function OR(){const i=Zh();return function(e,t){return i[e.getGeometry().getType()]}}function GR(i){switch(i){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+i)}}const bf=0,Fr=1,Af=[0,0,0,0],bs=[],sc={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class rc extends qt{constructor(e,t,n){super(e),this.features=t,this.mapBrowserEvent=n}}class NR extends Vn{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:w_,this.defaultDeleteCondition_=function(n){return tx(n)&&T_(n)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:ya,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Uc,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new io({source:new Sa({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:UR(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new Nt(this.source_.getFeatures()),this.source_.addEventListener(vt.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(vt.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Ye.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Ye.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const s=this.SEGMENT_WRITERS_[t.getType()];s&&s(e,t)}const n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(n.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(ae.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Nt;const n=this.featuresBeingModified_.getArray();for(let s=0,r=t.length;s<r;++s){const o=t[s].feature;o&&!n.includes(o)&&this.featuresBeingModified_.push(o)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new rc(sc.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(ae.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,n=[];t.forEach(function(s){e===s.feature&&n.push(s)});for(let s=n.length-1;s>=0;--s){const r=n[s];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===r&&this.dragSegments_.splice(o,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const n=t.getCoordinates(),s={feature:e,geometry:t,segment:[n,n]};this.rBush_.insert(t.getExtent(),s)}writeMultiPointGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s],a={feature:e,geometry:t,depth:[s],index:s,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length-1;s<r;++s){const o=n.slice(s,s+2),a={feature:e,geometry:t,index:s,segment:o};this.rBush_.insert(ft(o),a)}}writeMultiLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,l=o.length-1;a<l;++a){const h=o.slice(a,a+2),c={feature:e,geometry:t,depth:[s],index:a,segment:h};this.rBush_.insert(ft(h),c)}}}writePolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,l=o.length-1;a<l;++a){const h=o.slice(a,a+2),c={feature:e,geometry:t,depth:[s],index:a,segment:h};this.rBush_.insert(ft(h),c)}}}writeMultiPolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const o=n[s];for(let a=0,l=o.length;a<l;++a){const h=o[a];for(let c=0,u=h.length-1;c<u;++c){const d=h.slice(c,c+2),f={feature:e,geometry:t,depth:[a,s],index:c,segment:d};this.rBush_.insert(ft(d),f)}}}}writeCircleGeometry_(e,t){const n=t.getCenter(),s={feature:e,geometry:t,index:bf,segment:[n,n]},r={feature:e,geometry:t,index:Fr,segment:[n,n]},o=[s,r];s.featureSegments=o,r.featureSegments=o,this.rBush_.insert(br(n),s);let a=t;this.rBush_.insert(a.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const n=t.getGeometriesArray();for(let s=0;s<n.length;++s){const r=n[s],o=this.SEGMENT_WRITERS_[r.getType()];o(e,r)}}createOrUpdateVertexFeature_(e,t,n,s){let r=this.vertexFeature_;return r?r.getGeometry().setCoordinates(e):(r=new Pt(new Zt(e)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r)),r.set("features",t),r.set("geometries",n),r.set("existing",s),r}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==Te.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Te.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==Te.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const t=this.vertexFeature_;if(!t)return;this.getMap().getView().getProjection();const n=[],s=t.getGeometry().getCoordinates(),r=ft([s]),o=this.rBush_.getInExtent(r),a={};o.sort(kR);for(let l=0,h=o.length;l<h;++l){const c=o[l],u=c.segment;let d=ne(c.geometry);const f=c.depth;if(f&&(d+="-"+f.join("-")),a[d]||(a[d]=new Array(2)),c.geometry.getType()==="Circle"&&c.index===Fr){const g=Lf(e,c);gt(g,s)&&!a[d][0]&&(this.dragSegments_.push([c,0]),a[d][0]=c);continue}if(gt(u[0],s)&&!a[d][0]){this.dragSegments_.push([c,0]),a[d][0]=c;continue}if(gt(u[1],s)&&!a[d][1]){if(a[d][0]&&a[d][0].index===0){let g=c.geometry.getCoordinates();switch(c.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":g=g[f[1]];case"Polygon":if(c.index!==g[f[0]].length-2)continue;break}}this.dragSegments_.push([c,1]),a[d][1]=c;continue}ne(u)in this.vertexSegments_&&!a[d][0]&&!a[d][1]&&n.push(c)}return n}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([r])=>r));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],n=[],s=[];for(let r=0,o=this.dragSegments_.length;r<o;++r){const a=this.dragSegments_[r],l=a[0],h=l.feature;n.includes(h)||n.push(h);const c=l.geometry;s.includes(c)||s.push(c);const u=l.depth;let d;const f=l.segment,g=a[1];for(;t.length<c.getStride();)t.push(f[g][t.length]);switch(c.getType()){case"Point":d=t,f[0]=t,f[1]=t;break;case"MultiPoint":d=c.getCoordinates(),d[l.index]=t,f[0]=t,f[1]=t;break;case"LineString":d=c.getCoordinates(),d[l.index+g]=t,f[g]=t;break;case"MultiLineString":d=c.getCoordinates(),d[u[0]][l.index+g]=t,f[g]=t;break;case"Polygon":d=c.getCoordinates(),d[u[0]][l.index+g]=t,f[g]=t;break;case"MultiPolygon":d=c.getCoordinates(),d[u[1]][u[0]][l.index+g]=t,f[g]=t;break;case"Circle":const _=c;if(f[0]=t,f[1]=t,l.index===bf)this.changingFeature_=!0,_.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let m=ua(Be(_.getCenter()),Be(t));_.setRadius(m),this.changingFeature_=!1}break}d&&this.setGeometryCoordinates_(c,d)}this.createOrUpdateVertexFeature_(t,n,s,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,n=this.findInsertVerticesAndUpdateDragSegments_(t);if(n?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,n),this.vertexFeature_)){const s=this.vertexFeature_.getGeometry().getCoordinates();for(let r=n.length-1;r>=0;--r)this.insertVertex_(n[r],s);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const n=this.dragSegments_[t][0],s=n.geometry;if(s.getType()==="Circle"){const r=s,o=r.getCenter(),a=n.featureSegments[0],l=n.featureSegments[1];a.segment[0]=o,a.segment[1]=o,l.segment[0]=o,l.segment[1]=o,this.rBush_.update(br(o),a);let h=r;this.rBush_.update(h.getExtent(),l)}else this.rBush_.update(ft(n.segment),n)}return this.featuresBeingModified_&&(this.dispatchEvent(new rc(sc.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const t=this.getMap(),n=t.getPixelFromCoordinate(e);t.getView().getProjection();const s=function(a,l){return Pf(e,a)-Pf(e,l)};let r,o;if(this.hitDetection_){const a=typeof this.hitDetection_=="object"?l=>l===this.hitDetection_:void 0;t.forEachFeatureAtPixel(n,(l,h,c)=>{c&&c.getType()==="Point"&&(c=new Zt(fn(c.getCoordinates())));const u=c||l.getGeometry();if(u&&u.getType()==="Point"&&l instanceof Pt&&this.features_.getArray().includes(l)){o=u;const d=l.getGeometry().getFlatCoordinates().slice(0,2);r=[{feature:l,geometry:o,segment:[d,d]}]}return!0},{layerFilter:a})}if(!r){const a=ei(br(e,Af)),l=t.getView().getResolution()*this.pixelTolerance_,h=Wa(ka(a,l,Af));r=this.rBush_.getInExtent(h)}if(r&&r.length>0){const a=r.sort(s)[0],l=a.segment;let h=Lf(e,a);const c=t.getPixelFromCoordinate(h);let u=ua(n,c);if(o||u<=this.pixelTolerance_){const d={};if(d[ne(l)]=!0,this.snapToPointer_||(this.delta_[0]=h[0]-e[0],this.delta_[1]=h[1]-e[1]),a.geometry.getType()==="Circle"&&a.index===Fr)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h,[a.feature],[a.geometry],this.snappedToVertex_);else{const f=t.getPixelFromCoordinate(l[0]),g=t.getPixelFromCoordinate(l[1]),_=Ms(c,f),m=Ms(c,g);if(u=Math.sqrt(Math.min(_,m)),this.snappedToVertex_=u<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(h=_>m?l[1]:l[0]),this.createOrUpdateVertexFeature_(h,[a.feature],[a.geometry],this.snappedToVertex_);const y={};y[ne(a.geometry)]=!0;for(let p=1,x=r.length;p<x;++p){const E=r[p].segment;if(gt(l[0],E[0])&&gt(l[1],E[1])||gt(l[0],E[1])&&gt(l[1],E[0])){const T=ne(r[p].geometry);T in y||(y[T]=!0,d[ne(E)]=!0)}else break}}this.vertexSegments_=d;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const n=e.segment,s=e.feature,r=e.geometry,o=e.depth,a=e.index;let l;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"Polygon":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"MultiPolygon":l=r.getCoordinates(),l[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":l=r.getCoordinates(),l.splice(a+1,0,t);break;default:return!1}this.setGeometryCoordinates_(r,l);const h=this.rBush_;h.remove(e),this.updateSegmentIndices_(r,a,o,1);const c={segment:[n[0],t],feature:s,geometry:r,depth:o,index:a};h.insert(ft(c.segment),c),this.dragSegments_.push([c,1]);const u={segment:[t,n[1]],feature:s,geometry:r,depth:o,index:a+1};return h.insert(ft(u.segment),u),this.dragSegments_.push([u,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){const e=this.vertexFeature_?.getGeometry().getCoordinates();return e?fn(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(n=>n.getType()==="Circle"||n.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(ft([e])).some(({segment:n})=>gt(n[0],e)||gt(n[1],e))}removePoint(e){if(e&&(e=Be(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=Te.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([s])=>s));const n=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new rc(sc.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,n}return!1}removeVertex_(){const e=this.dragSegments_,t={};let n=!1,s,r,o,a,l,h,c,u,d,f,g;for(l=e.length-1;l>=0;--l)o=e[l],f=o[0],g=ne(f.feature),f.depth&&(g+="-"+f.depth.join("-")),g in t||(t[g]={}),o[1]===0?(t[g].right=f,t[g].index=f.index):o[1]==1&&(t[g].left=f,t[g].index=f.index+1);for(g in t){switch(d=t[g].right,c=t[g].left,h=t[g].index,u=h-1,c!==void 0?f=c:f=d,u<0&&(u=0),a=f.geometry,r=a.getCoordinates(),s=r,n=!1,a.getType()){case"MultiLineString":r[f.depth[0]].length>2&&(r[f.depth[0]].splice(h,1),n=!0);break;case"LineString":r.length>2&&(r.splice(h,1),n=!0);break;case"MultiPolygon":s=s[f.depth[1]];case"Polygon":s=s[f.depth[0]],s.length>4&&(h==s.length-1&&(h=0),s.splice(h,1),n=!0,h===0&&(s.pop(),s.push(s[0]),u=s.length-1));break}if(n){this.setGeometryCoordinates_(a,r);const _=[];if(c!==void 0&&(this.rBush_.remove(c),_.push(c.segment[0])),d!==void 0&&(this.rBush_.remove(d),_.push(d.segment[1])),c!==void 0&&d!==void 0){const m={depth:f.depth,feature:f.feature,geometry:f.geometry,index:u,segment:_};this.rBush_.insert(ft(m.segment),m)}this.updateSegmentIndices_(a,h,f.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return n}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(n=>n.getType()==="Circle"||n.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(ft([e])).some(({segment:n})=>!(gt(n[0],e)||gt(n[1],e)))}insertPoint(e){const t=e?Be(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((s,r)=>s||this.insertVertex_(r,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,n,s){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(n===void 0||r.depth===void 0||zi(r.depth,n))&&r.index>t&&(r.index+=s)})}}function kR(i,e){return i.index-e.index}function Pf(i,e,t){const n=e.geometry;if(n.getType()==="Circle"){let r=n;if(e.index===Fr){const o=Ms(r.getCenter(),Be(i)),a=Math.sqrt(o)-r.getRadius();return a*a}}const s=Be(i);return bs[0]=Be(e.segment[0]),bs[1]=Be(e.segment[1]),Oy(s,bs)}function Lf(i,e,t){const n=e.geometry;if(n.getType()==="Circle"&&e.index===Fr)return fn(n.getClosestPoint(Be(i)));const s=Be(i);return bs[0]=Be(e.segment[0]),bs[1]=Be(e.segment[1]),fn(Zg(s,bs))}function UR(){const i=Zh();return function(e,t){return i.Point}}const BR={SELECT:"select"};class XR extends qt{constructor(e,t,n,s){super(e),this.selected=t,this.deselected=n,this.mapBrowserEvent=s}}const Ho={};class xu extends Ys{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:T_,this.addCondition_=e.addCondition?e.addCondition:Lc,this.removeCondition_=e.removeCondition?e.removeCondition:Lc,this.toggleCondition_=e.toggleCondition?e.toggleCondition:Xh,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:un,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:jR(),this.features_=e.features||new Nt;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const n=e.layers;t=function(s){return n.includes(s)}}else t=un;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[ne(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[ne(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(Ye.ADD,this.boundAddFeature_),this.features_.addEventListener(Ye.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(Ye.ADD,this.boundAddFeature_),this.features_.removeEventListener(Ye.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const n=this.getMap().getAllLayers().find(function(s){if(s instanceof io&&s.getSource()&&s.getSource().hasFeature(t))return s});n&&this.addFeatureLayerAssociation_(t,n)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=ne(e);t in Ho||(Ho[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let s=t.length-1;s>=0;--s){const r=t[s];if(r!==this&&r instanceof xu&&r.getStyle()&&r.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(r.getStyle());return}}const n=ne(e);e.setStyle(Ho[n]),delete Ho[n]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[ne(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),n=this.removeCondition_(e),s=this.toggleCondition_(e),r=!t&&!n&&!s,o=e.map,a=this.getFeatures(),l=[],h=[];if(r){Xn(this.featureLayerAssociation_),o.forEachFeatureAtPixel(e.pixel,(c,u)=>{if(!(!(c instanceof Pt)||!this.filter_(c,u)))return this.addFeatureLayerAssociation_(c,u),h.push(c),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=a.getLength()-1;c>=0;--c){const u=a.item(c),d=h.indexOf(u);d>-1?h.splice(d,1):(a.remove(u),l.push(u))}h.length!==0&&a.extend(h)}else{o.forEachFeatureAtPixel(e.pixel,(c,u)=>{if(!(!(c instanceof Pt)||!this.filter_(c,u)))return(t||s)&&!a.getArray().includes(c)?(this.addFeatureLayerAssociation_(c,u),h.push(c)):(n||s)&&a.getArray().includes(c)&&(l.push(c),this.removeFeatureLayerAssociation_(c)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=l.length-1;c>=0;--c)a.remove(l[c]);a.extend(h)}return(h.length>0||l.length>0)&&this.dispatchEvent(new XR(BR.SELECT,h,l,e)),!0}}function jR(){const i=Zh();return $t(i.Polygon,i.LineString),$t(i.GeometryCollection,i.LineString),function(e){return e.getGeometry()?i[e.getGeometry().getType()]:null}}class zR{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Pt,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let n=t.dataProjection?ke(t.dataProjection):this.readProjection(e);t.extent&&n&&n.getUnits()==="tile-pixels"&&(n=ke(n),n.setWorldExtent(t.extent)),t={dataProjection:n,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return ce()}readFeature(e,t){return ce()}readFeatures(e,t){return ce()}readGeometry(e,t){return ce()}readProjection(e){return ce()}writeFeature(e,t){return ce()}writeFeatures(e,t){return ce()}writeGeometry(e,t){return ce()}}function Tu(i,e,t){const n=t?ke(t.featureProjection):null,s=t?ke(t.dataProjection):null;let r=i;if(n&&s&&!kn(n,s)){e&&(r=i.clone());const o=e?n:s,a=e?s:n;o.getUnits()==="tile-pixels"?r.transform(o,a):r.applyTransform(Vr(o,a))}if(e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};r===i&&(r=i.clone()),r.applyTransform(a)}return r}const VR={Point:Zt,LineString:pi,Polygon:Ti,MultiPoint:po,MultiLineString:Us,MultiPolygon:Bs};function WR(i,e,t){return Array.isArray(e[0])?(p_(i,0,e,t)||(i=i.slice(),vc(i,0,e,t)),i):(Fh(i,0,e,t)||(i=i.slice(),ma(i,0,e,t)),i)}function Um(i,e){const t=i.geometry;if(!t)return[];if(Array.isArray(t))return t.map(r=>Um({...i,geometry:r})).flat();const n=t.type==="MultiPolygon"?"Polygon":t.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);const s=t.layout.length;return Tu(new Dt(n,n==="Polygon"?WR(t.flatCoordinates,t.ends,s):t.flatCoordinates,t.ends?.flat(),s,i.properties||{},i.id).enableSimplifyTransformed(),!1,e)}function Cu(i,e){if(!i)return null;if(Array.isArray(i)){const n=i.map(s=>Cu(s,e));return new no(n)}const t=VR[i.type];return Tu(new t(i.flatCoordinates,i.layout||"XY",i.ends),!1,e)}class KR extends zR{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(Zo(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(Zo(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return ce()}readFeaturesFromObject(e,t){return ce()}readGeometry(e,t){return this.readGeometryFromObject(Zo(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return ce()}readProjection(e){return this.readProjectionFromObject(Zo(e))}readProjectionFromObject(e){return ce()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return ce()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return ce()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return ce()}}function Zo(i){if(typeof i=="string"){const e=JSON.parse(i);return e||null}return i!==null?i:null}class YR extends KR{constructor(e){e=e||{},super(),this.dataProjection=ke(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=ke(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let n=null;e.type==="Feature"?n=e:n={type:"Feature",geometry:e,properties:null};const s=wu(n.geometry);if(this.featureClass===Dt)return Um({geometry:s,id:n.id,properties:n.properties},t);const r=new Pt;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&r.setGeometryName(n.geometry_name),r.setGeometry(Cu(s,t)),"id"in n&&r.setId(n.id),n.properties&&r.setProperties(n.properties,!0),r}readFeaturesFromObject(e,t){const n=e;let s=null;if(n.type==="FeatureCollection"){const r=e;s=[];const o=r.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],t);h&&s.push(h)}}else s=[this.readFeatureFromObject(e,t)];return s.flat()}readGeometryFromObject(e,t){return $R(e,t)}readProjectionFromObject(e){const t=e.crs;let n;if(t)if(t.type=="name")n=ke(t.properties.name);else if(t.type==="EPSG")n=ke("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={type:"Feature",geometry:null,properties:null},s=e.getId();if(s!==void 0&&(n.id=s),!e.hasProperties())return n;const r=e.getProperties(),o=e.getGeometry();return o&&(n.geometry=Wc(o,t),delete r[e.getGeometryName()]),Un(r)||(n.properties=r),n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let s=0,r=e.length;s<r;++s)n.push(this.writeFeatureObject(e[s],t));return{type:"FeatureCollection",features:n}}writeGeometryObject(e,t){return Wc(e,this.adaptOptions(t))}}function wu(i,e){if(!i)return null;let t;switch(i.type){case"Point":{t=ZR(i);break}case"LineString":{t=qR(i);break}case"Polygon":{t=tS(i);break}case"MultiPoint":{t=QR(i);break}case"MultiLineString":{t=JR(i);break}case"MultiPolygon":{t=eS(i);break}case"GeometryCollection":{t=HR(i);break}default:throw new Error("Unsupported GeoJSON type: "+i.type)}return t}function $R(i,e){const t=wu(i);return Cu(t,e)}function HR(i,e){return i.geometries.map(function(n){return wu(n)})}function ZR(i){const e=i.coordinates;return{type:"Point",flatCoordinates:e,layout:zn(e.length)}}function qR(i){const e=i.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:zn(e[0]?.length||2)}}function JR(i){const e=i.coordinates,t=e[0]?.[0]?.length||2,n=[],s=fo(n,0,e,t);return{type:"MultiLineString",flatCoordinates:n,ends:s,layout:zn(t)}}function QR(i){const e=i.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:zn(e[0]?.length||2)}}function eS(i){const e=i.coordinates,t=[],n=e[0]?.[0]?.[0].length||2,s=u_(t,0,e,n);return{type:"MultiPolygon",flatCoordinates:t,ends:s,layout:zn(n)}}function tS(i){const e=i.coordinates,t=[],n=e[0]?.[0]?.length,s=fo(t,0,e,n);return{type:"Polygon",flatCoordinates:t,ends:s,layout:zn(n)}}function Wc(i,e){i=Tu(i,!0,e);const t=i.getType();let n;switch(t){case"Point":{n=aS(i);break}case"LineString":{n=nS(i);break}case"Polygon":{n=lS(i,e);break}case"MultiPoint":{n=rS(i);break}case"MultiLineString":{n=sS(i);break}case"MultiPolygon":{n=oS(i,e);break}case"GeometryCollection":{n=iS(i,e);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return n}function iS(i,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:i.getGeometriesArray().map(function(n){return Wc(n,e)})}}function nS(i,e){return{type:"LineString",coordinates:i.getCoordinates()}}function sS(i,e){return{type:"MultiLineString",coordinates:i.getCoordinates()}}function rS(i,e){return{type:"MultiPoint",coordinates:i.getCoordinates()}}function oS(i,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:i.getCoordinates(t)}}function aS(i,e){return{type:"Point",coordinates:i.getCoordinates()}}function lS(i,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:i.getCoordinates(t)}}const cS={__name:"MapView",props:{mode:{type:String,required:!0},drawShape:{type:String,required:!0},layersConfig:{type:Array,default:()=>[]}},emits:["features","info","request-layer-sync","suggest-mode"],setup(i,{expose:e,emit:t}){const n=i,s=t,r=tn(null);let o,a,l,h,c,u,d,f,g=null;const _=tn(!1),m=new YR;function y(z){let N=2166136261;for(let J=0;J<z.length;J++)N^=z.charCodeAt(J),N=N+((N<<1)+(N<<4)+(N<<7)+(N<<8)+(N<<24))>>>0;return(N>>>0).toString(16)}function p(z){const N={...z.getProperties()};if(delete N.geometry,N.id!==void 0&&N.id!==null&&String(N.id)!=="")return String(N.id);const J=k(z),[te,ge]=md(J),Ce=Number.isFinite(ge)?ge.toFixed(6):"0",Re=Number.isFinite(te)?te.toFixed(6):"0",Jt=m.writeFeatureObject(z,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}).geometry,C=y(JSON.stringify(Jt)).slice(0,8),w=`${z.getGeometry().getType()}@${Ce},${Re}#${C}`;return z.set("id",w),w}function x(z){const N={...z.getProperties()};return delete N.geometry,N.id!==void 0&&N.id!==null&&String(N.id)!==""?String(N.id):p(z)}function E(){for(const z of l.getFeatures())p(z)}function T(z,N={dedupe:!0,prefer:"incoming"}){if(!l||!z)return;const J=R(z);if(J.length){if(E(),N.dedupe){const te=new Map;for(const ge of l.getFeatures())te.set(x(ge),ge);for(const ge of J){const Ce=x(ge);te.has(Ce)?N.prefer==="incoming"&&(l.removeFeature(te.get(Ce)),l.addFeature(ge),te.set(Ce,ge)):(l.addFeature(ge),te.set(Ce,ge))}}else{for(const te of J)p(te);l.addFeatures(J)}G()}}function R(z){try{return z.type==="FeatureCollection"?m.readFeatures(z,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}):z.type==="Feature"?[m.readFeature(z,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})]:[]}catch{return[]}}function I(){L({type:"FeatureCollection",features:[]})}function S(){return m.writeFeaturesObject(l.getFeatures(),{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})}const A=new Map;function b(z,N){if(!_.value||!o)return;const J=A.get(z);J&&J.setVisible(!!N)}function X(z,N,J=13){o.getView().animate({zoom:7,duration:250},{center:_d([N,z]),duration:650},{zoom:J,duration:300})}function O(z={}){if(!g)return null;const N={...g.getProperties()};delete N.geometry;const J={...N,...z};g.setProperties(J),G();const te=k(g),{lat:ge,lon:Ce}=ue(te),Re=m.writeFeatureObject(g,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});return s("info",{visible:!0,lat:ge,lon:Ce,feature:Re}),Re}function B(){return g?(l.removeFeature(g),u.getFeatures().clear(),g=null,G(),s("info",{visible:!1,lat:0,lon:0,feature:null}),!0):!1}e({loadGeoJSON:T,clearFeatures:I,getFeaturesFC:S,setLayerVisibility:b,flyTo:X,updateSelectedFeatureProps:O,deleteSelectedFeature:B});function K(){return new Lt({image:new Hs({radius:6,fill:new _i({color:"#ffffff"}),stroke:new mi({color:"#000",width:2})})})}function Y(){return new Lt({stroke:new mi({color:"#ffff00",width:2}),fill:new _i({color:"rgba(0,0,0,0)"})})}function W(){return new Lt({text:new il({text:"",font:"bold 24px sans-serif",fill:new _i({color:"#ffffff"}),stroke:new mi({color:"#000",width:3})})})}function k(z){const N=z.getGeometry(),J=N.getType();if(J==="Point")return N.getCoordinates();if(J==="LineString")return N.getCoordinateAt(.5);if(J==="Polygon")return N.getInteriorPoint().getCoordinates();try{return xi(N.getExtent())}catch{return N.getFirstCoordinate()}}function G(){s("features",S())}function q(){if(!_.value||!u||!d)return;const z=n.mode==="modify",N=n.mode==="draw";u.setActive(!N||z),d.setActive(z),f&&(o.removeInteraction(f),f=null),N&&(f=new DR({source:l,type:n.drawShape}),o.addInteraction(f),f.on("drawend",J=>{rg(()=>G());const te=J.feature;p(te),g=te;const ge=u.getFeatures();ge.clear(),ge.push(te);const Ce=k(te),{lat:Re,lon:Jt}=ue(Ce),C=m.writeFeatureObject(te,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});s("info",{visible:!0,lat:Re,lon:Jt,feature:C}),s("suggest-mode",{mode:"modify"})}))}function Q(){if(!(!_.value||!o)){o.getLayers().getArray().slice().forEach(z=>{z!==a&&z!==h&&o.removeLayer(z)}),A.clear();for(const z of n.layersConfig){const N=re(z);N&&(N.setVisible(!!z.visible),o.addLayer(N),A.set(z.id,N))}}}function re(z){const{type:N,url:J,attributionText:te,attributionUrl:ge,maxZoom:Ce}=z;return N==="osm"?new Yd({source:new Iw}):N==="satellite"?new Yd({source:new ym({url:J,attributions:te&&ge?`Tiles  <a href="${ge}">${te}</a>`:te||"",maxZoom:Ce})}):N==="geotiff"?new om({source:new AR({sources:[{url:J}],attributions:te||""})}):(console.warn("Unknown layer type:",N),null)}function L(z){if(l.clear(),z?.features?.length){const N=m.readFeatures(z,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});for(const J of N)p(J);l.addFeatures(N)}G()}function ue(z){const[N,J]=md(z);return{lat:J,lon:N}}return fg(()=>{l=new Sa,a=new io({source:l,style:z=>z.getGeometry().getType()==="Point"?K():Y(),zIndex:1e3}),c=new Sa,h=new io({source:c,style:W(),zIndex:1100}),o=new OT({target:r.value,layers:[a,h],view:new ui({center:_d([115.367526,-8.129998]),zoom:18}),controls:y_().extend([new LR({units:"metric",bar:!0,steps:6,minWidth:180})])}),u=new xu,d=new NR({source:l}),d.setActive(!1),o.addInteraction(u),o.addInteraction(d),l.on("addfeature",G),l.on("changefeature",G),l.on("removefeature",G),u.on("select",z=>{if(g=z.selected[0]||null,!g){n.mode==="modify"&&s("info",{visible:!1,lat:0,lon:0,feature:null});return}const N=k(g),{lat:J,lon:te}=ue(N),ge=m.writeFeatureObject(g,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"});s("info",{visible:!0,lat:J,lon:te,feature:ge})}),o.on("singleclick",z=>{c.clear();const N=o.forEachFeatureAtPixel(z.pixel,J=>J,{layerFilter:J=>J===a});if(n.mode==="browse"){const J=N?k(N):z.coordinate,{lat:te,lon:ge}=ue(J);N||c.addFeature(new Pt(new Zt(z.coordinate)));const Ce=N?m.writeFeatureObject(N,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}):null;s("info",{visible:!0,lat:te,lon:ge,feature:Ce})}}),q(),Q(),_.value=!0,s("request-layer-sync")}),Cs(()=>[n.mode,n.drawShape],()=>q()),Cs(()=>n.layersConfig,()=>Q()),gg(()=>{o&&o.setTarget(void 0)}),(z,N)=>(Ue(),ze("div",{ref_key:"mapEl",ref:r,style:{height:"100%",width:"100%"}},null,512))}},hS={class:"topbar"},uS={class:"group",role:"toolbar","aria-label":"Mode"},dS=["aria-pressed"],fS=["aria-pressed"],gS=["aria-pressed"],_S={class:"group","aria-label":"Draw type"},mS=["aria-pressed"],pS=["aria-pressed"],yS=["aria-pressed"],ES={__name:"TopBar",props:{mode:{type:String,required:!0},drawShape:{type:String,required:!0}},emits:["change"],setup(i,{emit:e}){const t=e;function n(r){t("change",{mode:r})}function s(r){t("change",{mode:"draw",drawShape:r})}return(r,o)=>(Ue(),ze("div",hS,[ee("div",uS,[ee("button",{class:"iconbtn","aria-pressed":i.mode==="browse",onClick:o[0]||(o[0]=a=>n("browse")),title:"Select"},"",8,dS),ee("button",{class:"iconbtn","aria-pressed":i.mode==="modify",onClick:o[1]||(o[1]=a=>n("modify")),title:"Modify"},"",8,fS),ee("button",{class:"iconbtn","aria-pressed":i.mode==="draw",onClick:o[2]||(o[2]=a=>n("draw")),title:"Draw"},"",8,gS)]),Pn(ee("div",_S,[ee("button",{class:"chip","aria-pressed":i.drawShape==="Point",onClick:o[3]||(o[3]=a=>s("Point"))},"",8,mS),ee("button",{class:"chip","aria-pressed":i.drawShape==="LineString",onClick:o[4]||(o[4]=a=>s("LineString"))},"",8,pS),ee("button",{class:"chip","aria-pressed":i.drawShape==="Polygon",onClick:o[5]||(o[5]=a=>s("Polygon"))},"",8,yS)],512),[[B0,i.mode==="draw"]])]))}},xS={style:{"margin-top":".5rem",display:"flex",gap:".5rem","flex-wrap":"wrap"}},TS=["disabled"],CS=["disabled"],wS={style:{"margin-top":".5rem"}},RS={key:0,class:"list"},SS=["onClick"],vS={key:1,style:{opacity:".7",padding:".5rem 0"}},IS={open:""},bS={style:{"margin-top":".35rem"}},AS=["checked","onChange"],PS={style:{"margin-top":".5rem"}},LS={__name:"ToolsDrawer",props:{open:{type:Boolean,default:!1},layers:{type:Array,default:()=>[]},hasFeatures:{type:Boolean,default:!1},manifestUrl:{type:String,default:""}},emits:["close","toggle-layer","load-geojson","save-geojson","clear-geojson","refresh-manifest","fly-to"],setup(i,{emit:e}){const t=e,n=tn(null),s=tn(""),r=tn(!1),o=tn([]);function a(c){const u=c.target.files?.[0];if(!u)return;const d=new FileReader;d.onload=()=>{try{const f=JSON.parse(d.result);if(f?.type!=="FeatureCollection")throw new Error("Must be a GeoJSON FeatureCollection");t("load-geojson",f)}catch(f){alert("Error loading GeoJSON: "+f.message)}finally{n.value.value=""}},d.readAsText(u)}let l;async function h(){clearTimeout(l);const c=s.value.trim();if(c.length<3){o.value=[];return}l=setTimeout(async()=>{r.value=!0;try{const u=`https://nominatim.openstreetmap.org/search?format=json&limit=6&q=${encodeURIComponent(c)}`,d=await fetch(u,{headers:{"Accept-Language":navigator.language||"en"}});o.value=d.ok?await d.json():[]}catch{o.value=[]}finally{r.value=!1}},350)}return(c,u)=>(Ue(),ze("aside",{class:Pa(["drawer",{open:i.open}]),onKeydown:u[6]||(u[6]=ry(ny(d=>t("close"),["stop","prevent"]),["esc"]))},[ee("header",null,[u[7]||(u[7]=ee("strong",null,"Tools",-1)),ee("button",{class:"iconbtn",onClick:u[0]||(u[0]=d=>t("close"))},"")]),ee("section",null,[ee("details",null,[u[8]||(u[8]=ee("summary",null,"Load / Save",-1)),ee("div",xS,[ee("button",{class:"chip",disabled:!i.hasFeatures,onClick:u[1]||(u[1]=d=>t("save-geojson"))}," Save GeoJSON",8,TS),ee("button",{class:"chip",onClick:u[2]||(u[2]=d=>n.value.click())}," Load GeoJSON"),ee("input",{ref_key:"fileEl",ref:n,type:"file",accept:".geojson,.json",class:"hidden",onChange:a},null,544),ee("button",{class:"chip",disabled:!i.hasFeatures,onClick:u[3]||(u[3]=d=>t("clear-geojson"))}," Clear all",8,CS)])]),ee("details",null,[u[9]||(u[9]=ee("summary",null,"Search / Fly-to",-1)),ee("div",wS,[Pn(ee("input",{type:"search",placeholder:"Search places (Nominatim)","onUpdate:modelValue":u[4]||(u[4]=d=>s.value=d),onInput:h},null,544),[[rs,s.value]]),o.value.length?(Ue(),ze("div",RS,[(Ue(!0),ze(mt,null,uc(o.value,d=>(Ue(),ze("button",{key:d.place_id,onClick:f=>{t("fly-to",parseFloat(d.lat),parseFloat(d.lon),15),o.value=[]}},zt(d.display_name),9,SS))),128))])):r.value?(Ue(),ze("div",vS,"Searching")):Ai("",!0)])]),ee("details",IS,[u[10]||(u[10]=ee("summary",null,"Layers",-1)),ee("div",bS,[(Ue(!0),ze(mt,null,uc(i.layers,d=>(Ue(),ze("div",{class:"switch",key:d.id},[ee("input",{type:"checkbox",checked:!!d.visible,onChange:f=>t("toggle-layer",d.id,f.target.checked)},null,40,AS),ee("label",null,zt(d.label||d.id),1)]))),128)),ee("div",PS,[ee("button",{class:"chip",onClick:u[5]||(u[5]=d=>t("refresh-manifest"))}," Reload manifest")])])])])],34))}},MS=(i,e)=>{const t=i.__vccOpts||i;for(const[n,s]of e)t[n]=s;return t},FS={class:"info",role:"dialog","aria-label":"Map info"},DS={class:"info__coords"},OS={class:"info__section"},GS={class:"info__title"},NS={key:0,class:"info__descr"},kS={key:1,class:"info__tags"},US={key:2,class:"info__dates"},BS={key:0},XS={key:1},jS={class:"info__raw"},zS={class:"info__section"},VS={class:"field"},WS={class:"field"},KS={class:"field"},YS={class:"grid2"},$S={class:"field"},HS={class:"field"},ZS={key:0,class:"info__raw"},qS={__name:"InfoToast",props:{mode:{type:String,required:!0},lat:{type:Number,required:!0},lon:{type:Number,required:!0},feature:{type:Object,default:null}},emits:["close","save-props","delete"],setup(i,{emit:e}){const t=i,n=e,s=bn(()=>t.feature?.properties??null),r=bn(()=>s.value?.name||s.value?.id||"Selected feature"),o=bn(()=>s.value?.description||""),a=bn(()=>{const g=s.value?.tags;return g?Array.isArray(g)?g:String(g).split(",").map(_=>_.trim()).filter(Boolean):[]}),l=bn(()=>({added:s.value?.dateAdded||"",removed:s.value?.dateRemoved||""})),h=bn(()=>t.mode==="modify"&&!!t.feature),c=As({name:"",description:"",tags:"",dateAdded:"",dateRemoved:""});Cs(()=>t.feature,g=>{const _=g?.properties||{};c.name=_.name||"",c.description=_.description||"",c.tags=Array.isArray(_.tags)?_.tags.join(", "):_.tags||"",c.dateAdded=_.dateAdded||"",c.dateRemoved=_.dateRemoved||""},{immediate:!0});function u(g){return typeof g=="number"&&isFinite(g)?g.toFixed(6):String(g??"")}function d(){const g={};c.name!==""&&(g.name=c.name),c.description!==""&&(g.description=c.description);const _=c.tags.split(",").map(m=>m.trim()).filter(Boolean);_.length&&(g.tags=_),c.dateAdded!==""&&(g.dateAdded=c.dateAdded),c.dateRemoved!==""&&(g.dateRemoved=c.dateRemoved),n("save-props",g)}function f(){n("delete")}return(g,_)=>(Ue(),ze("div",FS,[ee("div",DS,[ee("span",null,"Lon/Lat: [ "+zt(u(i.lon))+", "+zt(u(i.lat))+" ]",1),ee("button",{class:"iconbtn info__close",onClick:_[0]||(_[0]=m=>n("close")),"aria-label":"Close"},"")]),h.value?(Ue(),ze(mt,{key:1},[ee("div",zS,[ee("div",{class:"actions"},[ee("button",{class:"chip",onClick:d}," Save"),ee("button",{class:"chip danger",onClick:f}," Delete")]),ee("label",VS,[_[7]||(_[7]=ee("span",{class:"label"},"Name",-1)),Pn(ee("input",{type:"text","onUpdate:modelValue":_[1]||(_[1]=m=>c.name=m),placeholder:""},null,512),[[rs,c.name]])]),ee("label",WS,[_[8]||(_[8]=ee("span",{class:"label"},"Description",-1)),Pn(ee("textarea",{"onUpdate:modelValue":_[2]||(_[2]=m=>c.description=m),rows:"2",placeholder:""},null,512),[[rs,c.description]])]),ee("label",KS,[_[9]||(_[9]=ee("span",{class:"label"},"Tags (comma separated)",-1)),Pn(ee("input",{type:"text","onUpdate:modelValue":_[3]||(_[3]=m=>c.tags=m),placeholder:"reef, coral, site-42"},null,512),[[rs,c.tags]])]),ee("div",YS,[ee("label",$S,[_[10]||(_[10]=ee("span",{class:"label"},"Date added",-1)),Pn(ee("input",{type:"text","onUpdate:modelValue":_[4]||(_[4]=m=>c.dateAdded=m),placeholder:"YYYY-MM-DD"},null,512),[[rs,c.dateAdded]])]),ee("label",HS,[_[11]||(_[11]=ee("span",{class:"label"},"Date removed",-1)),Pn(ee("input",{type:"text","onUpdate:modelValue":_[5]||(_[5]=m=>c.dateRemoved=m),placeholder:"YYYY-MM-DD"},null,512),[[rs,c.dateRemoved]])])])]),i.feature?(Ue(),ze("details",ZS,[_[12]||(_[12]=ee("summary",null,"Feature JSON",-1)),ee("pre",null,[ee("code",null,zt(JSON.stringify(i.feature,null,2)),1)])])):Ai("",!0)],64)):(Ue(),ze(mt,{key:0},[i.feature&&s.value?(Ue(),ze(mt,{key:0},[ee("div",OS,[ee("div",GS,zt(r.value),1),o.value?(Ue(),ze("div",NS,zt(o.value),1)):Ai("",!0),a.value.length?(Ue(),ze("div",kS,[(Ue(!0),ze(mt,null,uc(a.value,m=>(Ue(),ze("span",{class:"tag",key:m},"#"+zt(m),1))),128))])):Ai("",!0),l.value.added||l.value.removed?(Ue(),ze("div",US,[l.value.added?(Ue(),ze("small",BS,"added: "+zt(l.value.added),1)):Ai("",!0),l.value.removed?(Ue(),ze("small",XS,"  removed: "+zt(l.value.removed),1)):Ai("",!0)])):Ai("",!0)]),ee("details",jS,[_[6]||(_[6]=ee("summary",null,"Feature JSON",-1)),ee("pre",null,[ee("code",null,zt(JSON.stringify(i.feature,null,2)),1)])])],64)):Ai("",!0)],64))]))}},JS=MS(qS,[["__scopeId","data-v-ebdddc60"]]),QS={class:"app"},ev={__name:"App",setup(i){const e=tn(null),t=tn(!1),n=As({mode:"browse",drawShape:"Point",manifestUrl:"https://dinamap-les.s3.ap-southeast-1.amazonaws.com/metadata/layers_202507200627.json",layersConfig:[],features:{type:"FeatureCollection",features:[]}}),s=As({visible:!1,lat:0,lon:0,feature:null});function r({mode:y,drawShape:p}){n.mode=y,p&&(n.drawShape=p)}async function o(){try{const y=await fetch(n.manifestUrl,{cache:"no-store"});if(!y.ok)throw new Error("HTTP "+y.status);const p=await y.json();n.layersConfig=p.layers||[]}catch{n.layersConfig=[{id:"osm",type:"osm",label:"OpenStreetMap",visible:!0}]}}function a(y){n.features=y}function l(y){s.visible=!!y.visible,s.lat=y.lat??0,s.lon=y.lon??0,s.feature=y.feature??null}function h({mode:y}){y&&(n.mode=y)}function c(y){e.value?.loadGeoJSON(y)}function u(){const y=new Blob([JSON.stringify(n.features,null,2)],{type:"application/json"}),p=document.createElement("a");p.href=URL.createObjectURL(y),p.download=`features-${new Date().toISOString().slice(0,10)}.geojson`,p.click(),URL.revokeObjectURL(p.href)}function d(){e.value?.clearFeatures()}function f(y,p){e.value?.setLayerVisibility(y,p)}function g(y,p,x=15){e.value?.flyTo(y,p,x)}function _(y){const p=e.value?.updateSelectedFeatureProps(y);p&&(s.feature=p),n.mode="browse"}function m(){e.value?.deleteSelectedFeature()&&(n.mode="browse",s.visible=!1)}return(y,p)=>(Ue(),ze("div",QS,[Yt(ES,{mode:n.mode,"draw-shape":n.drawShape,onChange:r},null,8,["mode","draw-shape"]),ee("button",{class:"drawer-toggle iconbtn",onClick:p[0]||(p[0]=x=>t.value=!t.value),"aria-label":"Open tools"},""),Yt(LS,{open:t.value,layers:n.layersConfig,"has-features":n.features.features.length>0,"manifest-url":n.manifestUrl,onClose:p[1]||(p[1]=x=>t.value=!1),onRefreshManifest:o,onToggleLayer:f,onLoadGeojson:c,onSaveGeojson:u,onClearGeojson:d,onFlyTo:g},null,8,["open","layers","has-features","manifest-url"]),Yt(cS,{ref_key:"mapRef",ref:e,class:"map-wrap",mode:n.mode,"draw-shape":n.drawShape,"layers-config":n.layersConfig,onFeatures:a,onInfo:l,onRequestLayerSync:o,onSuggestMode:h},null,8,["mode","draw-shape","layers-config"]),s.visible?(Ue(),Dg(JS,{key:0,mode:n.mode,lat:s.lat,lon:s.lon,feature:s.feature,onClose:p[2]||(p[2]=x=>s.visible=!1),onSaveProps:_,onDelete:m},null,8,["mode","lat","lon","feature"])):Ai("",!0)]))}};ly(ev).mount("#app");export{nv as L,sv as a,Lm as g};
